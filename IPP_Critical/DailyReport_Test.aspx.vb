Imports System.Data.SqlClient
Imports System.Data
Imports Dundas.Charting.WebControl.Chart
Imports System.Drawing
Imports Dundas.Charting.WebControl

Partial Class DailyReport_Test
    Inherits System.Web.UI.Page

    Private Structure yieldInfo
        Dim LotCount As String

        ' INTEL Column
        Dim TotalYieldWO_Inline As String
        Dim inLineyield As String
        Dim OSyield As String
        Dim Bumpyield As String
        Dim FVIyield As String
        Dim IPQC As String
        Dim Open4W As String
        Dim X6CAW As String
        Dim LE4W As String
        Dim Short4W As String
        Dim X24W As String
        Dim Land4W As String

        ' Non-INTEL Column
        Dim InLine As String
        Dim CCPin As String
        Dim PinCC As String
        Dim BumpAOI As String
        Dim WOS2 As String
        Dim WOS4 As String
        Dim FEOS As String
        Dim FEFVI As String
        Dim BEOS As String
        Dim BEFVI As String
        Dim Bump As String
        Dim C4 As String
        Dim FETOTAL As String
        Dim BETOTAL As String
        Dim BumpAOI_FluxClean As String
        Dim Land As String
        Dim Totalyield As String
    End Structure

    '*** 如果要加入新產品到此 ***
    ' 1. Customer_Prodction_Mapping 要加入相關 CustomerID 與 PartID
    ' 2. Yield_CATEGORY_Mapping 要加入要呈現的 Yield Type
    ' 3. yieldInfo Structure 要加入yield
    ' 4. getDateRangeData 與 generateDataSource 要加入判斷式
    Private confTable As String = "Customer_Prodction_Mapping"
    Private confTableRename As String = "Customer_Prodction_Mapping_BU_Rename"
    Private confTableRenameOrder As String = "Yield_CATEGORY_Order_Mapping"
    Private IsRename As Boolean = True
    Private IsRenameOrder As Boolean = True
    Private sWB As String = "WB"
    Private sWB_Rename As String = "PPS"

    Protected Sub Page_Load(sender As Object, e As System.EventArgs) Handles Me.Load
        Me.but_Execute.Attributes.Add("onclick", "javascript:document.getElementById('lab_wait').innerText='Please wait ......';" & _
                                                 "javascript:document.getElementById('but_Execute').disabled=true;" & _
                                                 Me.Page.GetPostBackEventReference(but_Execute))
        If Not Me.IsPostBack Then
            PageInit()
        End If
    End Sub

    ' 程式初始化
    Private Sub PageInit()
        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim categoryStr As String = ""
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        Try
            'listB_BumpingTypeSource.Enabled = False
            'listB_BumpingTypeShow.Enabled = False

            tr_BumpingType.Visible = False
            tr_OL_Process.Visible = False
            tr_Backend.Visible = False
            tr_chartDisplay.Visible = False
            tr_gvDisplay.Visible = False
            txtDateFrom.Text = DateTime.Now.AddDays(-1).ToString("yyyyMMdd")
            txtDateTo.Text = DateTime.Now.ToString("yyyyMMdd")

            rbl_BySource.Items(0).Enabled = True
            rbl_BySource.Items(1).Enabled = True

            conn.Open()

            ' --- Product Type (產品種類) ---
            If IsRename = False Then
                sqlStr = "select category from " + confTable + " where 1=1 "
            Else
                sqlStr = "select category from " + confTableRename + " where 1=1 "
            End If
            sqlStr += "and yield_function=1 "
            sqlStr += "group by category order by category DESC"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            UtilObj.FillController(myDT, ddl_ProductType, 0)

            ' --- Customer ID (廠商) ---
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                tr_Customer1.Visible = True
                tr_Customer2.Visible = False
            Else
                tr_Customer1.Visible = False
                tr_Customer2.Visible = True
            End If

            '================
            'Customer開放複選
            '================
            listB_CustomerIDSource.Items.Clear()
            listB_CustomerIDShow.Items.Clear()
            If IsRename = False Then
                sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
            Else
                sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
            End If
            sqlStr += "and a.yield_function=1 "
            ' --- Product Type ---
            sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            sqlStr += "group by a.customer_id order by a.customer_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            '================
            'Customer開放複選
            '================
            listB_CustomerIDSource.Items.Clear()
            listB_CustomerIDShow.Items.Clear()
            If ddl_ProductType.Text <> sWB_Rename Then
                UtilObj.FillController(myDT, ddl_CustomerID, 1)
            Else
                For i As Integer = 0 To myDT.Rows.Count - 1
                    Dim sData As String = myDT.Rows(i)("customer_id").ToString()
                    If sData <> "" Then
                        listB_CustomerIDSource.Items.Add(sData)
                    End If
                Next
            End If
            '================
            'Customer開放複選
            '================
            ddl_CustomerID_SelectedIndexChanged(Nothing, Nothing)
            ddl_YieldMode.Items.Clear()
            '================
            'Customer開放複選
            '================
            'If ddl_CustomerID.SelectedValue = "INTEL" Then
            '    ddl_YieldMode.Items.Add("By Fail Mode")
            '    ddl_YieldMode.Items.Add("By BKM")
            '    If ddl_YieldMode.SelectedIndex = 1 Then
            '        BKMSql = "and BKM='Y' "
            '    End If
            'ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
            '    ddl_YieldMode.Items.Add("By Fail Mode")
            '    ddl_YieldMode.Items.Add("By Station")
            '    If ddl_YieldMode.SelectedIndex = 1 = 0 Then
            '        AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            '    End If
            'Else
            '    If IsRename = False Then
            '        If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
            '            ddl_YieldMode.Items.Add("By Fail Mode")
            '        Else
            '            ddl_YieldMode.Items.Add("By Station")
            '        End If
            '    Else
            '        If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
            '            ddl_YieldMode.Items.Add("By Fail Mode")
            '        Else
            '            ddl_YieldMode.Items.Add("By Station")
            '        End If
            '    End If
            'End If
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.SelectedValue = "INTEL" Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                    ddl_YieldMode.Items.Add("By BKM")
                    If ddl_YieldMode.SelectedIndex = 1 Then
                        BKMSql = "and BKM='Y' "
                    End If
                ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                    ddl_YieldMode.Items.Add("By Station")
                    If ddl_YieldMode.SelectedIndex = 0 Then
                        AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
                    End If
                ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                    ddl_YieldMode.Items.Add("By Station")
                    If ddl_YieldMode.SelectedIndex = 0 Then
                        AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
                    End If
                Else
                    If IsRename = False Then
                        If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                            ddl_YieldMode.Items.Add("By Fail Mode")
                        Else
                            ddl_YieldMode.Items.Add("By Station")
                        End If
                    Else
                        If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                            ddl_YieldMode.Items.Add("By Fail Mode")
                        Else
                            ddl_YieldMode.Items.Add("By Station")
                        End If
                    End If
                End If
            Else
                If IsRename = False Then
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                        ddl_YieldMode.Items.Add("By Fail Mode")
                    Else
                        ddl_YieldMode.Items.Add("By Station")
                    End If
                Else
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                        ddl_YieldMode.Items.Add("By Fail Mode")
                    Else
                        ddl_YieldMode.Items.Add("By Station")
                    End If
                End If
            End If

            ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
            'If IsRename = False Then
            '    sqlStr = "select production_id from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            'sqlStr += "and production_id <> '' "
            sqlStr += "group by a.production_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)

            ' --- Group ---
            If myDT.Rows.Count > 0 Then
                'If Not IsDBNull(myDT.Rows(0)(0)) Then
                If myDT.Rows(0)(0).ToString() <> "" Then
                    ' 有就秀 Group
                    rbl_BySource.SelectedIndex = 0
                    'UtilObj.FillController(myDT, ddlPart, 0)
                    listB_PartSource.Items.Clear()
                    listB_PartShow.Items.Clear()
                    For i As Integer = 0 To myDT.Rows.Count - 1
                        listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                    Next
                Else
                    ' 轉向 Part ID
                    rbl_BySource.SelectedIndex = 1
                    rbl_BySource.Items(0).Enabled = False
                    'If IsRename = False Then
                    '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                    'Else
                    '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                    'End If
                    If IsRename = False Then
                        sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                    Else
                        sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                    End If
                    ' --- Product Type ---
                    sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                    If tr_BumpingType.Visible = True Then
                        ' --- Bumping Type ---
                        Dim strBumpingType As String = ""
                        For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                            If n = 0 Then
                                strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                            Else
                                strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                            End If
                        Next
                        ' --- OL_Process ---
                        Dim strOL_Process As String = ""
                        For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                            If n = 0 Then
                                strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                            Else
                                strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                            End If
                        Next
                        ' --- Backend ---
                        Dim strBackend As String = ""
                        For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                            If n = 0 Then
                                strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                            Else
                                strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                            End If
                        Next
                        If listB_BumpingTypeShow.Items.Count > 0 Then
                            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            Else
                                If strBumpingType <> "" Then
                                    sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                                End If
                            End If
                        Else
                            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                    sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and b.Backend IN(" + strBackend + ") "
                                End If
                            End If
                        End If
                    End If
                    '================
                    'Customer開放複選
                    '================
                    If ddl_ProductType.Text <> sWB_Rename Then
                        If ddl_CustomerID.Text <> "All" Then
                            ' --- Customer ID ---
                            If ddl_CustomerID.SelectedValue <> "" Then
                                sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                            End If
                        End If
                    Else
                        Dim strCustomerID As String = ""
                        For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                            If n = 0 Then
                                strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                            Else
                                strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                            End If
                        Next
                        If strCustomerID <> "" Then
                            sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                        End If
                    End If
                    sqlStr += "and a.yield_function=1 "
                    sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                    myAdapter = New SqlDataAdapter(sqlStr, conn)
                    myAdapter.SelectCommand.CommandTimeout = 3600
                    myDT = New DataTable
                    myAdapter.Fill(myDT)
                    'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                    listB_PartSource.Items.Clear()
                    listB_PartShow.Items.Clear()
                    For i As Integer = 0 To myDT.Rows.Count - 1
                        listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                    Next
                End If
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        If ddl_CustomerID.Text = "INTEL" Then
                            ' --- Customer ID ---
                            If ddl_CustomerID.SelectedValue <> "" Then
                                sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                            End If
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If

            ' --- Yield Item ---
            'sqlStr = "select yield_category, SEQ "
            sqlStr = "select yield_category "
            If IsRename = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping "
            Else
                If IsRenameOrder = False Then
                    sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
                Else
                    sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
                End If
            End If
            sqlStr += "where 1=1 "
            ' --- Product Type ---
            sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    If ddl_CustomerID.Text = "INTEL" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    Else
                        ' --- Customer ID ---
                        sqlStr += "and customer_id ='All' "
                    End If
                End If
            Else
                If IsRenameOrder = False Then
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                    End If
                End If
            End If
            sqlStr += "and SEQ != 1 "
            If IsRenameOrder = False Then
                sqlStr += BKMSql
                sqlStr += AMD_FAILMODESql
            Else
                If ddl_YieldMode.Text = "By Fail Mode" Then
                    sqlStr += "and Yield_Mode = 'FailMode' "
                ElseIf ddl_YieldMode.Text = "By Station" Then
                    sqlStr += "and Yield_Mode = 'Station' "
                ElseIf ddl_YieldMode.Text = "By BKM" Then
                    sqlStr += "and Yield_Mode = 'BKM' "
                End If
            End If
            'sqlStr += "group by yield_category, SEQ order by SEQ"
            'sqlStr += "group by yield_category order by yield_category"
            sqlStr += "group by SEQ, yield_category order by SEQ"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

            ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
            Dim addIndex As Integer = 0
            Dim gItem(myDT.Rows.Count) As String
            gItem(addIndex) = "LotCount"
            addIndex += 1
            For i As Integer = 0 To (myDT.Rows.Count - 1)
                gItem(addIndex) = myDT.Rows(i)(0)
                addIndex += 1
            Next
            ViewState("CPU_gItem") = gItem
            conn.Close()

            ' --- Add Hours ---
            Dim hourStr As String = ""
            For i As Integer = 0 To 23
                hourStr = (i.ToString).PadLeft(2, "0")
                ddlHourFrom.Items.Add(hourStr)
                ddlHourTo.Items.Add(hourStr)
            Next

            ' --- Bumping Type ---
            'ddl_BumpingType.Items.Clear()
            'ddl_BumpingType.Items.Add("All")
            'sqlStr = "select Bumping_Type from " + confTable + " where 1=1 "
            'sqlStr += "and BU_type='WB' "
            'sqlStr += "group by Bumping_Type order by Bumping_Type"
            'myAdapter = New SqlDataAdapter(sqlStr, conn)
            'myDT = New DataTable
            'myAdapter.Fill(myDT)
            ''UtilObj.FillController(myDT, ddl_BumpingType, 0)
            'For i As Integer = 0 To myDT.Rows.Count - 1
            '    ddl_BumpingType.Items.Add(myDT.Rows(i)("Bumping_Type"))
            'Next

            'ddl_BumpingType.Enabled = False
            listB_BumpingTypeSource.Items.Clear()
            listB_BumpingTypeShow.Items.Clear()
            If IsRename = False Then
                sqlStr = "select Bumping_Type from " + confTable + " where 1=1 "
                sqlStr += "and BU_type='" + sWB + "' "
            Else
                sqlStr = "select Bumping_Type from " + confTableRename + " where 1=1 "
                sqlStr += "and BU_type='" + sWB_Rename + "' "
            End If
            sqlStr += "group by Bumping_Type order by Bumping_Type"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            For i As Integer = 0 To myDT.Rows.Count - 1
                Dim sData As String = myDT.Rows(i)("Bumping_Type").ToString()
                If sData <> "" Then
                    listB_BumpingTypeSource.Items.Add(sData)
                End If
            Next

            listB_OL_ProcessSource.Items.Clear()
            listB_OL_ProcessShow.Items.Clear()
            If IsRename = False Then
                sqlStr = "select b.OL_Process from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                sqlStr += "and a.BU_type='" + sWB + "' "
            Else
                sqlStr = "select b.OL_Process from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                sqlStr += "and a.BU_type='" + sWB_Rename + "' "
            End If
            sqlStr += "group by b.OL_Process order by b.OL_Process"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            For i As Integer = 0 To myDT.Rows.Count - 1
                Dim sData As String = myDT.Rows(i)("OL_Process").ToString()
                If sData <> "" Then
                    listB_OL_ProcessSource.Items.Add(sData)
                End If
            Next

            listB_BackendSource.Items.Clear()
            listB_BackendShow.Items.Clear()
            If IsRename = False Then
                sqlStr = "select b.Backend from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                sqlStr += "and a.BU_type='" + sWB + "' "
            Else
                sqlStr = "select b.Backend from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                sqlStr += "and a.BU_type='" + sWB_Rename + "' "
            End If
            sqlStr += "group by b.Backend order by b.Backend"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            For i As Integer = 0 To myDT.Rows.Count - 1
                Dim sData As String = myDT.Rows(i)("Backend").ToString()
                If sData <> "" Then
                    listB_BackendSource.Items.Add(sData)
                End If
            Next

            'cb_ChartMerge0.Visible = False
            If IsRename = False Then
                If ddl_ProductType.Text = sWB Then
                    cb_ChartMerge0.Checked = True
                    cb_ChartMerge0.Visible = True
                    cb_FinalYield.Checked = False
                    cb_FinalYield.Visible = True
                Else
                    cb_ChartMerge0.Checked = True
                    cb_ChartMerge0.Visible = False
                    cb_FinalYield.Checked = False
                    cb_FinalYield.Visible = False
                End If
            Else
                If ddl_ProductType.Text = sWB_Rename Then
                    'cb_ChartMerge0.Checked = True
                    'cb_ChartMerge0.Visible = True
                    'cb_FinalYield.Checked = False
                    'cb_FinalYield.Visible = True
                Else
                    'cb_ChartMerge0.Checked = True
                    'cb_ChartMerge0.Visible = False
                    'cb_FinalYield.Checked = False
                    'cb_FinalYield.Visible = False
                End If
            End If
        Catch ex As Exception

        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try
    End Sub

    Protected Sub ddl_ProductType_Init(ByVal sender As Object, ByVal e As System.EventArgs) Handles ddl_ProductType.Init

    End Sub

    ' 選擇產品種類
    Protected Sub ddl_ProductType_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles ddl_ProductType.SelectedIndexChanged
        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim categoryStr As String = ""
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        Try
            lb_weekSource.Items.Clear()
            lb_weekShow.Items.Clear()

            tr_chartDisplay.Visible = False
            tr_gvDisplay.Visible = False
            tb_uploadLot.Visible = False

            rbl_BySource.Items(0).Enabled = True
            rbl_BySource.Items(1).Enabled = True

            conn.Open()

            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                tr_Customer1.Visible = True
                tr_Customer2.Visible = False
            Else
                tr_Customer1.Visible = False
                tr_Customer2.Visible = True
            End If

            ' --- Customer ID (廠商) ---
            If IsRename = False Then
                sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
            Else
                sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id IS NOT NULL and a.customer_id <> '')  "
            End If
            sqlStr += "and a.yield_function=1 "
            ' --- Product Type ---
            sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            If ddl_ProductType.Text = sWB_Rename Then
                ' --- Customer ID ---
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id not IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "group by a.customer_id order by a.customer_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                UtilObj.FillController(myDT, ddl_CustomerID, 1)
            Else
                listB_CustomerIDSource.Items.Clear()
                listB_OL_ProcessShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    Dim sData As String = myDT.Rows(i)("customer_id").ToString()
                    If sData <> "" Then
                        listB_CustomerIDSource.Items.Add(sData)
                    End If
                Next

                If IsRename = False Then
                    If ddl_ProductType.Text = sWB Then
                        tr_BumpingType.Visible = True
                        tr_OL_Process.Visible = True
                        tr_Backend.Visible = True
                    Else
                        tr_BumpingType.Visible = False
                        tr_OL_Process.Visible = False
                        tr_Backend.Visible = False
                    End If
                Else
                    If ddl_ProductType.Text = sWB_Rename Then
                        tr_BumpingType.Visible = True
                        tr_OL_Process.Visible = True
                        tr_Backend.Visible = True
                    Else
                        tr_BumpingType.Visible = False
                        tr_OL_Process.Visible = False
                        tr_Backend.Visible = False
                    End If
                End If
                tr_chartDisplay.Visible = False
                tr_gvDisplay.Visible = False
                tr_dateRange.Visible = False
                tb_uploadLot.Visible = False
                rb_DataTimeCustor.SelectedIndex = 0

                rbl_BySource.Items(0).Enabled = True
                rbl_BySource.Items(1).Enabled = True
            End If

            ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
            'If IsRename = False Then
            '    sqlStr = "select production_id from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.production_id IS NOT NULL and a.production_id <> '' "
            Else
                sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.production_id IS NOT NULL and a.production_id <> '' "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            'sqlStr += "and production_id <> '' "
            sqlStr += "group by a.production_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)

            ddl_YieldMode.Items.Clear()
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.SelectedValue = "INTEL" Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                    ddl_YieldMode.Items.Add("By BKM")
                    If ddl_YieldMode.SelectedIndex = 1 Then
                        BKMSql = "and BKM='Y' "
                    End If
                ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                    ddl_YieldMode.Items.Add("By Station")
                    If ddl_YieldMode.SelectedIndex = 0 Then
                        AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
                    End If
                ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                    ddl_YieldMode.Items.Add("By Station")
                    If ddl_YieldMode.SelectedIndex = 0 Then
                        AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
                    End If
                Else
                    If IsRename = False Then
                        If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                            ddl_YieldMode.Items.Add("By Fail Mode")
                        Else
                            ddl_YieldMode.Items.Add("By Station")
                        End If
                    Else
                        If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                            ddl_YieldMode.Items.Add("By Fail Mode")
                        Else
                            ddl_YieldMode.Items.Add("By Station")
                        End If
                    End If
                End If
            Else
                If IsRename = False Then
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                        ddl_YieldMode.Items.Add("By Fail Mode")
                    Else
                        ddl_YieldMode.Items.Add("By Station")
                    End If
                Else
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                        ddl_YieldMode.Items.Add("By Fail Mode")
                    Else
                        ddl_YieldMode.Items.Add("By Station")
                    End If
                End If
            End If

            ' --- Group ---
            If myDT.Rows.Count > 0 Then
                'If Not IsDBNull(myDT.Rows(0)(0)) Then
                If myDT.Rows(0)(0).ToString() <> "" Then
                    ' 有就秀 Group
                    rbl_BySource.SelectedIndex = 0
                    'UtilObj.FillController(myDT, ddlPart, 0)
                    listB_PartSource.Items.Clear()
                    listB_PartShow.Items.Clear()
                    For i As Integer = 0 To myDT.Rows.Count - 1
                        listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                    Next
                Else
                    ' 轉向 Part ID
                    rbl_BySource.SelectedIndex = 1
                    rbl_BySource.Items(0).Enabled = False
                    'If IsRename = False Then
                    '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                    'Else
                    '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                    'End If
                    If IsRename = False Then
                        sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Part_id IS NOT NULL "
                    Else
                        sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Part_id IS NOT NULL "
                    End If
                    ' --- Product Type ---
                    sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                    If tr_BumpingType.Visible = True Then
                        ' --- Bumping Type ---
                        Dim strBumpingType As String = ""
                        For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                            If n = 0 Then
                                strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                            Else
                                strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                            End If
                        Next
                        ' --- OL_Process ---
                        Dim strOL_Process As String = ""
                        For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                            If n = 0 Then
                                strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                            Else
                                strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                            End If
                        Next
                        ' --- Backend ---
                        Dim strBackend As String = ""
                        For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                            If n = 0 Then
                                strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                            Else
                                strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                            End If
                        Next
                        If listB_BumpingTypeShow.Items.Count > 0 Then
                            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            Else
                                If strBumpingType <> "" Then
                                    sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                                End If
                            End If
                        Else
                            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                    sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and b.Backend IN(" + strBackend + ") "
                                End If
                            End If
                        End If
                    End If
                    '================
                    'Customer開放複選
                    '================
                    If ddl_ProductType.Text <> sWB_Rename Then
                        If ddl_CustomerID.Text <> "All" Then
                            ' --- Customer ID ---
                            If ddl_CustomerID.SelectedValue <> "" Then
                                sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                            End If
                        End If
                    Else
                        Dim strCustomerID As String = ""
                        For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                            If n = 0 Then
                                strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                            Else
                                strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                            End If
                        Next
                        If strCustomerID <> "" Then
                            sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                        End If
                    End If
                    sqlStr += "and a.yield_function=1 "
                    sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                    myAdapter = New SqlDataAdapter(sqlStr, conn)
                    myAdapter.SelectCommand.CommandTimeout = 3600
                    myDT = New DataTable
                    myAdapter.Fill(myDT)
                    'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                    listB_PartSource.Items.Clear()
                    listB_PartShow.Items.Clear()
                    For i As Integer = 0 To myDT.Rows.Count - 1
                        listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                    Next
                End If
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        If ddl_CustomerID.Text = "INTEL" Then
                            ' --- Customer ID ---
                            If ddl_CustomerID.SelectedValue <> "" Then
                                sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                            End If
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If

            ' --- Yield Item ---
            'sqlStr = "select yield_category, SEQ "
            sqlStr = "select yield_category "
            If IsRename = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping "
            Else
                If IsRenameOrder = False Then
                    sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
                Else
                    sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
                End If
            End If
            sqlStr += "where 1=1 "
            ' --- Product Type ---
            sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    If ddl_CustomerID.Text = "INTEL" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    Else
                        ' --- Customer ID ---
                        sqlStr += "and customer_id ='All' "
                    End If
                End If
            Else
                If IsRenameOrder = False Then
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                    End If
                End If
            End If
            sqlStr += "and SEQ != 1 "
            If IsRenameOrder = False Then
                sqlStr += BKMSql
                sqlStr += AMD_FAILMODESql
            Else
                If ddl_YieldMode.Text = "By Fail Mode" Then
                    sqlStr += "and Yield_Mode = 'FailMode' "
                ElseIf ddl_YieldMode.Text = "By Station" Then
                    sqlStr += "and Yield_Mode = 'Station' "
                ElseIf ddl_YieldMode.Text = "By BKM" Then
                    sqlStr += "and Yield_Mode = 'BKM' "
                End If
            End If
            'sqlStr += "group by yield_category, SEQ order by SEQ"
            'sqlStr += "group by yield_category order by yield_category"
            sqlStr += "group by SEQ, yield_category order by SEQ"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            lb_weekShow.Items.Clear()
            UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

            ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
            Dim addIndex As Integer = 0
            Dim gItem(myDT.Rows.Count) As String
            gItem(addIndex) = "LotCount"
            addIndex += 1
            For i As Integer = 0 To (myDT.Rows.Count - 1)
                gItem(addIndex) = myDT.Rows(i)(0)
                addIndex += 1
            Next
            ViewState("CPU_gItem") = gItem

            conn.Close()

            'If ddl_ProductType.Text = "WB" Then
            '    ddl_BumpingType.Enabled = True
            'Else
            '    ddl_BumpingType.Enabled = False
            'End If
            cb_ChartMerge0.Visible = False
            If IsRename = False Then
                If ddl_ProductType.Text = sWB Then
                    listB_BumpingTypeSource.Enabled = True
                    listB_BumpingTypeShow.Enabled = True
                    tr_BumpingType.Visible = True
                    tr_OL_Process.Visible = True
                    tr_Backend.Visible = True

                    'If listB_BumpingTypeShow.Items.Count = 0 Then
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = True
                    'Else
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = False
                    'End If
                    cb_ChartMerge0.Checked = True
                    cb_ChartMerge0.Visible = True
                    cb_FinalYield.Checked = False
                    cb_FinalYield.Visible = True
                Else
                    listB_BumpingTypeSource.Enabled = False
                    listB_BumpingTypeShow.Enabled = False
                    tr_BumpingType.Visible = False
                    tr_OL_Process.Visible = False
                    tr_Backend.Visible = False

                    'If listB_BumpingTypeShow.Items.Count = 0 Then
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = True
                    'Else
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = False
                    'End If
                    cb_ChartMerge0.Checked = True
                    cb_ChartMerge0.Visible = False
                    cb_FinalYield.Checked = False
                    cb_FinalYield.Visible = False
                End If
            Else
                If ddl_ProductType.Text = sWB_Rename Then
                    listB_BumpingTypeSource.Enabled = True
                    listB_BumpingTypeShow.Enabled = True
                    tr_BumpingType.Visible = True
                    tr_OL_Process.Visible = True
                    tr_Backend.Visible = True

                    'If listB_BumpingTypeShow.Items.Count = 0 Then
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = True
                    'Else
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = False
                    'End If
                    cb_ChartMerge0.Checked = True
                    cb_ChartMerge0.Visible = True
                    cb_FinalYield.Checked = False
                    cb_FinalYield.Visible = True
                Else
                    listB_BumpingTypeSource.Enabled = False
                    listB_BumpingTypeShow.Enabled = False
                    tr_BumpingType.Visible = False
                    tr_OL_Process.Visible = False
                    tr_Backend.Visible = False

                    'If listB_BumpingTypeShow.Items.Count = 0 Then
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = True
                    'Else
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = False
                    'End If
                    cb_ChartMerge0.Checked = True
                    cb_ChartMerge0.Visible = False
                    cb_FinalYield.Checked = False
                    cb_FinalYield.Visible = False
                End If
            End If
            'If ddl_BumpingType.Text = "All" Then
            '    ddl_CustomerID.Enabled = True
            '    ddlPart.Enabled = True
            '    rbl_BySource.Enabled = True
            '    rbl_BySource.Items(0).Selected = True
            'Else
            '    ddl_CustomerID.Enabled = False
            '    ddlPart.Enabled = False
            '    rbl_BySource.Enabled = False
            '    If ddl_CustomerID.Items.Count > 0 Then
            '        ddl_CustomerID.SelectedIndex = 0
            '    End If
            '    If ddlPart.Items.Count > 0 Then
            '        ddlPart.SelectedIndex = 0
            '    End If
            'End If
            If listB_BumpingTypeSource.Items.Count = 0 Then
                'ddl_CustomerID.Enabled = True
                'ddlPart.Enabled = True
                'rbl_BySource.Enabled = True
                'rbl_BySource.Items(0).Selected = True

                ddl_CustomerID.Enabled = False
                rbl_BySource.Enabled = False
                'ddlPart.Enabled = False
                listB_PartSource.Enabled = False
                listB_PartShow.Enabled = False
                but_PartRight.Enabled = False
                but_PartLeft.Enabled = False
                '================
                'Customer開放複選
                '================
                but_PartRightAll.Enabled = False
                but_PartLeftAll.Enabled = False

                'cb_ChartMerge.Checked = True
                'cb_ChartMerge.Enabled = False
            Else
                If IsRename = False Then
                    If ddl_ProductType.Text = sWB Then
                        If listB_BumpingTypeShow.Items.Count = 0 Then
                            ddl_CustomerID.Enabled = True
                            rbl_BySource.Enabled = True
                            'ddlPart.Enabled = True
                            listB_PartSource.Enabled = True
                            listB_PartShow.Enabled = True
                            but_PartRight.Enabled = True
                            but_PartLeft.Enabled = True
                            '================
                            'Customer開放複選
                            '================
                            but_PartRightAll.Enabled = True
                            but_PartLeftAll.Enabled = True

                            'cb_ChartMerge.Checked = True
                            'cb_ChartMerge.Enabled = True
                        Else
                            ddl_CustomerID.Enabled = False
                            rbl_BySource.Enabled = False
                            'ddlPart.Enabled = False
                            listB_PartSource.Enabled = False
                            listB_PartShow.Enabled = False
                            but_PartRight.Enabled = False
                            but_PartLeft.Enabled = False
                            '================
                            'Customer開放複選
                            '================
                            but_PartRightAll.Enabled = False
                            but_PartLeftAll.Enabled = False

                            'cb_ChartMerge.Checked = True
                            'cb_ChartMerge.Enabled = False
                        End If
                    Else
                        ddl_CustomerID.Enabled = True
                        rbl_BySource.Enabled = True
                        rbl_BySource.Items(0).Selected = True
                        'ddlPart.Enabled = True
                        listB_PartSource.Enabled = True
                        listB_PartShow.Enabled = True
                        but_PartRight.Enabled = True
                        but_PartLeft.Enabled = True
                        '================
                        'Customer開放複選
                        '================
                        but_PartRightAll.Enabled = True
                        but_PartLeftAll.Enabled = True

                        'cb_ChartMerge.Checked = True
                        'cb_ChartMerge.Enabled = True
                    End If
                Else
                    If ddl_ProductType.Text = sWB_Rename Then
                        If listB_BumpingTypeShow.Items.Count = 0 Then
                            ddl_CustomerID.Enabled = True
                            rbl_BySource.Enabled = True
                            'ddlPart.Enabled = True
                            listB_PartSource.Enabled = True
                            listB_PartShow.Enabled = True
                            but_PartRight.Enabled = True
                            but_PartLeft.Enabled = True
                            '================
                            'Customer開放複選
                            '================
                            but_PartRightAll.Enabled = True
                            but_PartLeftAll.Enabled = True

                            'cb_ChartMerge.Checked = True
                            'cb_ChartMerge.Enabled = True
                        Else
                            ddl_CustomerID.Enabled = False
                            rbl_BySource.Enabled = False
                            'ddlPart.Enabled = False
                            listB_PartSource.Enabled = False
                            listB_PartShow.Enabled = False
                            but_PartRight.Enabled = False
                            but_PartLeft.Enabled = False
                            '================
                            'Customer開放複選
                            '================
                            but_PartRightAll.Enabled = False
                            but_PartLeftAll.Enabled = False

                            'cb_ChartMerge.Checked = True
                            'cb_ChartMerge.Enabled = False
                        End If
                    Else
                        ddl_CustomerID.Enabled = True
                        rbl_BySource.Enabled = True
                        rbl_BySource.Items(0).Selected = True
                        'ddlPart.Enabled = True
                        listB_PartSource.Enabled = True
                        listB_PartShow.Enabled = True
                        but_PartRight.Enabled = True
                        but_PartLeft.Enabled = True
                        '================
                        'Customer開放複選
                        '================
                        but_PartRightAll.Enabled = True
                        but_PartLeftAll.Enabled = True

                        'cb_ChartMerge.Checked = True
                        'cb_ChartMerge.Enabled = True
                    End If
                End If
                If ddl_CustomerID.Items.Count > 0 Then
                    ddl_CustomerID.SelectedIndex = 0
                End If
                'If ddlPart.Items.Count > 0 Then
                '    ddlPart.SelectedIndex = 0
                'End If
            End If

            If ddl_ProductType.Text = "CS" OrElse ddl_ProductType.Text = "CPU" Then
                tr_FE_ABFS.Visible = True
                tr_BE_ABFS.Visible = True
                tr_FE.Visible = True
                tr_BE.Visible = True

                rb_FE.SelectedIndex = 0
                listB_FESource.Items.Clear()
                listB_FEShow.Items.Clear()

                rb_BE.SelectedIndex = 0
                listB_BESource.Items.Clear()
                listB_BEShow.Items.Clear()
            Else
                tr_FE_ABFS.Visible = False
                tr_BE_ABFS.Visible = False
                tr_FE.Visible = False
                tr_BE.Visible = False

                rb_FE.SelectedIndex = 0
                listB_FESource.Items.Clear()
                listB_FEShow.Items.Clear()

                rb_BE.SelectedIndex = 0
                listB_BESource.Items.Clear()
                listB_BEShow.Items.Clear()
            End If
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    ' 選擇廠商
    Protected Sub ddl_CustomerID_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles ddl_CustomerID.SelectedIndexChanged
        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim categoryStr As String = ""
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        Try
            If IsRename = False Then
                If ddl_ProductType.Text = sWB Then
                    tr_BumpingType.Visible = True
                    tr_OL_Process.Visible = True
                    tr_Backend.Visible = True

                    'If listB_BumpingTypeShow.Items.Count = 0 Then
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = True
                    'Else
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = False
                    'End If
                Else
                    tr_BumpingType.Visible = False
                    tr_OL_Process.Visible = False
                    tr_Backend.Visible = False

                    'If listB_BumpingTypeShow.Items.Count = 0 Then
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = True
                    'Else
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = False
                    'End If
                End If
            Else
                If ddl_ProductType.Text = sWB_Rename Then
                    tr_BumpingType.Visible = True
                    tr_OL_Process.Visible = True
                    tr_Backend.Visible = True

                    'If listB_BumpingTypeShow.Items.Count = 0 Then
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = True
                    'Else
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = False
                    'End If
                Else
                    tr_BumpingType.Visible = False
                    tr_OL_Process.Visible = False
                    tr_Backend.Visible = False

                    'If listB_BumpingTypeShow.Items.Count = 0 Then
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = True
                    'Else
                    '    cb_ChartMerge.Checked = True
                    '    cb_ChartMerge.Enabled = False
                    'End If
                End If
            End If
            tr_chartDisplay.Visible = False
            tr_gvDisplay.Visible = False
            tr_dateRange.Visible = False
            tb_uploadLot.Visible = False
            rb_DataTimeCustor.SelectedIndex = 0

            rbl_BySource.Items(0).Enabled = True
            rbl_BySource.Items(1).Enabled = True

            conn.Open()

            ddl_YieldMode.Items.Clear()
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.SelectedValue = "INTEL" Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                    ddl_YieldMode.Items.Add("By BKM")
                    If ddl_YieldMode.SelectedIndex = 1 Then
                        BKMSql = "and BKM='Y' "
                    End If
                ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                    ddl_YieldMode.Items.Add("By Station")
                    If ddl_YieldMode.SelectedIndex = 0 Then
                        AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
                    End If
                ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                    ddl_YieldMode.Items.Add("By Station")
                    If ddl_YieldMode.SelectedIndex = 0 Then
                        AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
                    End If
                Else
                    If IsRename = False Then
                        If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                            ddl_YieldMode.Items.Add("By Fail Mode")
                        Else
                            ddl_YieldMode.Items.Add("By Station")
                        End If
                    Else
                        If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                            ddl_YieldMode.Items.Add("By Fail Mode")
                        Else
                            ddl_YieldMode.Items.Add("By Station")
                        End If
                    End If
                End If
            Else
                If IsRename = False Then
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                        ddl_YieldMode.Items.Add("By Fail Mode")
                    Else
                        ddl_YieldMode.Items.Add("By Station")
                    End If
                Else
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                        ddl_YieldMode.Items.Add("By Fail Mode")
                    Else
                        ddl_YieldMode.Items.Add("By Station")
                    End If
                End If
            End If

            ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
            'If IsRename = False Then
            '    sqlStr = "select production_id from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "and a.production_id <> '' "
            sqlStr += "group by a.production_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)

            ' --- Group ---
            If myDT.Rows.Count > 0 Then
                'If Not IsDBNull(myDT.Rows(0)(0)) Then
                If myDT.Rows(0)(0).ToString() <> "" Then
                    ' 有就秀 Group
                    rbl_BySource.SelectedIndex = 0
                    'UtilObj.FillController(myDT, ddlPart, 0)
                    listB_PartSource.Items.Clear()
                    listB_PartShow.Items.Clear()
                    For i As Integer = 0 To myDT.Rows.Count - 1
                        listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                    Next
                Else
                    ' 轉向 Part ID
                    rbl_BySource.SelectedIndex = 1
                    rbl_BySource.Items(0).Enabled = False
                    'If IsRename = False Then
                    '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                    'Else
                    '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                    'End If
                    If IsRename = False Then
                        sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                    Else
                        sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                    End If
                    ' --- Product Type ---
                    sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                    If tr_BumpingType.Visible = True Then
                        ' --- Bumping Type ---
                        Dim strBumpingType As String = ""
                        For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                            If n = 0 Then
                                strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                            Else
                                strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                            End If
                        Next
                        ' --- OL_Process ---
                        Dim strOL_Process As String = ""
                        For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                            If n = 0 Then
                                strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                            Else
                                strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                            End If
                        Next
                        ' --- Backend ---
                        Dim strBackend As String = ""
                        For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                            If n = 0 Then
                                strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                            Else
                                strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                            End If
                        Next
                        If listB_BumpingTypeShow.Items.Count > 0 Then
                            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            Else
                                If strBumpingType <> "" Then
                                    sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                                End If
                            End If
                        Else
                            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                    sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and b.Backend IN(" + strBackend + ") "
                                End If
                            End If
                        End If
                    End If
                    '================
                    'Customer開放複選
                    '================
                    If ddl_ProductType.Text <> sWB_Rename Then
                        If ddl_CustomerID.Text <> "All" Then
                            ' --- Customer ID ---
                            If ddl_CustomerID.SelectedValue <> "" Then
                                sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                            End If
                        End If
                    Else
                        Dim strCustomerID As String = ""
                        For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                            If n = 0 Then
                                strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                            Else
                                strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                            End If
                        Next
                        If strCustomerID <> "" Then
                            sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                        End If
                    End If
                    sqlStr += "and a.yield_function=1 "
                    sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                    myAdapter = New SqlDataAdapter(sqlStr, conn)
                    myAdapter.SelectCommand.CommandTimeout = 3600
                    myDT = New DataTable
                    myAdapter.Fill(myDT)
                    'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                    listB_PartSource.Items.Clear()
                    listB_PartShow.Items.Clear()
                    For i As Integer = 0 To myDT.Rows.Count - 1
                        listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                    Next
                End If
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        If ddl_CustomerID.Text = "INTEL" Then
                            ' --- Customer ID ---
                            If ddl_CustomerID.SelectedValue <> "" Then
                                sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                            End If
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If

            ' --- Yield Item ---
            'sqlStr = "select yield_category, SEQ "
            sqlStr = "select yield_category "
            If IsRename = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping "
            Else
                If IsRenameOrder = False Then
                    sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
                Else
                    sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
                End If
            End If
            sqlStr += "where 1=1 "
            ' --- Product Type ---
            sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    If ddl_CustomerID.Text = "INTEL" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    Else
                        ' --- Customer ID ---
                        sqlStr += "and customer_id ='All' "
                    End If
                End If
            Else
                If IsRenameOrder = False Then
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                    End If
                End If
            End If
            sqlStr += "and SEQ != 1 "
            If IsRenameOrder = False Then
                sqlStr += BKMSql
                sqlStr += AMD_FAILMODESql
            Else
                If ddl_YieldMode.Text = "By Fail Mode" Then
                    sqlStr += "and Yield_Mode = 'FailMode' "
                ElseIf ddl_YieldMode.Text = "By Station" Then
                    sqlStr += "and Yield_Mode = 'Station' "
                ElseIf ddl_YieldMode.Text = "By BKM" Then
                    sqlStr += "and Yield_Mode = 'BKM' "
                End If
            End If
            'sqlStr += "group by yield_category, SEQ order by SEQ"
            'sqlStr += "group by yield_category order by yield_category"
            sqlStr += "group by SEQ, yield_category order by SEQ"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            lb_weekShow.Items.Clear()
            UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

            ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
            Dim addIndex As Integer = 0
            Dim gItem(myDT.Rows.Count) As String
            gItem(addIndex) = "LotCount"
            addIndex += 1
            For i As Integer = 0 To (myDT.Rows.Count - 1)
                gItem(addIndex) = myDT.Rows(i)(0)
                addIndex += 1
            Next
            ViewState("CPU_gItem") = gItem

            conn.Close()
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
        If ddl_ProductType.Text = "CS" ORELSE ddl_ProductType.Text = "CPU" Then
            rb_BE_SelectedIndexChanged(sender, e)
            rb_FE_SelectedIndexChanged(sender, e)
        End If
    End Sub

    ' 選擇 Yield Mode
    Protected Sub ddl_YieldMode_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles ddl_YieldMode.SelectedIndexChanged

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        Try

            tr_chartDisplay.Visible = False
            tr_gvDisplay.Visible = False
            tb_uploadLot.Visible = False

            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                ' --- INTEL ---
                If ddl_CustomerID.SelectedValue = "INTEL" And ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                    BKMSql = "and BKM='Y' "
                End If

                ' --- AMD/NVD ---
                If (ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD") And ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
                End If
            End If

            conn.Open()

            ' --- Yield Item ---
            'sqlStr = "select yield_category, SEQ "
            sqlStr = "select yield_category "
            If IsRename = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping "
            Else
                If IsRenameOrder = False Then
                    sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
                Else
                    sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
                End If
            End If
            sqlStr += "where 1=1 "
            ' --- Product Type ---
            sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    If ddl_CustomerID.Text = "INTEL" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    Else
                        ' --- Customer ID ---
                        sqlStr += "and customer_id ='All' "
                    End If
                End If
            Else
                If IsRenameOrder = False Then
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                    End If
                End If
            End If
            sqlStr += "and SEQ != 1 "
            If IsRenameOrder = False Then
                sqlStr += BKMSql
                sqlStr += AMD_FAILMODESql
            Else
                If ddl_YieldMode.Text = "By Fail Mode" Then
                    sqlStr += "and Yield_Mode = 'FailMode' "
                ElseIf ddl_YieldMode.Text = "By Station" Then
                    sqlStr += "and Yield_Mode = 'Station' "
                ElseIf ddl_YieldMode.Text = "By BKM" Then
                    sqlStr += "and Yield_Mode = 'BKM' "
                End If
            End If
            'sqlStr += "group by yield_category, SEQ order by SEQ"
            'sqlStr += "group by yield_category order by yield_category"
            sqlStr += "group by SEQ, yield_category order by SEQ"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            lb_weekShow.Items.Clear()
            UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

            conn.Close()

            ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
            Dim addIndex As Integer = 0
            Dim gItem(myDT.Rows.Count) As String
            gItem(addIndex) = "LotCount"
            addIndex += 1
            For i As Integer = 0 To (myDT.Rows.Count - 1)
                gItem(addIndex) = myDT.Rows(i)(0)
                addIndex += 1
            Next
            ViewState("CPU_gItem") = gItem

        Catch ex As Exception

        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
        If ddl_ProductType.Text = "CS" ORELSE ddl_ProductType.Text = "CPU" Then
            rb_BE_SelectedIndexChanged(sender, e)
            rb_FE_SelectedIndexChanged(sender, e)
        End If
    End Sub

    ' 選擇 Group or Part ID
    Protected Sub rbl_BySource_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles rbl_BySource.SelectedIndexChanged

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim categoryStr As String = ""
        tr_gvDisplay.Visible = False
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FailModeSql As String = "and AMD_FAILMODE='N' "

        Try

            tr_chartDisplay.Visible = False
            tr_gvDisplay.Visible = False
            tb_uploadLot.Visible = False

            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                ' --- INTEL ---
                If ddl_CustomerID.SelectedValue = "INTEL" And ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                    BKMSql = "and BKM='Y' "
                End If

                ' --- AMD/NVD ---
                If (ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD") And ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    AMD_FailModeSql = "and AMD_FAILMODE='Y' "
                End If
            End If

            conn.Open()

            If rbl_BySource.SelectedIndex = 0 Then
                ' Group
                If IsRename = False Then
                    sqlStr = "select production_id from " + confTable + " where 1=1 "
                Else
                    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and yield_function=1 "
                sqlStr += "group by production_id"
            Else
                ' Part
                If IsRename = False Then
                    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                Else
                    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and yield_function=1 "
                sqlStr += "group by Part_id, Memo order by Part_id"
            End If

            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)

            ' --- Group ---
            'ddlPart.Items.Clear()
            lb_weekSource.Items.Clear()
            lb_weekShow.Items.Clear()
            If myDT.Rows.Count > 0 Then
                If IsDBNull(myDT.Rows(0)(0)) Then
                    If rbl_BySource.SelectedIndex = 0 Then
                        ShowMessage("沒有 Group 的資訊!")
                    Else
                        ShowMessage("沒有 Part 的資訊!")
                    End If
                Else

                    If rbl_BySource.SelectedIndex = 0 Then
                        'UtilObj.FillController(myDT, ddlPart, 0)
                        listB_PartSource.Items.Clear()
                        listB_PartShow.Items.Clear()
                        For i As Integer = 0 To myDT.Rows.Count - 1
                            listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                        Next
                    Else
                        'If ddl_CustomerID.SelectedValue = "INTEL" Then
                        '    UtilObj.FillController(myDT, ddlPart, 0, "Part_id", "Memo")
                        'Else
                        '    UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                        'End If
                        listB_PartSource.Items.Clear()
                        listB_PartShow.Items.Clear()
                        For i As Integer = 0 To myDT.Rows.Count - 1
                            listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                        Next
                    End If
                End If

                ' --- Yield Item ---
                'sqlStr = "select yield_category, SEQ "
                sqlStr = "select yield_category "
                If IsRename = False Then
                    sqlStr += "from dbo.Yield_CATEGORY_Mapping "
                Else
                    If IsRenameOrder = False Then
                        sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
                    Else
                        sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
                    End If
                End If
                sqlStr += "where 1=1 "
                ' --- Product Type ---
                sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        If ddl_CustomerID.Text = "INTEL" Then
                            ' --- Customer ID ---
                            If ddl_CustomerID.SelectedValue <> "" Then
                                sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                            End If
                        Else
                            ' --- Customer ID ---
                            sqlStr += "and customer_id ='All' "
                        End If
                    End If
                Else
                    If IsRenameOrder = False Then
                        Dim strCustomerID As String = ""
                        For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                            If n = 0 Then
                                strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                            Else
                                strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                            End If
                        Next
                        If strCustomerID <> "" Then
                            sqlStr += "and customer_id IN(" + strCustomerID + ") "
                        End If
                    End If
                End If
                sqlStr += "and SEQ != 1 "
                If IsRenameOrder = False Then
                    sqlStr += BKMSql
                    sqlStr += AMD_FailModeSql
                Else
                    If ddl_YieldMode.Text = "By Fail Mode" Then
                        sqlStr += "and Yield_Mode = 'FailMode' "
                    ElseIf ddl_YieldMode.Text = "By Station" Then
                        sqlStr += "and Yield_Mode = 'Station' "
                    ElseIf ddl_YieldMode.Text = "By BKM" Then
                        sqlStr += "and Yield_Mode = 'BKM' "
                    End If
                End If
                'sqlStr += "group by yield_category, SEQ order by SEQ"
                'sqlStr += "group by yield_category order by yield_category"
                sqlStr += "group by SEQ, yield_category order by SEQ"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                lb_weekShow.Items.Clear()
                UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

            End If
            conn.Close()

            ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
            Dim addIndex As Integer = 0
            Dim gItem(myDT.Rows.Count) As String
            gItem(addIndex) = "LotCount"
            addIndex += 1
            For i As Integer = 0 To (myDT.Rows.Count - 1)
                gItem(addIndex) = myDT.Rows(i)(0)
                addIndex += 1
            Next
            ViewState("CPU_gItem") = gItem
        Catch ex As Exception

        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try

    End Sub

    '取得目前週數
    Public Function GetWeekOfYear(ByVal dt As DateTime) As Integer
        Dim GetWeek As System.Globalization.GregorianCalendar = New System.Globalization.GregorianCalendar()
        Return GetWeek.GetWeekOfYear(dt, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday)
    End Function

    '取得該年有多少週
    Public Function GetWeekAmount(ByVal year As Integer) As Integer
        Dim EndDay As DateTime = New DateTime(year, 12, 31) '該年最後一天
        Dim GC As System.Globalization.GregorianCalendar = New System.Globalization.GregorianCalendar()
        Return GC.GetWeekOfYear(EndDay, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday) '該年的週數
    End Function

    ' Execute Query
    Protected Sub but_Execute_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles but_Execute.Click
        If cb_ChartMerge1.Checked = False Then
            'If ddl_ProductType.Text = "WB" Then
            '    'If listB_BumpingTypeShow.Items.Count = 0 Then
            '    '    cb_ChartMerge.Checked = True
            '    '    cb_ChartMerge.Enabled = True
            '    'Else
            '    '    cb_ChartMerge.Checked = True
            '    '    cb_ChartMerge.Enabled = False
            '    'End If
            'Else
            '    cb_ChartMerge.Checked = True
            '    cb_ChartMerge.Enabled = True
            'End If

            If (lb_weekShow.Items.Count = 0) Then
                ShowMessage("請選擇 Yield Type !")
                Return
            End If

            If rb_DataTimeCustor.SelectedIndex = 1 AndAlso listB_timeShow.Items.Count < 1 Then
                ShowMessage("請選擇時間區間 !")
                Return
            End If

            If rbl_BySource.Enabled = True AndAlso rbl_BySource.SelectedIndex = 1 AndAlso listB_PartShow.Items.Count = 0 Then
                ShowMessage("請至少選擇一個料號進行資料篩選 !")
                Return
                'ElseIf rbl_BySource.Enabled = True AndAlso rbl_BySource.SelectedIndex = 1 AndAlso listB_PartShow.Items.Count > 10 Then
                '    ShowMessage("請減少料號數量至10個以內進行資料篩選 !")
                '    Return
            End If

            'If tr_BumpingType.Visible = True AndAlso listB_BumpingTypeShow.Items.Count = 0 Then
            '    'ShowMessage("請至少選擇一個BumpingType進行資料篩選 !")
            '    'Return
            'ElseIf tr_BumpingType.Visible = True AndAlso listB_BumpingTypeShow.Items.Count > 2 Then
            '    ShowMessage("請減少BumpingType數量至多2個進行資料篩選 !")
            '    Return
            'End If

            'If rbl_BySource.Enabled = True AndAlso rbl_BySource.SelectedIndex = 0 AndAlso listB_PartShow.Items.Count = 0 Then
            '    ShowMessage("請至少選擇一個Product No進行資料篩選 !")
            '    Return
            'ElseIf rbl_BySource.Enabled = True AndAlso rbl_BySource.SelectedIndex = 0 AndAlso listB_PartShow.Items.Count > 10 Then
            '    ShowMessage("請減少Product No數量至10個以內進行資料篩選 !")
            '    Return
            'End If

            'If ddl_ProductType.Text = "WB" Then
            '    If (listB_BumpingTypeShow.Items.Count = 0) Then
            '        ShowMessage("請選擇 Bumping Type !")
            '        Return
            '    End If
            'End If

            ' Step1. 尋找要的日, 週, 月
            Dim dayAry As ArrayList = New ArrayList
            Dim weekAry As ArrayList = New ArrayList
            Dim monthAry As ArrayList = New ArrayList
            Dim dyear As String = ""
            Dim dWeek As String = ""
            Dim dStr As String = ""
            Dim tmpString As String = ""

            Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
            Dim sqlStr As String = ""
            Dim conditionStr As String = ""
            Dim myAdapter As SqlDataAdapter
            Dim yObj As yieldInfo
            Dim myDT, chartTable As DataTable
            Dim chartAry As ArrayList = New ArrayList
            Dim chartHash As Hashtable = New Hashtable
            Dim hAry As Hashtable = New Hashtable

            Try
                conn.Open()
                If rb_DataTimeCustor.SelectedIndex = 1 Then
                    If rbl_lossItem.SelectedIndex = 0 Then
                        ' Day
                        For i As Integer = 0 To (listB_timeShow.Items.Count - 1)
                            dayAry.Add(listB_timeShow.Items(i).Text)
                        Next
                        dayAry.Reverse()
                    ElseIf rbl_lossItem.SelectedIndex = 1 Then
                        ' Week 
                        For i As Integer = 0 To (listB_timeShow.Items.Count - 1)
                            weekAry.Add(listB_timeShow.Items(i).Text)
                        Next
                        weekAry.Reverse()
                    Else
                        ' Month
                        For i As Integer = 0 To (listB_timeShow.Items.Count - 1)
                            monthAry.Add(listB_timeShow.Items(i).Text)
                        Next
                        monthAry.Reverse()
                    End If
                Else
                    ' === Day === 取7天
                    Dim i As Integer = 6
                    While (i > -1)
                        If cb_ShowToday.Checked Then
                            ' 當天要納入
                            tmpString = Date.Now.AddDays(-(i)).ToString("yyyyMMdd")
                        ElseIf cb_customerDay.Checked Then
                            ' 自訂時間區間
                            If i = 0 Then
                                tmpString = ((txtDateFrom.Text) + (ddlHourFrom.SelectedValue)) + "~" + ((txtDateTo.Text) + (ddlHourTo.SelectedValue))
                            Else
                                tmpString = Date.Now.AddDays(-(i)).ToString("yyyyMMdd")
                            End If
                        Else
                            ' 一般,當天不要納入
                            tmpString = Date.Now.AddDays(-(i + 1)).ToString("yyyyMMdd")
                        End If
                        dayAry.Add(tmpString)
                        i -= 1
                    End While
                    ' === Week === 取5週  
                    Dim weeksql As String = "select yearWW from SystemDateMapping where customer='YIP' and DateTime='{0}'"
                    i = 4
                    While (i > -1)
                        If cb_ShowToday.Checked Then '當天要納入
                            tmpString = Date.Now.AddDays(-(i * 7)).ToString("yyyy-MM-dd")
                        Else '一般,當天不要納入
                            If Date.Now.DayOfWeek = DayOfWeek.Friday Then
                                tmpString = Date.Now.AddDays(-(i * 7) - 1).ToString("yyyy-MM-dd")
                            Else
                                tmpString = Date.Now.AddDays(-(i * 7)).ToString("yyyy-MM-dd")
                            End If
                        End If
                        myAdapter = New SqlDataAdapter(String.Format(weeksql, tmpString), conn)
                        myDT = New DataTable
                        myAdapter.Fill(myDT)
                        weekAry.Add(myDT.Rows(0)("yearWW").ToString())
                        i -= 1
                    End While
                    ' === Month === 取3個月
                    i = 2
                    While (i > -1)
                        If cb_ShowToday.Checked Then '當天要納入
                            tmpString = Date.Now.AddMonths(-i).ToString("yyyyMM00")
                        Else '一般,當天不要納入
                            If Date.Now.Day = 1 Then
                                tmpString = Date.Now.AddMonths(-i - 1).ToString("yyyyMM00")
                            Else
                                tmpString = Date.Now.AddMonths(-i).ToString("yyyyMM00")
                            End If
                        End If
                        monthAry.Add(tmpString)
                        i -= 1
                    End While
                End If

                ' Step2. 先組合 Report 所要的 DataTable 
                Dim workTable As DataTable = New DataTable()
                workTable.Columns.Add("Type", Type.GetType("System.String"))
                workTable.Columns.Add("Customer ID", Type.GetType("System.String"))
                workTable.Columns.Add("Part ID", Type.GetType("System.String"))
                For x As Integer = 0 To (monthAry.Count - 1)
                    If workTable.Columns(monthAry(x)) Is Nothing = True Then
                        workTable.Columns.Add((monthAry(x)).ToString(), Type.GetType("System.String"))
                    End If
                Next
                For x As Integer = 0 To (weekAry.Count - 1)
                    If workTable.Columns(weekAry(x)) Is Nothing = True Then
                        workTable.Columns.Add((weekAry(x)).ToString(), Type.GetType("System.String"))
                    End If
                Next
                For x As Integer = 0 To (dayAry.Count - 1)
                    If workTable.Columns(dayAry(x)) Is Nothing = True Then
                        workTable.Columns.Add((dayAry(x)).ToString(), Type.GetType("System.String"))
                    End If
                Next

                ' 2012/12/20 如果有 All, 就呈現所有料號的 "Total yield Bar Chart!"
                'If ddlPart.SelectedValue = "All" Then
                'If (listB_PartSource.Items.Count = 0 AndAlso listB_PartShow.Items.Count > 0) Then
                '    If listB_PartShow.Items.Count > 1 Then
                '        Dim gItem(1) As String
                '        gItem(0) = "LotCount"
                '        If lb_weekShow.Items(0).Text = "Total Yield" Then
                '            gItem(1) = "Total Yield"
                '        Else
                '            gItem(1) = "Total"
                '        End If
                '        ViewState("CPU_gItem") = gItem
                '    End If
                'End If
                Dim myYieldItem As DataTable = New DataTable()
                Dim sYieldItem As String = Get_YieldItem()
                Dim YieldItemSeq_sql As String = "SELECT * "
                YieldItemSeq_sql += "FROM Yield_CATEGORY_Order_Mapping "
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        If ddl_CustomerID.Text = "INTEL" Then
                            YieldItemSeq_sql += "WHERE Customer_Id = 'INTEL' "
                        Else
                            YieldItemSeq_sql += "WHERE Customer_Id = 'ALL' "
                        End If
                    Else
                        YieldItemSeq_sql += "WHERE Customer_Id = 'ALL' "
                    End If
                Else
                    YieldItemSeq_sql += "WHERE Customer_Id = 'ALL' "
                End If
                If sYieldItem <> "" Then
                    YieldItemSeq_sql += "AND Yield_Category IN(" + Get_YieldItem() + ") "
                End If
                YieldItemSeq_sql += "AND yield_type = '" + ddl_ProductType.SelectedValue + "' "
                YieldItemSeq_sql += "AND yield_mode = '" + ddl_YieldMode.SelectedValue.Replace("By ", "").Replace(" ", "") + "' "
                YieldItemSeq_sql += "ORDER BY SEQ"

                myAdapter = New SqlDataAdapter(String.Format(YieldItemSeq_sql, tmpString), conn)
                myAdapter.Fill(myYieldItem)

                ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
                Dim addIndex As Integer = 0
                Dim gItem(lb_weekShow.Items.Count) As String
                gItem(addIndex) = "LotCount"
                addIndex += 1
                'For i As Integer = 0 To (lb_weekShow.Items.Count - 1)
                For i As Integer = 0 To myYieldItem.Rows.Count - 1
                    'gItem(addIndex) = lb_weekShow.Items(i).Text
                    gItem(addIndex) = myYieldItem.Rows(i)("Yield_CATEGORY")
                    addIndex += 1
                Next
                ViewState("CPU_gItem") = gItem

                tr_chartDisplay.Visible = False
                tr_gvDisplay.Visible = False
                tb_uploadLot.Visible = False

                Dim sGetPartID As String = Get_PartID()
                If (rbl_BySource.SelectedIndex = 0) Then
                    ' --- Production ID ---
                    If rbl_BySource.Enabled = True Then
                        If sGetPartID <> "" Then
                            'conditionStr += "and production_id='" + (Me.ddlPart.SelectedValue) + "' "
                            '===[Loader取消ABFS by Product 計算，改由網頁即時計算]====================
                            'conditionStr += "and production_id in(" + sGetPartID + ") "
                            'conditionStr += "and Part_Id in(select a.Part_id from EDA.dbo.Customer_Prodction_Mapping a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                            If IsRename = False Then
                                conditionStr = "and Part_Id in(select a.Part_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                            Else
                                conditionStr = "and Part_Id in(select a.Part_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                            End If
                        End If
                    End If
                Else
                    ' --- Part ID ---
                    If rbl_BySource.Enabled = True Then
                        If sGetPartID <> "" Then
                            'conditionStr += "and Part_Id='" + (Me.ddlPart.SelectedValue) + "' "
                            conditionStr += "and Part_Id in(" + sGetPartID + ") "
                        End If
                    End If
                End If
                'If (rbl_BySource.SelectedIndex = 1 And ddlPart.SelectedValue = "All") Then
                'If (rbl_BySource.SelectedIndex = 1 And (listB_PartSource.Items.Count = 0 AndAlso listB_PartSource.Items.Count > 0)) Then
                '    If ddl_CustomerID.Enabled = True Then
                '        conditionStr = "and customer_id='" + ddl_CustomerID.SelectedValue + "' "
                '    End If
                'End If
                'sqlStr += "Select production_id, Part_Id, Memo "
                'If IsRename = False Then
                '    sqlStr += "from " + confTable + " "
                'Else
                '    sqlStr += "from " + confTableRename + " "
                'End If
                If IsRename = False Then
                    'sqlStr = "select a.production_id, Part_Id, Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where  (a.production_id is not null and a.production_id <> '') "
                    sqlStr = "select a.production_id, Part_Id, Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    'sqlStr = "select a.production_id, Part_Id, Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.production_id is not null and a.production_id <> '') "
                    sqlStr = "select a.production_id, Part_Id, Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                'sqlStr += "where 1=1 "
                'sqlStr += "and yield_function=1 "
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                'If ddl_CustomerID.Text <> "All" Then
                '    ' --- Customer ID ---
                '    If ddl_CustomerID.SelectedValue <> "" Then
                '        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                '    End If
                'End If
                'sqlStr += conditionStr
                'sqlStr += "group by production_id, Part_Id, Memo"
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += conditionStr
                'sqlStr += "and production_id <> '' "
                sqlStr += "group by a.production_id, a.Part_Id, a.Memo"

                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)

                ' Step3. 取得 Part 下面的 RowData
                Dim customerStr, productionStr, partStr, part_plant As String
                For partIndex As Integer = 0 To (myDT.Rows.Count - 1)

                    If IsDBNull(myDT.Rows(partIndex)("production_id")) OrElse myDT.Rows(partIndex)("production_id").ToString = "" Then
                        customerStr = "N/A"
                    Else
                        customerStr = myDT.Rows(partIndex)("production_id")
                    End If
                    productionStr = "'" + myDT.Rows(partIndex)("production_id").ToString() + "'"
                    partStr = "'" + myDT.Rows(partIndex)("Part_Id").ToString() + "'"
                    part_plant = "'" + myDT.Rows(partIndex)("Memo").ToString() + "'"

                    hAry = New Hashtable
                    ' PART By Day
                    For x As Integer = 0 To (dayAry.Count - 1)
                        yObj = New yieldInfo
                        'If ddl_BumpingType.Enabled = False Then
                        '    If getDateRangeData(yObj, conn, partStr, (dayAry(x).ToString()), 0, False) Then
                        '        hAry.Add((dayAry(x).ToString()), yObj)
                        '    End If
                        'Else
                        '    If getDateRangeData(yObj, conn, partStr, (dayAry(x).ToString()), 0, False, ddl_BumpingType.Text) Then
                        '        hAry.Add((dayAry(x).ToString()), yObj)
                        '    End If
                        'End If
                        If listB_BumpingTypeShow.Enabled = False Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                If getDateRangeData(yObj, conn, productionStr, partStr, (dayAry(x).ToString()), 0, False, dayAry) Then
                                    If hAry(dayAry(x).ToString()) Is Nothing = True Then
                                        hAry.Add((dayAry(x).ToString()), yObj)
                                    End If
                                End If
                            Else
                                If getDateRangeData(yObj, conn, productionStr, partStr, (dayAry(x).ToString()), 0, False, dayAry) Then
                                    If hAry(dayAry(x).ToString()) Is Nothing = True Then
                                        hAry.Add((dayAry(x).ToString()), yObj)
                                    End If
                                End If
                            End If
                        Else
                            Dim strBumpingType As String = ""
                            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                If n = 0 Then
                                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                Else
                                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                End If
                            Next

                            'If getDateRangeData(yObj, conn, partStr, (dayAry(x).ToString()), 0, False, ddl_BumpingType.Text) Then
                            '    hAry.Add((dayAry(x).ToString()), yObj)
                            'End If
                            If rbl_BySource.SelectedIndex = 0 Then
                                If getDateRangeData(yObj, conn, productionStr, partStr, (dayAry(x).ToString()), 0, False, dayAry, strBumpingType) Then
                                    If hAry(dayAry(x).ToString()) Is Nothing = True Then
                                        hAry.Add((dayAry(x).ToString()), yObj)
                                    End If
                                End If
                            Else
                                If getDateRangeData(yObj, conn, productionStr, partStr, (dayAry(x).ToString()), 0, False, dayAry, strBumpingType) Then
                                    If hAry(dayAry(x).ToString()) Is Nothing = True Then
                                        hAry.Add((dayAry(x).ToString()), yObj)
                                    End If
                                End If
                            End If
                        End If
                    Next
                    ' PART By Week
                    For x As Integer = 0 To (weekAry.Count - 1)
                        yObj = New yieldInfo
                        'If ddl_BumpingType.Enabled = False Then
                        '    If getDateRangeData(yObj, conn, partStr, (weekAry(x).ToString()), 1, False) Then
                        '        hAry.Add((weekAry(x).ToString()), yObj)
                        '    End If
                        'Else
                        '    If getDateRangeData(yObj, conn, partStr, (weekAry(x).ToString()), 1, False, ddl_BumpingType.Text) Then
                        '        hAry.Add((weekAry(x).ToString()), yObj)
                        '    End If
                        'End If
                        If listB_BumpingTypeShow.Enabled = False Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                If getDateRangeData(yObj, conn, productionStr, partStr, (weekAry(x).ToString()), 1, False, dayAry) Then
                                    If hAry(weekAry(x).ToString()) Is Nothing = True Then
                                        hAry.Add((weekAry(x).ToString()), yObj)
                                    End If
                                End If
                            Else
                                If getDateRangeData(yObj, conn, productionStr, partStr, (weekAry(x).ToString()), 1, False, dayAry) Then
                                    If hAry(weekAry(x).ToString()) Is Nothing = True Then
                                        hAry.Add((weekAry(x).ToString()), yObj)
                                    End If
                                End If
                            End If
                        Else
                            Dim strBumpingType As String = ""
                            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                If n = 0 Then
                                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                Else
                                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                End If
                            Next

                            If rbl_BySource.SelectedIndex = 0 Then
                                If getDateRangeData(yObj, conn, productionStr, partStr, (weekAry(x).ToString()), 1, False, dayAry, strBumpingType) Then
                                    If hAry(weekAry(x).ToString()) Is Nothing = True Then
                                        hAry.Add((weekAry(x).ToString()), yObj)
                                    End If
                                End If
                            Else
                                If getDateRangeData(yObj, conn, productionStr, partStr, (weekAry(x).ToString()), 1, False, dayAry, strBumpingType) Then
                                    If hAry(weekAry(x).ToString()) Is Nothing = True Then
                                        hAry.Add((weekAry(x).ToString()), yObj)
                                    End If
                                End If
                            End If
                        End If
                    Next
                    ' PART By Month
                    For x As Integer = 0 To (monthAry.Count - 1)
                        yObj = New yieldInfo
                        'If ddl_BumpingType.Enabled = False Then
                        '    If getDateRangeData(yObj, conn, partStr, (monthAry(x).ToString()), 2, False) Then
                        '        hAry.Add((monthAry(x).ToString()), yObj)
                        '    End If
                        'Else
                        '    If getDateRangeData(yObj, conn, partStr, (monthAry(x).ToString()), 2, False, ddl_BumpingType.Text) Then
                        '        hAry.Add((monthAry(x).ToString()), yObj)
                        '    End If
                        'End If
                        If listB_BumpingTypeShow.Enabled = False Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                If getDateRangeData(yObj, conn, productionStr, partStr, (monthAry(x).ToString()), 2, False, dayAry) Then
                                    If hAry(monthAry(x).ToString()) Is Nothing = True Then
                                        hAry.Add((monthAry(x).ToString()), yObj)
                                    End If
                                End If
                            Else
                                If getDateRangeData(yObj, conn, productionStr, partStr, (monthAry(x).ToString()), 2, False, dayAry) Then
                                    If hAry(monthAry(x).ToString()) Is Nothing = True Then
                                        hAry.Add((monthAry(x).ToString()), yObj)
                                    End If
                                End If
                            End If
                        Else
                            Dim strBumpingType As String = ""
                            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                If n = 0 Then
                                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                Else
                                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                End If
                            Next

                            If rbl_BySource.SelectedIndex = 0 Then
                                If getDateRangeData(yObj, conn, productionStr, partStr, (monthAry(x).ToString()), 2, False, dayAry, strBumpingType) Then
                                    If hAry(monthAry(x).ToString()) Is Nothing = True Then
                                        hAry.Add((monthAry(x).ToString()), yObj)
                                    End If
                                End If
                            Else
                                If getDateRangeData(yObj, conn, productionStr, partStr, (monthAry(x).ToString()), 2, False, dayAry, strBumpingType) Then
                                    If hAry(monthAry(x).ToString()) Is Nothing = True Then
                                        hAry.Add((monthAry(x).ToString()), yObj)
                                    End If
                                End If
                            End If
                        End If
                    Next

                    chartTable = New DataTable()
                    chartTable = workTable.Clone()
                    'generateDataSource(customerStr, part_plant, chartTable, workTable, hAry)
                    generateDataSource(customerStr, partStr, chartTable, workTable, hAry)

                    chartHash = New Hashtable
                    chartHash.Add(partStr, chartTable)
                    chartAry.Add(chartHash)

                    '加入(Summary) ' 選擇 CustomerID, 最後一筆, Part有2筆以上 " * 非必要 "
                    If partIndex = (myDT.Rows.Count - 1) Then
                        'Dim oPartID = Get_ProductNo_PartID().Split(",")
                        partStr = Get_ProductNo_PartID()
                        productionStr = ""
                        For n As Integer = 0 To (listB_PartShow.Items.Count - 1)
                            If n = 0 Then
                                productionStr += "'" & listB_PartShow.Items(n).Text & "'"
                            Else
                                productionStr += ",'" & listB_PartShow.Items(n).Text & "'"
                            End If
                        Next
                        If rbl_BySource.SelectedIndex = 0 Then

                        End If
                        'If (rbl_BySource.SelectedIndex = 0 Or ddlPart.SelectedValue = "All") And (partIndex = (myDT.Rows.Count - 1)) And (myDT.Rows.Count > 1) Then
                        If (rbl_BySource.SelectedIndex = 0 Or (listB_PartShow.Items.Count > 0 Or listB_BumpingTypeShow.Items.Count > 0)) And (myDT.Rows.Count > 1) Then
                            'If (rbl_BySource.SelectedIndex = 0 Or listB_PartShow.Items.Count > 0)) And (partIndex = (myDT.Rows.Count - 1)) And (myDT.Rows.Count > 1) Then

                            Dim partStrtemp As String = ""
                            'If (ddlPart.SelectedValue = "All") Then
                            If (listB_PartSource.Items.Count = 0 AndAlso listB_PartShow.Items.Count > 0) Then
                                '================
                                'Customer開放複選
                                '================
                                If ddl_ProductType.Text <> sWB_Rename Then
                                    partStrtemp = "'" + (ddl_CustomerID.SelectedValue) + "'"
                                Else
                                    Dim strCustomerID As String = ""
                                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                                        If n = 0 Then
                                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                                        Else
                                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                                        End If
                                    Next
                                    partStrtemp = "'" + strCustomerID + "'"
                                End If
                            Else
                                'partStrtemp = (Me.ddlPart.SelectedValue)
                                '================
                                'Customer開放複選
                                '================
                                If ddl_ProductType.Text = sWB_Rename Then
                                    partStrtemp = Get_PartID()
                                End If
                            End If
                            hAry = New Hashtable
                            ' PART By Day
                            For x As Integer = 0 To (dayAry.Count - 1)
                                yObj = New yieldInfo
                                'If ddl_BumpingType.Enabled = False Then
                                '    If getDateRangeData(yObj, conn, partStrtemp, (dayAry(x).ToString()), 0, True) Then
                                '        hAry.Add((dayAry(x).ToString()), yObj)
                                '    End If
                                'Else
                                '    If getDateRangeData(yObj, conn, partStrtemp, (dayAry(x).ToString()), 0, True, ddl_BumpingType.Text) Then
                                '        hAry.Add((dayAry(x).ToString()), yObj)
                                '    End If
                                'End If
                                If listB_BumpingTypeShow.Enabled = False Then
                                    If rbl_BySource.SelectedIndex = 0 Then
                                        If getDateRangeData(yObj, conn, productionStr, partStr, (dayAry(x).ToString()), 0, True, dayAry) Then
                                            If hAry(dayAry(x).ToString()) Is Nothing = True Then
                                                hAry.Add((dayAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    Else
                                        If getDateRangeData(yObj, conn, partStrtemp, productionStr, (dayAry(x).ToString()), 0, True, dayAry) Then
                                            If hAry(dayAry(x).ToString()) Is Nothing = True Then
                                                hAry.Add((dayAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    End If
                                Else
                                    Dim strBumpingType As String = ""
                                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                        If n = 0 Then
                                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                        Else
                                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                        End If
                                    Next

                                    If rbl_BySource.SelectedIndex = 0 Then
                                        If getDateRangeData(yObj, conn, productionStr, partStr, (dayAry(x).ToString()), 0, True, dayAry, strBumpingType) Then
                                            If hAry(dayAry(x).ToString()) Is Nothing = True Then
                                                hAry.Add((dayAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    Else
                                        If getDateRangeData(yObj, conn, partStrtemp, productionStr, (dayAry(x).ToString()), 0, True, dayAry, strBumpingType) Then
                                            If hAry(dayAry(x).ToString()) Is Nothing = True Then
                                                hAry.Add((dayAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    End If
                                End If
                            Next
                            ' PART By Week
                            For x As Integer = 0 To (weekAry.Count - 1)
                                yObj = New yieldInfo
                                'If ddl_BumpingType.Enabled = False Then
                                '    If getDateRangeData(yObj, conn, partStrtemp, (weekAry(x).ToString()), 1, True) Then
                                '        hAry.Add((weekAry(x).ToString()), yObj)
                                '    End If
                                'Else
                                '    If getDateRangeData(yObj, conn, partStrtemp, (weekAry(x).ToString()), 1, True, ddl_BumpingType.Text) Then
                                '        hAry.Add((weekAry(x).ToString()), yObj)
                                '    End If
                                'End If
                                If listB_BumpingTypeShow.Enabled = False Then
                                    If rbl_BySource.SelectedIndex = 0 Then
                                        If getDateRangeData(yObj, conn, productionStr, partStr, (weekAry(x).ToString()), 1, True, dayAry) Then
                                            If hAry(weekAry(x).ToString()) Is Nothing = True Then
                                                hAry.Add((weekAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    Else
                                        If getDateRangeData(yObj, conn, partStrtemp, productionStr, (weekAry(x).ToString()), 1, True, dayAry) Then
                                            If hAry(weekAry(x).ToString()) Is Nothing = True Then
                                                hAry.Add((weekAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    End If
                                Else
                                    Dim strBumpingType As String = ""
                                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                        If n = 0 Then
                                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                        Else
                                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                        End If
                                    Next

                                    If rbl_BySource.SelectedIndex = 0 Then
                                        If getDateRangeData(yObj, conn, productionStr, partStr, (weekAry(x).ToString()), 1, True, dayAry, strBumpingType) Then
                                            If hAry(weekAry(x).ToString()) Is Nothing = True Then
                                                hAry.Add((weekAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    Else
                                        If getDateRangeData(yObj, conn, partStrtemp, productionStr, (weekAry(x).ToString()), 1, True, dayAry, strBumpingType) Then
                                            If hAry(weekAry(x).ToString()) Is Nothing = True Then
                                                hAry.Add((weekAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    End If
                                End If
                            Next
                            ' PART By Month
                            For x As Integer = 0 To (monthAry.Count - 1)
                                yObj = New yieldInfo
                                'If ddl_BumpingType.Enabled = False Then
                                '    If getDateRangeData(yObj, conn, partStrtemp, (monthAry(x).ToString()), 2, True) Then
                                '        hAry.Add((monthAry(x).ToString()), yObj)
                                '    End If
                                'Else
                                '    If getDateRangeData(yObj, conn, partStrtemp, (monthAry(x).ToString()), 2, True, ddl_BumpingType.Text) Then
                                '        hAry.Add((monthAry(x).ToString()), yObj)
                                '    End If
                                'End If
                                If listB_BumpingTypeShow.Enabled = False Then
                                    If rbl_BySource.SelectedIndex = 0 Then
                                        If getDateRangeData(yObj, conn, productionStr, partStr, (monthAry(x).ToString()), 2, True, dayAry) Then
                                            If hAry(monthAry(x).ToString()) Is Nothing = True Then
                                                hAry.Add((monthAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    Else
                                        If getDateRangeData(yObj, conn, partStrtemp, productionStr, (monthAry(x).ToString()), 2, True, dayAry) Then
                                            If hAry(monthAry(x).ToString()) Is Nothing = True Then
                                                hAry.Add((monthAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    End If
                                Else
                                    Dim strBumpingType As String = ""
                                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                        If n = 0 Then
                                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                        Else
                                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                        End If
                                    Next

                                    If rbl_BySource.SelectedIndex = 0 Then
                                        If getDateRangeData(yObj, conn, productionStr, partStr, (monthAry(x).ToString()), 2, True, dayAry, strBumpingType) Then
                                            If hAry(monthAry(x).ToString()) Is Nothing = True Then
                                                hAry.Add((monthAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    Else
                                        If getDateRangeData(yObj, conn, partStrtemp, productionStr, (monthAry(x).ToString()), 2, True, dayAry, strBumpingType) Then
                                            If hAry(monthAry(x).ToString()) Is Nothing = True Then
                                                hAry.Add((monthAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    End If
                                End If
                            Next
                            chartTable = New DataTable()
                            chartTable = workTable.Clone()
                            generateDataSource(customerStr, ("Summary"), chartTable, workTable, hAry)

                            chartHash = New Hashtable
                            chartHash.Add(("Summary"), chartTable)
                            chartAry.Add(chartHash)

                        End If
                    End If
                Next
                conn.Close()

                ' --- Row Data Display ---
                Try
                    gv_rowdata.DataSource = workTable
                    gv_rowdata.DataBind()
                    UtilObj.Set_DataGridRow_OnMouseOver_Color(gv_rowdata, "#FFF68F", gv_rowdata.AlternatingRowStyle.BackColor)
                Catch ex As Exception
                    Dim sError As String = ex.ToString()
                End Try

                ' --- 放 Chart 到 Chart_Panel ---
                Dim yield_item() As String = CType(ViewState("CPU_gItem"), String())
                'Dim yield_item_temp() As String = CType(ViewState("CPU_gItem"), String())
                'Dim oYield_item_temp As Hashtable = New Hashtable()
                'Dim sYield_item_temp As String = ""
                'For idx As Integer = 0 To (yield_item_temp.Length - 1)
                '    If oYield_item_temp(yield_item_temp(idx)) = Nothing Then
                '        If idx <> yield_item_temp.Length - 1 Then
                '            sYield_item_temp += yield_item_temp(idx) + ","
                '        Else
                '            sYield_item_temp += yield_item_temp(idx)
                '        End If
                '        oYield_item_temp.Add(yield_item_temp(idx), yield_item_temp(idx))
                '    End If
                'Next
                'Dim yield_item() As String = sYield_item_temp.Split(",")
                Dim yieldexist As Boolean = False
                Dim chartYieldStr As String = ""
                Dim aryColor() As Color = {Color.DodgerBlue, Color.Olive, Color.DarkOrange, Color.Purple, Color.DarkGreen, Color.Blue, Color.Firebrick, Color.Green, Color.DarkSlateBlue, Color.DarkSlateGray, Color.Khaki, Color.Thistle}
                'Dim aryColor() As Color = {Color.FromArgb(179, 29, 64), Color.FromArgb(239, 104, 38), Color.FromArgb(245, 218, 13), Color.FromArgb(134, 196, 63), Color.FromArgb(37, 170, 227), Color.FromArgb(16, 83, 164), Color.FromArgb(88, 55, 146), Color.FromArgb(216, 27, 91), Color.FromArgb(252, 181, 29), Color.FromArgb(247, 238, 47), Color.FromArgb(29, 157, 132), Color.FromArgb(24, 121, 190), Color.FromArgb(13, 84, 166), Color.FromArgb(187, 29, 106), Color.FromArgb(240, 149, 32), Color.FromArgb(204, 219, 40), Color.FromArgb(32, 127, 145), Color.FromArgb(25, 86, 166), Color.FromArgb(45, 57, 141), Color.FromArgb(150, 36, 147)}
                For idx As Integer = 0 To (yield_item.Length - 1)
                    yieldexist = False
                    chartYieldStr = yield_item(idx)
                    For idy As Integer = 0 To (lb_weekShow.Items.Count - 1)
                        If chartYieldStr = lb_weekShow.Items(idy).Text Then
                            yieldexist = True
                            Exit For
                        End If
                    Next
                    If yieldexist Then
                        'If ddlPart.SelectedValue = "All" Then
                        If IsRename = False Then
                            If ddl_ProductType.SelectedValue <> sWB Then
                                'If idx = 0 Then
                                Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                Chart.ImageType = ChartImageType.Png
                                Chart.Palette = ChartColorPalette.Dundas
                                Chart.Height = Unit.Pixel(400)
                                Chart.Width = Unit.Pixel(1050)

                                Chart.Palette = ChartColorPalette.Dundas
                                Chart.BackColor = Color.White
                                Chart.BackGradientEndColor = Color.Peru
                                Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                Chart.BorderStyle = ChartDashStyle.Solid
                                Chart.BorderWidth = 3
                                Chart.BorderColor = Color.DarkBlue

                                'If Chart.ChartAreas.Count = 0 Then
                                Chart.ChartAreas.Add("Default")
                                'End If
                                Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                Chart.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                Chart.ChartAreas("Default").AxisY.Interval = 10
                                Chart.ChartAreas("Default").AxisY.Minimum = 0 '50
                                Chart.ChartAreas("Default").AxisY.Maximum = 100

                                Chart.UI.Toolbar.Enabled = False
                                Chart.UI.ContextMenu.Enabled = True

                                chartYieldStr = yield_item(idx)
                                yieldexist = False
                                'End If
                                If (listB_PartShow.Items.Count > 1) Then
                                    If cb_ChartMerge.Checked = True Then
                                        DrawChart(Chart, chartAry, idx, chartYieldStr)
                                        Chart_Panel.Controls.Add(Chart)
                                    Else
                                        'For x As Integer = 0 To (chartAry.Count - 1)
                                        '    chartHash = CType(chartAry(x), Hashtable)
                                        '    Dim Chart1 As Dundas.Charting.WebControl.Chart = Chart
                                        '    DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                        '    Chart_Panel.Controls.Add(Chart1)
                                        'Next
                                        For x As Integer = 0 To (chartAry.Count - 1)
                                            Dim Chart1 As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                            'If idx = 0 Then
                                            Chart1.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                            Chart1.ImageType = ChartImageType.Png
                                            Chart1.Palette = ChartColorPalette.Dundas
                                            Chart1.Height = Unit.Pixel(400)
                                            Chart1.Width = Unit.Pixel(1050)

                                            Chart1.Palette = ChartColorPalette.Dundas
                                            Chart1.BackColor = Color.White
                                            Chart1.BackGradientEndColor = Color.Peru
                                            Chart1.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                            Chart1.BorderStyle = ChartDashStyle.Solid
                                            Chart1.BorderWidth = 3
                                            Chart1.BorderColor = Color.DarkBlue

                                            Chart1.ChartAreas.Add("Default")
                                            Chart1.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                            Chart1.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                            Chart1.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                            Chart1.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                            Chart1.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                            Chart1.ChartAreas("Default").AxisY.Interval = 10
                                            Chart1.ChartAreas("Default").AxisY.Minimum = 0 '50
                                            Chart1.ChartAreas("Default").AxisY.Maximum = 100

                                            Chart1.UI.Toolbar.Enabled = False
                                            Chart1.UI.ContextMenu.Enabled = True

                                            chartYieldStr = yield_item(idx)
                                            yieldexist = False
                                            'End If

                                            chartHash = CType(chartAry(x), Hashtable)
                                            DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                            Chart_Panel.Controls.Add(Chart1)
                                        Next
                                    End If
                                Else
                                    DrawChart(Chart, chartAry, idx, chartYieldStr)
                                    Chart_Panel.Controls.Add(Chart)
                                End If
                            Else
                                If (listB_BumpingTypeShow.Items.Count > 0) Then
                                    Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                    If (listB_PartShow.Items.Count > 1) Then
                                        If cb_ChartMerge.Checked = True Then
                                            DrawChart(Chart, chartAry, idx, chartYieldStr)
                                            Chart_Panel.Controls.Add(Chart)
                                        Else
                                            'For x As Integer = 0 To (chartAry.Count - 1)
                                            '    chartHash = CType(chartAry(x), Hashtable)
                                            '    Dim Chart1 As Dundas.Charting.WebControl.Chart = Chart
                                            '    DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                            '    Chart_Panel.Controls.Add(Chart1)
                                            'Next
                                            For x As Integer = 0 To (chartAry.Count - 1)
                                                Dim Chart1 As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                                'If idx = 0 Then
                                                Chart1.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                                Chart1.ImageType = ChartImageType.Png
                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.Height = Unit.Pixel(400)
                                                Chart1.Width = Unit.Pixel(1050)

                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.BackColor = Color.White
                                                Chart1.BackGradientEndColor = Color.Peru
                                                Chart1.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                                Chart1.BorderStyle = ChartDashStyle.Solid
                                                Chart1.BorderWidth = 3
                                                Chart1.BorderColor = Color.DarkBlue

                                                Chart1.ChartAreas.Add("Default")
                                                Chart1.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                                Chart1.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                                Chart1.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                                Chart1.ChartAreas("Default").AxisY.Interval = 10
                                                Chart1.ChartAreas("Default").AxisY.Minimum = 0 '50
                                                Chart1.ChartAreas("Default").AxisY.Maximum = 100

                                                Chart1.UI.Toolbar.Enabled = False
                                                Chart1.UI.ContextMenu.Enabled = True

                                                chartYieldStr = yield_item(idx)
                                                yieldexist = False
                                                'End If

                                                chartHash = CType(chartAry(x), Hashtable)
                                                DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                                Chart_Panel.Controls.Add(Chart1)
                                            Next
                                        End If
                                    Else
                                        DrawChart(Chart, chartAry, idx, chartYieldStr)
                                        Chart_Panel.Controls.Add(Chart)
                                    End If
                                    'DrawChart(Chart, chartAry, idx, chartYieldStr)
                                    'Chart_Panel.Controls.Add(Chart)

                                    'For i As Integer = 0 To (chartAry.Count - 1)
                                    '    Try
                                    '        Dim isMultiChart As Boolean = False
                                    '        If (chartAry.Count > 1) Then
                                    '            isMultiChart = True
                                    '        End If
                                    '        chartHash = CType(chartAry(i), Hashtable)
                                    '        Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                    '        For Each entry As DictionaryEntry In chartHash
                                    '            If idx = 0 Then
                                    '                Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                    '                Chart.ImageType = ChartImageType.Png
                                    '                Chart.Palette = ChartColorPalette.Dundas
                                    '                Chart.Height = Unit.Pixel(400)
                                    '                Chart.Width = Unit.Pixel(1050)

                                    '                Chart.Palette = ChartColorPalette.Dundas
                                    '                Chart.BackColor = Color.White
                                    '                Chart.BackGradientEndColor = Color.Peru
                                    '                Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                    '                Chart.BorderStyle = ChartDashStyle.Solid
                                    '                Chart.BorderWidth = 3
                                    '                Chart.BorderColor = Color.DarkBlue

                                    '                Chart.ChartAreas.Add("Default")
                                    '                Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                    '                Chart.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                    '                Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                    '                Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                    '                Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet

                                    '                Chart.UI.Toolbar.Enabled = False
                                    '                Chart.UI.ContextMenu.Enabled = True

                                    '                chartYieldStr = yield_item(idx)
                                    '                yieldexist = False
                                    '            End If
                                    '            Dim chartDT As DataTable
                                    '            If entry.Key.ToString <> "Summary" Then
                                    '                If chartAry.Count <= 10 Then
                                    '                    ' --- Bar Chart ---
                                    '                    chartDT = CType(entry.Value, DataTable)
                                    '                    If rb_DataTimeCustor.SelectedIndex = 1 Then
                                    '                        DrawBar_Range(Chart, aryColor(i), entry, chartDT, idx, isMultiChart)
                                    '                    Else
                                    '                        DrawBar(Chart, aryColor(i), entry, chartDT, idx, isMultiChart)
                                    '                    End If
                                    '                End If
                                    '            Else
                                    '                ' --- Thrend Chart ---
                                    '                chartDT = CType(entry.Value, DataTable)
                                    '                DrawThrend(Chart, Color.DarkRed, entry, chartDT, idx)
                                    '                Chart_Panel.Controls.Add(Chart)
                                    '            End If
                                    '        Next
                                    '    Catch ex As Exception
                                    '        Dim sError As String = ex.ToString()
                                    '    End Try
                                    'Next
                                Else
                                    Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                    If idx = 0 Then
                                        Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                        Chart.ImageType = ChartImageType.Png
                                        Chart.Palette = ChartColorPalette.Dundas
                                        Chart.Height = Unit.Pixel(400)
                                        Chart.Width = Unit.Pixel(1050)

                                        Chart.Palette = ChartColorPalette.Dundas
                                        Chart.BackColor = Color.White
                                        Chart.BackGradientEndColor = Color.Peru
                                        Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                        Chart.BorderStyle = ChartDashStyle.Solid
                                        Chart.BorderWidth = 3
                                        Chart.BorderColor = Color.DarkBlue

                                        'If Chart.ChartAreas.Count = 0 Then
                                        Chart.ChartAreas.Add("Default")
                                        'End If
                                        Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                        Chart.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                        Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                        Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                        Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                        Chart.ChartAreas("Default").AxisY.Interval = 10
                                        Chart.ChartAreas("Default").AxisY.Minimum = 0 '50
                                        Chart.ChartAreas("Default").AxisY.Maximum = 100

                                        Chart.UI.Toolbar.Enabled = False
                                        Chart.UI.ContextMenu.Enabled = True

                                        chartYieldStr = yield_item(idx)
                                        yieldexist = False
                                    End If

                                    If (listB_PartShow.Items.Count > 1) Then
                                        If cb_ChartMerge.Checked = True Then
                                            DrawChart(Chart, chartAry, idx, chartYieldStr)
                                            Chart_Panel.Controls.Add(Chart)
                                        Else
                                            For x As Integer = 0 To (chartAry.Count - 1)
                                                Dim Chart1 As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                                'If idx = 0 Then
                                                Chart1.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                                Chart1.ImageType = ChartImageType.Png
                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.Height = Unit.Pixel(400)
                                                Chart1.Width = Unit.Pixel(1050)

                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.BackColor = Color.White
                                                Chart1.BackGradientEndColor = Color.Peru
                                                Chart1.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                                Chart1.BorderStyle = ChartDashStyle.Solid
                                                Chart1.BorderWidth = 3
                                                Chart1.BorderColor = Color.DarkBlue

                                                Chart1.ChartAreas.Add("Default")
                                                Chart1.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                                Chart1.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                                Chart1.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                                Chart1.ChartAreas("Default").AxisY.Interval = 10
                                                Chart1.ChartAreas("Default").AxisY.Minimum = 0 '50
                                                Chart1.ChartAreas("Default").AxisY.Maximum = 100

                                                Chart1.UI.Toolbar.Enabled = False
                                                Chart1.UI.ContextMenu.Enabled = True

                                                chartYieldStr = yield_item(idx)
                                                yieldexist = False
                                                'End If

                                                chartHash = CType(chartAry(x), Hashtable)
                                                DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                                Chart_Panel.Controls.Add(Chart1)
                                            Next
                                        End If
                                    Else
                                        DrawChart(Chart, chartAry, idx, chartYieldStr)
                                        Chart_Panel.Controls.Add(Chart)
                                    End If
                                End If
                            End If
                        Else
                            If ddl_ProductType.SelectedValue <> sWB_Rename Then
                                'If idx = 0 Then
                                Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                Chart.ImageType = ChartImageType.Png
                                Chart.Palette = ChartColorPalette.Dundas
                                Chart.Height = Unit.Pixel(400)
                                Chart.Width = Unit.Pixel(1050)

                                Chart.Palette = ChartColorPalette.Dundas
                                Chart.BackColor = Color.White
                                Chart.BackGradientEndColor = Color.Peru
                                Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                Chart.BorderStyle = ChartDashStyle.Solid
                                Chart.BorderWidth = 3
                                Chart.BorderColor = Color.DarkBlue

                                'If Chart.ChartAreas.Count = 0 Then
                                Chart.ChartAreas.Add("Default")
                                'End If
                                Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                Chart.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                Chart.ChartAreas("Default").AxisY.Interval = 10
                                Chart.ChartAreas("Default").AxisY.Minimum = 0 '50
                                Chart.ChartAreas("Default").AxisY.Maximum = 100

                                Chart.UI.Toolbar.Enabled = False
                                Chart.UI.ContextMenu.Enabled = True

                                chartYieldStr = yield_item(idx)
                                yieldexist = False
                                'End If
                                If (listB_PartShow.Items.Count > 1) Then
                                    If cb_ChartMerge.Checked = True Then
                                        DrawChart(Chart, chartAry, idx, chartYieldStr)
                                        Chart_Panel.Controls.Add(Chart)
                                    Else
                                        'For x As Integer = 0 To (chartAry.Count - 1)
                                        '    chartHash = CType(chartAry(x), Hashtable)
                                        '    Dim Chart1 As Dundas.Charting.WebControl.Chart = Chart
                                        '    DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                        '    Chart_Panel.Controls.Add(Chart1)
                                        'Next
                                        For x As Integer = 0 To (chartAry.Count - 1)
                                            Dim Chart1 As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                            'If idx = 0 Then
                                            Chart1.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                            Chart1.ImageType = ChartImageType.Png
                                            Chart1.Palette = ChartColorPalette.Dundas
                                            Chart1.Height = Unit.Pixel(400)
                                            Chart1.Width = Unit.Pixel(1050)

                                            Chart1.Palette = ChartColorPalette.Dundas
                                            Chart1.BackColor = Color.White
                                            Chart1.BackGradientEndColor = Color.Peru
                                            Chart1.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                            Chart1.BorderStyle = ChartDashStyle.Solid
                                            Chart1.BorderWidth = 3
                                            Chart1.BorderColor = Color.DarkBlue

                                            Chart1.ChartAreas.Add("Default")
                                            Chart1.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                            Chart1.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                            Chart1.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                            Chart1.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                            Chart1.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                            Chart1.ChartAreas("Default").AxisY.Interval = 10
                                            Chart1.ChartAreas("Default").AxisY.Minimum = 0 '50
                                            Chart1.ChartAreas("Default").AxisY.Maximum = 100

                                            Chart1.UI.Toolbar.Enabled = False
                                            Chart1.UI.ContextMenu.Enabled = True

                                            chartYieldStr = yield_item(idx)
                                            yieldexist = False
                                            'End If

                                            chartHash = CType(chartAry(x), Hashtable)
                                            DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                            Chart_Panel.Controls.Add(Chart1)
                                        Next
                                    End If
                                Else
                                    DrawChart(Chart, chartAry, idx, chartYieldStr)
                                    Chart_Panel.Controls.Add(Chart)
                                End If
                            Else
                                If (listB_BumpingTypeShow.Items.Count > 0) Then
                                    Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                    If (listB_PartShow.Items.Count > 1) Then
                                        If cb_ChartMerge.Checked = True Then
                                            DrawChart(Chart, chartAry, idx, chartYieldStr)
                                            Chart_Panel.Controls.Add(Chart)
                                        Else
                                            'For x As Integer = 0 To (chartAry.Count - 1)
                                            '    chartHash = CType(chartAry(x), Hashtable)
                                            '    Dim Chart1 As Dundas.Charting.WebControl.Chart = Chart
                                            '    DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                            '    Chart_Panel.Controls.Add(Chart1)
                                            'Next
                                            For x As Integer = 0 To (chartAry.Count - 1)
                                                Dim Chart1 As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                                'If idx = 0 Then
                                                Chart1.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                                Chart1.ImageType = ChartImageType.Png
                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.Height = Unit.Pixel(400)
                                                Chart1.Width = Unit.Pixel(1050)

                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.BackColor = Color.White
                                                Chart1.BackGradientEndColor = Color.Peru
                                                Chart1.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                                Chart1.BorderStyle = ChartDashStyle.Solid
                                                Chart1.BorderWidth = 3
                                                Chart1.BorderColor = Color.DarkBlue

                                                Chart1.ChartAreas.Add("Default")
                                                Chart1.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                                Chart1.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                                Chart1.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                                Chart1.ChartAreas("Default").AxisY.Interval = 10
                                                Chart1.ChartAreas("Default").AxisY.Minimum = 0 '50
                                                Chart1.ChartAreas("Default").AxisY.Maximum = 100

                                                Chart1.UI.Toolbar.Enabled = False
                                                Chart1.UI.ContextMenu.Enabled = True

                                                chartYieldStr = yield_item(idx)
                                                yieldexist = False
                                                'End If

                                                chartHash = CType(chartAry(x), Hashtable)
                                                DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                                Chart_Panel.Controls.Add(Chart1)
                                            Next
                                        End If
                                    Else
                                        DrawChart(Chart, chartAry, idx, chartYieldStr)
                                        Chart_Panel.Controls.Add(Chart)
                                    End If
                                    'DrawChart(Chart, chartAry, idx, chartYieldStr)
                                    'Chart_Panel.Controls.Add(Chart)

                                    'For i As Integer = 0 To (chartAry.Count - 1)
                                    '    Try
                                    '        Dim isMultiChart As Boolean = False
                                    '        If (chartAry.Count > 1) Then
                                    '            isMultiChart = True
                                    '        End If
                                    '        chartHash = CType(chartAry(i), Hashtable)
                                    '        Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                    '        For Each entry As DictionaryEntry In chartHash
                                    '            If idx = 0 Then
                                    '                Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                    '                Chart.ImageType = ChartImageType.Png
                                    '                Chart.Palette = ChartColorPalette.Dundas
                                    '                Chart.Height = Unit.Pixel(400)
                                    '                Chart.Width = Unit.Pixel(1050)

                                    '                Chart.Palette = ChartColorPalette.Dundas
                                    '                Chart.BackColor = Color.White
                                    '                Chart.BackGradientEndColor = Color.Peru
                                    '                Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                    '                Chart.BorderStyle = ChartDashStyle.Solid
                                    '                Chart.BorderWidth = 3
                                    '                Chart.BorderColor = Color.DarkBlue

                                    '                Chart.ChartAreas.Add("Default")
                                    '                Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                    '                Chart.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                    '                Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                    '                Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                    '                Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet

                                    '                Chart.UI.Toolbar.Enabled = False
                                    '                Chart.UI.ContextMenu.Enabled = True

                                    '                chartYieldStr = yield_item(idx)
                                    '                yieldexist = False
                                    '            End If
                                    '            Dim chartDT As DataTable
                                    '            If entry.Key.ToString <> "Summary" Then
                                    '                If chartAry.Count <= 10 Then
                                    '                    ' --- Bar Chart ---
                                    '                    chartDT = CType(entry.Value, DataTable)
                                    '                    If rb_DataTimeCustor.SelectedIndex = 1 Then
                                    '                        DrawBar_Range(Chart, aryColor(i), entry, chartDT, idx, isMultiChart)
                                    '                    Else
                                    '                        DrawBar(Chart, aryColor(i), entry, chartDT, idx, isMultiChart)
                                    '                    End If
                                    '                End If
                                    '            Else
                                    '                ' --- Thrend Chart ---
                                    '                chartDT = CType(entry.Value, DataTable)
                                    '                DrawThrend(Chart, Color.DarkRed, entry, chartDT, idx)
                                    '                Chart_Panel.Controls.Add(Chart)
                                    '            End If
                                    '        Next
                                    '    Catch ex As Exception
                                    '        Dim sError As String = ex.ToString()
                                    '    End Try
                                    'Next
                                Else
                                    Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                    If idx = 0 Then
                                        Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                        Chart.ImageType = ChartImageType.Png
                                        Chart.Palette = ChartColorPalette.Dundas
                                        Chart.Height = Unit.Pixel(400)
                                        Chart.Width = Unit.Pixel(1050)

                                        Chart.Palette = ChartColorPalette.Dundas
                                        Chart.BackColor = Color.White
                                        Chart.BackGradientEndColor = Color.Peru
                                        Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                        Chart.BorderStyle = ChartDashStyle.Solid
                                        Chart.BorderWidth = 3
                                        Chart.BorderColor = Color.DarkBlue

                                        'If Chart.ChartAreas.Count = 0 Then
                                        Chart.ChartAreas.Add("Default")
                                        'End If
                                        Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                        Chart.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                        Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                        Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                        Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                        Chart.ChartAreas("Default").AxisY.Interval = 10
                                        Chart.ChartAreas("Default").AxisY.Minimum = 0 '50
                                        Chart.ChartAreas("Default").AxisY.Maximum = 100

                                        Chart.UI.Toolbar.Enabled = False
                                        Chart.UI.ContextMenu.Enabled = True

                                        chartYieldStr = yield_item(idx)
                                        yieldexist = False
                                    End If

                                    If (listB_PartShow.Items.Count > 1) Then
                                        If cb_ChartMerge.Checked = True Then
                                            DrawChart(Chart, chartAry, idx, chartYieldStr)
                                            Chart_Panel.Controls.Add(Chart)
                                        Else
                                            For x As Integer = 0 To (chartAry.Count - 1)
                                                Dim Chart1 As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                                'If idx = 0 Then
                                                Chart1.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                                Chart1.ImageType = ChartImageType.Png
                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.Height = Unit.Pixel(400)
                                                Chart1.Width = Unit.Pixel(1050)

                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.BackColor = Color.White
                                                Chart1.BackGradientEndColor = Color.Peru
                                                Chart1.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                                Chart1.BorderStyle = ChartDashStyle.Solid
                                                Chart1.BorderWidth = 3
                                                Chart1.BorderColor = Color.DarkBlue

                                                Chart1.ChartAreas.Add("Default")
                                                Chart1.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                                Chart1.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                                Chart1.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                                Chart1.ChartAreas("Default").AxisY.Interval = 10
                                                Chart1.ChartAreas("Default").AxisY.Minimum = 0 '50
                                                Chart1.ChartAreas("Default").AxisY.Maximum = 100

                                                Chart1.UI.Toolbar.Enabled = False
                                                Chart1.UI.ContextMenu.Enabled = True

                                                chartYieldStr = yield_item(idx)
                                                yieldexist = False
                                                'End If

                                                chartHash = CType(chartAry(x), Hashtable)
                                                DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                                Chart_Panel.Controls.Add(Chart1)
                                            Next
                                        End If
                                    Else
                                        DrawChart(Chart, chartAry, idx, chartYieldStr)
                                        Chart_Panel.Controls.Add(Chart)
                                    End If
                                End If
                            End If
                        End If
                    End If
                Next

                tr_chartDisplay.Visible = True
                tr_gvDisplay.Visible = True
            Catch ex As Exception
                Dim sError As String = ex.ToString()
            Finally
                If conn.State = ConnectionState.Open Then
                    conn.Close()
                End If
            End Try
        Else
            'If ddl_ProductType.Text <> "WB" Then
            '    cb_ChartMerge.Checked = True
            '    cb_ChartMerge.Enabled = True
            'End If

            If (lb_weekShow.Items.Count = 0) Then
                ShowMessage("請選擇 Yield Type !")
                Return
            End If

            If rb_DataTimeCustor.SelectedIndex = 1 AndAlso listB_timeShow.Items.Count < 1 Then
                ShowMessage("請選擇時間區間 !")
                Return
            End If

            If rbl_BySource.Enabled = True AndAlso rbl_BySource.SelectedIndex = 1 AndAlso listB_PartShow.Items.Count = 0 Then
                ShowMessage("請至少選擇一個料號進行資料篩選 !")
                Return
            ElseIf rbl_BySource.Enabled = True AndAlso rbl_BySource.SelectedIndex = 1 AndAlso listB_PartShow.Items.Count > 10 Then
                ShowMessage("請減少料號數量至10個以內進行資料篩選 !")
                Return
            End If

            ' Step1. 尋找要的日, 週, 月
            Dim dayAry As ArrayList = New ArrayList
            Dim weekAry As ArrayList = New ArrayList
            Dim monthAry As ArrayList = New ArrayList
            Dim dyear As String = ""
            Dim dWeek As String = ""
            Dim dStr As String = ""
            Dim tmpString As String = ""

            Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
            Dim sqlStr As String = ""
            Dim conditionStr As String = ""
            Dim myAdapter As SqlDataAdapter
            Dim yObj As yieldInfo
            Dim myDT, chartTable As DataTable
            Dim chartAry As ArrayList = New ArrayList
            Dim chartHash As Hashtable = New Hashtable
            Dim hAry As Hashtable = New Hashtable

            If AxisYMinimum.Text = "" Then
                AxisYMinimum.Text = "85"
            End If
            Try
                conn.Open()
                If rb_DataTimeCustor.SelectedIndex = 1 Then
                    If rbl_lossItem.SelectedIndex = 0 Then
                        ' Day
                        For i As Integer = 0 To (listB_timeShow.Items.Count - 1)
                            dayAry.Add(listB_timeShow.Items(i).Text)
                        Next
                        dayAry.Reverse()
                    ElseIf rbl_lossItem.SelectedIndex = 1 Then
                        ' Week 
                        For i As Integer = 0 To (listB_timeShow.Items.Count - 1)
                            weekAry.Add(listB_timeShow.Items(i).Text)
                        Next
                        weekAry.Reverse()
                    Else
                        ' Month
                        For i As Integer = 0 To (listB_timeShow.Items.Count - 1)
                            monthAry.Add(listB_timeShow.Items(i).Text)
                        Next
                        monthAry.Reverse()
                    End If
                Else
                    ' === Day === 取7天
                    Dim i As Integer = 6
                    While (i > -1)
                        If cb_ShowToday.Checked Then
                            ' 當天要納入
                            tmpString = Date.Now.AddDays(-(i)).ToString("yyyyMMdd")
                        ElseIf cb_customerDay.Checked Then
                            ' 自訂時間區間
                            If i = 0 Then
                                tmpString = ((txtDateFrom.Text) + (ddlHourFrom.SelectedValue)) + "~" + ((txtDateTo.Text) + (ddlHourTo.SelectedValue))
                            Else
                                tmpString = Date.Now.AddDays(-(i)).ToString("yyyyMMdd")
                            End If
                        Else
                            ' 一般,當天不要納入
                            tmpString = Date.Now.AddDays(-(i + 1)).ToString("yyyyMMdd")
                        End If
                        dayAry.Add(tmpString)
                        i -= 1
                    End While
                    ' === Week === 取5週  
                    Dim weeksql As String = "select yearWW from SystemDateMapping where customer='YIP' and DateTime='{0}'"
                    i = 4
                    While (i > -1)
                        If cb_ShowToday.Checked Then '當天要納入
                            tmpString = Date.Now.AddDays(-(i * 7)).ToString("yyyy-MM-dd")
                        Else '一般,當天不要納入
                            If Date.Now.DayOfWeek = DayOfWeek.Friday Then
                                tmpString = Date.Now.AddDays(-(i * 7) - 1).ToString("yyyy-MM-dd")
                            Else
                                tmpString = Date.Now.AddDays(-(i * 7)).ToString("yyyy-MM-dd")
                            End If
                        End If
                        myAdapter = New SqlDataAdapter(String.Format(weeksql, tmpString), conn)
                        myDT = New DataTable
                        myAdapter.Fill(myDT)
                        weekAry.Add(myDT.Rows(0)("yearWW").ToString())
                        i -= 1
                    End While
                    ' === Month === 取3個月
                    i = 2
                    While (i > -1)
                        tmpString = Date.Now.AddMonths(-i).ToString("yyyyMM")
                        monthAry.Add(tmpString)
                        i -= 1
                    End While
                End If

                ' Step2. 先組合 Report 所要的 DataTable 
                Dim workTable As DataTable = New DataTable()
                workTable.Columns.Add("Type", Type.GetType("System.String"))
                workTable.Columns.Add("Customer ID", Type.GetType("System.String"))
                workTable.Columns.Add("Part ID", Type.GetType("System.String"))
                For x As Integer = 0 To (monthAry.Count - 1)
                    workTable.Columns.Add((monthAry(x)).ToString(), Type.GetType("System.String"))
                Next
                For x As Integer = 0 To (weekAry.Count - 1)
                    workTable.Columns.Add((weekAry(x)).ToString(), Type.GetType("System.String"))
                Next
                For x As Integer = 0 To (dayAry.Count - 1)
                    workTable.Columns.Add((dayAry(x)).ToString(), Type.GetType("System.String"))
                Next

                ' 2012/12/20 如果有 All, 就呈現所有料號的 "Total yield Bar Chart!"
                'If (listB_PartSource.Items.Count = 0 AndAlso listB_PartShow.Items.Count > 0) Then
                '    If listB_PartShow.Items.Count > 1 Then
                '        Dim gItem(1) As String
                '        gItem(0) = "LotCount"
                '        If lb_weekShow.Items(0).Text = "Total Yield" Then
                '            gItem(1) = "Total Yield"
                '        Else
                '            gItem(1) = "Total"
                '        End If
                '        ViewState("CPU_gItem") = gItem
                '    End If
                'End If

                Dim myYieldItem As DataTable = New DataTable()
                Dim sYieldItem As String = Get_YieldItem()
                Dim YieldItemSeq_sql As String = "SELECT * "
                YieldItemSeq_sql += "FROM Yield_CATEGORY_Order_Mapping "
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        If ddl_CustomerID.Text = "INTEL" Then
                            YieldItemSeq_sql += "WHERE Customer_Id = 'INTEL' "
                        Else
                            YieldItemSeq_sql += "WHERE Customer_Id = 'ALL' "
                        End If
                    Else
                        YieldItemSeq_sql += "WHERE Customer_Id = 'ALL' "
                    End If
                Else
                    YieldItemSeq_sql += "WHERE Customer_Id = 'ALL' "
                End If
                If sYieldItem <> "" Then
                    YieldItemSeq_sql += "AND Yield_Category IN(" + Get_YieldItem() + ") "
                End If
                YieldItemSeq_sql += "AND yield_type = '" + ddl_ProductType.SelectedValue + "' "
                YieldItemSeq_sql += "AND yield_mode = '" + ddl_YieldMode.SelectedValue.Replace("By ", "").Replace(" ", "") + "' "
                YieldItemSeq_sql += "ORDER BY SEQ"

                myAdapter = New SqlDataAdapter(String.Format(YieldItemSeq_sql, tmpString), conn)
                myAdapter.Fill(myYieldItem)

                ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
                Dim addIndex As Integer = 0
                Dim gItem(lb_weekShow.Items.Count) As String
                gItem(addIndex) = "LotCount"
                addIndex += 1
                'For i As Integer = 0 To (lb_weekShow.Items.Count - 1)
                For i As Integer = 0 To myYieldItem.Rows.Count - 1
                    'gItem(addIndex) = lb_weekShow.Items(i).Text
                    gItem(addIndex) = myYieldItem.Rows(i)("Yield_CATEGORY")
                    addIndex += 1
                Next
                ViewState("CPU_gItem") = gItem

                tr_chartDisplay.Visible = False
                tr_gvDisplay.Visible = False
                tb_uploadLot.Visible = False

                Dim sGetPartID As String = Get_PartID()
                If (rbl_BySource.SelectedIndex = 0) Then
                    ' --- Production ID ---
                    If rbl_BySource.Enabled = True Then
                        If sGetPartID <> "" Then
                            '===[Loader取消ABFS by Product 計算，改由網頁即時計算]====================
                            'conditionStr += "and production_id in(" + sGetPartID + ") "
                            'conditionStr += "and Part_Id in(select a.Part_id from EDA.dbo.Customer_Prodction_Mapping a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                            If IsRename = False Then
                                sqlStr = "and Part_Id in(select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                            Else
                                sqlStr = "and Part_Id in(select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                            End If
                        End If
                    End If
                Else
                    ' --- Part ID ---
                    If rbl_BySource.Enabled = True Then
                        If sGetPartID <> "" Then
                            conditionStr += "and Part_Id in(" + sGetPartID + ") "
                        End If
                    End If
                End If
                'If (rbl_BySource.SelectedIndex = 1 And (listB_PartSource.Items.Count = 0 AndAlso listB_PartSource.Items.Count > 0)) Then
                '    If ddl_CustomerID.Enabled = True Then
                '        conditionStr = "and customer_id='" + ddl_CustomerID.SelectedValue + "' "
                '    End If
                'End If
                sqlStr += "Select production_id, Part_Id, Memo "
                If IsRename = False Then
                    sqlStr += "from " + confTable + " "
                Else
                    sqlStr += "from " + confTableRename + " "
                End If
                sqlStr += "where 1=1 "
                sqlStr += "and yield_function=1 "
                ' --- Product Type ---
                sqlStr += "and category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += conditionStr
                sqlStr += "group by production_id, Part_Id, Memo"

                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)

                ' Step3. 取得 Part 下面的 RowData
                Dim customerStr, productionStr, partStr, part_plant As String
                For partIndex As Integer = 0 To (myDT.Rows.Count - 1)
                    If IsDBNull(myDT.Rows(partIndex)("production_id")) Then
                        customerStr = "N/A"
                    Else
                        customerStr = myDT.Rows(partIndex)("production_id")
                    End If
                    productionStr = "'" + myDT.Rows(partIndex)("production_id").ToString() + "'"
                    partStr = "'" + myDT.Rows(partIndex)("Part_Id").ToString() + "'"
                    part_plant = "'" + myDT.Rows(partIndex)("Memo").ToString() + "'"

                    hAry = New Hashtable
                    ' PART By Day
                    For x As Integer = 0 To (dayAry.Count - 1)
                        yObj = New yieldInfo
                        If listB_BumpingTypeShow.Enabled = False Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                If getDateRangeData(yObj, conn, productionStr, partStr, (dayAry(x).ToString()), 0, False, dayAry) Then
                                    hAry.Add((dayAry(x).ToString()), yObj)
                                End If
                            Else
                                If getDateRangeData(yObj, conn, productionStr, partStr, (dayAry(x).ToString()), 0, False, dayAry) Then
                                    hAry.Add((dayAry(x).ToString()), yObj)
                                End If
                            End If
                        Else
                            Dim strBumpingType As String = ""
                            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                If n = 0 Then
                                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                Else
                                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                End If
                            Next

                            If rbl_BySource.SelectedIndex = 0 Then
                                If getDateRangeData(yObj, conn, productionStr, partStr, (dayAry(x).ToString()), 0, False, dayAry, strBumpingType) Then
                                    hAry.Add((dayAry(x).ToString()), yObj)
                                End If
                            Else
                                If getDateRangeData(yObj, conn, productionStr, partStr, (dayAry(x).ToString()), 0, False, dayAry, strBumpingType) Then
                                    hAry.Add((dayAry(x).ToString()), yObj)
                                End If
                            End If
                        End If
                    Next
                    ' PART By Week
                    For x As Integer = 0 To (weekAry.Count - 1)
                        yObj = New yieldInfo
                        If listB_BumpingTypeShow.Enabled = False Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                If getDateRangeData(yObj, conn, productionStr, partStr, (weekAry(x).ToString()), 1, False, dayAry) Then
                                    hAry.Add((weekAry(x).ToString()), yObj)
                                End If
                            Else
                                If getDateRangeData(yObj, conn, productionStr, partStr, (weekAry(x).ToString()), 1, False, dayAry) Then
                                    hAry.Add((weekAry(x).ToString()), yObj)
                                End If
                            End If
                        Else
                            Dim strBumpingType As String = ""
                            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                If n = 0 Then
                                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                Else
                                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                End If
                            Next

                            If rbl_BySource.SelectedIndex = 0 Then
                                If getDateRangeData(yObj, conn, productionStr, partStr, (weekAry(x).ToString()), 1, False, dayAry, strBumpingType) Then
                                    hAry.Add((weekAry(x).ToString()), yObj)
                                End If
                            Else
                                If getDateRangeData(yObj, conn, productionStr, partStr, (weekAry(x).ToString()), 1, False, dayAry, strBumpingType) Then
                                    hAry.Add((weekAry(x).ToString()), yObj)
                                End If
                            End If
                        End If
                    Next
                    ' PART By Month
                    For x As Integer = 0 To (monthAry.Count - 1)
                        yObj = New yieldInfo
                        If listB_BumpingTypeShow.Enabled = False Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                If getDateRangeData(yObj, conn, productionStr, partStr, (monthAry(x).ToString()), 2, False, dayAry) Then
                                    hAry.Add((monthAry(x).ToString()), yObj)
                                End If
                            Else
                                If getDateRangeData(yObj, conn, productionStr, partStr, (monthAry(x).ToString()), 2, False, dayAry) Then
                                    hAry.Add((monthAry(x).ToString()), yObj)
                                End If
                            End If
                        Else
                            Dim strBumpingType As String = ""
                            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                If n = 0 Then
                                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                Else
                                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                End If
                            Next

                            If rbl_BySource.SelectedIndex = 0 Then
                                If getDateRangeData(yObj, conn, productionStr, partStr, (monthAry(x).ToString()), 2, False, dayAry, strBumpingType) Then
                                    hAry.Add((monthAry(x).ToString()), yObj)
                                End If
                            Else
                                If getDateRangeData(yObj, conn, productionStr, partStr, (monthAry(x).ToString()), 2, False, dayAry, strBumpingType) Then
                                    hAry.Add((monthAry(x).ToString()), yObj)
                                End If
                            End If
                        End If
                    Next

                    chartTable = New DataTable()
                    chartTable = workTable.Clone()
                    generateDataSource(customerStr, part_plant, chartTable, workTable, hAry)

                    chartHash = New Hashtable
                    chartHash.Add(partStr, chartTable)
                    chartAry.Add(chartHash)

                    Try
                        '加入(Summary) ' 選擇 CustomerID, 最後一筆, Part有2筆以上 " * 非必要 "
                        If partIndex = (myDT.Rows.Count - 1) Then
                            If (rbl_BySource.SelectedIndex = 0 Or (listB_PartShow.Items.Count > 0 Or listB_BumpingTypeShow.Items.Count > 0)) And (myDT.Rows.Count > 1) Then
                                Dim partStrtemp As String = ""
                                If (listB_PartSource.Items.Count = 0 AndAlso listB_PartShow.Items.Count > 0) Then
                                    partStrtemp = "'" + (ddl_CustomerID.SelectedValue) + "'"
                                Else
                                    partStrtemp = Get_PartID()
                                End If
                                hAry = New Hashtable
                                ' PART By Day
                                For x As Integer = 0 To (dayAry.Count - 1)
                                    yObj = New yieldInfo
                                    If listB_BumpingTypeShow.Enabled = False Then
                                        If rbl_BySource.SelectedIndex = 0 Then
                                            If getDateRangeData(yObj, conn, productionStr, partStr, (dayAry(x).ToString()), 0, True, dayAry) Then
                                                hAry.Add((dayAry(x).ToString()), yObj)
                                            End If
                                        Else
                                            If getDateRangeData(yObj, conn, productionStr, partStrtemp, (dayAry(x).ToString()), 0, True, dayAry) Then
                                                hAry.Add((dayAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    Else
                                        Dim strBumpingType As String = ""
                                        For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                            If n = 0 Then
                                                strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                            Else
                                                strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                            End If
                                        Next

                                        If rbl_BySource.SelectedIndex = 0 Then
                                            If getDateRangeData(yObj, conn, productionStr, partStr, (dayAry(x).ToString()), 0, True, dayAry, strBumpingType) Then
                                                hAry.Add((dayAry(x).ToString()), yObj)
                                            End If
                                        Else
                                            If getDateRangeData(yObj, conn, productionStr, partStrtemp, (dayAry(x).ToString()), 0, True, dayAry, strBumpingType) Then
                                                hAry.Add((dayAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    End If
                                Next
                                ' PART By Week
                                For x As Integer = 0 To (weekAry.Count - 1)
                                    yObj = New yieldInfo
                                    If listB_BumpingTypeShow.Enabled = False Then
                                        If rbl_BySource.SelectedIndex = 0 Then
                                            If getDateRangeData(yObj, conn, productionStr, partStr, (weekAry(x).ToString()), 1, True, dayAry) Then
                                                hAry.Add((weekAry(x).ToString()), yObj)
                                            End If
                                        Else
                                            If getDateRangeData(yObj, conn, productionStr, partStrtemp, (weekAry(x).ToString()), 1, True, dayAry) Then
                                                hAry.Add((weekAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    Else
                                        Dim strBumpingType As String = ""
                                        For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                            If n = 0 Then
                                                strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                            Else
                                                strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                            End If
                                        Next

                                        If rbl_BySource.SelectedIndex = 0 Then
                                            If getDateRangeData(yObj, conn, productionStr, partStr, (weekAry(x).ToString()), 1, True, dayAry, strBumpingType) Then
                                                hAry.Add((weekAry(x).ToString()), yObj)
                                            End If
                                        Else
                                            If getDateRangeData(yObj, conn, productionStr, partStrtemp, (weekAry(x).ToString()), 1, True, dayAry, strBumpingType) Then
                                                hAry.Add((weekAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    End If
                                Next
                                ' PART By Month
                                For x As Integer = 0 To (monthAry.Count - 1)
                                    yObj = New yieldInfo
                                    If listB_BumpingTypeShow.Enabled = False Then
                                        If rbl_BySource.SelectedIndex = 0 Then
                                            If getDateRangeData(yObj, conn, productionStr, partStr, (monthAry(x).ToString()), 2, True, dayAry) Then
                                                hAry.Add((monthAry(x).ToString()), yObj)
                                            End If
                                        Else
                                            If getDateRangeData(yObj, conn, productionStr, partStrtemp, (monthAry(x).ToString()), 2, True, dayAry) Then
                                                hAry.Add((monthAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    Else
                                        Dim strBumpingType As String = ""
                                        For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                            If n = 0 Then
                                                strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                            Else
                                                strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                            End If
                                        Next

                                        If rbl_BySource.SelectedIndex = 0 Then
                                            If getDateRangeData(yObj, conn, productionStr, partStr, (monthAry(x).ToString()), 2, True, dayAry, strBumpingType) Then
                                                hAry.Add((monthAry(x).ToString()), yObj)
                                            End If
                                        Else
                                            If getDateRangeData(yObj, conn, productionStr, partStrtemp, (monthAry(x).ToString()), 2, True, dayAry, strBumpingType) Then
                                                hAry.Add((monthAry(x).ToString()), yObj)
                                            End If
                                        End If
                                    End If
                                Next
                                chartTable = New DataTable()
                                chartTable = workTable.Clone()
                                generateDataSource(customerStr, ("Summary"), chartTable, workTable, hAry)

                                chartHash = New Hashtable
                                chartHash.Add(("Summary"), chartTable)
                                chartAry.Add(chartHash)
                            End If
                        End If
                    Catch ex As Exception
                        Dim sError As String = ex.ToString()
                    End Try
                Next
                conn.Close()

                ' --- Row Data Display ---
                Try
                    gv_rowdata.DataSource = workTable
                    gv_rowdata.DataBind()
                    UtilObj.Set_DataGridRow_OnMouseOver_Color(gv_rowdata, "#FFF68F", gv_rowdata.AlternatingRowStyle.BackColor)
                Catch ex As Exception
                    Dim sError As String = ex.ToString()
                End Try

                ' --- 放 Chart 到 Chart_Panel ---
                Dim yield_item() As String = CType(ViewState("CPU_gItem"), String())
                Dim yieldexist As Boolean = False
                Dim chartYieldStr As String = ""
                Dim aryColor() As Color = {Color.DodgerBlue, Color.Olive, Color.DarkOrange, Color.Purple, Color.DarkGreen, Color.Blue, Color.Firebrick, Color.Green, Color.DarkSlateBlue, Color.DarkSlateGray, Color.Khaki, Color.Thistle}
                For idx As Integer = 0 To (yield_item.Length - 1)
                    yieldexist = False
                    chartYieldStr = yield_item(idx)
                    For idy As Integer = 0 To (lb_weekShow.Items.Count - 1)
                        If chartYieldStr = lb_weekShow.Items(idy).Text Then
                            yieldexist = True
                            Exit For
                        End If
                    Next
                    If yieldexist Then
                        If IsRename = False Then
                            If ddl_ProductType.SelectedValue <> sWB Then
                                'If idx = 0 Then
                                Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                Chart.ImageType = ChartImageType.Png
                                Chart.Palette = ChartColorPalette.Dundas
                                Chart.Height = Unit.Pixel(400)
                                Chart.Width = Unit.Pixel(1050)

                                Chart.Palette = ChartColorPalette.Dundas
                                Chart.BackColor = Color.White
                                Chart.BackGradientEndColor = Color.Peru
                                Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                Chart.BorderStyle = ChartDashStyle.Solid
                                Chart.BorderWidth = 3
                                Chart.BorderColor = Color.DarkBlue

                                'If Chart.ChartAreas.Count = 0 Then
                                Chart.ChartAreas.Add("Default")
                                'End If
                                Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                Chart.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                Chart.ChartAreas("Default").AxisY.Interval = 10
                                Chart.ChartAreas("Default").AxisY.Minimum = 0 '50
                                Chart.ChartAreas("Default").AxisY.Maximum = 100

                                Chart.UI.Toolbar.Enabled = False
                                Chart.UI.ContextMenu.Enabled = True

                                chartYieldStr = yield_item(idx)
                                yieldexist = False
                                'End If
                                If (listB_PartShow.Items.Count > 1) Then
                                    If cb_ChartMerge.Checked = True Then
                                        DrawChart_Target(Chart, chartAry, idx, chartYieldStr)
                                        Chart_Panel.Controls.Add(Chart)
                                    Else
                                        'For x As Integer = 0 To (chartAry.Count - 1)
                                        '    chartHash = CType(chartAry(x), Hashtable)
                                        '    DrawChartBySingle_Target(Chart, chartHash, idx, chartYieldStr)
                                        '    Chart_Panel.Controls.Add(Chart)
                                        'Next
                                        For x As Integer = 0 To (chartAry.Count - 1)
                                            Dim Chart1 As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                            'If idx = 0 Then
                                            Chart1.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                            Chart1.ImageType = ChartImageType.Png
                                            Chart1.Palette = ChartColorPalette.Dundas
                                            Chart1.Height = Unit.Pixel(400)
                                            Chart1.Width = Unit.Pixel(1050)

                                            Chart1.Palette = ChartColorPalette.Dundas
                                            Chart1.BackColor = Color.White
                                            Chart1.BackGradientEndColor = Color.Peru
                                            Chart1.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                            Chart1.BorderStyle = ChartDashStyle.Solid
                                            Chart1.BorderWidth = 3
                                            Chart1.BorderColor = Color.DarkBlue

                                            Chart1.ChartAreas.Add("Default")
                                            Chart1.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                            Chart1.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                            Chart1.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                            Chart1.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                            Chart1.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                            Chart1.ChartAreas("Default").AxisY.Interval = 10
                                            Chart1.ChartAreas("Default").AxisY.Minimum = 0 '50
                                            Chart1.ChartAreas("Default").AxisY.Maximum = 100

                                            Chart1.UI.Toolbar.Enabled = False
                                            Chart1.UI.ContextMenu.Enabled = True

                                            chartYieldStr = yield_item(idx)
                                            yieldexist = False
                                            'End If

                                            chartHash = CType(chartAry(x), Hashtable)
                                            DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                            Chart_Panel.Controls.Add(Chart1)
                                        Next
                                    End If
                                Else
                                    DrawChart_Target(Chart, chartAry, idx, chartYieldStr)
                                    Chart_Panel.Controls.Add(Chart)
                                End If
                            Else
                                If (listB_BumpingTypeShow.Items.Count > 0) Then
                                    Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                    If (listB_PartShow.Items.Count > 1) Then
                                        If cb_ChartMerge.Checked = True Then
                                            DrawChart_Target(Chart, chartAry, idx, chartYieldStr)
                                            Chart_Panel.Controls.Add(Chart)
                                        Else
                                            'For x As Integer = 0 To (chartAry.Count - 1)
                                            '    chartHash = CType(chartAry(x), Hashtable)
                                            '    DrawChartBySingle_Target(Chart, chartHash, idx, chartYieldStr)
                                            '    Chart_Panel.Controls.Add(Chart)
                                            'Next
                                            For x As Integer = 0 To (chartAry.Count - 1)
                                                Dim Chart1 As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                                'If idx = 0 Then
                                                Chart1.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                                Chart1.ImageType = ChartImageType.Png
                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.Height = Unit.Pixel(400)
                                                Chart1.Width = Unit.Pixel(1050)

                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.BackColor = Color.White
                                                Chart1.BackGradientEndColor = Color.Peru
                                                Chart1.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                                Chart1.BorderStyle = ChartDashStyle.Solid
                                                Chart1.BorderWidth = 3
                                                Chart1.BorderColor = Color.DarkBlue

                                                Chart1.ChartAreas.Add("Default")
                                                Chart1.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                                Chart1.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                                Chart1.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                                Chart1.ChartAreas("Default").AxisY.Interval = 10
                                                Chart1.ChartAreas("Default").AxisY.Minimum = 0 '50
                                                Chart1.ChartAreas("Default").AxisY.Maximum = 100

                                                Chart1.UI.Toolbar.Enabled = False
                                                Chart1.UI.ContextMenu.Enabled = True

                                                chartYieldStr = yield_item(idx)
                                                yieldexist = False
                                                'End If

                                                chartHash = CType(chartAry(x), Hashtable)
                                                DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                                Chart_Panel.Controls.Add(Chart1)
                                            Next
                                        End If
                                    Else
                                        DrawChart_Target(Chart, chartAry, idx, chartYieldStr)
                                        Chart_Panel.Controls.Add(Chart)
                                    End If
                                Else
                                    Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                    If idx = 0 Then
                                        Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                        Chart.ImageType = ChartImageType.Png
                                        Chart.Palette = ChartColorPalette.Dundas
                                        Chart.Height = Unit.Pixel(400)
                                        Chart.Width = Unit.Pixel(1050)

                                        Chart.Palette = ChartColorPalette.Dundas
                                        Chart.BackColor = Color.White
                                        Chart.BackGradientEndColor = Color.Peru
                                        Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                        Chart.BorderStyle = ChartDashStyle.Solid
                                        Chart.BorderWidth = 3
                                        Chart.BorderColor = Color.DarkBlue

                                        'If Chart.ChartAreas.Count = 0 Then
                                        Chart.ChartAreas.Add("Default")
                                        'End If
                                        Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                        Chart.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                        Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                        Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                        Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                        Chart.ChartAreas("Default").AxisY.Interval = 10
                                        Chart.ChartAreas("Default").AxisY.Minimum = 0 '50
                                        Chart.ChartAreas("Default").AxisY.Maximum = 100

                                        Chart.UI.Toolbar.Enabled = False
                                        Chart.UI.ContextMenu.Enabled = True

                                        chartYieldStr = yield_item(idx)
                                        yieldexist = False
                                    End If

                                    If (listB_PartShow.Items.Count > 1) Then
                                        If cb_ChartMerge.Checked = True Then
                                            DrawChart_Target(Chart, chartAry, idx, chartYieldStr)
                                            Chart_Panel.Controls.Add(Chart)
                                        Else
                                            For x As Integer = 0 To (chartAry.Count - 1)
                                                Dim Chart1 As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                                'If idx = 0 Then
                                                Chart1.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                                Chart1.ImageType = ChartImageType.Png
                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.Height = Unit.Pixel(400)
                                                Chart1.Width = Unit.Pixel(1050)

                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.BackColor = Color.White
                                                Chart1.BackGradientEndColor = Color.Peru
                                                Chart1.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                                Chart1.BorderStyle = ChartDashStyle.Solid
                                                Chart1.BorderWidth = 3
                                                Chart1.BorderColor = Color.DarkBlue

                                                Chart1.ChartAreas.Add("Default")
                                                Chart1.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                                Chart1.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                                Chart1.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                                Chart1.ChartAreas("Default").AxisY.Interval = 10
                                                Chart1.ChartAreas("Default").AxisY.Minimum = 0 '50
                                                Chart1.ChartAreas("Default").AxisY.Maximum = 100

                                                Chart1.UI.Toolbar.Enabled = False
                                                Chart1.UI.ContextMenu.Enabled = True

                                                chartYieldStr = yield_item(idx)
                                                yieldexist = False
                                                'End If

                                                chartHash = CType(chartAry(x), Hashtable)
                                                DrawChartBySingle_Target(Chart1, chartHash, idx, chartYieldStr)
                                                Chart_Panel.Controls.Add(Chart1)
                                            Next
                                        End If
                                    Else
                                        DrawChart_Target(Chart, chartAry, idx, chartYieldStr)
                                        Chart_Panel.Controls.Add(Chart)
                                    End If
                                End If
                            End If
                        Else
                            If ddl_ProductType.SelectedValue <> sWB_Rename Then
                                'If idx = 0 Then
                                Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                Chart.ImageType = ChartImageType.Png
                                Chart.Palette = ChartColorPalette.Dundas
                                Chart.Height = Unit.Pixel(400)
                                Chart.Width = Unit.Pixel(1050)

                                Chart.Palette = ChartColorPalette.Dundas
                                Chart.BackColor = Color.White
                                Chart.BackGradientEndColor = Color.Peru
                                Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                Chart.BorderStyle = ChartDashStyle.Solid
                                Chart.BorderWidth = 3
                                Chart.BorderColor = Color.DarkBlue

                                'If Chart.ChartAreas.Count = 0 Then
                                Chart.ChartAreas.Add("Default")
                                'End If
                                Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                Chart.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                Chart.ChartAreas("Default").AxisY.Interval = 10
                                Chart.ChartAreas("Default").AxisY.Minimum = 0 '50
                                Chart.ChartAreas("Default").AxisY.Maximum = 100

                                Chart.UI.Toolbar.Enabled = False
                                Chart.UI.ContextMenu.Enabled = True

                                chartYieldStr = yield_item(idx)
                                yieldexist = False
                                'End If
                                If (listB_PartShow.Items.Count > 1) Then
                                    If cb_ChartMerge.Checked = True Then
                                        DrawChart_Target(Chart, chartAry, idx, chartYieldStr)
                                        Chart_Panel.Controls.Add(Chart)
                                    Else
                                        'For x As Integer = 0 To (chartAry.Count - 1)
                                        '    chartHash = CType(chartAry(x), Hashtable)
                                        '    DrawChartBySingle_Target(Chart, chartHash, idx, chartYieldStr)
                                        '    Chart_Panel.Controls.Add(Chart)
                                        'Next
                                        For x As Integer = 0 To (chartAry.Count - 1)
                                            Dim Chart1 As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                            'If idx = 0 Then
                                            Chart1.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                            Chart1.ImageType = ChartImageType.Png
                                            Chart1.Palette = ChartColorPalette.Dundas
                                            Chart1.Height = Unit.Pixel(400)
                                            Chart1.Width = Unit.Pixel(1050)

                                            Chart1.Palette = ChartColorPalette.Dundas
                                            Chart1.BackColor = Color.White
                                            Chart1.BackGradientEndColor = Color.Peru
                                            Chart1.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                            Chart1.BorderStyle = ChartDashStyle.Solid
                                            Chart1.BorderWidth = 3
                                            Chart1.BorderColor = Color.DarkBlue

                                            Chart1.ChartAreas.Add("Default")
                                            Chart1.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                            Chart1.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                            Chart1.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                            Chart1.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                            Chart1.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                            Chart1.ChartAreas("Default").AxisY.Interval = 10
                                            Chart1.ChartAreas("Default").AxisY.Minimum = 0 '50
                                            Chart1.ChartAreas("Default").AxisY.Maximum = 100

                                            Chart1.UI.Toolbar.Enabled = False
                                            Chart1.UI.ContextMenu.Enabled = True

                                            chartYieldStr = yield_item(idx)
                                            yieldexist = False
                                            'End If

                                            chartHash = CType(chartAry(x), Hashtable)
                                            DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                            Chart_Panel.Controls.Add(Chart1)
                                        Next
                                    End If
                                Else
                                    DrawChart_Target(Chart, chartAry, idx, chartYieldStr)
                                    Chart_Panel.Controls.Add(Chart)
                                End If
                            Else
                                If (listB_BumpingTypeShow.Items.Count > 0) Then
                                    Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                    If (listB_PartShow.Items.Count > 1) Then
                                        If cb_ChartMerge.Checked = True Then
                                            DrawChart_Target(Chart, chartAry, idx, chartYieldStr)
                                            Chart_Panel.Controls.Add(Chart)
                                        Else
                                            'For x As Integer = 0 To (chartAry.Count - 1)
                                            '    chartHash = CType(chartAry(x), Hashtable)
                                            '    DrawChartBySingle_Target(Chart, chartHash, idx, chartYieldStr)
                                            '    Chart_Panel.Controls.Add(Chart)
                                            'Next
                                            For x As Integer = 0 To (chartAry.Count - 1)
                                                Dim Chart1 As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                                'If idx = 0 Then
                                                Chart1.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                                Chart1.ImageType = ChartImageType.Png
                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.Height = Unit.Pixel(400)
                                                Chart1.Width = Unit.Pixel(1050)

                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.BackColor = Color.White
                                                Chart1.BackGradientEndColor = Color.Peru
                                                Chart1.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                                Chart1.BorderStyle = ChartDashStyle.Solid
                                                Chart1.BorderWidth = 3
                                                Chart1.BorderColor = Color.DarkBlue

                                                Chart1.ChartAreas.Add("Default")
                                                Chart1.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                                Chart1.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                                Chart1.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                                Chart1.ChartAreas("Default").AxisY.Interval = 10
                                                Chart1.ChartAreas("Default").AxisY.Minimum = 0 '50
                                                Chart1.ChartAreas("Default").AxisY.Maximum = 100

                                                Chart1.UI.Toolbar.Enabled = False
                                                Chart1.UI.ContextMenu.Enabled = True

                                                chartYieldStr = yield_item(idx)
                                                yieldexist = False
                                                'End If

                                                chartHash = CType(chartAry(x), Hashtable)
                                                DrawChartBySingle(Chart1, chartHash, idx, chartYieldStr)
                                                Chart_Panel.Controls.Add(Chart1)
                                            Next
                                        End If
                                    Else
                                        DrawChart_Target(Chart, chartAry, idx, chartYieldStr)
                                        Chart_Panel.Controls.Add(Chart)
                                    End If
                                Else
                                    Dim Chart As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                    If idx = 0 Then
                                        Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                        Chart.ImageType = ChartImageType.Png
                                        Chart.Palette = ChartColorPalette.Dundas
                                        Chart.Height = Unit.Pixel(400)
                                        Chart.Width = Unit.Pixel(1050)

                                        Chart.Palette = ChartColorPalette.Dundas
                                        Chart.BackColor = Color.White
                                        Chart.BackGradientEndColor = Color.Peru
                                        Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                        Chart.BorderStyle = ChartDashStyle.Solid
                                        Chart.BorderWidth = 3
                                        Chart.BorderColor = Color.DarkBlue

                                        'If Chart.ChartAreas.Count = 0 Then
                                        Chart.ChartAreas.Add("Default")
                                        'End If
                                        Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                        Chart.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                        Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                        Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                        Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                        Chart.ChartAreas("Default").AxisY.Interval = 10
                                        Chart.ChartAreas("Default").AxisY.Minimum = 0 '50
                                        Chart.ChartAreas("Default").AxisY.Maximum = 100

                                        Chart.UI.Toolbar.Enabled = False
                                        Chart.UI.ContextMenu.Enabled = True

                                        chartYieldStr = yield_item(idx)
                                        yieldexist = False
                                    End If

                                    If (listB_PartShow.Items.Count > 1) Then
                                        If cb_ChartMerge.Checked = True Then
                                            DrawChart_Target(Chart, chartAry, idx, chartYieldStr)
                                            Chart_Panel.Controls.Add(Chart)
                                        Else
                                            For x As Integer = 0 To (chartAry.Count - 1)
                                                Dim Chart1 As Dundas.Charting.WebControl.Chart = New Dundas.Charting.WebControl.Chart()
                                                'If idx = 0 Then
                                                Chart1.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
                                                Chart1.ImageType = ChartImageType.Png
                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.Height = Unit.Pixel(400)
                                                Chart1.Width = Unit.Pixel(1050)

                                                Chart1.Palette = ChartColorPalette.Dundas
                                                Chart1.BackColor = Color.White
                                                Chart1.BackGradientEndColor = Color.Peru
                                                Chart1.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                                                Chart1.BorderStyle = ChartDashStyle.Solid
                                                Chart1.BorderWidth = 3
                                                Chart1.BorderColor = Color.DarkBlue

                                                Chart1.ChartAreas.Add("Default")
                                                Chart1.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                                                Chart1.ChartAreas("Default").AxisX.Title = "【" + yield_item(idx) + "】"
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                                                Chart1.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
                                                Chart1.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
                                                Chart1.ChartAreas("Default").AxisY.Interval = 10
                                                Chart1.ChartAreas("Default").AxisY.Minimum = 0 '50
                                                Chart1.ChartAreas("Default").AxisY.Maximum = 100

                                                Chart1.UI.Toolbar.Enabled = False
                                                Chart1.UI.ContextMenu.Enabled = True

                                                chartYieldStr = yield_item(idx)
                                                yieldexist = False
                                                'End If

                                                chartHash = CType(chartAry(x), Hashtable)
                                                DrawChartBySingle_Target(Chart1, chartHash, idx, chartYieldStr)
                                                Chart_Panel.Controls.Add(Chart1)
                                            Next
                                        End If
                                    Else
                                        DrawChart_Target(Chart, chartAry, idx, chartYieldStr)
                                        Chart_Panel.Controls.Add(Chart)
                                    End If
                                End If
                            End If
                        End If
                    End If
                Next

                tr_chartDisplay.Visible = True
                tr_gvDisplay.Visible = True
            Catch ex As Exception
                Dim sError As String = ex.ToString()
            Finally
                If conn.State = ConnectionState.Open Then
                    conn.Close()
                End If
            End Try
        End If
    End Sub

    ' 程式初始化
    Private Function Get_BumpingType_PartID(ByVal sourceBumpingType As String) As String
        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter

        Try
            txtDateFrom.Text = DateTime.Now.AddDays(-1).ToString("yyyyMMdd")
            txtDateTo.Text = DateTime.Now.ToString("yyyyMMdd")

            conn.Open()

            ' --- Part ID ---
            If sourceBumpingType <> "All" Then
                sqlStr = "SELECT DISTINCT [Part_Id] "
                sqlStr += "FROM [EDA].[dbo].[Customer_Prodction_Mapping] "
                sqlStr += "WHERE 1=1 "
                ' --- Product Type ---
                sqlStr += "and category ='" + ddl_ProductType.SelectedValue + "' "
                sqlStr += "and [Bumping_Type] in(" & sourceBumpingType & ") "
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                    End If
                End If
            Else
                Return Nothing
            End If
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)

            conn.Close()

            Dim oPartID As New StringBuilder
            For I As Integer = 0 To myDT.Rows.Count - 1
                If I = 0 Then
                    oPartID.Append("'" & myDT.Rows(I)("Part_Id").ToString() & "'")
                Else
                    oPartID.Append(",'" & myDT.Rows(I)("Part_Id").ToString() & "'")
                End If
            Next

            Return oPartID.ToString()
        Catch ex As Exception

        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try

        Return Nothing
    End Function

    Private Function Get_ProductNo_PartID() As String
        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter

        Try
            txtDateFrom.Text = DateTime.Now.AddDays(-1).ToString("yyyyMMdd")
            txtDateTo.Text = DateTime.Now.ToString("yyyyMMdd")

            conn.Open()

            Dim sGetPartID As String = Get_PartID()
            sqlStr = "select a.Part_id "
            sqlStr += "from Customer_Prodction_Mapping_BU_Rename a "
            sqlStr += "LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No "
            sqlStr += "where a.Production_Id IN(" + sGetPartID + ")"

            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)

            conn.Close()

            Dim oPartID As New StringBuilder
            For I As Integer = 0 To myDT.Rows.Count - 1
                If I = 0 Then
                    oPartID.Append("'" & myDT.Rows(I)("Part_Id").ToString() & "'")
                Else
                    oPartID.Append(",'" & myDT.Rows(I)("Part_Id").ToString() & "'")
                End If
            Next

            Return oPartID.ToString()
        Catch ex As Exception

        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try

        Return Nothing
    End Function

    Private Function Get_PartID() As String
        Dim oPartID As New StringBuilder
        Try
            For I As Integer = 0 To listB_PartShow.Items.Count - 1
                If I = 0 Then
                    oPartID.Append("'" & listB_PartShow.Items(I).Text & "'")
                Else
                    oPartID.Append(",'" & listB_PartShow.Items(I).Text & "'")
                End If
            Next
        Catch ex As Exception

        End Try

        Return oPartID.ToString()
    End Function

    Private Function Get_YieldType() As String
        Dim oYieldType As New StringBuilder
        Try
            For I As Integer = 0 To lb_weekShow.Items.Count - 1
                If I = 0 Then
                    oYieldType.Append("'" & lb_weekShow.Items(I).Text & "'")
                Else
                    oYieldType.Append(",'" & lb_weekShow.Items(I).Text & "'")
                End If
            Next
        Catch ex As Exception

        End Try

        Return oYieldType.ToString()
    End Function

    Private Function Get_YieldItem() As String
        Dim oYieldItem As New StringBuilder
        Try
            For I As Integer = 0 To lb_weekShow.Items.Count - 1
                If I = 0 Then
                    oYieldItem.Append("'" & lb_weekShow.Items(I).Text & "'")
                Else
                    oYieldItem.Append(",'" & lb_weekShow.Items(I).Text & "'")
                End If
            Next
        Catch ex As Exception

        End Try

        Return oYieldItem.ToString()
    End Function

    Private Function Get_DateRange() As String
        Dim oDateRange As New StringBuilder
        Try
            For I As Integer = 0 To listB_timeShow.Items.Count - 1
                If I = 0 Then
                    oDateRange.Append("'" & listB_timeShow.Items(I).Text & "'")
                Else
                    oDateRange.Append(",'" & listB_timeShow.Items(I).Text & "'")
                End If
            Next
        Catch ex As Exception

        End Try

        Return oDateRange.ToString()
    End Function

    ' 取得每一 Yield Type 資料  [主要資料來源]
    Private Function getDateRangeData(ByRef yObj As yieldInfo, ByRef conn As SqlConnection, ByVal productionID As String, ByVal partID As String, ByVal WD As String, ByVal timeType As Integer, ByVal is_summary As Boolean, ByVal dayAry As ArrayList, Optional ByVal bumpingType As String = "") As Boolean
        Dim status As Boolean = False
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim monthNextStr As String
        Dim ConditionStr As String = ""

        Try
            'If ddl_BumpingType.Enabled = False AndAlso ddl_BumpingType.Text <> "All" Then
            '    is_summary = True
            'End If
            If listB_BumpingTypeShow.Enabled = False AndAlso listB_BumpingTypeSource.Items.Count > 0 Then
                is_summary = True
            End If
            Dim yyyy As String = WD.Replace("-", "").Substring(0, 4)
            Dim MM As String = WD.Replace("-", "").Substring(4, 2)
            Dim WW As String = WD.Replace("-", "").Substring(4, 2)
            Dim dd As String = ""
            If timeType = 0 Then
                dd = WD.Substring(6, 2)
            End If
            Dim sYearMonthDay = ""
            If timeType = 0 Then
                sYearMonthDay = yyyy + "-" + MM + "-" + dd
            End If
            Dim sYearMonth = ""
            If timeType = 0 OrElse timeType = 2 Then
                sYearMonth = yyyy + "-" + MM
            End If
            Dim sYearWeek = ""
            If timeType = 0 Then
                sYearWeek = yyyy + "-" + GetWeekOfYear(DateTime.ParseExact(sYearMonthDay, "yyyy-MM-dd", Nothing)).ToString("00")
            ElseIf timeType = 1 Then
                sYearWeek = yyyy + "-" + WW
            End If
            If is_summary = True Then
                Dim strBumpingType As String = ""
                If bumpingType <> "" Then
                    strBumpingType = Get_BumpingType_PartID(bumpingType)
                End If

                If timeType = 0 Then
                    ' --- Day ---
                    'If ddl_BumpingType.Enabled = False Then
                    '    ConditionStr += "and Production_id='{0}' "
                    'Else
                    '    If strBumpingType <> "" Then
                    '        'ConditionStr += "and Production_id in (" & strBumpingType & ") "
                    '        ConditionStr += "and Part_Id in (" & strBumpingType & ") "
                    '    End If
                    'End If
                    'If listB_BumpingTypeShow.Enabled = False Then
                    '    ConditionStr += "and Production_id='{0}' "
                    'Else
                    '    If strBumpingType <> "" Then
                    '        'ConditionStr += "and Production_id in (" & strBumpingType & ") "
                    '        ConditionStr += "and Part_Id in (" & strBumpingType & ") "
                    '    End If
                    'End If
                    If tr_BumpingType.Visible = False Then
                        If rbl_BySource.SelectedIndex = 0 Then 'Product No
                            Dim oPartID = Nothing
                            If (partID IsNot Nothing) Then
                                oPartID = partID.Split(",")
                            End If
                            Dim oProductionID = Nothing
                            If (productionID IsNot Nothing) Then
                                oProductionID = productionID.Split(",")
                            End If
                            If ddl_ProductType.Text <> sWB_Rename Then
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Production_id = " + productionID + " "
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Production_id in (" + productionID + ") "
                                    End If
                                End If
                            Else
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        'ConditionStr += "and Part_Id = " + productionID + " "
                                        ConditionStr += "and Production_id = " + productionID + " "
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        'ConditionStr += "and Part_Id in (" + productionID + ") "
                                        ConditionStr += "and Production_id in (" + productionID + ") "
                                    End If
                                End If
                            End If
                            If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                                If partID <> "" AndAlso partID <> "''" Then
                                    ConditionStr += "and Part_Id = " + partID + " "
                                End If
                            ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                                If partID <> "" AndAlso partID <> "''" Then
                                    ConditionStr += "and Part_Id in (" + partID + ") "
                                End If
                            End If
                        ElseIf rbl_BySource.SelectedIndex = 1 Then 'Part No
                            Dim oPartID = Nothing
                            If (partID IsNot Nothing) Then
                                oPartID = partID.Split(",")
                            End If
                            Dim oProductionID = Nothing
                            If (productionID IsNot Nothing) Then
                                oProductionID = productionID.Split(",")
                            End If
                            'If ddl_ProductType.Text <> sWB_Rename Then
                            '    If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                            '        If partID <> "" AndAlso partID <> "''" Then
                            '            ConditionStr += "and Part_Id = " + partID + " "
                            '        End If
                            '    ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                            '        If partID <> "" AndAlso partID <> "''" Then
                            '            ConditionStr += "and Part_Id in (" + partID + ") "
                            '        End If
                            '    End If
                            'Else
                            '    If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                            '        If productionID <> "" AndAlso productionID <> "''" Then
                            '            ConditionStr += "and Part_Id = " + productionID + " "
                            '        End If
                            '    ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                            '        If productionID <> "" AndAlso productionID <> "''" Then
                            '            ConditionStr += "and Part_Id in (" + productionID + ") "
                            '        End If
                            '    End If
                            'End If
                            If ddl_ProductType.Text <> sWB_Rename Then
                                If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                                    If partID <> "" AndAlso partID <> "''" Then
                                        ConditionStr += "and Part_Id = " + partID + " "
                                    End If
                                ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                                    If partID <> "" AndAlso partID <> "''" Then
                                        ConditionStr += "and Part_Id in (" + partID + ") "
                                    End If
                                End If
                            Else
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id = " + productionID + " "
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id in (" + productionID + ") "
                                    End If
                                End If
                            End If
                            'If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                            '    If partID <> "" AndAlso partID <> "''" Then
                            '        ConditionStr += "and Part_Id = " + partID + " "
                            '    End If
                            'ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                            '    If partID <> "" AndAlso partID <> "''" Then
                            '        ConditionStr += "and Part_Id in (" + partID + ") "
                            '    End If
                            'End If
                        End If
                    Else
                        If strBumpingType <> "" Then
                            ConditionStr += "and Part_Id in (" & strBumpingType & ") "
                        Else
                            Dim oPartID = Nothing
                            If (partID IsNot Nothing) Then
                                oPartID = partID.Split(",")
                            End If
                            Dim oProductionID = Nothing
                            If (productionID IsNot Nothing) Then
                                oProductionID = productionID.Split(",")
                            End If
                            If ddl_ProductType.Text <> sWB_Rename Then
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If rbl_BySource.SelectedIndex = 0 Then
                                        If productionID <> "" AndAlso productionID <> "''" Then
                                            ConditionStr += "and Production_id = " + productionID + " "
                                        End If
                                    Else
                                        If productionID <> "" AndAlso productionID <> "''" Then
                                            ConditionStr += "and Part_Id = " + productionID + " "
                                        End If
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If rbl_BySource.SelectedIndex = 0 Then
                                        If productionID <> "" AndAlso productionID <> "''" Then
                                            ConditionStr += "and Production_id in (" + productionID + ") "
                                        End If
                                    Else
                                        If productionID <> "" AndAlso productionID <> "''" Then
                                            ConditionStr += "and Part_Id in (" + productionID + ") "
                                        End If
                                    End If
                                End If
                            Else
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id = " + productionID + " "
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id in (" + productionID + ") "
                                    End If
                                End If
                            End If
                            If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                                If partID <> "" AndAlso partID <> "''" Then
                                    ConditionStr += "and Part_Id = " + partID + " "
                                End If
                            ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                                If partID <> "" AndAlso partID <> "''" Then
                                    ConditionStr += "and Part_Id in (" + partID + ") "
                                End If
                            End If
                        End If
                    End If
                    ConditionStr += "and DataTime >= '{1}' "
                    ConditionStr += "and DataTime <= '{2}' "
                    If cb_CR.Checked = False Then
                        ConditionStr += "and substring(lot_id,9,1)<>'Y' "
                        ConditionStr += "and substring(lot_id,9,1)<>'Z' "
                        ConditionStr += "and substring(Part_id,7,1)<>'V' "
                    End If
                    If cb_FAI.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                        ConditionStr += "and ISNUMERIC(SUBSTRING(Part_id,2,1))=0 "
                    End If
                    If cb_out.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                        ConditionStr += "and (substring(Part_id,2,1)<>'W' and (substring(Part_id,1,3)<>'SNW' and substring(Part_id,1,3)<>'AKW')) "
                    End If
                    If (WD.IndexOf("~") >= 0) And cb_customerDay.Checked Then
                        ConditionStr = String.Format(ConditionStr, partID, ((txtDateFrom.Text.Trim) + " " + (ddlHourFrom.SelectedValue) + ":00:00"), ((txtDateTo.Text.Trim) + " " + (ddlHourTo.SelectedValue) + ":00:00"))
                    Else
                        If cb_ShowToday.Checked And (WD = (DateTime.Now.ToString("yyyyMMdd"))) Then
                            Dim mWD As DateTime = DateTime.ParseExact(sYearMonthDay, "yyyy-MM-dd", Nothing)
                            ConditionStr = String.Format(ConditionStr, partID, ((mWD.AddDays(-1).ToString("yyyy-MM-dd")) + " 16:00:00"), (sYearMonthDay + " 16:00:00"))
                        Else
                            If (WD.Trim().Length = 8) Then
                                ConditionStr = String.Format(ConditionStr, partID, (sYearMonthDay + " 00:00:00"), (sYearMonthDay + " 23:59:59"))
                            End If
                        End If
                    End If
                ElseIf timeType = 1 Then
                    ' --- Week --
                    If tr_BumpingType.Visible = False Then
                        If rbl_BySource.SelectedIndex = 0 Then 'Product No
                            Dim oPartID = Nothing
                            If (partID IsNot Nothing) Then
                                oPartID = partID.Split(",")
                            End If
                            Dim oProductionID = Nothing
                            If (productionID IsNot Nothing) Then
                                oProductionID = productionID.Split(",")
                            End If
                            'If opartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                            '    If listB_BumpingTypeShow.Enabled = False Then
                            '        If partID <> "" AndAlso partID <> "''" Then
                            '            ConditionStr += "and Production_id = {0} "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    Else
                            '        If bumpingType <> "" Then
                            '            ConditionStr += "and Production_id = {0} "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    End If
                            'ElseIf opartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                            '    If listB_BumpingTypeShow.Enabled = False Then
                            '        If partID <> "" AndAlso partID <> "''" Then
                            '            ConditionStr += "and Part_Id in({0}) "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    Else
                            '        If bumpingType <> "" Then
                            '            ConditionStr += "and Part_Id in({0}) "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    End If
                            'End If
                            If ddl_ProductType.Text <> sWB_Rename Then
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    'If rbl_BySource.SelectedIndex = 0 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Production_id = " + productionID + " "
                                    End If
                                    'Else
                                    '    If productionID <> "" AndAlso productionID <> "''" Then
                                    '        ConditionStr += "and Part_Id = " + productionID + " "
                                    '    End If
                                    'End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    'If rbl_BySource.SelectedIndex = 0 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Production_id in (" + productionID + ") "
                                    End If
                                    'Else
                                    '    If productionID <> "" AndAlso productionID <> "''" Then
                                    '        ConditionStr += "and Part_Id in (" + productionID + ") "
                                    '    End If
                                    'End If
                                End If
                            Else
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id = " + productionID + " "
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id in (" + productionID + ") "
                                    End If
                                End If
                            End If
                            If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                                If partID <> "" AndAlso partID <> "''" Then
                                    ConditionStr += "and Part_Id = " + partID + " "
                                End If
                            ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                                If partID <> "" AndAlso partID <> "''" Then
                                    ConditionStr += "and Part_Id in (" + partID + ") "
                                End If
                            End If
                        ElseIf rbl_BySource.SelectedIndex = 1 Then 'Part No

                            Dim oPartID = Nothing
                            If (partID IsNot Nothing) Then
                                oPartID = partID.Split(",")
                            End If
                            Dim oProductionID = Nothing
                            If (productionID IsNot Nothing) Then
                                oProductionID = productionID.Split(",")
                            End If
                            'If opartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                            '    If listB_BumpingTypeShow.Enabled = False Then
                            '        If partID <> "" AndAlso partID <> "''" Then
                            '            ConditionStr += "and Part_Id = {0} "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    Else
                            '        If bumpingType <> "" Then
                            '            ConditionStr += "and Part_Id = {0} "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    End If
                            'ElseIf opartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                            '    If listB_BumpingTypeShow.Enabled = False Then
                            '        If partID <> "" AndAlso partID <> "''" Then
                            '            ConditionStr += "and Part_Id in({0}) "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    Else
                            '        If bumpingType <> "" Then
                            '            ConditionStr += "and Part_Id in({0}) "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    End If
                            'End If
                            ' ''If ddl_ProductType.Text <> sWB_Rename Then
                            ' ''    If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                            ' ''        If partID <> "" AndAlso partID <> "''" Then
                            ' ''            ConditionStr += "and Part_Id = " + partID + " "
                            ' ''        End If
                            ' ''    ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                            ' ''        If partID <> "" AndAlso partID <> "''" Then
                            ' ''            ConditionStr += "and Part_Id in (" + partID + ") "
                            ' ''        End If
                            ' ''    End If
                            ' ''Else
                            ' ''    If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                            ' ''        If productionID <> "" AndAlso productionID <> "''" Then
                            ' ''            ConditionStr += "and Part_Id = " + productionID + " "
                            ' ''        End If
                            ' ''    ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                            ' ''        If productionID <> "" AndAlso productionID <> "''" Then
                            ' ''            ConditionStr += "and Part_Id in (" + productionID + ") "
                            ' ''        End If
                            ' ''    End If
                            ' ''End If
                            ' ''If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                            ' ''    If partID <> "" AndAlso partID <> "''" Then
                            ' ''        ConditionStr += "and Part_Id = " + partID + " "
                            ' ''    End If
                            ' ''ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                            ' ''    If partID <> "" AndAlso partID <> "''" Then
                            ' ''        ConditionStr += "and Part_Id in (" + partID + ") "
                            ' ''    End If
                            ' ''End If

                            'If ddl_ProductType.Text <> sWB_Rename Then
                            '    If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                            '        'If rbl_BySource.SelectedIndex = 0 Then
                            '        '    If productionID <> "" AndAlso productionID <> "''" Then
                            '        '        ConditionStr += "and Production_id = " + productionID + " "
                            '        '    End If
                            '        'Else
                            '        If productionID <> "" AndAlso productionID <> "''" Then
                            '            ConditionStr += "and Production_id = " + productionID + " "
                            '        End If
                            '        'End If
                            '    ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                            '        'If rbl_BySource.SelectedIndex = 0 Then
                            '        '    If productionID <> "" AndAlso productionID <> "''" Then
                            '        '        ConditionStr += "and Production_id in (" + productionID + ") "
                            '        '    End If
                            '        'Else
                            '        If productionID <> "" AndAlso productionID <> "''" Then
                            '            ConditionStr += "and Part_Id in (" + productionID + ") "
                            '        End If
                            '        'End If
                            '    End If
                            'Else
                            '    If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                            '        If productionID <> "" AndAlso productionID <> "''" Then
                            '            ConditionStr += "and Part_Id = " + productionID + " "
                            '        End If
                            '    ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                            '        If productionID <> "" AndAlso productionID <> "''" Then
                            '            ConditionStr += "and Part_Id in (" + productionID + ") "
                            '        End If
                            '    End If
                            'End If
                            'If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                            '    If partID <> "" AndAlso partID <> "''" Then
                            '        ConditionStr += "and Part_Id = " + partID + " "
                            '    End If
                            'ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                            '    If partID <> "" AndAlso partID <> "''" Then
                            '        ConditionStr += "and Part_Id in (" + partID + ") "
                            '    End If
                            'End If
                            If ddl_ProductType.Text <> sWB_Rename Then
                                If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                                    If partID <> "" AndAlso partID <> "''" Then
                                        ConditionStr += "and Part_Id = " + partID + " "
                                    End If
                                ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                                    If partID <> "" AndAlso partID <> "''" Then
                                        ConditionStr += "and Part_Id in (" + partID + ") "
                                    End If
                                End If
                            Else
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id = " + productionID + " "
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id in (" + productionID + ") "
                                    End If
                                End If
                            End If
                        End If
                    Else
                        If strBumpingType <> "" Then
                            ConditionStr += "and Part_Id in (" & strBumpingType & ") "
                        Else
                            Dim oPartID = Nothing
                            If (partID IsNot Nothing) Then
                                oPartID = partID.Split(",")
                            End If
                            Dim oProductionID = Nothing
                            If (productionID IsNot Nothing) Then
                                oProductionID = productionID.Split(",")
                            End If
                            'If opartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                            '    If partID <> "" AndAlso partID <> "''" Then
                            '        ConditionStr += "and Part_Id = " + partID
                            '    End If
                            'ElseIf opartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                            '    If partID <> "" AndAlso partID <> "''" Then
                            '        ConditionStr += "and Part_Id in(" + partID + ") "
                            '    End If
                            'End If
                            If ddl_ProductType.Text <> sWB_Rename Then
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If rbl_BySource.SelectedIndex = 0 Then
                                        If productionID <> "" AndAlso productionID <> "''" Then
                                            ConditionStr += "and Production_id = " + productionID + " "
                                        End If
                                    Else
                                        If productionID <> "" AndAlso productionID <> "''" Then
                                            ConditionStr += "and Part_Id = " + productionID + " "
                                        End If
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If rbl_BySource.SelectedIndex = 0 Then
                                        If productionID <> "" AndAlso productionID <> "''" Then
                                            ConditionStr += "and Production_id in (" + productionID + ") "
                                        End If
                                    Else
                                        If productionID <> "" AndAlso productionID <> "''" Then
                                            ConditionStr += "and Part_Id in (" + productionID + ") "
                                        End If
                                    End If
                                End If
                            Else
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id = " + productionID + " "
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id in (" + productionID + ") "
                                    End If
                                End If
                            End If
                            If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                                If partID <> "" AndAlso partID <> "''" Then
                                    ConditionStr += "and Part_Id = " + partID + " "
                                End If
                            ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                                If partID <> "" AndAlso partID <> "''" Then
                                    ConditionStr += "and Part_Id in (" + partID + ") "
                                End If
                            End If
                        End If
                    End If
                    ConditionStr += "and YearWW={1} "
                    If cb_CR.Checked = False Then
                        ConditionStr += "and substring(lot_id,9,1)<>'Y' "
                        ConditionStr += "and substring(lot_id,9,1)<>'Z' "
                        ConditionStr += "and substring(Part_id,7,1)<>'V' "
                    End If
                    If cb_FAI.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                        ConditionStr += "and ISNUMERIC(SUBSTRING(Part_id,2,1))=0 "
                    End If
                    If cb_out.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                        ConditionStr += "and (substring(Part_id,2,1)<>'W' and (substring(Part_id,1,3)<>'SNW' and substring(Part_id,1,3)<>'AKW')) "
                    End If
                    'If ddl_BumpingType.Enabled = False Then
                    '    ConditionStr = String.Format(ConditionStr, partID, (WD))
                    'Else
                    '    ConditionStr = String.Format(ConditionStr, bumpingType, (WD))
                    'End If
                    If listB_BumpingTypeShow.Enabled = False Then
                        ConditionStr = String.Format(ConditionStr, partID, (sYearWeek.Replace("-", "")))
                    Else
                        ConditionStr = String.Format(ConditionStr, bumpingType, (sYearWeek.Replace("-", "")))
                    End If
                Else
                    ' --- Month ---
                    Dim monthNext As Date = (DateTime.ParseExact(sYearMonth + "-01", "yyyy-MM-dd", Nothing))
                    monthNextStr = monthNext.AddMonths(1).ToString("yyyy-MM")
                    If tr_BumpingType.Visible = False Then
                        If rbl_BySource.SelectedIndex = 0 Then 'Product No
                            Dim oPartID = Nothing
                            If (partID IsNot Nothing) Then
                                oPartID = partID.Split(",")
                            End If
                            Dim oProductionID = Nothing
                            If (productionID IsNot Nothing) Then
                                oProductionID = productionID.Split(",")
                            End If
                            'If opartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                            '    If listB_BumpingTypeShow.Enabled = False Then
                            '        If partID <> "" AndAlso partID <> "''" Then
                            '            'ConditionStr += "and Part_Id = '{0}' "
                            '            ConditionStr += "and Production_id = {0} "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    Else
                            '        If bumpingType <> "" Then
                            '            'ConditionStr += "and Part_Id = '{0}' "
                            '            ConditionStr += "and Production_id = {0} "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    End If
                            'ElseIf opartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                            '    If listB_BumpingTypeShow.Enabled = False Then
                            '        If partID <> "" AndAlso partID <> "''" Then
                            '            ConditionStr += "and Production_id in({0}) "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    Else
                            '        If bumpingType <> "" Then
                            '            ConditionStr += "and Production_id in({0}) "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    End If
                            'End If
                            If ddl_ProductType.Text <> sWB_Rename Then
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Production_id = " + productionID + " "
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Production_id in (" + productionID + ") "
                                    End If
                                End If
                            Else
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id = " + productionID + " "
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id in (" + productionID + ") "
                                    End If
                                End If
                            End If
                            If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                                If partID <> "" AndAlso partID <> "''" Then
                                    ConditionStr += "and Part_Id = " + partID + " "
                                End If
                            ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                                If partID <> "" AndAlso partID <> "''" Then
                                    ConditionStr += "and Part_Id in (" + partID + ") "
                                End If
                            End If
                        ElseIf rbl_BySource.SelectedIndex = 1 Then 'Part No
                            Dim oPartID = Nothing
                            If (partID IsNot Nothing) Then
                                oPartID = partID.Split(",")
                            End If
                            Dim oProductionID = Nothing
                            If (productionID IsNot Nothing) Then
                                oProductionID = productionID.Split(",")
                            End If
                            'If opartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                            '    If listB_BumpingTypeShow.Enabled = False Then
                            '        If partID <> "" AndAlso partID <> "''" Then
                            '            'ConditionStr += "and Part_Id = '{0}' "
                            '            ConditionStr += "and Part_Id = {0} "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    Else
                            '        If bumpingType <> "" Then
                            '            'ConditionStr += "and Part_Id = '{0}' "
                            '            ConditionStr += "and Part_Id = {0} "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    End If
                            'ElseIf opartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                            '    If listB_BumpingTypeShow.Enabled = False Then
                            '        If partID <> "" AndAlso partID <> "''" Then
                            '            ConditionStr += "and Part_Id in({0}) "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    Else
                            '        If bumpingType <> "" Then
                            '            ConditionStr += "and Part_Id in({0}) "
                            '        Else
                            '            ConditionStr += "{0}"
                            '        End If
                            '    End If
                            'End If

                            'If ddl_ProductType.Text <> sWB_Rename Then
                            '    If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                            '        If partID <> "" AndAlso partID <> "''" Then
                            '            ConditionStr += "and Part_Id = " + partID + " "
                            '        End If
                            '    ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                            '        If partID <> "" AndAlso partID <> "''" Then
                            '            ConditionStr += "and Part_Id in (" + partID + ") "
                            '        End If
                            '    End If
                            'Else
                            '    If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                            '        If productionID <> "" AndAlso productionID <> "''" Then
                            '            ConditionStr += "and Part_Id = " + productionID + " "
                            '        End If
                            '    ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                            '        If productionID <> "" AndAlso productionID <> "''" Then
                            '            ConditionStr += "and Part_Id in (" + productionID + ") "
                            '        End If
                            '    End If
                            'End If
                            'If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                            '    If partID <> "" AndAlso partID <> "''" Then
                            '        ConditionStr += "and Part_Id = " + partID + " "
                            '    End If
                            'ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                            '    If partID <> "" AndAlso partID <> "''" Then
                            '        ConditionStr += "and Part_Id in (" + partID + ") "
                            '    End If
                            'End If
                            If ddl_ProductType.Text <> sWB_Rename Then
                                If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                                    If partID <> "" AndAlso partID <> "''" Then
                                        ConditionStr += "and Part_Id = " + partID + " "
                                    End If
                                ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                                    If partID <> "" AndAlso partID <> "''" Then
                                        ConditionStr += "and Part_Id in (" + partID + ") "
                                    End If
                                End If
                            Else
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id = " + productionID + " "
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id in (" + productionID + ") "
                                    End If
                                End If
                            End If
                        End If
                    Else
                        If strBumpingType <> "" Then
                            ConditionStr += "and Part_Id in (" & strBumpingType & ") "
                        Else
                            Dim oPartID = Nothing
                            If (partID IsNot Nothing) Then
                                oPartID = partID.Split(",")
                            End If
                            Dim oProductionID = Nothing
                            If (productionID IsNot Nothing) Then
                                oProductionID = productionID.Split(",")
                            End If
                            'If opartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                            '    If partID <> "" AndAlso partID <> "''" Then
                            '        ConditionStr += "and Part_Id = " + partID
                            '    End If
                            'ElseIf opartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                            '    If partID <> "" AndAlso partID <> "''" Then
                            '        ConditionStr += "and Part_Id in(" + partID + ") "
                            '    End If
                            'End If
                            If ddl_ProductType.Text <> sWB_Rename Then
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If rbl_BySource.SelectedIndex = 0 Then
                                        If productionID <> "" AndAlso productionID <> "''" Then
                                            ConditionStr += "and Production_id = " + productionID + " "
                                        End If
                                    Else
                                        If productionID <> "" AndAlso productionID <> "''" Then
                                            ConditionStr += "and Part_Id = " + productionID + " "
                                        End If
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If rbl_BySource.SelectedIndex = 0 Then
                                        If productionID <> "" AndAlso productionID <> "''" Then
                                            ConditionStr += "and Production_id in (" + productionID + ") "
                                        End If
                                    Else
                                        If productionID <> "" AndAlso productionID <> "''" Then
                                            ConditionStr += "and Part_Id in (" + productionID + ") "
                                        End If
                                    End If
                                End If
                            Else
                                If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id = " + productionID + " "
                                    End If
                                ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                                    If productionID <> "" AndAlso productionID <> "''" Then
                                        ConditionStr += "and Part_Id in (" + productionID + ") "
                                    End If
                                End If
                            End If
                            If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                                If partID <> "" AndAlso partID <> "''" Then
                                    ConditionStr += "and Part_Id = " + partID + " "
                                End If
                            ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                                If partID <> "" AndAlso partID <> "''" Then
                                    ConditionStr += "and Part_Id in (" + partID + ") "
                                End If
                            End If
                        End If
                    End If
                    ConditionStr += "and DataTime >='{1}' "
                    ConditionStr += "and DataTime < '{2}' "
                    If cb_CR.Checked = False Then
                        ConditionStr += "and substring(lot_id,9,1)<>'Y' "
                        ConditionStr += "and substring(lot_id,9,1)<>'Z' "
                        ConditionStr += "and substring(Part_id,7,1)<>'V' "
                    End If
                    If cb_FAI.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                        ConditionStr += "and ISNUMERIC(SUBSTRING(Part_id,2,1))=0 "
                    End If
                    If cb_out.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                        ConditionStr += "and (substring(Part_id,2,1)<>'W' and (substring(Part_id,1,3)<>'SNW' and substring(Part_id,1,3)<>'AKW')) "
                    End If
                    'If ddl_BumpingType.Enabled = False Then
                    '    ConditionStr = String.Format(ConditionStr, partID, (WD + "-01"), (monthNextStr + "-01"))
                    'Else
                    '    ConditionStr = String.Format(ConditionStr, bumpingType, (WD + "-01"), (monthNextStr + "-01"))
                    'End If
                    If listB_BumpingTypeShow.Enabled = False Then
                        'ConditionStr = String.Format(ConditionStr, partID, (sYearMonth + "-01 00:00:00"), (monthNextStr + "-01 23:59:59"))
                        ConditionStr = String.Format(ConditionStr, partID, (sYearMonth + "-01 00:00:00"), (monthNextStr + "-01 00:00:00"))
                    Else
                        'ConditionStr = String.Format(ConditionStr, bumpingType, (sYearMonth + "-01 00:00:00"), (monthNextStr + "-01 23:59:59"))
                        ConditionStr = String.Format(ConditionStr, bumpingType, (sYearMonth + "-01 00:00:00"), (monthNextStr + "-01 00:00:00"))
                    End If
                End If
            ElseIf is_summary = False Then
                If timeType = 0 Then
                    ' --- Day ---
                    Dim oPartID = Nothing
                    If (partID IsNot Nothing) Then
                        oPartID = partID.Split(",")
                    End If
                    Dim oProductionID = Nothing
                    If (productionID IsNot Nothing) Then
                        oProductionID = productionID.Split(",")
                    End If
                    If ddl_ProductType.Text <> sWB_Rename Then
                        If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                If productionID <> "" AndAlso productionID <> "''" Then
                                    ConditionStr += "and Production_id = " + productionID + " "
                                End If
                            Else
                                If productionID <> "" AndAlso productionID <> "''" Then
                                    ConditionStr += "and Part_Id = " + productionID + " "
                                End If
                            End If
                        ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                If productionID <> "" AndAlso productionID <> "''" Then
                                    ConditionStr += "and Production_id in (" + productionID + ") "
                                End If
                            Else
                                If productionID <> "" AndAlso productionID <> "''" Then
                                    ConditionStr += "and Part_Id in (" + productionID + ") "
                                End If
                            End If
                        End If
                    Else
                        If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                            If productionID <> "" AndAlso productionID <> "''" Then
                                ConditionStr += "and Part_Id = " + productionID + " "
                            End If
                        ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                            If productionID <> "" AndAlso productionID <> "''" Then
                                ConditionStr += "and Part_Id in (" + productionID + ") "
                            End If
                        End If
                    End If
                    If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                        If partID <> "" AndAlso partID <> "''" Then
                            ConditionStr += "and Part_Id = " + partID + " "
                        End If
                    ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                        If partID <> "" AndAlso partID <> "''" Then
                            ConditionStr += "and Part_Id in (" + partID + ") "
                        End If
                    End If
                    ConditionStr += "and DataTime >= '{1}' "
                    ConditionStr += "and DataTime <= '{2}' "
                    If cb_CR.Checked = False Then
                        ConditionStr += "and substring(lot_id,9,1)<>'Y' "
                        ConditionStr += "and substring(lot_id,9,1)<>'Z' "
                        ConditionStr += "and substring(Part_id,7,1)<>'V' "
                    End If
                    If cb_FAI.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                        ConditionStr += "and ISNUMERIC(SUBSTRING(Part_id,2,1))=0 "
                    End If
                    If cb_out.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                        ConditionStr += "and (substring(Part_id,2,1)<>'W' and (substring(Part_id,1,3)<>'SNW' and substring(Part_id,1,3)<>'AKW')) "
                    End If
                    If (WD.IndexOf("~") >= 0) And cb_customerDay.Checked Then
                        ConditionStr = String.Format(ConditionStr, partID, ((txtDateFrom.Text.Trim) + " " + (ddlHourFrom.SelectedValue) + ":00:00"), ((txtDateTo.Text.Trim) + " " + (ddlHourTo.SelectedValue) + ":00:00"))
                    Else
                        If cb_ShowToday.Checked And (WD = (DateTime.Now.ToString("yyyyMMdd"))) Then
                            Dim mWD As DateTime = DateTime.ParseExact(sYearMonthDay, "yyyy-MM-dd", Nothing)
                            ConditionStr = String.Format(ConditionStr, partID, ((mWD.AddDays(-1).ToString("yyyy-MM-dd")) + " 16:00:00"), (sYearMonthDay + " 16:00:00"))
                        Else
                            ConditionStr = String.Format(ConditionStr, partID, (sYearMonthDay + " 00:00:00"), (sYearMonthDay + " 23:59:59"))
                        End If
                    End If
                ElseIf timeType = 1 Then
                    ' --- Week --
                    Dim oPartID = Nothing
                    If (partID IsNot Nothing) Then
                        oPartID = partID.Split(",")
                    End If
                    Dim oProductionID = Nothing
                    If (productionID IsNot Nothing) Then
                        oProductionID = productionID.Split(",")
                    End If
                    If ddl_ProductType.Text <> sWB_Rename Then
                        If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                If productionID <> "" AndAlso productionID <> "''" Then
                                    ConditionStr += "and Production_id = " + productionID + " "
                                End If
                            Else
                                If productionID <> "" AndAlso productionID <> "''" Then
                                    ConditionStr += "and Part_Id = " + productionID + " "
                                End If
                            End If
                        ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                If productionID <> "" AndAlso productionID <> "''" Then
                                    ConditionStr += "and Production_id in (" + productionID + ") "
                                End If
                            Else
                                If productionID <> "" AndAlso productionID <> "''" Then
                                    ConditionStr += "and Part_Id in (" + productionID + ") "
                                End If
                            End If
                        End If
                    Else
                        If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                            If productionID <> "" AndAlso productionID <> "''" Then
                                ConditionStr += "and Part_Id = " + productionID + " "
                            End If
                        ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                            If productionID <> "" AndAlso productionID <> "''" Then
                                ConditionStr += "and Part_Id in (" + productionID + ") "
                            End If
                        End If
                    End If
                    If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                        If partID <> "" AndAlso partID <> "''" Then
                            ConditionStr += "and Part_Id = " + partID + " "
                        End If
                    ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                        If partID <> "" AndAlso partID <> "''" Then
                            ConditionStr += "and Part_Id in (" + partID + ") "
                        End If
                    End If
                    ConditionStr += "and YearWW={1} "
                    ConditionStr = String.Format(ConditionStr, partID, (sYearWeek.Replace("-", "")))
                    If cb_ShowToday.Checked Then '當天要納入
                        ConditionStr += "and DataTime <= '" + Date.Now.ToString("yyyy-MM-dd 23:59:59") + "' "
                    Else '一般,當天不要納入
                        ConditionStr += "and DataTime <= '" + Date.Now.AddDays(-1).ToString("yyyy-MM-dd 23:59:59") + "' "
                    End If
                    If cb_CR.Checked = False Then
                        ConditionStr += "and substring(lot_id,9,1)<>'Y' "
                        ConditionStr += "and substring(lot_id,9,1)<>'Z' "
                        ConditionStr += "and substring(Part_id,7,1)<>'V' "
                    End If
                    If cb_FAI.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                        ConditionStr += "and ISNUMERIC(SUBSTRING(Part_id,2,1))=0 "
                    End If
                    If cb_out.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                        ConditionStr += "and (substring(Part_id,2,1)<>'W' and (substring(Part_id,1,3)<>'SNW' and substring(Part_id,1,3)<>'AKW')) "
                    End If
                Else
                    ' --- Month ---
                    Dim monthNext As Date = (DateTime.ParseExact(sYearMonth + "-01", "yyyy-MM-dd", Nothing))
                    monthNextStr = monthNext.AddMonths(1).ToString("yyyy-MM")
                    Dim oPartID = Nothing
                    If (partID IsNot Nothing) Then
                        oPartID = partID.Split(",")
                    End If
                    Dim oProductionID = Nothing
                    If (productionID IsNot Nothing) Then
                        oProductionID = productionID.Split(",")
                    End If
                    If ddl_ProductType.Text <> sWB_Rename Then
                        If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                If productionID <> "" AndAlso productionID <> "''" Then
                                    ConditionStr += "and Production_id = " + productionID + " "
                                End If
                            Else
                                If productionID <> "" AndAlso productionID <> "''" Then
                                    ConditionStr += "and Part_Id = " + productionID + " "
                                End If
                            End If
                        ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                If productionID <> "" AndAlso productionID <> "''" Then
                                    ConditionStr += "and Production_id in (" + productionID + ") "
                                End If
                            Else
                                If productionID <> "" AndAlso productionID <> "''" Then
                                    ConditionStr += "and Part_Id in (" + productionID + ") "
                                End If
                            End If
                        End If
                    Else
                        If oProductionID IsNot Nothing AndAlso oProductionID.Length = 1 Then
                            If productionID <> "" AndAlso productionID <> "''" Then
                                ConditionStr += "and Part_Id = " + productionID + " "
                            End If
                        ElseIf oProductionID IsNot Nothing AndAlso oProductionID.Length > 1 Then
                            If productionID <> "" AndAlso productionID <> "''" Then
                                ConditionStr += "and Part_Id in (" + productionID + ") "
                            End If
                        End If
                    End If
                    If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                        If partID <> "" AndAlso partID <> "''" Then
                            ConditionStr += "and Part_Id = " + partID + " "
                        End If
                    ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                        If partID <> "" AndAlso partID <> "''" Then
                            ConditionStr += "and Part_Id in (" + partID + ") "
                        End If
                    End If
                    ConditionStr += "and DataTime >='{1}' "
                    ConditionStr += "and DataTime < '{2}' "
                    ConditionStr = String.Format(ConditionStr, partID, (sYearMonth + "-01"), (monthNextStr + "-01"))
                    If cb_ShowToday.Checked Then '當天要納入
                        'ConditionStr += "and DataTime <= '" + Date.Now.ToString("yyyy-MM-dd 23:59:59") + "' "
                        ConditionStr += "and DataTime <= '" + Date.Now.ToString("yyyy-MM-dd 23:59:59") + "' "
                    Else '一般,當天不要納入
                        ConditionStr += "and DataTime <= '" + Date.Now.AddDays(-1).ToString("yyyy-MM-dd 23:59:59") + "' "
                    End If
                    If cb_CR.Checked = False Then
                        ConditionStr += "and substring(lot_id,9,1)<>'Y' "
                        ConditionStr += "and substring(lot_id,9,1)<>'Z' "
                        ConditionStr += "and substring(Part_id,7,1)<>'V' "
                    End If
                    If cb_FAI.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                        ConditionStr += "and ISNUMERIC(SUBSTRING(Part_id,2,1))=0 "
                    End If
                    If cb_out.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                        ConditionStr += "and (substring(Part_id,2,1)<>'W' and (substring(Part_id,1,3)<>'SNW' and substring(Part_id,1,3)<>'AKW')) "
                    End If
                End If
            End If

            Try
                sqlStr += "select LotCount,YIELD_CATEGORY,case when YIELD_VALUE is null then 0 else YIELD_VALUE end as YIELD_VALUE from ("
                '***sqlStr += "select LotCount,YIELD_CATEGORY,case when YIELD_VALUE is null then 0 else YIELD_VALUE end as YIELD_VALUE,CASE WHEN UPPER(Customer_ID)='INTEL' THEN (SELECT TOP 1 SEQ FROM Yield_CATEGORY_Order_Mapping WHERE Customer_Id = 'INTEL' AND Yield_Category = sm.YIELD_CATEGORY AND Part_Id = sm.Part_Id) ELSE(SELECT TOP 1 SEQ FROM Yield_CATEGORY_Order_Mapping WHERE Customer_Id = 'ALL' AND Yield_Category = sm.YIELD_CATEGORY AND Part_Id = sm.Part_Id) END AS SEQ from ("
                sqlStr += "select COUNT(*) AS LotCount, "
                '***sqlStr += "select Part_Id,Customer_ID,COUNT(*) AS LotCount, "
                sqlStr += "YIELD_CATEGORY, "
                sqlStr += "CASE WHEN SUM(Input_QTY) <> 0 THEN ROUND(convert(float,SUM(OUTPUT_QTY))/SUM(Input_QTY), 4) ELSE 0 END as YIELD_VALUE "

                ' --- INTEL 的產品 ---
                'If ddl_CustomerID.SelectedValue = "INTEL" Then
                '    If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                '        sqlStr += "from dbo.Yield_Daily_RawData "
                '        sqlStr += "where Customer_Id='INTEL' "
                '    Else
                '        sqlStr += "from dbo.BKM_Yield_Daily_RawData "
                '        sqlStr += "where 1=1 "
                '    End If
                'ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                '    If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                '        sqlStr += "from dbo.Yield_Daily_RawData "
                '        sqlStr += "where Customer_Id='AMD' "
                '    Else
                '        sqlStr += "from dbo.Yield_Daily_RawData_NonIntel "
                '        sqlStr += "where 1=1 "
                '    End If
                'Else
                '    If ddl_ProductType.SelectedValue = "WB" Then
                '        If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                '            sqlStr += "from WB_Yield_Daily_RawData "
                '        ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                '            sqlStr += "from WB_Yield_Daily_RawData_NotMerge "
                '        End If
                '    Else
                '        sqlStr += "from dbo.Yield_Daily_RawData_NonIntel "
                '    End If
                '    sqlStr += "where 1=1 "
                'End If
                If IsRename = False Then
                    If ddl_ProductType.Text = sWB Then
                        If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                            If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                sqlStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                            Else
                                sqlStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                            End If
                        ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF where 1=1 "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                                End If
                            End If
                        End If
                    Else
                        If ddl_CustomerID.SelectedValue = "INTEL" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                sqlStr += "from dbo.Yield_Daily_RawData where customer_id='INTEL' "
                            Else
                                sqlStr += "from dbo.BKM_Yield_Daily_RawData where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                sqlStr += "from dbo.Yield_Daily_RawData where customer_id='AMD' "
                            Else
                                sqlStr += "from dbo.Yield_Daily_RawData_NonIntel where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "NVD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                sqlStr += "from dbo.Yield_Daily_RawData where customer_id='NVD' "
                            Else
                                sqlStr += "from dbo.Yield_Daily_RawData_NonIntel where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "BCM" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                sqlStr += "from dbo.Yield_Daily_RawData where customer_id='BCM' "
                            Else
                                sqlStr += "from dbo.Yield_Daily_RawData_NonIntel where 1=1 "
                            End If
                        Else
                            sqlStr += "from dbo.Yield_Daily_RawData_NonIntel where 1=1 "
                        End If
                    End If
                Else
                    If ddl_ProductType.Text = sWB_Rename Then
                        If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                            If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                sqlStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                            Else
                                sqlStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                            End If
                        ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                            'sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF where 1=1 "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                                End If
                            End If
                        End If
                    Else
                        If ddl_CustomerID.SelectedValue = "INTEL" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                sqlStr += "from dbo.Yield_Daily_RawData where customer_id='INTEL' "
                            Else
                                sqlStr += "from dbo.BKM_Yield_Daily_RawData where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                sqlStr += "from dbo.Yield_Daily_RawData where customer_id='AMD' "
                            Else
                                sqlStr += "from dbo.Yield_Daily_RawData_NonIntel where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "NVD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                sqlStr += "from dbo.Yield_Daily_RawData where customer_id='NVD' "
                            Else
                                sqlStr += "from dbo.Yield_Daily_RawData_NonIntel where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "BCM" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                sqlStr += "from dbo.Yield_Daily_RawData where customer_id='BCM' "
                            Else
                                sqlStr += "from dbo.Yield_Daily_RawData_NonIntel where 1=1 "
                            End If
                        Else
                            sqlStr += "from dbo.Yield_Daily_RawData_NonIntel where 1=1 "
                        End If
                    End If
                End If

                sqlStr += ConditionStr
                If ddl_ProductType.Text = "CS" ORELSE ddl_ProductType.Text = "CPU" Then
                    Dim sFE As String = Get_FE()
                    If sFE <> "" Then
                        sqlStr += "AND FE_Plant_Id IN(" + sFE + ") "
                    End If

                    Dim sBE As String = Get_BE()
                    If sBE <> "" Then
                        sqlStr += "AND BE_Plant_Id IN(" + sBE + ") "
                    End If
                End If
                sqlStr += "GROUP BY YIELD_CATEGORY"
                '***sqlStr += "GROUP BY Part_Id,Customer_ID,YIELD_CATEGORY"
                sqlStr += ") sm"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)

                Dim itemStr As String = ""
                If (myDT.Rows.Count > 0) Then

                    For i As Integer = 0 To (myDT.Rows.Count - 1)

                        If i = 0 Then
                            yObj.LotCount = myDT.Rows(i)("LotCount")
                        End If

                        itemStr = myDT.Rows(i)("YIELD_CATEGORY").ToString.Trim().ToLower

                        If itemStr = "inline yield" Then
                            yObj.inLineyield = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.inLineyield_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "total yield w/o inline" Then
                            yObj.TotalYieldWO_Inline = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.TotalYieldWO_Inline_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "o/s yield" Then
                            yObj.OSyield = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.OSyield_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "bump yield" Then
                            yObj.Bumpyield = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.Bumpyield_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "fvi yield" Then
                            yObj.FVIyield = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.FVIyield_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "ipqc" Then
                            yObj.IPQC = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.IPQC_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "4w open" Then
                            yObj.Open4W = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.Open4W_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "4w short" Then
                            yObj.Short4W = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.Short4W_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "4w x2" Then
                            yObj.X24W = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.X24W_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "4w le" Then
                            yObj.LE4W = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.LE4W_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "4w land" Then
                            yObj.Land4W = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.Land4W_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "x6 caw" Then
                            yObj.X6CAW = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.X6CAW_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "in line" Then
                            yObj.InLine = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.InLine_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "feos" Then
                            yObj.FEOS = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.FEOS_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "fefvi" Then
                            yObj.FEFVI = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.FEFVI_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "beos" Then
                            yObj.BEOS = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.BEOS_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "befvi" Then
                            yObj.BEFVI = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.BEFVI_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "bumpaoi" Then
                            yObj.Bump = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.Bump_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf itemStr = "c4" Then
                            yObj.C4 = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.C4_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf (itemStr = "fe total") Then
                            yObj.FETOTAL = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.FETOTAL_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf (itemStr = "be total") Then
                            yObj.BETOTAL = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.BETOTAL_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf (itemStr = "total" Or itemStr = "total yield") Then
                            yObj.Totalyield = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.Totalyield_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf (itemStr = "ccpin") Then
                            yObj.CCPin = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.CCPin_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf (itemStr = "pincc") Then
                            yObj.PinCC = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.PinCC_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf (itemStr = "bumpaoi") Then
                            yObj.BumpAOI = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.BumpAOI_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf (itemStr = "2wos") Then
                            yObj.WOS2 = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.WOS2_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf (itemStr = "4wos") Then
                            yObj.WOS4 = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.WOS4_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf (itemStr = "fluxclean後bumpaoi") Then
                            yObj.BumpAOI_FluxClean = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.BumpAOI_FluxClean_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        ElseIf (itemStr = "land") Then
                            yObj.Land = myDT.Rows(i)("YIELD_VALUE").ToString.Trim()
                            '***yObj.Land_SEQ = Convert.ToInt32(myDT.Rows(i)("SEQ").ToString.Trim())
                        End If
                    Next
                    status = True
                End If
            Catch ex As Exception
                Dim sError As String = ex.ToString()
            End Try
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try

        Return status
    End Function

    ' DataTable 需要的資訊, 畫 Chart 資料在這組合
    Private Sub generateDataSource(ByVal customerID As String, ByVal partID As String, ByRef chartTable As DataTable, ByRef workTable As DataTable, ByRef hAry As Hashtable)
        Try
            Dim workRow As DataRow
            Dim yObj As yieldInfo
            Dim yield_item() As String = CType(ViewState("CPU_gItem"), String())

            For x As Integer = 0 To (yield_item.Length - 1) ' [列] : 產品 Yield Type

                workRow = workTable.NewRow

                For y As Integer = 0 To (workTable.Columns.Count - 1) ' [欄] : 日, 週, 月

                    If y = 0 Then
                        workRow(y) = yield_item(x)
                    ElseIf y = 1 Then
                        workRow(y) = customerID
                    ElseIf y = 2 Then
                        workRow(y) = partID.Replace("'", "")
                    Else

                        If hAry.Contains(workTable.Columns(y).ColumnName) Then

                            yObj = CType(hAry(workTable.Columns(y).ColumnName), yieldInfo)

                            If yield_item(x).ToLower = "lotcount" Then
                                workRow(y) = yObj.LotCount
                            ElseIf yield_item(x).ToLower = "total yield w/o inline" Then
                                workRow(y) = yObj.TotalYieldWO_Inline
                            ElseIf yield_item(x).ToLower = "inline yield" Then
                                workRow(y) = yObj.inLineyield
                            ElseIf yield_item(x).ToLower = "o/s yield" Then
                                workRow(y) = yObj.OSyield
                            ElseIf yield_item(x).ToLower = "bump yield" Then
                                workRow(y) = yObj.Bumpyield
                            ElseIf yield_item(x).ToLower = "fvi yield" Then
                                workRow(y) = yObj.FVIyield
                            ElseIf yield_item(x).ToLower = "ipqc" Then
                                workRow(y) = yObj.IPQC
                            ElseIf yield_item(x).ToLower = "4w open" Then
                                workRow(y) = yObj.Open4W
                            ElseIf yield_item(x).ToLower = "4w short" Then
                                workRow(y) = yObj.Short4W
                            ElseIf yield_item(x).ToLower = "4w x2" Then
                                workRow(y) = yObj.X24W
                            ElseIf yield_item(x).ToLower = "4w le" Then
                                workRow(y) = yObj.LE4W
                            ElseIf yield_item(x).ToLower = "4w land" Then
                                workRow(y) = yObj.Land4W
                            ElseIf yield_item(x).ToLower = "x6 caw" Then
                                workRow(y) = yObj.X6CAW
                            ElseIf yield_item(x).ToLower = "in line" Then
                                workRow(y) = yObj.InLine
                            ElseIf yield_item(x).ToLower = "feos" Then
                                workRow(y) = yObj.FEOS
                            ElseIf yield_item(x).ToLower = "fefvi" Then
                                workRow(y) = yObj.FEFVI
                            ElseIf yield_item(x).ToLower = "beos" Then
                                workRow(y) = yObj.BEOS
                            ElseIf yield_item(x).ToLower = "befvi" Then
                                workRow(y) = yObj.BEFVI
                            ElseIf yield_item(x).ToLower = "bumpaoi" Then
                                workRow(y) = yObj.Bump
                            ElseIf yield_item(x).ToLower = "c4" Then
                                workRow(y) = yObj.C4
                            ElseIf yield_item(x).ToLower = "fe total" Then
                                workRow(y) = yObj.FETOTAL
                            ElseIf yield_item(x).ToLower = "be total" Then
                                workRow(y) = yObj.BETOTAL
                            ElseIf yield_item(x).ToLower = "ccpin" Then
                                workRow(y) = yObj.CCPin
                            ElseIf yield_item(x).ToLower = "pincc" Then
                                workRow(y) = yObj.PinCC
                            ElseIf yield_item(x).ToLower = "2wos" Then
                                workRow(y) = yObj.WOS2
                            ElseIf yield_item(x).ToLower = "4wos" Then
                                workRow(y) = yObj.WOS4
                            ElseIf yield_item(x).ToLower = "bumpaoi" Then
                                workRow(y) = yObj.BumpAOI
                            ElseIf yield_item(x).ToLower = "fluxclean後bumpaoi" Then
                                workRow(y) = yObj.BumpAOI_FluxClean
                            ElseIf (yield_item(x).ToLower = "total yield") Or (yield_item(x).ToLower = "total") Then
                                workRow(y) = yObj.Totalyield
                            ElseIf yield_item(x).ToLower = "land" Then
                                workRow(y) = yObj.Land
                            End If

                        Else
                            workRow(y) = ""
                        End If

                    End If
                Next

                workTable.Rows.Add(workRow)
                chartTable.ImportRow(workRow)
            Next
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try
    End Sub

    Private Function getGridView() As GridView

        Dim dataGrid As GridView = New GridView
        dataGrid.BackColor = Drawing.Color.White
        dataGrid.BorderColor = Drawing.Color.Black
        dataGrid.BorderWidth = Unit.Pixel(1)
        dataGrid.CellPadding = 3
        dataGrid.HeaderStyle.BackColor = System.Drawing.ColorTranslator.FromHtml("#5D7B9D")
        dataGrid.HeaderStyle.Font.Bold = True
        dataGrid.HeaderStyle.ForeColor = Drawing.Color.White
        dataGrid.AlternatingRowStyle.BackColor = System.Drawing.ColorTranslator.FromHtml("#DBEEFF")

        Return dataGrid

    End Function

    Protected Sub gv_rowdata_RowDataBound(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.GridViewRowEventArgs) Handles gv_rowdata.RowDataBound
        Try
            If e.Row.RowType = DataControlRowType.Header Then
                For i As Integer = 0 To (e.Row.Cells.Count - 1)
                    If i <= 2 Then
                        e.Row.Cells(i).Width = Unit.Pixel(90)
                    End If

                    If i >= 3 Then
                        e.Row.Cells(i).Font.Size = FontUnit.Point(8)
                        e.Row.Cells(i).Width = Unit.Pixel(60)
                    End If

                    If rb_DataTimeCustor.SelectedIndex = 1 Then
                        If i >= 3 Then
                            If rbl_lossItem.SelectedIndex = 0 Then
                                ' Day
                                e.Row.Cells(i).Text = (e.Row.Cells(i).Text).Substring(0, 4) + "<br>" + (e.Row.Cells(i).Text).Substring(4, 4)
                            ElseIf rbl_lossItem.SelectedIndex = 1 Then
                                ' Week
                                e.Row.Cells(i).Text = (e.Row.Cells(i).Text).Substring(0, 4) + "<br>W" + (e.Row.Cells(i).Text).Substring(4, 2)
                            Else
                                ' Month
                                'e.Row.Cells(i).Text = (e.Row.Cells(i).Text).Substring(0, 4) + "<br>M" + (e.Row.Cells(i).Text).Substring(5, 2)
                                e.Row.Cells(i).Text = (e.Row.Cells(i).Text).Substring(0, 4) + "<br>M" + (e.Row.Cells(i).Text).Substring(4, 2)
                            End If
                        End If
                    Else
                        If i >= 3 And i <= 5 Then
                            'e.Row.Cells(i).Text = (e.Row.Cells(i).Text).Substring(0, 4) + "<br>M" + (e.Row.Cells(i).Text).Substring(5, 2)
                            e.Row.Cells(i).Text = (e.Row.Cells(i).Text).Substring(0, 4) + "<br>M" + (e.Row.Cells(i).Text).Substring(4, 2)
                        End If

                        If i >= 6 And i <= 10 Then
                            e.Row.Cells(i).Text = (e.Row.Cells(i).Text).Substring(0, 4) + "<br>W" + (e.Row.Cells(i).Text).Substring(4, 2)
                        End If

                        If i >= 11 Then
                            e.Row.Cells(i).Text = (e.Row.Cells(i).Text).Substring(0, 4) + "<br>" + (e.Row.Cells(i).Text).Substring(4, 4)
                        End If
                    End If
                Next
            End If

            If e.Row.RowType = DataControlRowType.DataRow Then
                e.Row.Height = Unit.Pixel(30)
                e.Row.Cells(0).Font.Size = FontUnit.XXSmall
                e.Row.Cells(0).Font.Bold = True
                e.Row.Cells(0).ForeColor = Drawing.Color.Red
                e.Row.Cells(1).Font.Size = FontUnit.XXSmall
                e.Row.Cells(1).Font.Bold = True
                e.Row.Cells(2).Font.Size = FontUnit.XXSmall
                e.Row.Cells(2).Font.Bold = True
            End If
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try
    End Sub

    Private Sub DrawChartBySingle(ByRef Chart As Dundas.Charting.WebControl.Chart, ByRef chartHash As Hashtable, ByVal yieldIndex As Integer, ByVal yieldName As String)
        Try
            Dim aryColor() As Color = {Color.DodgerBlue, Color.Olive, Color.DarkOrange, Color.Purple, Color.DarkGreen, Color.Blue, Color.Firebrick, Color.Green, Color.DarkSlateBlue, Color.DarkSlateGray, Color.Khaki, Color.Thistle}
            'Dim aryColor() As Color = {Color.FromArgb(179, 29, 64), Color.FromArgb(239, 104, 38), Color.FromArgb(245, 218, 13), Color.FromArgb(134, 196, 63), Color.FromArgb(37, 170, 227), Color.FromArgb(16, 83, 164), Color.FromArgb(88, 55, 146), Color.FromArgb(216, 27, 91), Color.FromArgb(252, 181, 29), Color.FromArgb(247, 238, 47), Color.FromArgb(29, 157, 132), Color.FromArgb(24, 121, 190), Color.FromArgb(13, 84, 166), Color.FromArgb(187, 29, 106), Color.FromArgb(240, 149, 32), Color.FromArgb(204, 219, 40), Color.FromArgb(32, 127, 145), Color.FromArgb(25, 86, 166), Color.FromArgb(45, 57, 141), Color.FromArgb(150, 36, 147)}
            Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
            Chart.ImageType = ChartImageType.Png
            Chart.Palette = ChartColorPalette.Dundas
            Chart.Height = Unit.Pixel(400)
            Chart.Width = Unit.Pixel(1050)

            Chart.Palette = ChartColorPalette.Dundas
            Chart.BackColor = Color.White
            Chart.BackGradientEndColor = Color.Peru
            Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
            Chart.BorderStyle = ChartDashStyle.Solid
            Chart.BorderWidth = 3
            Chart.BorderColor = Color.DarkBlue

            If Chart.ChartAreas.Count = 0 Then
                Chart.ChartAreas.Add("Default")
            End If
            Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
            Chart.ChartAreas("Default").AxisX.Title = "【" + yieldName + "】"
            Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
            Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
            Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet

            Chart.UI.Toolbar.Enabled = False
            Chart.UI.ContextMenu.Enabled = True

            Dim chartDT As DataTable
            Dim isMultiChart As Boolean = False

            Try
                For Each entry As DictionaryEntry In chartHash
                    chartDT = CType(entry.Value, DataTable)
                    If rb_DataTimeCustor.SelectedIndex = 1 Then
                        DrawBar_Range(Chart, aryColor(0), entry, chartDT, yieldIndex, isMultiChart)
                    Else
                        DrawBar(Chart, aryColor(0), entry, chartDT, yieldIndex, isMultiChart)
                    End If
                Next
            Catch ex As Exception
                Dim sError As String = ex.ToString()
            End Try

            Chart.ChartAreas("Default").AxisY.Interval = 10
            If (yieldName.ToUpper).IndexOf("YIELD") >= 0 Then
                Chart.ChartAreas("Default").AxisY.Minimum = 0 '50
                Chart.ChartAreas("Default").AxisY.Maximum = 100
            Else
                Chart.ChartAreas("Default").AxisY.Minimum = 0
                Chart.ChartAreas("Default").AxisY.Maximum = 100
            End If
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try
    End Sub

    Private Sub DrawChart(ByRef Chart As Dundas.Charting.WebControl.Chart, ByRef chartAry As ArrayList, ByVal yieldIndex As Integer, ByVal yieldName As String)
        Try
            Dim aryColor() As Color = {Color.DodgerBlue, Color.Olive, Color.DarkOrange, Color.Purple, Color.DarkGreen, Color.Blue, Color.Firebrick, Color.Green, Color.DarkSlateBlue, Color.DarkSlateGray, Color.Khaki, Color.Thistle}
            'Dim aryColor() As Color = {Color.FromArgb(179, 29, 64), Color.FromArgb(239, 104, 38), Color.FromArgb(245, 218, 13), Color.FromArgb(134, 196, 63), Color.FromArgb(37, 170, 227), Color.FromArgb(16, 83, 164), Color.FromArgb(88, 55, 146), Color.FromArgb(216, 27, 91), Color.FromArgb(252, 181, 29), Color.FromArgb(247, 238, 47), Color.FromArgb(29, 157, 132), Color.FromArgb(24, 121, 190), Color.FromArgb(13, 84, 166), Color.FromArgb(187, 29, 106), Color.FromArgb(240, 149, 32), Color.FromArgb(204, 219, 40), Color.FromArgb(32, 127, 145), Color.FromArgb(25, 86, 166), Color.FromArgb(45, 57, 141), Color.FromArgb(150, 36, 147)}
            Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
            Chart.ImageType = ChartImageType.Png
            Chart.Palette = ChartColorPalette.Dundas
            Chart.Height = Unit.Pixel(400)
            Chart.Width = Unit.Pixel(1050)

            Chart.Palette = ChartColorPalette.Dundas
            Chart.BackColor = Color.White
            Chart.BackGradientEndColor = Color.Peru
            Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
            Chart.BorderStyle = ChartDashStyle.Solid
            Chart.BorderWidth = 3
            Chart.BorderColor = Color.DarkBlue

            If Chart.ChartAreas.Count = 0 Then
                Chart.ChartAreas.Add("Default")
            End If
            Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
            Chart.ChartAreas("Default").AxisX.Title = "【" + yieldName + "】"
            Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
            Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
            Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet

            Chart.UI.Toolbar.Enabled = False
            Chart.UI.ContextMenu.Enabled = True

            Dim chartDT As DataTable
            Dim chartHash As Hashtable
            Dim isMultiChart As Boolean = False

            If (chartAry.Count > 1) Then
                isMultiChart = True
            End If

            Dim iMAX As Integer = 0
            If chartAry.Count > 10 Then
                iMAX = 10
            Else
                iMAX = chartAry.Count
            End If
            Dim iAxisY_Minimum = 0 '50
            Dim iAxisY_Maximum = 100
            For i As Integer = 0 To chartAry.Count - 1 '(iMAX - 1)
                Try
                    chartHash = CType(chartAry(i), Hashtable)
                    For Each entry As DictionaryEntry In chartHash
                        If entry.Key.ToString <> "Summary" Then
                            If chartAry.Count <= 10 Then
                                ' --- Bar Chart ---
                                chartDT = CType(entry.Value, DataTable)
                                If rb_DataTimeCustor.SelectedIndex = 1 Then
                                    DrawBar_Range(Chart, aryColor(i), entry, chartDT, yieldIndex, isMultiChart)
                                Else
                                    DrawBar(Chart, aryColor(i), entry, chartDT, yieldIndex, isMultiChart)
                                End If
                            End If
                        Else
                            ' --- Thrend Chart ---
                            chartDT = CType(entry.Value, DataTable)
                            DrawThrend(Chart, Color.DarkRed, entry, chartDT, yieldIndex)
                        End If
                    Next
                Catch ex As Exception
                    Dim sError As String = ex.ToString()
                End Try
            Next

            If (yieldName.ToUpper).IndexOf("YIELD") >= 0 Then
                Chart.ChartAreas("Default").AxisY.Interval = 10
                Chart.ChartAreas("Default").AxisY.Minimum = 0 '50
                Chart.ChartAreas("Default").AxisY.Maximum = 100
            Else
                Chart.ChartAreas("Default").AxisY.Interval = 10
                Chart.ChartAreas("Default").AxisY.Minimum = 0
                Chart.ChartAreas("Default").AxisY.Maximum = 100
            End If
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try
    End Sub

    Private Sub DrawBar(ByRef Chart As Dundas.Charting.WebControl.Chart, ByVal chartColor As Color, ByRef entry As DictionaryEntry, ByRef chartDT As DataTable, ByVal yieldIndex As Integer, ByVal Ismultibar As Boolean)
        Try
            Dim series As Series
            Dim XStr As String
            Dim XFormat As String
            Dim Value As Double
            Dim nYvalue As Double = 0
            Dim part_id As String = entry.Key.ToString.Replace("'", "")

            series = Chart.Series.Add(part_id)
            series.ChartArea = "Default"
            series.Type = SeriesChartType.Column
            series.Color = chartColor
            series.BorderColor = Color.White
            series.BorderWidth = 1
            series("PointWidth") = "0.5"

            Dim addIndex As Integer = 0
            Dim cpu_item() As String = CType(ViewState("CPU_gItem"), String())
            ' M month, W week, D day, 如果之後要加日期區間選擇, 都只有 D
            Dim rangeType As String = "D"
            Dim iMAX As Integer = 0
            For rowIndex As Integer = 3 To chartDT.Columns.Count - 1 'iMAX
                XStr = chartDT.Columns(rowIndex).ColumnName
                XFormat = XStr
                If rowIndex >= 3 And rowIndex <= 5 Then
                    rangeType = "M"
                    Dim MDate As Date = (DateTime.ParseExact(XStr, "yyyyMM00", Nothing))
                    XFormat = MDate.ToString("yyyy MMM", System.Globalization.CultureInfo.InvariantCulture)
                ElseIf rowIndex >= 6 And rowIndex <= 10 Then
                    rangeType = "W"
                    XFormat = XFormat.Substring(0, 4) + " W" + XFormat.Substring(4, 2)
                Else
                    rangeType = "D"
                    If (cb_customerDay.Checked) And (XFormat.IndexOf("~") >= 0) Then
                        XFormat = (txtDateFrom.Text) + (ddlHourFrom.SelectedValue) + vbCrLf + (txtDateTo.Text) + (ddlHourTo.SelectedValue)
                    Else
                        XFormat = XFormat.Substring(0, 4) + " " + XFormat.Substring(4, 4)
                    End If
                End If

                If Not IsDBNull(chartDT.Rows(yieldIndex)(rowIndex)) Then
                    If (chartDT.Rows(yieldIndex)(rowIndex)).ToString.Length > 0 Then
                        Value = (CType(chartDT.Rows(yieldIndex)(rowIndex), Double) * 100)
                    Else
                        Value = 0
                    End If
                Else
                    Value = 0
                End If

                If Value > nYvalue Then
                    nYvalue = Value
                End If

                Chart.Series(part_id).Points.AddXY(XFormat, Value)
                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).ToolTip = (XFormat + " : " + (Value.ToString) + "%")
                If Not Ismultibar Then
                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Label = ((Value.ToString) + "%")
                End If

                Dim FE As String = Get_FE().Replace("'", "")
                Dim BE As String = Get_BE().Replace("'", "")
                If (part_id.Replace("'", "") <> "Summary") Then
                    If ddl_CustomerID.SelectedValue = "INTEL" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                        End If
                    ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                        End If
                    ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                        End If
                    Else
                        If IsRename = False Then
                            If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                                If IsRename = False Then
                                    If cb_ChartMerge0.Checked = True Then
                                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','1','" + FE + "','" + BE + "')"
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','0','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','2','" + FE + "','" + BE + "')"
                                        End If
                                    End If
                                Else
                                    'If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                                    '    If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    '        tableStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                                    '    Else
                                    '        tableStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                                    '    End If
                                    'ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                                    '    'tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge "
                                    '    'tableStr += "where 1=1 "
                                    '    If cb_FinalYield.Checked = False Then
                                    '        If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    '            tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                                    '        Else
                                    '            tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                                    '        End If
                                    '    Else
                                    '        tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                                    '    End If
                                    'End If
                                    'If IsMerge = "1" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData "
                                    'ElseIf IsMerge = "0" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData_NotMerge "
                                    'ElseIf IsMerge = "2" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData_NotMerge_Storage "
                                    'ElseIf IsMerge = "3" Then
                                    '    sqlStr += "from vw_wb_Yield_Daily_RawData_SF "
                                    'ElseIf IsMerge = "4" Then
                                    '    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                    'ElseIf IsMerge = "5" Then
                                    '    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF "
                                    'End If
                                    If cb_ChartMerge0.Checked = True Then
                                        If cb_SF.Checked = True Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','3','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','1','" + FE + "','" + BE + "')"
                                        End If
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            If cb_SF.Checked = True Then
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','4','" + FE + "','" + BE + "')"
                                            Else
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','0','" + FE + "','" + BE + "')"
                                            End If
                                        Else
                                            If cb_SF.Checked = True Then
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','5','" + FE + "','" + BE + "')"
                                            Else
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','2','" + FE + "','" + BE + "')"
                                            End If
                                        End If
                                    End If
                                End If
                            Else
                                'Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                                End If
                            End If
                        Else
                            If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                                If IsRename = False Then
                                    If cb_ChartMerge0.Checked = True Then
                                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','1','" + FE + "','" + BE + "')"
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','0','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','2','" + FE + "','" + BE + "')"
                                        End If
                                    End If
                                Else
                                    'If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                                    '    If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    '        tableStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                                    '    Else
                                    '        tableStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                                    '    End If
                                    'ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                                    '    'tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge "
                                    '    'tableStr += "where 1=1 "
                                    '    If cb_FinalYield.Checked = False Then
                                    '        If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    '            tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                                    '        Else
                                    '            tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                                    '        End If
                                    '    Else
                                    '        tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                                    '    End If
                                    'End If
                                    'If IsMerge = "1" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData "
                                    'ElseIf IsMerge = "0" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData_NotMerge "
                                    'ElseIf IsMerge = "2" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData_NotMerge_Storage "
                                    'ElseIf IsMerge = "3" Then
                                    '    sqlStr += "from vw_wb_Yield_Daily_RawData_SF "
                                    'ElseIf IsMerge = "4" Then
                                    '    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                    'ElseIf IsMerge = "5" Then
                                    '    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF "
                                    'End If
                                    If cb_ChartMerge0.Checked = True Then
                                        If cb_SF.Checked = True Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','3','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','1','" + FE + "','" + BE + "')"
                                        End If
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            If cb_SF.Checked = True Then
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','4','" + FE + "','" + BE + "')"
                                            Else
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','0','" + FE + "','" + BE + "')"
                                            End If
                                        Else
                                            If cb_SF.Checked = True Then
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','5','" + FE + "','" + BE + "')"
                                            Else
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','2','" + FE + "','" + BE + "')"
                                            End If
                                        End If
                                    End If
                                End If
                            Else
                                'Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                                End If
                            End If
                        End If
                    End If
                End If

                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).BorderWidth = 1

                If rowIndex = 5 Then
                    Chart.Series(part_id).Points.AddXY("", 0)
                    addIndex = 1
                ElseIf rowIndex = 10 Then
                    Chart.Series(part_id).Points.AddXY("", 0)
                    addIndex = 2
                End If
            Next

            If nYvalue < 10 Then
                Chart.ChartAreas("Default").AxisY.Maximum = 10
            End If
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try
    End Sub

    Private Sub DrawChartBySingle_Target(ByRef Chart As Dundas.Charting.WebControl.Chart, ByRef chartHash As Hashtable, ByVal yieldIndex As Integer, ByVal yieldName As String)
        Try
            Dim aryColor() As Color = {Color.DodgerBlue, Color.Olive, Color.DarkOrange, Color.Purple, Color.DarkGreen, Color.Blue, Color.Firebrick, Color.Green, Color.DarkSlateBlue, Color.DarkSlateGray, Color.Khaki, Color.Thistle}
            'Dim aryColor() As Color = {Color.FromArgb(179, 29, 64), Color.FromArgb(239, 104, 38), Color.FromArgb(245, 218, 13), Color.FromArgb(134, 196, 63), Color.FromArgb(37, 170, 227), Color.FromArgb(16, 83, 164), Color.FromArgb(88, 55, 146), Color.FromArgb(216, 27, 91), Color.FromArgb(252, 181, 29), Color.FromArgb(247, 238, 47), Color.FromArgb(29, 157, 132), Color.FromArgb(24, 121, 190), Color.FromArgb(13, 84, 166), Color.FromArgb(187, 29, 106), Color.FromArgb(240, 149, 32), Color.FromArgb(204, 219, 40), Color.FromArgb(32, 127, 145), Color.FromArgb(25, 86, 166), Color.FromArgb(45, 57, 141), Color.FromArgb(150, 36, 147)}
            Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
            Chart.ImageType = ChartImageType.Png
            Chart.Palette = ChartColorPalette.Dundas
            Chart.Height = Unit.Pixel(400)
            Chart.Width = Unit.Pixel(1050)

            Chart.Palette = ChartColorPalette.Dundas
            Chart.BackColor = Color.White
            Chart.BackGradientEndColor = Color.Peru
            Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
            Chart.BorderStyle = ChartDashStyle.Solid
            Chart.BorderWidth = 3
            Chart.BorderColor = Color.DarkBlue

            If Chart.ChartAreas.Count = 0 Then
                Chart.ChartAreas.Add("Default")
            End If
            Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
            Chart.ChartAreas("Default").AxisX.Title = "【" + yieldName + "】"
            Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
            Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
            Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet

            Chart.UI.Toolbar.Enabled = False
            Chart.UI.ContextMenu.Enabled = True

            Dim chartDT As DataTable
            Dim isMultiChart As Boolean = False

            Try
                For Each entry As DictionaryEntry In chartHash
                    chartDT = CType(entry.Value, DataTable)
                    If rb_DataTimeCustor.SelectedIndex = 1 Then
                        DrawBar_Range_Target(Chart, aryColor(0), entry, chartDT, yieldIndex, isMultiChart)
                    Else
                        DrawBar_Target(Chart, aryColor(0), entry, chartDT, yieldIndex, isMultiChart)
                    End If
                Next
            Catch ex As Exception
                Dim sError As String = ex.ToString()
            End Try

            Chart.ChartAreas("Default").AxisY.Interval = 10
            If (yieldName.ToUpper).IndexOf("YIELD") >= 0 Then
                Chart.ChartAreas("Default").AxisY.Minimum = 0 '50
                Chart.ChartAreas("Default").AxisY.Maximum = 100
            Else
                Chart.ChartAreas("Default").AxisY.Minimum = 0
                Chart.ChartAreas("Default").AxisY.Maximum = 100
            End If
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try
    End Sub

    Private Sub DrawChart_Target(ByRef Chart As Dundas.Charting.WebControl.Chart, ByRef chartAry As ArrayList, ByVal yieldIndex As Integer, ByVal yieldName As String)
        Try
            Dim aryColor() As Color = {Color.DodgerBlue, Color.Olive, Color.DarkOrange, Color.Purple, Color.DarkGreen, Color.Blue, Color.Firebrick, Color.Green, Color.DarkSlateBlue, Color.DarkSlateGray, Color.Khaki, Color.Thistle}
            'Dim aryColor() As Color = {Color.FromArgb(179, 29, 64), Color.FromArgb(239, 104, 38), Color.FromArgb(245, 218, 13), Color.FromArgb(134, 196, 63), Color.FromArgb(37, 170, 227), Color.FromArgb(16, 83, 164), Color.FromArgb(88, 55, 146), Color.FromArgb(216, 27, 91), Color.FromArgb(252, 181, 29), Color.FromArgb(247, 238, 47), Color.FromArgb(29, 157, 132), Color.FromArgb(24, 121, 190), Color.FromArgb(13, 84, 166), Color.FromArgb(187, 29, 106), Color.FromArgb(240, 149, 32), Color.FromArgb(204, 219, 40), Color.FromArgb(32, 127, 145), Color.FromArgb(25, 86, 166), Color.FromArgb(45, 57, 141), Color.FromArgb(150, 36, 147)}
            Chart.ImageUrl = "temp/DailyYieldBihon_#SEQ(1000,1)"
            Chart.ImageType = ChartImageType.Png
            Chart.Palette = ChartColorPalette.Dundas
            Chart.Height = Unit.Pixel(400)
            Chart.Width = Unit.Pixel(1050)

            Chart.Palette = ChartColorPalette.Dundas
            Chart.BackColor = Color.White
            Chart.BackGradientEndColor = Color.Peru
            Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
            Chart.BorderStyle = ChartDashStyle.Solid
            Chart.BorderWidth = 3
            Chart.BorderColor = Color.DarkBlue

            If Chart.ChartAreas.Count = 0 Then
                Chart.ChartAreas.Add("Default")
            End If
            Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
            Chart.ChartAreas("Default").AxisX.Title = "【" + yieldName + "】"
            Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
            Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
            Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet

            Chart.UI.Toolbar.Enabled = False
            Chart.UI.ContextMenu.Enabled = True

            Dim chartDT As DataTable
            Dim chartHash As Hashtable
            Dim isMultiChart As Boolean = False

            If (chartAry.Count > 1) Then
                isMultiChart = True
            End If

            Dim iMAX As Integer = 0
            If chartAry.Count > 10 Then
                iMAX = 10
            Else
                iMAX = chartAry.Count
            End If
            Dim iAxisY_Minimum = 0 '50
            Dim iAxisY_Maximum = 100
            For i As Integer = 0 To chartAry.Count - 1 '(iMAX - 1)
                Try
                    chartHash = CType(chartAry(i), Hashtable)
                    For Each entry As DictionaryEntry In chartHash
                        If entry.Key.ToString <> "Summary" Then
                            If chartAry.Count <= 10 Then
                                ' --- Bar Chart ---
                                chartDT = CType(entry.Value, DataTable)
                                If rb_DataTimeCustor.SelectedIndex = 1 Then
                                    DrawBar_Range_Target(Chart, aryColor(i), entry, chartDT, yieldIndex, isMultiChart)
                                Else
                                    DrawBar_Target(Chart, aryColor(i), entry, chartDT, yieldIndex, isMultiChart)
                                End If
                            End If
                        Else
                            ' --- Thrend Chart ---
                            chartDT = CType(entry.Value, DataTable)
                            DrawThrend(Chart, Color.DarkRed, entry, chartDT, yieldIndex)
                        End If
                    Next
                Catch ex As Exception
                    Dim sError As String = ex.ToString()
                End Try
            Next

            If (yieldName.ToUpper).IndexOf("YIELD") >= 0 Then
                Chart.ChartAreas("Default").AxisY.Interval = 10
                Chart.ChartAreas("Default").AxisY.Minimum = 0 '50
                Chart.ChartAreas("Default").AxisY.Maximum = 100
            Else
                Chart.ChartAreas("Default").AxisY.Interval = 10
                Chart.ChartAreas("Default").AxisY.Minimum = 0
                Chart.ChartAreas("Default").AxisY.Maximum = 100
            End If
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try
    End Sub

    'Private Sub DrawBar_Target(ByRef Chart As Dundas.Charting.WebControl.Chart, ByVal chartColor As Color, ByRef entry As DictionaryEntry, ByRef chartDT As DataTable, ByVal yieldIndex As Integer, ByVal Ismultibar As Boolean)
    '    Try
    '        'Dim series As Series
    '        Dim XStr As String
    '        Dim XFormat As String
    '        Dim Value As Double
    '        Dim nYvalue As Double = 0
    '        Dim part_id As String = entry.Key.ToString

    '        'series = Chart.Series.Add(part_id)
    '        'series.ChartArea = "Default"
    '        'series.Type = SeriesChartType.Column
    '        'series.Color = chartColor
    '        'series.BorderColor = Color.White
    '        'series.BorderWidth = 1
    '        'series("PointWidth") = "0.5"

    '        Dim addIndex As Integer = 0
    '        Dim cpu_item() As String = CType(ViewState("CPU_gItem"), String())
    '        ' M month, W week, D day, 如果之後要加日期區間選擇, 都只有 D
    '        Dim rangeType As String = "D"
    '        Dim iMAX As Integer = 0
    '        For rowIndex As Integer = 3 To chartDT.Columns.Count - 1 'iMAX
    '            XStr = chartDT.Columns(rowIndex).ColumnName
    '            XFormat = XStr
    '            If rowIndex >= 3 And rowIndex <= 5 Then
    '                rangeType = "M"
    '                Dim MDate As Date = (DateTime.ParseExact(XStr, "yyyyMM", Nothing))
    '                XFormat = MDate.ToString("yyyy MMM", System.Globalization.CultureInfo.InvariantCulture)
    '            ElseIf rowIndex >= 6 And rowIndex <= 10 Then
    '                rangeType = "W"
    '                XFormat = XFormat.Substring(0, 4) + " W" + XFormat.Substring(4, 2)
    '            Else
    '                rangeType = "D"
    '                If (cb_customerDay.Checked) And (XFormat.IndexOf("~") >= 0) Then
    '                    XFormat = (txtDateFrom.Text) + (ddlHourFrom.SelectedValue) + vbCrLf + (txtDateTo.Text) + (ddlHourTo.SelectedValue)
    '                Else
    '                    XFormat = XFormat.Substring(0, 4) + " " + XFormat.Substring(4, 4)
    '                End If
    '            End If

    '            If Not IsDBNull(chartDT.Rows(yieldIndex)(rowIndex)) Then
    '                If (chartDT.Rows(yieldIndex)(rowIndex)).ToString.Length > 0 Then
    '                    Value = (CType(chartDT.Rows(yieldIndex)(rowIndex), Double) * 100)
    '                Else
    '                    Value = 0
    '                End If
    '            Else
    '                Value = 0
    '            End If

    '            If Value > nYvalue Then
    '                nYvalue = Value
    '            End If

    '            Chart.Series(part_id).Points.AddXY(XFormat, Value)
    '            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).ToolTip = (XFormat + " : " + (Value.ToString) + "%")
    '            If Not Ismultibar Then
    '                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Label = ((Value.ToString) + "%")
    '            End If

    '            If (part_id.Replace("'", "") <> "Summary") Then
    '                If ddl_CustomerID.SelectedValue = "INTEL" Then
    '                    If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
    '                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','NORMAL','-1')"
    '                    Else
    '                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
    '                    End If
    '                ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
    '                    If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
    '                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','NORMAL','-1')"
    '                    Else
    '                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
    '                    End If
    '                Else
    '                    If ddl_ProductType.SelectedValue.ToUpper() = "WB" Then
    '                        If cb_ChartMerge0.Checked = True Then
    '                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','WB','1')"
    '                        Else
    '                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','WB','0')"
    '                        End If
    '                    Else
    '                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
    '                    End If
    '                End If
    '            End If

    '            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).BorderWidth = 1

    '            If rowIndex = 5 Then
    '                Chart.Series(part_id).Points.AddXY("", 0)
    '                addIndex = 1
    '            ElseIf rowIndex = 10 Then
    '                Chart.Series(part_id).Points.AddXY("", 0)
    '                addIndex = 2
    '            End If

    '            'Dim percentage As Double = 0.0
    '            'Dim pt As DataPoint
    '            'For Each pt In Chart.Series(srcSeriesName).Points
    '            '    Dim pos As Integer = 0
    '            '    percentage += pt.YValues(0) / total * 100.0
    '            '    pos = destSeries.Points.Add(Math.Round(percentage, 2))
    '            'Next pt
    '            'Dim objPoint As DataPoint = New DataPoint(CType((rowIndex - 3) + addIndex + 1, Double), CType(AxisYMinimum.Text, Double))
    '            'series1.Points.Add(objPoint)
    '            'objPoint.ToolTip = String.Format("Yield_Open_Fail_CL:{0:##0.###}", dt.Rows(0)("Yield_Open_Fail_CL"))

    '            'Chart.Series("CL").LegendText = "CL (" + cinfo.dt.Rows(cinfo.dt.Rows.Count - 1)("Yield_Open_Fail_CL").ToString() + ")"
    '        Next

    '        Try
    '            Dim series1 As Series
    '            series1 = Chart.Series.Add("Target")
    '            series1.ChartArea = "Default"
    '            series1.Type = SeriesChartType.Line
    '            series1.Color = Color.PaleVioletRed
    '            series1.BorderWidth = 2
    '            series1.MarkerStyle = MarkerStyle.None
    '            series1.MarkerSize = 0
    '            series1.Font = New Font("Times New Roman", 8, FontStyle.Regular)
    '            series1.ShowLabelAsValue = False
    '            series1("LabelStyle") = "Top"

    '            For rowIndex As Integer = 3 To chartDT.Columns.Count - 1 'iMAX
    '                'Dim objPoint As DataPoint = New DataPoint(CType((rowIndex - 3) + addIndex + 1, Double), CType(AxisYMinimum.Text, Double))
    '                'series1.Points.Add(objPoint)

    '                XStr = chartDT.Columns(rowIndex).ColumnName
    '                XFormat = XStr
    '                If rowIndex >= 3 And rowIndex <= 5 Then
    '                    rangeType = "M"
    '                    Dim MDate As Date = (DateTime.ParseExact(XStr, "yyyyMM", Nothing))
    '                    XFormat = MDate.ToString("yyyy MMM", System.Globalization.CultureInfo.InvariantCulture)
    '                ElseIf rowIndex >= 6 And rowIndex <= 10 Then
    '                    rangeType = "W"
    '                    XFormat = XFormat.Substring(0, 4) + " W" + XFormat.Substring(4, 2)
    '                Else
    '                    rangeType = "D"
    '                    If (cb_customerDay.Checked) And (XFormat.IndexOf("~") >= 0) Then
    '                        XFormat = (txtDateFrom.Text) + (ddlHourFrom.SelectedValue) + vbCrLf + (txtDateTo.Text) + (ddlHourTo.SelectedValue)
    '                    Else
    '                        XFormat = XFormat.Substring(0, 4) + " " + XFormat.Substring(4, 4)
    '                    End If
    '                End If

    '                If Not IsDBNull(chartDT.Rows(yieldIndex)(rowIndex)) Then
    '                    If (chartDT.Rows(yieldIndex)(rowIndex)).ToString.Length > 0 Then
    '                        Value = (CType(chartDT.Rows(yieldIndex)(rowIndex), Double) * 100)
    '                    Else
    '                        Value = 0
    '                    End If
    '                Else
    '                    Value = 0
    '                End If

    '                If Value > nYvalue Then
    '                    nYvalue = Value
    '                End If

    '                Chart.Series("Target").Points.AddXY(XFormat, Value)
    '                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).ToolTip = (XFormat + " : " + (Value.ToString) + "%")
    '                If Not Ismultibar Then
    '                    Chart.Series("Target").Points((rowIndex - 3) + addIndex).Label = ((Value.ToString) + "%")
    '                End If

    '                If ddl_CustomerID.SelectedValue = "INTEL" Then
    '                    If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
    '                        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','NORMAL','-1')"
    '                    Else
    '                        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
    '                    End If
    '                ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
    '                    If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
    '                        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','NORMAL','-1')"
    '                    Else
    '                        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
    '                    End If
    '                Else
    '                    If ddl_ProductType.SelectedValue.ToUpper() = "WB" Then
    '                        If cb_ChartMerge0.Checked = True Then
    '                            Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','WB','1')"
    '                        Else
    '                            Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','WB','0')"
    '                        End If
    '                    Else
    '                        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
    '                    End If
    '                End If
    '            Next
    '        Catch ex As Exception
    '            Dim sError As String = ex.ToString()
    '        End Try

    '        'Chart.Series(part_id).Points.AddXY(XFormat, Value)
    '        'Chart.Series(part_id).Points((rowIndex - 3) + addIndex).ToolTip = (XFormat + " : " + (Value.ToString) + "%")
    '        'If Not Ismultibar Then
    '        '    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Label = ((Value.ToString) + "%")
    '        'End If

    '        If nYvalue < 10 Then
    '            Chart.ChartAreas("Default").AxisY.Maximum = 10
    '        End If
    '    Catch ex As Exception
    '        Dim sError As String = ex.ToString()
    '    End Try
    'End Sub

    Private Sub DrawBar_Target(ByRef Chart As Dundas.Charting.WebControl.Chart, ByVal chartColor As Color, ByRef entry As DictionaryEntry, ByRef chartDT As DataTable, ByVal yieldIndex As Integer, ByVal Ismultibar As Boolean)
        Try
            Dim series As Series
            Dim XStr As String
            Dim XFormat As String
            Dim Value As Double
            Dim nYvalue As Double = 0
            Dim part_id As String = entry.Key.ToString.Replace("'", "")

            'Dim IsTarget As Boolean = False
            If (Chart.Series.Count = 0) Then
                series = Chart.Series.Add("Target")
                series.ChartArea = "Default"
                'series.Type = SeriesChartType.Line
                If chartDT.Columns.Count > 1 Then
                    series.Type = SeriesChartType.Line
                Else
                    series.Type = SeriesChartType.Point
                End If
                series.Color = Color.PaleVioletRed
                series.BorderColor = Color.White
                series.BorderWidth = 3
                series("PointWidth") = "0.5"
                'Istarget = True
            End If

            series = Chart.Series.Add(part_id)
            series.ChartArea = "Default"
            series.Type = SeriesChartType.Column
            series.Color = chartColor
            series.BorderColor = Color.White
            series.BorderWidth = 1
            series("PointWidth") = "0.5"

            Dim addIndex As Integer = 0
            Dim cpu_item() As String = CType(ViewState("CPU_gItem"), String())
            ' M month, W week, D day, 如果之後要加日期區間選擇, 都只有 D
            Dim rangeType As String = "D"
            Dim iMAX As Integer = 0
            For rowIndex As Integer = 3 To chartDT.Columns.Count - 1 'iMAX
                XStr = chartDT.Columns(rowIndex).ColumnName
                XFormat = XStr
                If rowIndex >= 3 And rowIndex <= 5 Then
                    rangeType = "M"
                    Dim MDate As Date = (DateTime.ParseExact(XStr, "yyyyMM", Nothing))
                    XFormat = MDate.ToString("yyyy MMM", System.Globalization.CultureInfo.InvariantCulture)
                ElseIf rowIndex >= 6 And rowIndex <= 10 Then
                    rangeType = "W"
                    XFormat = XFormat.Substring(0, 4) + " W" + XFormat.Substring(4, 2)
                Else
                    rangeType = "D"
                    If (cb_customerDay.Checked) And (XFormat.IndexOf("~") >= 0) Then
                        XFormat = (txtDateFrom.Text) + (ddlHourFrom.SelectedValue) + vbCrLf + (txtDateTo.Text) + (ddlHourTo.SelectedValue)
                    Else
                        XFormat = XFormat.Substring(0, 4) + " " + XFormat.Substring(4, 4)
                    End If
                End If

                If Not IsDBNull(chartDT.Rows(yieldIndex)(rowIndex)) Then
                    If (chartDT.Rows(yieldIndex)(rowIndex)).ToString.Length > 0 Then
                        Value = (CType(chartDT.Rows(yieldIndex)(rowIndex), Double) * 100)
                    Else
                        Value = 0
                    End If
                Else
                    Value = 0
                End If

                If Value > nYvalue Then
                    nYvalue = Value
                End If

                Chart.Series(part_id).Points.AddXY(XFormat, Value)
                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).ToolTip = (XFormat + " : " + (Value.ToString) + "%")
                If Not Ismultibar Then
                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Label = ((Value.ToString) + "%")
                End If

                Dim FE As String = Get_FE().Replace("'", "")
                Dim BE As String = Get_BE().Replace("'", "")
                If (part_id.Replace("'", "") <> "Summary") Then
                    If ddl_CustomerID.SelectedValue = "INTEL" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                        End If
                    ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                        End If
                    ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                        End If
                    Else
                        If IsRename = False Then
                            If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                                If IsRename = False Then
                                    If cb_ChartMerge0.Checked = True Then
                                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','1','" + FE + "','" + BE + "')"
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','0','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','2','" + FE + "','" + BE + "')"
                                        End If
                                    End If
                                Else
                                    If cb_ChartMerge0.Checked = True Then
                                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','1','" + FE + "','" + BE + "')"
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','0','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','2','" + FE + "','" + BE + "')"
                                        End If
                                    End If
                                End If
                            Else
                                'Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                                End If
                            End If
                        Else
                            If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                                If IsRename = False Then
                                    If cb_ChartMerge0.Checked = True Then
                                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','1','" + FE + "','" + BE + "')"
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','0','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','2','" + FE + "','" + BE + "')"
                                        End If
                                    End If
                                Else
                                    'If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                                    '    If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    '        tableStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                                    '    Else
                                    '        tableStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                                    '    End If
                                    'ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                                    '    'tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge "
                                    '    'tableStr += "where 1=1 "
                                    '    If cb_FinalYield.Checked = False Then
                                    '        If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    '            tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                                    '        Else
                                    '            tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                                    '        End If
                                    '    Else
                                    '        tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                                    '    End If
                                    'End If
                                    'If IsMerge = "1" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData "
                                    'ElseIf IsMerge = "0" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData_NotMerge "
                                    'ElseIf IsMerge = "2" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData_NotMerge_Storage "
                                    'ElseIf IsMerge = "3" Then
                                    '    sqlStr += "from vw_wb_Yield_Daily_RawData_SF "
                                    'ElseIf IsMerge = "4" Then
                                    '    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                    'ElseIf IsMerge = "5" Then
                                    '    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF "
                                    'End If
                                    If cb_ChartMerge0.Checked = True Then
                                        If cb_SF.Checked = True Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','3','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','1','" + FE + "','" + BE + "')"
                                        End If
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            If cb_SF.Checked = True Then
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','4','" + FE + "','" + BE + "')"
                                            Else
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','0','" + FE + "','" + BE + "')"
                                            End If
                                        Else
                                            If cb_SF.Checked = True Then
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','5','" + FE + "','" + BE + "')"
                                            Else
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','2','" + FE + "','" + BE + "')"
                                            End If
                                        End If
                                    End If
                                End If
                            Else
                                'Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                                End If
                            End If
                        End If
                    End If
                End If

                If (Chart.Series.Count = 2) Then
                    Chart.Series("Target").Points.AddXY(XFormat, CType(AxisYMinimum.Text, Double))
                    Chart.Series("Target").Points((rowIndex - 3) + addIndex).ToolTip = (XFormat + " : " + (AxisYMinimum.Text) + "%")
                    If Not Ismultibar Then
                        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Label = ((AxisYMinimum.Text) + "%")
                    End If
                End If

                'If ddl_CustomerID.SelectedValue = "INTEL" Then
                '    If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                '        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','NORMAL','-1')"
                '    Else
                '        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                '    End If
                'ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                '    If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                '        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','NORMAL','-1')"
                '    Else
                '        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                '    End If
                'Else
                '    If ddl_ProductType.SelectedValue.ToUpper() = "WB" Then
                '        If cb_ChartMerge0.Checked = True Then
                '            Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','WB','1')"
                '        Else
                '            Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','WB','0')"
                '        End If
                '    Else
                '        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                '    End If
                'End If
                'End If
                'End If
                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).BorderWidth = 1
                If (Chart.Series.Count = 2) Then
                    Chart.Series("Target").Points((rowIndex - 3) + addIndex).BorderWidth = 3
                End If
                If rowIndex = 5 Then
                    Chart.Series(part_id).Points.AddXY("", 0)
                    If (Chart.Series.Count = 2) Then
                        Chart.Series("Target").Points.AddXY("", CType(AxisYMinimum.Text, Double))
                    End If
                    addIndex = 1
                ElseIf rowIndex = 10 Then
                    Chart.Series(part_id).Points.AddXY("", 0)
                    If (Chart.Series.Count = 2) Then
                        Chart.Series("Target").Points.AddXY("", CType(AxisYMinimum.Text, Double))
                    End If
                    addIndex = 2
                End If
            Next
            If CheckBox1.Checked = True Then
                Chart.Series("Target").Points(Chart.Series("Target").Points.Count - 1).Label = String.Format(("Target:{0:##0.###}%"), (AxisYMinimum.Text))
                Chart.Series("Target").Points(series.Points.Count - 1).LabelBackColor = Color.Yellow
            Else
                Chart.Series("Target").Points(0).Label = String.Format(("Target:{0:##0.###}%"), (AxisYMinimum.Text))
                Chart.Series("Target").Points(0).LabelBackColor = Color.Yellow
            End If
            Chart.Series("Target").SmartLabels.Enabled = True
            Chart.Series("Target").SmartLabels.AllowOutsidePlotArea = LabelOutsidePlotAreaStyle.Partial
            Chart.Series("Target").SmartLabels.MarkerOverlapping = False
            Chart.Series("Target").SmartLabels.MinMovingDistance = 15
            Chart.Series("Target").LegendText = "Target"

            For rowIndex As Integer = 0 To Chart.Series("Target").Points.Count - 1
                Chart.Series("Target").Points(rowIndex).BorderWidth = 3
            Next

            If nYvalue < 10 Then
                Chart.ChartAreas("Default").AxisY.Maximum = 10
            End If
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try
    End Sub

    Private Sub DrawBar_Range(ByRef Chart As Dundas.Charting.WebControl.Chart, ByVal chartColor As Color, ByRef entry As DictionaryEntry, ByRef chartDT As DataTable, ByVal yieldIndex As Integer, ByVal Ismultibar As Boolean)
        Try
            Dim series As Series
            Dim XStr As String
            Dim XFormat As String
            Dim Value As Double
            Dim nYvalue As Double = 0
            Dim part_id As String = entry.Key.ToString.Replace("'", "")

            series = Chart.Series.Add(part_id)
            series.ChartArea = "Default"
            series.Type = SeriesChartType.Column
            series.Color = chartColor
            series.BorderColor = Color.White
            series.BorderWidth = 1
            series("PointWidth") = "0.5"

            Dim addIndex As Integer = 0
            Dim cpu_item() As String = CType(ViewState("CPU_gItem"), String())
            Dim rangeType As String = "D"
            'Dim iMAX As Integer = 0
            'If chartDT.Columns.Count > 10 Then
            '    iMAX = 10 + 3
            'Else
            '    iMAX = chartDT.Columns.Count + 3
            'End If
            For rowIndex As Integer = 3 To chartDT.Columns.Count - 1 'iMAX

                XStr = chartDT.Columns(rowIndex).ColumnName
                XFormat = XStr

                If rbl_lossItem.SelectedIndex = 0 Then
                    ' Day 
                    rangeType = "D"
                    XFormat = XFormat.Substring(0, 4) + " " + XFormat.Substring(4, 4)
                ElseIf rbl_lossItem.SelectedIndex = 1 Then
                    ' Week
                    rangeType = "W"
                    XFormat = XFormat.Substring(0, 4) + " W" + XFormat.Substring(4, 2)
                Else
                    ' Month
                    rangeType = "M"
                    Dim MDate As Date = (DateTime.ParseExact(XStr, "yyyyMM", Nothing))
                    XFormat = MDate.ToString("yyyy MMM", System.Globalization.CultureInfo.InvariantCulture)
                End If

                If Not IsDBNull(chartDT.Rows(yieldIndex)(rowIndex)) Then
                    If (chartDT.Rows(yieldIndex)(rowIndex)).ToString.Length > 0 Then
                        Value = (CType(chartDT.Rows(yieldIndex)(rowIndex), Double) * 100)
                    Else
                        Value = 0
                    End If
                Else
                    Value = 0
                End If

                If Value > nYvalue Then
                    nYvalue = Value
                End If

                Chart.Series(part_id).Points.AddXY(XFormat, Value)
                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).ToolTip = (XFormat + " : " + (Value.ToString) + "%")
                If Not Ismultibar Then
                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Label = ((Value.ToString) + "%")
                End If

                Dim FE As String = Get_FE().Replace("'", "")
                Dim BE As String = Get_BE().Replace("'", "")
                If (part_id.Replace("'", "") <> "Summary") Then
                    If ddl_CustomerID.SelectedValue = "INTEL" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                        End If
                    ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                        End If
                    ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                        End If
                    Else
                        If IsRename = False Then
                            If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                                If IsRename = False Then
                                    If cb_ChartMerge0.Checked = True Then
                                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','1','" + FE + "','" + BE + "')"
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','0','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','2','" + FE + "','" + BE + "')"
                                        End If
                                    End If
                                Else
                                    If cb_ChartMerge0.Checked = True Then
                                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','1','" + FE + "','" + BE + "')"
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','0','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','2','" + FE + "','" + BE + "')"
                                        End If
                                    End If
                                End If
                            Else
                                'Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                                End If
                            End If
                        Else
                            If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                                If IsRename = False Then
                                    If cb_ChartMerge0.Checked = True Then
                                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','1','" + FE + "','" + BE + "')"
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','0','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','2','" + FE + "','" + BE + "')"
                                        End If
                                    End If
                                Else
                                    'If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                                    '    If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    '        tableStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                                    '    Else
                                    '        tableStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                                    '    End If
                                    'ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                                    '    'tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge "
                                    '    'tableStr += "where 1=1 "
                                    '    If cb_FinalYield.Checked = False Then
                                    '        If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    '            tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                                    '        Else
                                    '            tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                                    '        End If
                                    '    Else
                                    '        tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                                    '    End If
                                    'End If
                                    'If IsMerge = "1" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData "
                                    'ElseIf IsMerge = "0" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData_NotMerge "
                                    'ElseIf IsMerge = "2" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData_NotMerge_Storage "
                                    'ElseIf IsMerge = "3" Then
                                    '    sqlStr += "from vw_wb_Yield_Daily_RawData_SF "
                                    'ElseIf IsMerge = "4" Then
                                    '    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                    'ElseIf IsMerge = "5" Then
                                    '    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF "
                                    'End If
                                    If cb_ChartMerge0.Checked = True Then
                                        If cb_SF.Checked = True Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','3','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','1','" + FE + "','" + BE + "')"
                                        End If
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            If cb_SF.Checked = True Then
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','4','" + FE + "','" + BE + "')"
                                            Else
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','0','" + FE + "','" + BE + "')"
                                            End If
                                        Else
                                            If cb_SF.Checked = True Then
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','5','" + FE + "','" + BE + "')"
                                            Else
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','2','" + FE + "','" + BE + "')"
                                            End If
                                        End If
                                    End If
                                End If
                            Else
                                'Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                                End If
                            End If
                        End If
                    End If
                End If

                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).BorderWidth = 1

            Next

            If nYvalue < 10 Then
                Chart.ChartAreas("Default").AxisY.Maximum = 10
            End If
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try
    End Sub

    Private Sub DrawBar_Range_Target(ByRef Chart As Dundas.Charting.WebControl.Chart, ByVal chartColor As Color, ByRef entry As DictionaryEntry, ByRef chartDT As DataTable, ByVal yieldIndex As Integer, ByVal Ismultibar As Boolean)
        Try
            Dim series As Series
            Dim XStr As String
            Dim XFormat As String
            Dim Value As Double
            Dim nYvalue As Double = 0
            Dim part_id As String = entry.Key.ToString.Replace("'", "")

            'Dim IsTarget As Boolean = False
            If (Chart.Series.Count = 0) Then
                series = Chart.Series.Add("Target")
                series.ChartArea = "Default"
                'series.Type = SeriesChartType.Line
                If chartDT.Columns.Count > 1 Then
                    series.Type = SeriesChartType.Line
                Else
                    series.Type = SeriesChartType.Point
                End If
                series.Color = Color.PaleVioletRed
                series.BorderColor = Color.White
                series.BorderWidth = 3
                series("PointWidth") = "0.5"
                'Istarget = True
            End If

            series = Chart.Series.Add(part_id)
            series.ChartArea = "Default"
            series.Type = SeriesChartType.Column
            series.Color = chartColor
            series.BorderColor = Color.White
            series.BorderWidth = 1
            series("PointWidth") = "0.5"

            Dim addIndex As Integer = 0
            Dim cpu_item() As String = CType(ViewState("CPU_gItem"), String())
            Dim rangeType As String = "D"
            'Dim iMAX As Integer = 0
            'If chartDT.Columns.Count > 10 Then
            '    iMAX = 10 + 3
            'Else
            '    iMAX = chartDT.Columns.Count + 3
            'End If
            For rowIndex As Integer = 3 To chartDT.Columns.Count - 1 'iMAX

                XStr = chartDT.Columns(rowIndex).ColumnName
                XFormat = XStr

                If rbl_lossItem.SelectedIndex = 0 Then
                    ' Day 
                    rangeType = "D"
                    XFormat = XFormat.Substring(0, 4) + " " + XFormat.Substring(4, 4)
                ElseIf rbl_lossItem.SelectedIndex = 1 Then
                    ' Week
                    rangeType = "W"
                    XFormat = XFormat.Substring(0, 4) + " W" + XFormat.Substring(4, 2)
                Else
                    ' Month
                    rangeType = "M"
                    Dim MDate As Date = (DateTime.ParseExact(XStr, "yyyyMM", Nothing))
                    XFormat = MDate.ToString("yyyy MMM", System.Globalization.CultureInfo.InvariantCulture)
                End If

                If Not IsDBNull(chartDT.Rows(yieldIndex)(rowIndex)) Then
                    If (chartDT.Rows(yieldIndex)(rowIndex)).ToString.Length > 0 Then
                        Value = (CType(chartDT.Rows(yieldIndex)(rowIndex), Double) * 100)
                    Else
                        Value = 0
                    End If
                Else
                    Value = 0
                End If

                If Value > nYvalue Then
                    nYvalue = Value
                End If

                Chart.Series(part_id).Points.AddXY(XFormat, Value)
                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).ToolTip = (XFormat + " : " + (Value.ToString) + "%")
                If Not Ismultibar Then
                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Label = ((Value.ToString) + "%")
                End If

                Dim FE As String = Get_FE().Replace("'", "")
                Dim BE As String = Get_BE().Replace("'", "")
                If (part_id.Replace("'", "") <> "Summary") Then
                    If ddl_CustomerID.SelectedValue = "INTEL" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                        End If
                    ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                        End If
                    ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                        ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                        End If
                    Else
                        If IsRename = False Then
                            If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                                If IsRename = False Then
                                    If cb_ChartMerge0.Checked = True Then
                                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','1','" + FE + "','" + BE + "')"
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','0','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','2','" + FE + "','" + BE + "')"
                                        End If
                                    End If
                                Else
                                    If cb_ChartMerge0.Checked = True Then
                                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','1','" + FE + "','" + BE + "')"
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','0','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','2','" + FE + "','" + BE + "')"
                                        End If
                                    End If
                                End If
                            Else
                                'Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                                End If
                            End If
                        Else
                            If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                                If IsRename = False Then
                                    If cb_ChartMerge0.Checked = True Then
                                        Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','1','" + FE + "','" + BE + "')"
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','0','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB + "','2','" + FE + "','" + BE + "')"
                                        End If
                                    End If
                                Else
                                    'If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                                    '    If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    '        tableStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                                    '    Else
                                    '        tableStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                                    '    End If
                                    'ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                                    '    'tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge "
                                    '    'tableStr += "where 1=1 "
                                    '    If cb_FinalYield.Checked = False Then
                                    '        If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    '            tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                                    '        Else
                                    '            tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                                    '        End If
                                    '    Else
                                    '        tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                                    '    End If
                                    'End If
                                    'If IsMerge = "1" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData "
                                    'ElseIf IsMerge = "0" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData_NotMerge "
                                    'ElseIf IsMerge = "2" Then
                                    '    sqlStr += "from WB_Yield_Daily_RawData_NotMerge_Storage "
                                    'ElseIf IsMerge = "3" Then
                                    '    sqlStr += "from vw_wb_Yield_Daily_RawData_SF "
                                    'ElseIf IsMerge = "4" Then
                                    '    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                    'ElseIf IsMerge = "5" Then
                                    '    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                    'End If
                                    If cb_ChartMerge0.Checked = True Then
                                        If cb_SF.Checked = True Then
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','3','" + FE + "','" + BE + "')"
                                        Else
                                            Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','1','" + FE + "','" + BE + "')"
                                        End If
                                    Else
                                        If cb_FinalYield.Checked = False Then
                                            If cb_SF.Checked = True Then
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','4','" + FE + "','" + BE + "')"
                                            Else
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','0','" + FE + "','" + BE + "')"
                                            End If
                                        Else
                                            If cb_SF.Checked = True Then
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','5','" + FE + "','" + BE + "')"
                                            Else
                                                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','" + sWB_Rename + "','2','" + FE + "','" + BE + "')"
                                            End If
                                        End If
                                    End If
                                End If
                            Else
                                'Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','FailMode','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY BKM" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1','" + FE + "','" + BE + "')"
                                ElseIf ddl_YieldMode.SelectedValue.ToUpper() = "BY STATION" Then
                                    Chart.Series(part_id).Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','Station','-1','" + FE + "','" + BE + "')"
                                End If
                            End If
                        End If
                    End If
                End If

                'Chart.Series(part_id).Points((rowIndex - 3) + addIndex).BorderWidth = 1

                'Dim percentage As Double = 0.0
                'Dim pt As DataPoint
                'For Each pt In Chart.Series(srcSeriesName).Points
                '    Dim pos As Integer = 0
                '    percentage += pt.YValues(0) / total * 100.0
                '    pos = destSeries.Points.Add(Math.Round(percentage, 2))
                'Next pt
                'Dim objPoint As DataPoint = New DataPoint(CType((rowIndex - 3) + addIndex + 1, Double), CType(AxisYMinimum.Text, Double))
                'series1.Points.Add(objPoint)
                'objPoint.ToolTip = String.Format("Yield_Open_Fail_CL:{0:##0.###}", dt.Rows(0)("Yield_Open_Fail_CL"))

                'Chart.Series("CL").LegendText = "CL (" + cinfo.dt.Rows(cinfo.dt.Rows.Count - 1)("Yield_Open_Fail_CL").ToString() + ")"

                If (Chart.Series.Count = 2) Then
                    Chart.Series("Target").Points.AddXY(XFormat, CType(AxisYMinimum.Text, Double))
                    Chart.Series("Target").Points((rowIndex - 3) + addIndex).ToolTip = (XFormat + " : " + (AxisYMinimum.Text) + "%")
                    If Not Ismultibar Then
                        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Label = ((AxisYMinimum.Text) + "%")
                    End If
                End If

                'If ddl_CustomerID.SelectedValue = "INTEL" Then
                '    If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                '        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','NORMAL','-1')"
                '    Else
                '        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                '    End If
                'ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                '    If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                '        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','NORMAL','-1')"
                '    Else
                '        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                '    End If
                'Else
                '    If ddl_ProductType.SelectedValue.ToUpper() = "WB" Then
                '        If cb_ChartMerge0.Checked = True Then
                '            Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','WB','1')"
                '        Else
                '            Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','WB','0')"
                '        End If
                '    Else
                '        Chart.Series("Target").Points((rowIndex - 3) + addIndex).Href = "javascript:openWindowWithPost('DailyReportDetail_Test.aspx', 'WEB', '" + (ddl_CustomerID.SelectedValue) + "','" + (ddl_ProductType.SelectedValue) + "','" + part_id.Replace("'", "") + "','" + cpu_item(yieldIndex) + "','" + XStr + "','" + rangeType + "','BKM','-1')"
                '    End If
                'End If
                'End If
                'End If
                Chart.Series(part_id).Points((rowIndex - 3) + addIndex).BorderWidth = 1
                If (Chart.Series.Count = 2) Then
                    Chart.Series("Target").Points((rowIndex - 3) + addIndex).BorderWidth = 3
                End If
                If rowIndex = 5 Then
                    Chart.Series(part_id).Points.AddXY("", 0)
                    If (Chart.Series.Count = 2) Then
                        Chart.Series("Target").Points.AddXY("", CType(AxisYMinimum.Text, Double))
                    End If
                    addIndex = 1
                ElseIf rowIndex = 10 Then
                    Chart.Series(part_id).Points.AddXY("", 0)
                    If (Chart.Series.Count = 2) Then
                        Chart.Series("Target").Points.AddXY("", CType(AxisYMinimum.Text, Double))
                    End If
                    addIndex = 2
                End If
            Next


            Dim series1 As Series
            series1 = Chart.Series.Add("Target")
            series1.ChartArea = "Default"
            'series1.Type = SeriesChartType.Line
            If chartDT.Columns.Count > 1 Then
                series.Type = SeriesChartType.Line
            Else
                series.Type = SeriesChartType.Point
            End If
            series1.Color = Color.PaleVioletRed
            series1.BorderWidth = 2
            series1.MarkerStyle = MarkerStyle.None
            series1.MarkerSize = 0
            series1.Font = New Font("Times New Roman", 8, FontStyle.Regular)
            series1.ShowLabelAsValue = False
            series1("LabelStyle") = "Top"

            For rowIndex As Integer = 3 To chartDT.Columns.Count - 1 'iMAX
                Dim objPoint As DataPoint = New DataPoint(CType((rowIndex - 3) + addIndex + 1, Double), CType(AxisYMinimum.Text, Double))
                series1.Points.Add(objPoint)
            Next

            If nYvalue < 10 Then
                Chart.ChartAreas("Default").AxisY.Maximum = 10
            End If
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try
    End Sub

    Private Sub DrawThrend(ByRef Chart As Dundas.Charting.WebControl.Chart, ByVal chartColor As Color, ByRef entry As DictionaryEntry, ByRef chartDT As DataTable, ByVal yieldIndex As Integer)
        Try
            Dim series As Series
            Dim XStr As String
            Dim Value As Double

            series = Chart.Series.Add(entry.Key.ToString)
            series.ChartArea = "Default"
            If chartDT.Columns.Count = 4 Then
                series.Type = SeriesChartType.Point
            Else
                series.Type = SeriesChartType.Line
            End If
            series.Color = chartColor
            series.BorderColor = Color.White
            series.BorderWidth = 1
            series.MarkerStyle = MarkerStyle.Circle
            series.MarkerSize = 8
            series.MarkerColor = Color.DarkRed

            Dim addIndex As Integer = 0
            For rowIndex As Integer = 3 To (chartDT.Columns.Count - 1)

                XStr = chartDT.Columns(rowIndex).ColumnName
                If Not IsDBNull(chartDT.Rows(yieldIndex)(rowIndex)) Then
                    If (chartDT.Rows(yieldIndex)(rowIndex)).ToString.Length > 0 Then
                        Value = (CType(chartDT.Rows(yieldIndex)(rowIndex), Double) * 100)
                    Else
                        Value = 0
                    End If
                Else
                    Value = 0
                End If

                Chart.Series(entry.Key.ToString).Points.AddXY(XStr, Value)
                Chart.Series(entry.Key.ToString).Points((rowIndex - 3) + addIndex).ToolTip = (XStr + " : " + (Value.ToString) + "%")
                Chart.Series(entry.Key.ToString).Points((rowIndex - 3) + addIndex).Label = ((Value.ToString) + "%")

                If rb_DataTimeCustor.SelectedIndex = 0 Then
                    If rowIndex = 5 Then
                        Chart.Series(entry.Key.ToString).Points.AddXY("", 0)
                        addIndex = 1
                    ElseIf rowIndex = 10 Then
                        Chart.Series(entry.Key.ToString).Points.AddXY("", 0)
                        addIndex = 2
                    End If
                End If
            Next
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try
    End Sub

    Private Sub getSPECLine(ByRef Chart As Dundas.Charting.WebControl.Chart, ByVal Part_ID As String, ByVal yieldType As String)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim categoryStr As String = ""

        Try
            conn.Open()
            sqlStr = "SELECT "
            sqlStr += "CASE WHEN (UCL_Sigma = 3) THEN UCL_3S  WHEN (UCL_Sigma = 4) THEN UCL_4S WHEN (UCL_Sigma = 5) THEN UCL_5S ELSE NULL END as UCL,"
            sqlStr += "CASE WHEN (LCL_Sigma = 3) THEN LCL_3S  WHEN (LCL_Sigma = 4) THEN LCL_4S WHEN (LCL_Sigma = 5) THEN LCL_5S ELSE NULL END as LCL "
            sqlStr += "FROM dbo.Yield_SPEC "
            sqlStr += "WHERE 1=1 "
            Dim oPartID = Part_ID.Split(",")
            If oPartID IsNot Nothing AndAlso oPartID.Length = 1 Then
                sqlStr += "AND Part_Id='{0}' "
            ElseIf oPartID IsNot Nothing AndAlso oPartID.Length > 1 Then
                sqlStr += "and Part_Id in('{0}') "
            End If
            sqlStr += "AND UPPER(OOC_Code)='{1}' "
            sqlStr = String.Format(sqlStr, Part_ID, (yieldType.ToUpper()))
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            conn.Close()

            If myDT.Rows.Count > 0 Then

                If Not IsDBNull(myDT.Rows(0)("UCL")) Then
                    Chart_UCL(Chart, "UCL", Math.Round((CType(myDT.Rows(0)("UCL").ToString(), Double) * 100), 2, MidpointRounding.AwayFromZero))
                End If

                If Not IsDBNull(myDT.Rows(0)("LCL")) Then
                    Chart_UCL(Chart, "LCL", Math.Round((CType(myDT.Rows(0)("LCL").ToString(), Double) * 100), 2, MidpointRounding.AwayFromZero))
                End If

            End If

        Catch ex As Exception

        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try

    End Sub

    Public Sub Chart_UCL(ByRef Chart As Dundas.Charting.WebControl.Chart, ByVal LineType As String, ByVal LineValue As Double)

        Dim series As Series
        series = Chart.Series.Add(LineType)
        series.ChartArea = "Default"
        series.Type = SeriesChartType.Line
        series.Color = Color.Red
        series.BorderWidth = 2
        series.MarkerStyle = MarkerStyle.None
        series.MarkerSize = 0
        series.Font = New Font("Times New Roman", 8, FontStyle.Regular)
        series.ShowLabelAsValue = False
        series("LabelStyle") = "Top"

        Dim objPoint As DataPoint
        For i As Integer = 0 To 18
            objPoint = New DataPoint(i, LineValue)
            series.Points.Add(objPoint)
            objPoint.ToolTip = String.Format((LineType + ":{0:##0.###}"), LineValue)
        Next

        If CheckBox1.Checked = True Then
            series.Points(series.Points.Count - 1).Label = String.Format((LineType + ":{0:##0.###}"), LineValue)
            series.Points(series.Points.Count - 1).LabelBackColor = Color.Yellow
        Else
            series.Points(0).Label = String.Format((LineType + ":{0:##0.###}"), LineValue)
            series.Points(0).LabelBackColor = Color.Yellow
        End If
        series.SmartLabels.Enabled = True
        series.SmartLabels.AllowOutsidePlotArea = LabelOutsidePlotAreaStyle.Partial
        series.SmartLabels.MarkerOverlapping = False
        series.SmartLabels.MinMovingDistance = 15
        Chart.Series(LineType).LegendText = LineType

    End Sub

    ' >>
    Protected Sub but_weekTo_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles but_weekTo.Click

        'tr_chartDisplay.Visible = False
        'tr_gvDisplay.Visible = False
        'tb_uploadLot.Visible = False
        'Dim sourceAry As ArrayList = New ArrayList
        'Dim DestAry As ArrayList = New ArrayList
        'For i As Integer = 0 To (lb_weekSource.Items.Count - 1)

        '    'If ddlPart.SelectedValue = "All" Then
        '    If (listB_PartSource.Items.Count = 0 AndAlso listB_PartShow.Items.Count > 0) Then
        '        'If ddl_BumpingType.Enabled = False Then
        '        '    If lb_weekSource.Items(i).Value.ToUpper() = "TOTAL YIELD" Or lb_weekSource.Items(i).Value.ToUpper() = "TOTAL" Then
        '        '        DestAry.Add(lb_weekSource.Items(i).Value)
        '        '    Else
        '        '        sourceAry.Add(lb_weekSource.Items(i).Value)
        '        '    End If
        '        'Else
        '        '    If lb_weekSource.Items(i).Selected Then
        '        '        DestAry.Add(lb_weekSource.Items(i).Value)
        '        '    Else
        '        '        sourceAry.Add(lb_weekSource.Items(i).Value)
        '        '    End If
        '        'End If
        '        If listB_BumpingTypeShow.Enabled = False Then
        '            If lb_weekSource.Items(i).Value.ToUpper() = "TOTAL YIELD" Or lb_weekSource.Items(i).Value.ToUpper() = "TOTAL" Then
        '                DestAry.Add(lb_weekSource.Items(i).Value)
        '            Else
        '                sourceAry.Add(lb_weekSource.Items(i).Value)
        '            End If
        '        Else
        '            If lb_weekSource.Items(i).Selected Then
        '                DestAry.Add(lb_weekSource.Items(i).Value)
        '            Else
        '                sourceAry.Add(lb_weekSource.Items(i).Value)
        '            End If
        '        End If
        '    Else
        '        If lb_weekSource.Items(i).Selected Then
        '            DestAry.Add(lb_weekSource.Items(i).Value)
        '        Else
        '            sourceAry.Add(lb_weekSource.Items(i).Value)
        '        End If
        '    End If

        'Next

        'lb_weekSource.Items.Clear()

        'For i As Integer = 0 To (sourceAry.Count - 1)
        '    lb_weekSource.Items.Add(sourceAry(i).ToString())
        'Next

        'For i As Integer = 0 To (DestAry.Count - 1)
        '    lb_weekShow.Items.Add(DestAry(i).ToString())
        'Next

        moveList(lb_weekSource, lb_weekShow)

        ListBoxSort(lb_weekSource, False)
        ListBoxSort(lb_weekShow, False)
    End Sub

    ' <<
    Protected Sub but_weekBack_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles but_weekBack.Click

        'tr_chartDisplay.Visible = False
        'tr_gvDisplay.Visible = False
        'tb_uploadLot.Visible = False
        'Dim sourceAry As ArrayList = New ArrayList
        'Dim DestAry As ArrayList = New ArrayList
        'For i As Integer = 0 To (lb_weekShow.Items.Count - 1)
        '    If lb_weekShow.Items(i).Selected Then
        '        DestAry.Add(lb_weekShow.Items(i).Value)
        '    Else
        '        sourceAry.Add(lb_weekShow.Items(i).Value)
        '    End If
        'Next

        ''lb_weekSource.Items.Clear()
        'lb_weekShow.Items.Clear()

        'For i As Integer = 0 To (sourceAry.Count - 1)
        '    lb_weekShow.Items.Add(sourceAry(i).ToString())
        'Next

        'For i As Integer = 0 To (DestAry.Count - 1)
        '    lb_weekSource.Items.Add(DestAry(i).ToString())
        'Next

        moveList(lb_weekShow, lb_weekSource)

        ListBoxSort(lb_weekSource, False)
        ListBoxSort(lb_weekShow, False)
    End Sub

    ' >>
    Protected Sub but_dateRight_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles but_dateRight.Click
        moveList(listB_timeSource, listB_timeShow)

        ListBoxSort(listB_timeSource, True)
        ListBoxSort(listB_timeShow, True)
    End Sub

    ' <<
    Protected Sub but_dateLeft_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles but_dateLeft.Click
        moveList(listB_timeShow, listB_timeSource)

        ListBoxSort(listB_timeSource, True)
        ListBoxSort(listB_timeShow, True)
    End Sub

    ' Alert 呈現
    Public Sub ShowMessage(ByVal mesStr As String)

        Dim sb As System.Text.StringBuilder = New System.Text.StringBuilder()
        sb.Append("<script language='javascript'>")
        sb.Append("alert('" + mesStr + "');")
        sb.Append("</script>")
        Dim myCSManager As ClientScriptManager = Page.ClientScript
        myCSManager.RegisterStartupScript(Me.GetType(), "SetStatusScript", sb.ToString())

    End Sub

    ' 自訂時間
    Protected Sub cb_customerDay_CheckedChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles cb_customerDay.CheckedChanged

        tr_dateRange.Visible = False
        rb_DataTimeCustor.SelectedIndex = 0
        If cb_customerDay.Checked Then
            txtDateFrom.Enabled = True
            txtDateTo.Enabled = True
            Calendar1.Enabled = True
            Calendar2.Enabled = True
            ddlHourFrom.Enabled = True
            ddlHourTo.Enabled = True
            cb_ShowToday.Checked = False
        Else
            txtDateFrom.Enabled = False
            txtDateTo.Enabled = False
            Calendar1.Enabled = False
            Calendar2.Enabled = False
            ddlHourFrom.Enabled = False
            ddlHourTo.Enabled = False
        End If

    End Sub

    ' 今天呈現
    Protected Sub cb_ShowToday_CheckedChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles cb_ShowToday.CheckedChanged
        If cb_ShowToday.Checked Then
            tr_dateRange.Visible = False
            cb_customerDay.Checked = False
            rb_DataTimeCustor.SelectedIndex = 0
        End If
    End Sub

    Private Sub moveList(ByRef sourceList As ListBox, ByRef destList As ListBox)

        Dim sourceAry As New ArrayList()
        Dim DestAry As New ArrayList()

        For i As Integer = 0 To sourceList.Items.Count - 1
            If sourceList.Items(i).Selected Then
                DestAry.Add(sourceList.Items(i).Value)
            Else
                sourceAry.Add(sourceList.Items(i).Value)
            End If
        Next
        sourceList.Items.Clear()

        For i As Integer = 0 To sourceAry.Count - 1
            sourceList.Items.Add(sourceAry(i).ToString())
        Next
        For i As Integer = 0 To DestAry.Count - 1
            destList.Items.Add(DestAry(i).ToString())
        Next

    End Sub

    Private Sub moveListAll(ByRef sourceList As ListBox, ByRef destList As ListBox)

        Dim sourceAry As New ArrayList()
        Dim DestAry As New ArrayList()

        For i As Integer = 0 To sourceList.Items.Count - 1
            DestAry.Add(sourceList.Items(i).Value)
        Next
        sourceList.Items.Clear()

        For i As Integer = 0 To DestAry.Count - 1
            destList.Items.Add(DestAry(i).ToString())
        Next

    End Sub

    Private Sub moveListOnlyTotal(ByRef sourceList As ListBox, ByRef destList As ListBox)

        Dim sourceAry As New ArrayList()
        Dim DestAry As New ArrayList()

        For i As Integer = 0 To sourceList.Items.Count - 1
            DestAry.Add(sourceList.Items(i).Value)
        Next
        sourceList.Items.Clear()

        For i As Integer = 0 To DestAry.Count - 1
            destList.Items.Add(DestAry(i).ToString())
        Next

        ' 移去 Total 與 加入 Total

    End Sub

    Protected Sub rbl_lossItem_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles rbl_lossItem.SelectedIndexChanged

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim tableStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim categoryStr As String = ""
        tr_gvDisplay.Visible = False

        Try
            conn.Open()
            If IsRename = False Then
                If ddl_ProductType.Text = sWB Then
                    If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                        If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                            tableStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                        Else
                            tableStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                        End If
                    ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                        'tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge "
                        'tableStr += "where 1=1 "
                        If cb_FinalYield.Checked = False Then
                            If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                            Else
                                tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                            End If
                        Else
                            If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF where 1=1 "
                            Else
                                tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                            End If
                        End If
                    End If
                Else
                    If ddl_CustomerID.SelectedValue = "INTEL" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            tableStr += "from dbo.Yield_Daily_RawData "
                            tableStr += "where 1=1 "
                            tableStr += "and customer_id='INTEL' "
                        Else
                            tableStr += "from dbo.BKM_Yield_Daily_RawData "
                            tableStr += "where 1=1 "
                        End If
                    ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            tableStr += "from dbo.Yield_Daily_RawData "
                            tableStr += "where 1=1 "
                            tableStr += "and customer_id='AMD' "
                        Else
                            tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                            tableStr += "where 1=1 "
                        End If
                    ElseIf ddl_CustomerID.SelectedValue = "NVD" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            tableStr += "from dbo.Yield_Daily_RawData "
                            tableStr += "where 1=1 "
                            tableStr += "and customer_id='NVD' "
                        Else
                            tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                            tableStr += "where 1=1 "
                        End If
                    ElseIf ddl_CustomerID.SelectedValue = "BCM" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            tableStr += "from dbo.Yield_Daily_RawData "
                            tableStr += "where 1=1 "
                            tableStr += "and customer_id='BCM' "
                        Else
                            tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                            tableStr += "where 1=1 "
                        End If
                    Else
                        tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                        tableStr += "where 1=1 "
                    End If
                End If
            Else
                If ddl_ProductType.Text = sWB_Rename Then
                    If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                        If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                            tableStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                        Else
                            tableStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                        End If
                    ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                        'tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge "
                        'tableStr += "where 1=1 "
                        If cb_FinalYield.Checked = False Then
                            If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                            Else
                                tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                            End If
                        Else
                            If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF where 1=1 "
                            Else
                                tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                            End If
                        End If
                    End If
                Else
                    If ddl_CustomerID.SelectedValue = "INTEL" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            tableStr += "from dbo.Yield_Daily_RawData "
                            tableStr += "where 1=1 "
                            tableStr += "and customer_id='INTEL' "
                        Else
                            tableStr += "from dbo.BKM_Yield_Daily_RawData "
                            tableStr += "where 1=1 "
                        End If
                    ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            tableStr += "from dbo.Yield_Daily_RawData "
                            tableStr += "where 1=1 "
                            tableStr += "and customer_id='AMD' "
                        Else
                            tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                            tableStr += "where 1=1 "
                        End If
                    ElseIf ddl_CustomerID.SelectedValue = "NVD" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            tableStr += "from dbo.Yield_Daily_RawData "
                            tableStr += "where 1=1 "
                            tableStr += "and customer_id='NVD' "
                        Else
                            tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                            tableStr += "where 1=1 "
                        End If
                    ElseIf ddl_CustomerID.SelectedValue = "BCM" Then
                        If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                            tableStr += "from dbo.Yield_Daily_RawData "
                            tableStr += "where 1=1 "
                            tableStr += "and customer_id='BCM' "
                        Else
                            tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                            tableStr += "where 1=1 "
                        End If
                    Else
                        tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                        tableStr += "where 1=1 "
                    End If
                End If
            End If

            Dim conditionStr As String = ""
            Dim sGetPartID As String = Get_PartID()
            If (rbl_BySource.SelectedIndex = 0) Then
                ' --- Production ID ---
                If rbl_BySource.Enabled = True Then
                    If sGetPartID <> "" Then
                        'conditionStr += "and production_id='" + (Me.ddlPart.SelectedValue) + "' "
                        '===[Loader取消ABFS by Product 計算，改由網頁即時計算]====================
                        'conditionStr += "and production_id in(" + sGetPartID + ") "
                        'conditionStr += "and Part_Id in(select a.Part_id from EDA.dbo.Customer_Prodction_Mapping a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                        If IsRename = False Then
                            sqlStr = "and Part_Id in(select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                        Else
                            sqlStr = "and Part_Id in(select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                        End If
                    End If
                End If
            Else
                ' --- Part ID ---
                If rbl_BySource.Enabled = True Then
                    If sGetPartID <> "" Then
                        'conditionStr += "and Part_Id='" + (Me.ddlPart.SelectedValue) + "' "
                        conditionStr += "and Part_Id in(" + sGetPartID + ") "
                    End If
                End If
            End If

            If rbl_lossItem.SelectedIndex = 0 Then
                ' Daily 
                sqlStr = "select Top(120) convert(char(10), datatime, 112) as trtm "
                sqlStr += tableStr
                sqlStr += conditionStr
                sqlStr += "group by convert(char(10), datatime, 112) "
                sqlStr += "order by convert(char(10), datatime, 112) desc "
            ElseIf rbl_lossItem.SelectedIndex = 1 Then
                ' Week 
                sqlStr = "select Top(52) yearWW as trtm "
                sqlStr += tableStr
                sqlStr += conditionStr
                sqlStr += "group by yearWW "
                sqlStr += "order by yearWW desc "
            Else
                ' Month
                'sqlStr = "select Top(12) convert(char(7), datatime, 120) as trtm "
                sqlStr = "select Top(120) substring(convert(char(10), datatime, 112),1,6) as trtm "
                sqlStr += tableStr
                sqlStr += conditionStr
                'sqlStr += "group by convert(char(7), datatime, 120) "
                'sqlStr += "order by convert(char(7), datatime, 120) desc "
                sqlStr += "group by substring(convert(char(10), datatime, 112),1,6) "
                sqlStr += "order by substring(convert(char(10), datatime, 112),1,6) desc "
            End If

            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            conn.Close()

            listB_timeSource.Items.Clear()
            listB_timeShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_timeSource.Items.Add(myDT.Rows(i)("trtm").ToString().Replace("-", ""))
            Next
            'rb_DataTimeCustor_SelectedIndexChanged(sender, e)
        Catch ex As Exception

        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try
    End Sub

    Protected Sub rb_DataTimeCustor_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles rb_DataTimeCustor.SelectedIndexChanged
        tr_dateRange.Visible = False
        If rb_DataTimeCustor.SelectedIndex = 1 Then
            tr_gvDisplay.Visible = False
            tr_dateRange.Visible = True
            cb_ShowToday.Checked = False
            cb_customerDay.Checked = False

            ' 取得時間區間
            Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
            Dim sqlStr As String = ""
            Dim tableStr As String = ""
            Dim myDT As DataTable
            Dim myAdapter As SqlDataAdapter
            Dim categoryStr As String = ""

            Try
                conn.Open()

                If IsRename = False Then
                    If ddl_ProductType.Text = sWB Then
                        If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                            If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                tableStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                            Else
                                tableStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                            End If
                        ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                            'tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge "
                            'tableStr += "where 1=1 "
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                                Else
                                    tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF where 1=1 "
                                Else
                                    tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                                End If
                            End If
                        End If
                    Else
                        If ddl_CustomerID.SelectedValue = "INTEL" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='INTEL' "
                            Else
                                tableStr += "from dbo.BKM_Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='AMD' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "NVD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='NVD' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "BCM" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='BCM' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        Else
                            tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                            tableStr += "where 1=1 "
                        End If
                    End If
                Else
                    If ddl_ProductType.Text = sWB_Rename Then
                        If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                            If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                tableStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                            Else
                                tableStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                            End If
                        ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                            'tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge "
                            'tableStr += "where 1=1 "
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                                Else
                                    tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF where 1=1 "
                                Else
                                    tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                                End If
                            End If
                        End If
                    Else
                        If ddl_CustomerID.SelectedValue = "INTEL" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='INTEL' "
                            Else
                                tableStr += "from dbo.BKM_Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='AMD' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "NVD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='NVD' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "BCM" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='BCM' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        Else
                            tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                            tableStr += "where 1=1 "
                        End If
                    End If
                End If

                Dim conditionStr As String = ""
                Dim sGetPartID As String = Get_PartID()
                If (rbl_BySource.SelectedIndex = 0) Then
                    ' --- Production ID ---
                    If rbl_BySource.Enabled = True Then
                        If sGetPartID <> "" Then
                            'conditionStr += "and production_id='" + (Me.ddlPart.SelectedValue) + "' "
                            '===[Loader取消ABFS by Product 計算，改由網頁即時計算]====================
                            'conditionStr += "and production_id in(" + sGetPartID + ") "
                            'conditionStr += "and Part_Id in(select a.Part_id from EDA.dbo.Customer_Prodction_Mapping a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                            If IsRename = False Then
                                sqlStr = "and Part_Id in(select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                            Else
                                sqlStr = "and Part_Id in(select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                            End If
                        End If
                    End If
                Else
                    ' --- Part ID ---
                    If rbl_BySource.Enabled = True Then
                        If sGetPartID <> "" Then
                            'conditionStr += "and Part_Id='" + (Me.ddlPart.SelectedValue) + "' "
                            conditionStr += "and Part_Id in(" + sGetPartID + ") "
                        End If
                    End If
                End If

                If rbl_lossItem.SelectedIndex = 0 Then
                    ' Daily 
                    sqlStr = "select convert(char(10), datatime, 112) as trtm "
                    sqlStr += tableStr
                    sqlStr += conditionStr
                    sqlStr += "group by convert(char(10), datatime, 112) "
                    sqlStr += "order by convert(char(10), datatime, 112) desc "
                ElseIf rbl_lossItem.SelectedIndex = 1 Then
                    ' Week 
                    sqlStr = "select yearWW as trtm "
                    sqlStr += tableStr
                    sqlStr += conditionStr
                    sqlStr += "group by yearWW "
                    sqlStr += "order by yearWW desc "
                Else
                    ' Month
                    sqlStr = "select convert(char(7), datatime, 120) as trtm "
                    sqlStr += tableStr
                    sqlStr += conditionStr
                    sqlStr += "group by convert(char(7), datatime, 120) "
                    sqlStr += "order by convert(char(7), datatime, 120) desc "
                End If

                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                conn.Close()

                listB_timeSource.Items.Clear()
                listB_timeShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_timeSource.Items.Add(myDT.Rows(i)("trtm").ToString().Replace("-", ""))
                Next
            Catch ex As Exception
                Dim sError As String = ex.ToString()
            Finally
                If conn.State = ConnectionState.Open Then
                    conn.Close()
                End If
            End Try
        End If
    End Sub

    'Protected Sub ddl_BumpingType_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles ddl_BumpingType.SelectedIndexChanged
    '    'If ddl_BumpingType.Text = "All" Then
    '    '    ddl_CustomerID.Enabled = True
    '    '    ddlPart.Enabled = True
    '    '    rbl_BySource.Enabled = True
    '    '    rbl_BySource.Items(0).Selected = True
    '    'Else
    '    '    ddl_CustomerID.Enabled = False
    '    '    ddlPart.Enabled = False
    '    '    rbl_BySource.Enabled = False
    '    '    If ddl_CustomerID.Items.Count > 0 Then
    '    '        ddl_CustomerID.SelectedIndex = 0
    '    '    End If
    '    '    If ddlPart.Items.Count > 0 Then
    '    '        ddlPart.SelectedIndex = 0
    '    '    End If
    '    'End If
    '    If listB_BumpingTypeSource.Items.Count = 0 Then
    '        ddl_CustomerID.Enabled = True
    '        ddlPart.Enabled = True
    '        rbl_BySource.Enabled = True
    '        rbl_BySource.Items(0).Selected = True
    '    Else
    '        ddl_CustomerID.Enabled = False
    '        ddlPart.Enabled = False
    '        rbl_BySource.Enabled = False
    '        If ddl_CustomerID.Items.Count > 0 Then
    '            ddl_CustomerID.SelectedIndex = 0
    '        End If
    '        If ddlPart.Items.Count > 0 Then
    '            ddlPart.SelectedIndex = 0
    '        End If
    '    End If
    'End Sub

    Public Class DecComparer
        Implements IComparer
        Dim myComapar As CaseInsensitiveComparer = New CaseInsensitiveComparer()
        Public Function Compare(ByVal x As Object, ByVal y As Object) As Integer Implements IComparer.Compare
            Return myComapar.Compare(y, x)
        End Function
    End Class

    Private Sub ListBoxSort(ByVal lbx As ListBox, ByVal DESC As Boolean)
        '利用sortedlist 類為listbox排序 
        Dim slist As New SortedList()
        '引用SortedList類别，實作IComparer
        Dim mySort As SortedList = New SortedList(New DecComparer())
        For i As Integer = 0 To lbx.Items.Count - 1
            If DESC = False Then
                '將listbox內容逐項複製到sortedlist物件中
                If slist(lbx.Items(i).Text()) Is Nothing Then
                    slist.Add(lbx.Items(i).Text, lbx.Items(i).Value)
                End If
            Else
                '將listbox內容逐項複製到sortedlist物件中
                If mySort(lbx.Items(i).Text()) Is Nothing Then
                    mySort.Add(lbx.Items(i).Text, lbx.Items(i).Value)
                End If
            End If
        Next

        lbx.Items.Clear()
        '清空原listbox

        If DESC = False Then
            For Each obj As DictionaryEntry In slist
                Dim myit As New ListItem()
                myit.Text = obj.Key.ToString()
                myit.Value = obj.Value.ToString()
                '再重新將sortlist集合複製回listbox，這樣，複製回來的陣列是按值排序過的
                lbx.Items.Add(myit)
            Next
        Else
            For Each obj As DictionaryEntry In mySort
                Dim myit As New ListItem()
                myit.Text = obj.Key.ToString()
                myit.Value = obj.Value.ToString()
                '再重新將sortlist集合複製回listbox，這樣，複製回來的陣列是按值排序過的
                lbx.Items.Add(myit)
            Next
        End If
    End Sub

    Protected Sub but_BumpingTypeRight_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles but_BumpingTypeRight.Click
        moveList(listB_BumpingTypeSource, listB_BumpingTypeShow)

        'If listB_BumpingTypeSource.Items.Count = 0 Then
        '    'ddl_CustomerID.Enabled = True
        '    'ddlPart.Enabled = True
        '    'rbl_BySource.Enabled = True
        '    'rbl_BySource.Items(0).Selected = True

        '    ddl_CustomerID.Enabled = False
        '    rbl_BySource.Enabled = False
        '    'ddlPart.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False

        '    'cb_ChartMerge.Checked = True
        '    'cb_ChartMerge.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_BumpingTypeShow.Items.Count = 0 Then
        '                'ddl_CustomerID.Enabled = True
        '                'rbl_BySource.Enabled = True
        '                ''ddlPart.Enabled = True
        '                'listB_PartSource.Enabled = True
        '                'listB_PartShow.Enabled = True
        '                'but_PartRight.Enabled = True
        '                'but_PartLeft.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                'ddl_CustomerID.Enabled = False
        '                'rbl_BySource.Enabled = False
        '                ''ddlPart.Enabled = False
        '                'listB_PartSource.Enabled = False
        '                'listB_PartShow.Enabled = False
        '                'but_PartRight.Enabled = False
        '                'but_PartLeft.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            'ddl_CustomerID.Enabled = True
        '            'rbl_BySource.Enabled = True
        '            'rbl_BySource.Items(0).Selected = True
        '            ''ddlPart.Enabled = True
        '            'listB_PartSource.Enabled = True
        '            'listB_PartShow.Enabled = True
        '            'but_PartRight.Enabled = True
        '            'but_PartLeft.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_BumpingTypeShow.Items.Count = 0 Then
        '                'ddl_CustomerID.Enabled = True
        '                'rbl_BySource.Enabled = True
        '                ''ddlPart.Enabled = True
        '                'listB_PartSource.Enabled = True
        '                'listB_PartShow.Enabled = True
        '                'but_PartRight.Enabled = True
        '                'but_PartLeft.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                'ddl_CustomerID.Enabled = False
        '                'rbl_BySource.Enabled = False
        '                ''ddlPart.Enabled = False
        '                'listB_PartSource.Enabled = False
        '                'listB_PartShow.Enabled = False
        '                'but_PartRight.Enabled = False
        '                'but_PartLeft.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            'ddl_CustomerID.Enabled = True
        '            'rbl_BySource.Enabled = True
        '            'rbl_BySource.Items(0).Selected = True
        '            ''ddlPart.Enabled = True
        '            'listB_PartSource.Enabled = True
        '            'listB_PartShow.Enabled = True
        '            'but_PartRight.Enabled = True
        '            'but_PartLeft.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    End If
        '    If ddl_CustomerID.Items.Count > 0 Then
        '        ddl_CustomerID.SelectedIndex = 0
        '    End If
        '    'If ddlPart.Items.Count > 0 Then
        '    '    ddlPart.SelectedIndex = 0
        '    'End If
        'End If

        ListBoxSort(listB_BumpingTypeSource, False)
        ListBoxSort(listB_BumpingTypeShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ' --- Customer ID (廠商) ---
        If IsRename = False Then
            sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        Else
            sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        End If
        sqlStr += "and a.yield_function=1 "
        ' --- Product Type ---
        sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        sqlStr += "group by a.customer_id order by a.customer_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillController(myDT, ddl_CustomerID, 1)

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        'sqlStr += "and production_id <> '' "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            'If Not IsDBNull(myDT.Rows(0)(0)) Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                'UtilObj.FillController(myDT, ddlPart, 0)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        lb_weekSource.Items.Clear()
        lb_weekShow.Items.Clear()
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Protected Sub but_BumpingTypeLeft_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles but_BumpingTypeLeft.Click
        moveList(listB_BumpingTypeShow, listB_BumpingTypeSource)

        'If listB_BumpingTypeSource.Items.Count = 0 Then
        '    'ddl_CustomerID.Enabled = True
        '    'ddlPart.Enabled = True
        '    'rbl_BySource.Enabled = True
        '    'rbl_BySource.Items(0).Selected = True

        '    ddl_CustomerID.Enabled = False
        '    rbl_BySource.Enabled = False
        '    'ddlPart.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False

        '    'cb_ChartMerge.Checked = True
        '    'cb_ChartMerge.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_BumpingTypeShow.Items.Count = 0 Then
        '                ddl_CustomerID.Enabled = True
        '                rbl_BySource.Enabled = True
        '                'ddlPart.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                ddl_CustomerID.Enabled = False
        '                rbl_BySource.Enabled = False
        '                'ddlPart.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            ddl_CustomerID.Enabled = True
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            'ddlPart.Enabled = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_BumpingTypeShow.Items.Count = 0 Then
        '                ddl_CustomerID.Enabled = True
        '                rbl_BySource.Enabled = True
        '                'ddlPart.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                ddl_CustomerID.Enabled = False
        '                rbl_BySource.Enabled = False
        '                'ddlPart.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            ddl_CustomerID.Enabled = True
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            'ddlPart.Enabled = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    End If
        '    If ddl_CustomerID.Items.Count > 0 Then
        '        ddl_CustomerID.SelectedIndex = 0
        '    End If
        '    'If ddlPart.Items.Count > 0 Then
        '    '    ddlPart.SelectedIndex = 0
        '    'End If
        'End If

        ListBoxSort(listB_BumpingTypeSource, False)
        ListBoxSort(listB_BumpingTypeShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ' --- Customer ID (廠商) ---
        If IsRename = False Then
            sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        Else
            sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        End If
        sqlStr += "and a.yield_function=1 "
        ' --- Product Type ---
        sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        sqlStr += "group by a.customer_id order by a.customer_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillController(myDT, ddl_CustomerID, 1)

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        'sqlStr += "and production_id <> '' "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            'If Not IsDBNull(myDT.Rows(0)(0)) Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                'UtilObj.FillController(myDT, ddlPart, 0)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            Else
                ' --- Customer ID ---
                sqlStr += "and customer_id ='All' "
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        lb_weekSource.Items.Clear()
        lb_weekShow.Items.Clear()
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    ' >>
    Protected Sub but_PartRight_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles but_PartRight.Click
        moveList(listB_PartSource, listB_PartShow)
        'If ddl_ProductType.Text = "WB" Then
        '    If listB_BumpingTypeShow.Items.Count = 0 Then
        '        cb_ChartMerge.Checked = True
        '        cb_ChartMerge.Enabled = True
        '    Else
        '        cb_ChartMerge.Checked = True
        '        cb_ChartMerge.Enabled = False
        '    End If
        'Else
        '    cb_ChartMerge.Checked = True
        '    cb_ChartMerge.Enabled = True
        'End If

        ListBoxSort(listB_PartSource, False)
        ListBoxSort(listB_PartShow, False)
        rb_DataTimeCustor_SelectedIndexChanged(sender, e)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim tableStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim categoryStr As String = ""
        tr_gvDisplay.Visible = False

        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "
        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        conn.Open()
        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        lb_weekSource.Items.Clear()
        lb_weekShow.Items.Clear()
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        If ddl_ProductType.Text = "CS" ORELSE ddl_ProductType.Text = "CPU" Then
            rb_BE_SelectedIndexChanged(sender, e)
            rb_FE_SelectedIndexChanged(sender, e)
        End If
    End Sub

    ' <<
    Protected Sub but_PartLeft_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles but_PartLeft.Click
        moveList(listB_PartShow, listB_PartSource)
        'If ddl_ProductType.Text = "WB" Then
        '    If listB_BumpingTypeShow.Items.Count = 0 Then
        '        cb_ChartMerge.Checked = True
        '        cb_ChartMerge.Enabled = True
        '    Else
        '        cb_ChartMerge.Checked = True
        '        cb_ChartMerge.Enabled = False
        '    End If
        'Else
        '    cb_ChartMerge.Checked = True
        '    cb_ChartMerge.Enabled = True
        'End If

        ListBoxSort(listB_PartSource, False)
        ListBoxSort(listB_PartShow, False)
        rb_DataTimeCustor_SelectedIndexChanged(sender, e)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim tableStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim categoryStr As String = ""
        tr_gvDisplay.Visible = False

        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "
        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        conn.Open()
        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        lb_weekSource.Items.Clear()
        lb_weekShow.Items.Clear()
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        If ddl_ProductType.Text = "CS" ORELSE ddl_ProductType.Text = "CPU" Then
            rb_BE_SelectedIndexChanged(sender, e)
            rb_FE_SelectedIndexChanged(sender, e)
        End If
    End Sub

    Protected Sub Button1_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles Button1.Click
        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter

        '' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        ''================
        ''Customer開放複選
        ''================
        'If ddl_ProductType.Text <> sWB_Rename Then
        '    If ddl_CustomerID.Text <> "All" Then
        '        ' --- Customer ID ---
        '        If ddl_CustomerID.SelectedValue <> "" Then
        '            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
        '        End If
        '    End If
        'Else
        '    Dim strCustomerID As String = ""
        '    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
        '        If n = 0 Then
        '            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
        '        Else
        '            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
        '        End If
        '    Next
        '    If strCustomerID <> "" Then
        '        sqlStr += "and customer_id IN(" + strCustomerID + ") "
        '    End If
        'End If
        'sqlStr += "and category ='" + ddl_ProductType.SelectedValue + "' "
        'If tr_BumpingType.Visible = True Then
        '    Dim strBumpingType As String = ""
        '    For x As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
        '        If x = 0 Then
        '            strBumpingType += "'" & listB_BumpingTypeShow.Items(x).Text & "'"
        '        Else
        '            strBumpingType += ",'" & listB_BumpingTypeShow.Items(x).Text & "'"
        '        End If
        '    Next
        '    sqlStr += "and Bumping_Type in (" + strBumpingType + ") "
        'End If
        'If TextBox1.Text <> "" Then
        '    If rbl_BySource.SelectedIndex = 0 Then
        '        sqlStr += "and production_id like '%" + TextBox1.Text + "%' "
        '    ElseIf rbl_BySource.SelectedIndex = 1 Then
        '        sqlStr += "and Part_id like '%" + TextBox1.Text + "%' "
        '    End If
        'End If
        'sqlStr += "and yield_function=1 "
        ''sqlStr += "and production_id <> '' "
        'sqlStr += "group by production_id"
        'myAdapter = New SqlDataAdapter(sqlStr, conn)
        'myAdapter.SelectCommand.CommandTimeout = 3600
        'myDT = New DataTable
        'myAdapter.Fill(myDT)

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        If TextBox1.Text <> "" Then
            If rbl_BySource.SelectedIndex = 0 Then
                sqlStr += "and a.production_id like '%" + TextBox1.Text + "%' "
            ElseIf rbl_BySource.SelectedIndex = 1 Then
                sqlStr += "and a.Part_id like '%" + TextBox1.Text + "%' "
            End If
        End If
        'sqlStr += "and production_id <> '' "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            'If Not IsDBNull(myDT.Rows(0)(0)) Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                If IsRename = False Then
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                        'rbl_BySource.SelectedIndex = 1
                        'rbl_BySource.Items(0).Enabled = False

                        '' 轉向 Part ID
                        ''rbl_BySource.SelectedIndex = 1

                        'If IsRename = False Then
                        '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                        'Else
                        '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                        'End If
                        ''================
                        ''Customer開放複選
                        ''================
                        'If ddl_ProductType.Text <> sWB_Rename Then
                        '    If ddl_CustomerID.Text <> "All" Then
                        '        ' --- Customer ID ---
                        '        If ddl_CustomerID.SelectedValue <> "" Then
                        '            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        '        End If
                        '    End If
                        'Else
                        '    Dim strCustomerID As String = ""
                        '    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        '        If n = 0 Then
                        '            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        '        Else
                        '            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        '        End If
                        '    Next
                        '    If strCustomerID <> "" Then
                        '        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                        '    End If
                        'End If
                        'sqlStr += "and category ='" + ddl_ProductType.SelectedValue + "' "
                        'If tr_BumpingType.Visible = True Then
                        '    Dim strBumpingType As String = ""
                        '    For x As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        '        If x = 0 Then
                        '            strBumpingType += "'" & listB_BumpingTypeShow.Items(x).Text & "'"
                        '        Else
                        '            strBumpingType += ",'" & listB_BumpingTypeShow.Items(x).Text & "'"
                        '        End If
                        '    Next
                        '    sqlStr += "and Bumping_Type in (" + strBumpingType + ") "
                        'End If
                        'sqlStr += "and yield_function=1 "
                        'If TextBox1.Text <> "" Then
                        '    If rbl_BySource.SelectedIndex = 0 Then
                        '        sqlStr += "and production_id like '%" + TextBox1.Text + "%' "
                        '    ElseIf rbl_BySource.SelectedIndex = 1 Then
                        '        sqlStr += "and Part_id like '%" + TextBox1.Text + "%' "
                        '    End If
                        'End If
                        'sqlStr += "group by Part_id, Memo order by Part_id"
                        'myAdapter = New SqlDataAdapter(sqlStr, conn)
                        'myAdapter.SelectCommand.CommandTimeout = 3600
                        'myDT = New DataTable
                        'myAdapter.Fill(myDT)

                        ' 轉向 Part ID
                        rbl_BySource.SelectedIndex = 1
                        'rbl_BySource.Items(0).Enabled = False
                        'If IsRename = False Then
                        '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                        'Else
                        '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                        'End If
                        If IsRename = False Then
                            sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                        Else
                            sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                        End If
                        ' --- Product Type ---
                        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                        If tr_BumpingType.Visible = True  Then
                            ' --- Bumping Type ---
                            Dim strBumpingType As String = ""
                            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                If n = 0 Then
                                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                Else
                                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                End If
                            Next
                            ' --- OL_Process ---
                            Dim strOL_Process As String = ""
                            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                                If n = 0 Then
                                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                                Else
                                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                                End If
                            Next
                            ' --- Backend ---
                            Dim strBackend As String = ""
                            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                                If n = 0 Then
                                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                                Else
                                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                                End If
                            Next
                            If listB_BumpingTypeShow.Items.Count > 0 Then
                                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                    End If
                                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                                    End If
                                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                                    End If
                                Else
                                    If strBumpingType <> "" Then
                                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                                    End If
                                End If
                            Else
                                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                    End If
                                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                                    End If
                                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                                    End If
                                End If
                            End If
                        End If
                        '================
                        'Customer開放複選
                        '================
                        If ddl_ProductType.Text <> sWB_Rename Then
                            If ddl_CustomerID.Text <> "All" Then
                                ' --- Customer ID ---
                                If ddl_CustomerID.SelectedValue <> "" Then
                                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                                End If
                            End If
                        Else
                            Dim strCustomerID As String = ""
                            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                                If n = 0 Then
                                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                                Else
                                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                                End If
                            Next
                            If strCustomerID <> "" Then
                                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                            End If
                        End If
                        sqlStr += "and a.yield_function=1 "
                        If TextBox1.Text <> "" Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                sqlStr += "and a.production_id like '%" + TextBox1.Text + "%' "
                            ElseIf rbl_BySource.SelectedIndex = 1 Then
                                sqlStr += "and a.Part_id like '%" + TextBox1.Text + "%' "
                            End If
                        End If
                        sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                        myAdapter = New SqlDataAdapter(sqlStr, conn)
                        myAdapter.SelectCommand.CommandTimeout = 3600
                        myDT = New DataTable
                        myAdapter.Fill(myDT)
                        'UtilObj.FillController(myDT, ddlPart, 0, "Part_id", "Memo")
                        listB_PartSource.Items.Clear()
                        listB_PartShow.Items.Clear()
                        For i As Integer = 0 To myDT.Rows.Count - 1
                            listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                        Next
                    Else
                        'rbl_BySource.SelectedIndex = 0
                        'rbl_BySource.Items(0).Enabled = True

                        ' 有就秀 Group
                        'rbl_BySource.SelectedIndex = 0

                        'UtilObj.FillController(myDT, ddlPart, 0)
                        listB_PartSource.Items.Clear()
                        listB_PartShow.Items.Clear()
                        If rbl_BySource.SelectedIndex = 1 Then
                            'rbl_BySource.SelectedIndex = 1
                            'rbl_BySource.Items(0).Enabled = False

                            '' 轉向 Part ID
                            ''rbl_BySource.SelectedIndex = 1

                            'If IsRename = False Then
                            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                            'Else
                            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                            'End If
                            ''================
                            ''Customer開放複選
                            ''================
                            'If ddl_ProductType.Text <> sWB_Rename Then
                            '    If ddl_CustomerID.Text <> "All" Then
                            '        ' --- Customer ID ---
                            '        If ddl_CustomerID.SelectedValue <> "" Then
                            '            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                            '        End If
                            '    End If
                            'Else
                            '    Dim strCustomerID As String = ""
                            '    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                            '        If n = 0 Then
                            '            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                            '        Else
                            '            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                            '        End If
                            '    Next
                            '    If strCustomerID <> "" Then
                            '        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                            '    End If
                            'End If
                            'sqlStr += "and category ='" + ddl_ProductType.SelectedValue + "' "
                            'If tr_BumpingType.Visible = True Then
                            '    Dim strBumpingType As String = ""
                            '    For x As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                            '        If x = 0 Then
                            '            strBumpingType += "'" & listB_BumpingTypeShow.Items(x).Text & "'"
                            '        Else
                            '            strBumpingType += ",'" & listB_BumpingTypeShow.Items(x).Text & "'"
                            '        End If
                            '    Next
                            '    sqlStr += "and Bumping_Type in (" + strBumpingType + ") "
                            'End If
                            'sqlStr += "and yield_function=1 "
                            'If TextBox1.Text <> "" Then
                            '    If rbl_BySource.SelectedIndex = 0 Then
                            '        sqlStr += "and production_id like '%" + TextBox1.Text + "%' "
                            '    ElseIf rbl_BySource.SelectedIndex = 1 Then
                            '        sqlStr += "and Part_id like '%" + TextBox1.Text + "%' "
                            '    End If
                            'End If
                            'sqlStr += "group by Part_id, Memo order by Part_id"
                            'myAdapter = New SqlDataAdapter(sqlStr, conn)
                            'myAdapter.SelectCommand.CommandTimeout = 3600
                            'myDT = New DataTable
                            'myAdapter.Fill(myDT)

                            ' 轉向 Part ID
                            rbl_BySource.SelectedIndex = 1
                            'rbl_BySource.Items(0).Enabled = False
                            'If IsRename = False Then
                            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                            'Else
                            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                            'End If
                            If IsRename = False Then
                                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                            Else
                                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                            End If
                            ' --- Product Type ---
                            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                            If tr_BumpingType.Visible = True  Then
                                ' --- Bumping Type ---
                                Dim strBumpingType As String = ""
                                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                    If n = 0 Then
                                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                    Else
                                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                    End If
                                Next
                                ' --- OL_Process ---
                                Dim strOL_Process As String = ""
                                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                                    If n = 0 Then
                                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                                    Else
                                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                                    End If
                                Next
                                ' --- Backend ---
                                Dim strBackend As String = ""
                                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                                    If n = 0 Then
                                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                                    Else
                                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                                    End If
                                Next
                                If listB_BumpingTypeShow.Items.Count > 0 Then
                                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                        End If
                                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                                        End If
                                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                                        End If
                                    Else
                                        If strBumpingType <> "" Then
                                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                                        End If
                                    End If
                                Else
                                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                        End If
                                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                                        End If
                                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                                        End If
                                    End If
                                End If
                            End If
                            '================
                            'Customer開放複選
                            '================
                            If ddl_ProductType.Text <> sWB_Rename Then
                                If ddl_CustomerID.Text <> "All" Then
                                    ' --- Customer ID ---
                                    If ddl_CustomerID.SelectedValue <> "" Then
                                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                                    End If
                                End If
                            Else
                                Dim strCustomerID As String = ""
                                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                                    If n = 0 Then
                                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                                    Else
                                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                                    End If
                                Next
                                If strCustomerID <> "" Then
                                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                                End If
                            End If
                            sqlStr += "and a.yield_function=1 "
                            If TextBox1.Text <> "" Then
                                If rbl_BySource.SelectedIndex = 0 Then
                                    sqlStr += "and a.production_id like '%" + TextBox1.Text + "%' "
                                ElseIf rbl_BySource.SelectedIndex = 1 Then
                                    sqlStr += "and a.Part_id like '%" + TextBox1.Text + "%' "
                                End If
                            End If
                            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                            myAdapter = New SqlDataAdapter(sqlStr, conn)
                            myAdapter.SelectCommand.CommandTimeout = 3600
                            myDT = New DataTable
                            myAdapter.Fill(myDT)
                            'UtilObj.FillController(myDT, ddlPart, 0, "Part_id", "Memo")
                            listB_PartSource.Items.Clear()
                            listB_PartShow.Items.Clear()
                            For i As Integer = 0 To myDT.Rows.Count - 1
                                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                            Next
                        Else
                            For i As Integer = 0 To myDT.Rows.Count - 1
                                listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                            Next
                        End If
                    End If
                Else
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                        'rbl_BySource.SelectedIndex = 1
                        'rbl_BySource.Items(0).Enabled = False

                        '' 轉向 Part ID
                        ''rbl_BySource.SelectedIndex = 1

                        'If IsRename = False Then
                        '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                        'Else
                        '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                        'End If
                        ''================
                        ''Customer開放複選
                        ''================
                        'If ddl_ProductType.Text <> sWB_Rename Then
                        '    If ddl_CustomerID.Text <> "All" Then
                        '        ' --- Customer ID ---
                        '        If ddl_CustomerID.SelectedValue <> "" Then
                        '            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        '        End If
                        '    End If
                        'Else
                        '    Dim strCustomerID As String = ""
                        '    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        '        If n = 0 Then
                        '            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        '        Else
                        '            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        '        End If
                        '    Next
                        '    If strCustomerID <> "" Then
                        '        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                        '    End If
                        'End If
                        'sqlStr += "and category ='" + ddl_ProductType.SelectedValue + "' "
                        'If tr_BumpingType.Visible = True Then
                        '    Dim strBumpingType As String = ""
                        '    For x As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        '        If x = 0 Then
                        '            strBumpingType += "'" & listB_BumpingTypeShow.Items(x).Text & "'"
                        '        Else
                        '            strBumpingType += ",'" & listB_BumpingTypeShow.Items(x).Text & "'"
                        '        End If
                        '    Next
                        '    sqlStr += "and Bumping_Type in (" + strBumpingType + ") "
                        'End If
                        'sqlStr += "and yield_function=1 "
                        'If TextBox1.Text <> "" Then
                        '    If rbl_BySource.SelectedIndex = 0 Then
                        '        sqlStr += "and production_id like '%" + TextBox1.Text + "%' "
                        '    ElseIf rbl_BySource.SelectedIndex = 1 Then
                        '        sqlStr += "and Part_id like '%" + TextBox1.Text + "%' "
                        '    End If
                        'End If
                        'sqlStr += "group by Part_id, Memo order by Part_id"
                        'myAdapter = New SqlDataAdapter(sqlStr, conn)
                        'myAdapter.SelectCommand.CommandTimeout = 3600
                        'myDT = New DataTable
                        'myAdapter.Fill(myDT)

                        ' 轉向 Part ID
                        rbl_BySource.SelectedIndex = 1
                        'rbl_BySource.Items(0).Enabled = False
                        'If IsRename = False Then
                        '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                        'Else
                        '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                        'End If
                        If IsRename = False Then
                            sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                        Else
                            sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                        End If
                        ' --- Product Type ---
                        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                        If tr_BumpingType.Visible = True  Then
                            ' --- Bumping Type ---
                            Dim strBumpingType As String = ""
                            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                If n = 0 Then
                                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                Else
                                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                End If
                            Next
                            ' --- OL_Process ---
                            Dim strOL_Process As String = ""
                            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                                If n = 0 Then
                                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                                Else
                                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                                End If
                            Next
                            ' --- Backend ---
                            Dim strBackend As String = ""
                            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                                If n = 0 Then
                                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                                Else
                                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                                End If
                            Next
                            If listB_BumpingTypeShow.Items.Count > 0 Then
                                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                    End If
                                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                                    End If
                                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                                    End If
                                Else
                                    If strBumpingType <> "" Then
                                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                                    End If
                                End If
                            Else
                                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                    End If
                                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                                    End If
                                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                                    End If
                                End If
                            End If
                        End If
                        '================
                        'Customer開放複選
                        '================
                        If ddl_ProductType.Text <> sWB_Rename Then
                            If ddl_CustomerID.Text <> "All" Then
                                ' --- Customer ID ---
                                If ddl_CustomerID.SelectedValue <> "" Then
                                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                                End If
                            End If
                        Else
                            Dim strCustomerID As String = ""
                            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                                If n = 0 Then
                                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                                Else
                                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                                End If
                            Next
                            If strCustomerID <> "" Then
                                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                            End If
                        End If
                        sqlStr += "and a.yield_function=1 "
                        If TextBox1.Text <> "" Then
                            If rbl_BySource.SelectedIndex = 0 Then
                                sqlStr += "and a.production_id like '%" + TextBox1.Text + "%' "
                            ElseIf rbl_BySource.SelectedIndex = 1 Then
                                sqlStr += "and a.Part_id like '%" + TextBox1.Text + "%' "
                            End If
                        End If
                        sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                        myAdapter = New SqlDataAdapter(sqlStr, conn)
                        myAdapter.SelectCommand.CommandTimeout = 3600
                        myDT = New DataTable
                        myAdapter.Fill(myDT)
                        'UtilObj.FillController(myDT, ddlPart, 0, "Part_id", "Memo")
                        listB_PartSource.Items.Clear()
                        listB_PartShow.Items.Clear()
                        For i As Integer = 0 To myDT.Rows.Count - 1
                            listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                        Next
                    Else
                        'rbl_BySource.SelectedIndex = 0
                        'rbl_BySource.Items(0).Enabled = True

                        ' 有就秀 Group
                        'rbl_BySource.SelectedIndex = 0

                        'UtilObj.FillController(myDT, ddlPart, 0)
                        listB_PartSource.Items.Clear()
                        listB_PartShow.Items.Clear()
                        If rbl_BySource.SelectedIndex = 1 Then
                            'rbl_BySource.SelectedIndex = 1
                            'rbl_BySource.Items(0).Enabled = False

                            '' 轉向 Part ID
                            ''rbl_BySource.SelectedIndex = 1

                            'If IsRename = False Then
                            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                            'Else
                            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                            'End If
                            ''================
                            ''Customer開放複選
                            ''================
                            'If ddl_ProductType.Text <> sWB_Rename Then
                            '    If ddl_CustomerID.Text <> "All" Then
                            '        ' --- Customer ID ---
                            '        If ddl_CustomerID.SelectedValue <> "" Then
                            '            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                            '        End If
                            '    End If
                            'Else
                            '    Dim strCustomerID As String = ""
                            '    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                            '        If n = 0 Then
                            '            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                            '        Else
                            '            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                            '        End If
                            '    Next
                            '    If strCustomerID <> "" Then
                            '        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                            '    End If
                            'End If
                            'sqlStr += "and category ='" + ddl_ProductType.SelectedValue + "' "
                            'If tr_BumpingType.Visible = True Then
                            '    Dim strBumpingType As String = ""
                            '    For x As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                            '        If x = 0 Then
                            '            strBumpingType += "'" & listB_BumpingTypeShow.Items(x).Text & "'"
                            '        Else
                            '            strBumpingType += ",'" & listB_BumpingTypeShow.Items(x).Text & "'"
                            '        End If
                            '    Next
                            '    sqlStr += "and Bumping_Type in (" + strBumpingType + ") "
                            'End If
                            'sqlStr += "and yield_function=1 "
                            'If TextBox1.Text <> "" Then
                            '    If rbl_BySource.SelectedIndex = 0 Then
                            '        sqlStr += "and production_id like '%" + TextBox1.Text + "%' "
                            '    ElseIf rbl_BySource.SelectedIndex = 1 Then
                            '        sqlStr += "and Part_id like '%" + TextBox1.Text + "%' "
                            '    End If
                            'End If
                            'sqlStr += "group by Part_id, Memo order by Part_id"
                            'myAdapter = New SqlDataAdapter(sqlStr, conn)
                            'myAdapter.SelectCommand.CommandTimeout = 3600
                            'myDT = New DataTable
                            'myAdapter.Fill(myDT)
                            ' 轉向 Part ID
                            rbl_BySource.SelectedIndex = 1
                            'rbl_BySource.Items(0).Enabled = False
                            'If IsRename = False Then
                            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                            'Else
                            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                            'End If
                            If IsRename = False Then
                                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                            Else
                                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                            End If
                            ' --- Product Type ---
                            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                            If tr_BumpingType.Visible = True  Then
                                ' --- Bumping Type ---
                                Dim strBumpingType As String = ""
                                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                                    If n = 0 Then
                                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                    Else
                                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                                    End If
                                Next
                                ' --- OL_Process ---
                                Dim strOL_Process As String = ""
                                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                                    If n = 0 Then
                                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                                    Else
                                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                                    End If
                                Next
                                ' --- Backend ---
                                Dim strBackend As String = ""
                                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                                    If n = 0 Then
                                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                                    Else
                                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                                    End If
                                Next
                                If listB_BumpingTypeShow.Items.Count > 0 Then
                                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                        End If
                                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                                        End If
                                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                                        End If
                                    Else
                                        If strBumpingType <> "" Then
                                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                                        End If
                                    End If
                                Else
                                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                        End If
                                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                                        End If
                                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                                        End If
                                    End If
                                End If
                            End If
                            '================
                            'Customer開放複選
                            '================
                            If ddl_ProductType.Text <> sWB_Rename Then
                                If ddl_CustomerID.Text <> "All" Then
                                    ' --- Customer ID ---
                                    If ddl_CustomerID.SelectedValue <> "" Then
                                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                                    End If
                                End If
                            Else
                                Dim strCustomerID As String = ""
                                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                                    If n = 0 Then
                                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                                    Else
                                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                                    End If
                                Next
                                If strCustomerID <> "" Then
                                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                                End If
                            End If
                            sqlStr += "and a.yield_function=1 "
                            If TextBox1.Text <> "" Then
                                If rbl_BySource.SelectedIndex = 0 Then
                                    sqlStr += "and a.production_id like '%" + TextBox1.Text + "%' "
                                ElseIf rbl_BySource.SelectedIndex = 1 Then
                                    sqlStr += "and a.Part_id like '%" + TextBox1.Text + "%' "
                                End If
                            End If
                            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                            myAdapter = New SqlDataAdapter(sqlStr, conn)
                            myAdapter.SelectCommand.CommandTimeout = 3600
                            myDT = New DataTable
                            myAdapter.Fill(myDT)
                            'UtilObj.FillController(myDT, ddlPart, 0, "Part_id", "Memo")
                            listB_PartSource.Items.Clear()
                            listB_PartShow.Items.Clear()
                            For i As Integer = 0 To myDT.Rows.Count - 1
                                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                            Next
                        Else
                            For i As Integer = 0 To myDT.Rows.Count - 1
                                listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                            Next
                        End If
                    End If
                End If
            Else
                '' 轉向 Part ID
                ''rbl_BySource.SelectedIndex = 1

                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                ''================
                ''Customer開放複選
                ''================
                'If ddl_ProductType.Text <> sWB_Rename Then
                '    If ddl_CustomerID.Text <> "All" Then
                '        ' --- Customer ID ---
                '        If ddl_CustomerID.SelectedValue <> "" Then
                '            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                '        End If
                '    End If
                'Else
                '    Dim strCustomerID As String = ""
                '    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                '        If n = 0 Then
                '            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                '        Else
                '            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                '        End If
                '    Next
                '    If strCustomerID <> "" Then
                '        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                '    End If
                'End If
                'sqlStr += "and category ='" + ddl_ProductType.SelectedValue + "' "
                'If tr_BumpingType.Visible = True Then
                '    Dim strBumpingType As String = ""
                '    For x As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                '        If x = 0 Then
                '            strBumpingType += "'" & listB_BumpingTypeShow.Items(x).Text & "'"
                '        Else
                '            strBumpingType += ",'" & listB_BumpingTypeShow.Items(x).Text & "'"
                '        End If
                '    Next
                '    sqlStr += "and Bumping_Type in (" + strBumpingType + ") "
                'End If
                'sqlStr += "and yield_function=1 "
                'If TextBox1.Text <> "" Then
                '    If rbl_BySource.SelectedIndex = 0 Then
                '        sqlStr += "and production_id like '%" + TextBox1.Text + "%' "
                '    ElseIf rbl_BySource.SelectedIndex = 1 Then
                '        sqlStr += "and Part_id like '%" + TextBox1.Text + "%' "
                '    End If
                'End If
                'sqlStr += "group by Part_id, Memo order by Part_id"
                'myAdapter = New SqlDataAdapter(sqlStr, conn)
                'myAdapter.SelectCommand.CommandTimeout = 3600
                'myDT = New DataTable
                'myAdapter.Fill(myDT)

                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                'rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True  Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                If TextBox1.Text <> "" Then
                    If rbl_BySource.SelectedIndex = 0 Then
                        sqlStr += "and a.production_id like '%" + TextBox1.Text + "%' "
                    ElseIf rbl_BySource.SelectedIndex = 1 Then
                        sqlStr += "and a.Part_id like '%" + TextBox1.Text + "%' "
                    End If
                End If
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 0, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            '' 轉向 Part ID
            ''rbl_BySource.SelectedIndex = 1
            ''rbl_BySource.Items(0).Enabled = False

            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            'sqlStr += "and category ='" + ddl_ProductType.SelectedValue + "' "
            ''================
            ''Customer開放複選
            ''================
            'If ddl_ProductType.Text <> sWB_Rename Then
            '    If ddl_CustomerID.Text <> "All" Then
            '        ' --- Customer ID ---
            '        If ddl_CustomerID.SelectedValue <> "" Then
            '            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
            '        End If
            '    End If
            'Else
            '    Dim strCustomerID As String = ""
            '    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
            '        If n = 0 Then
            '            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
            '        Else
            '            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
            '        End If
            '    Next
            '    If strCustomerID <> "" Then
            '        sqlStr += "and customer_id IN(" + strCustomerID + ") "
            '    End If
            'End If
            'If tr_BumpingType.Visible = True Then
            '    ' --- Bumping Type ---
            '    Dim strBumpingType As String = ""
            '    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
            '        If n = 0 Then
            '            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
            '        Else
            '            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
            '        End If
            '    Next

            '    If strBumpingType <> "" Then
            '        sqlStr += "and Bumping_Type IN(" + strBumpingType + ") "
            '    End If
            'End If
            'sqlStr += "and yield_function=1 "
            'If TextBox1.Text <> "" Then
            '    If rbl_BySource.SelectedIndex = 0 Then
            '        sqlStr += "and production_id like '%" + TextBox1.Text + "%' "
            '    ElseIf rbl_BySource.SelectedIndex = 1 Then
            '        sqlStr += "and Part_id like '%" + TextBox1.Text + "%' "
            '    End If
            'End If
            'sqlStr += "group by Part_id, Memo order by Part_id"
            'myAdapter = New SqlDataAdapter(sqlStr, conn)
            'myAdapter.SelectCommand.CommandTimeout = 3600
            'myDT = New DataTable
            'myAdapter.Fill(myDT)

            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True  Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            If TextBox1.Text <> "" Then
                If rbl_BySource.SelectedIndex = 0 Then
                    sqlStr += "and a.production_id like '%" + TextBox1.Text + "%' "
                ElseIf rbl_BySource.SelectedIndex = 1 Then
                    sqlStr += "and a.Part_id like '%" + TextBox1.Text + "%' "
                End If
            End If
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Public Sub ExportToExcel(ByVal dt As DataTable)
        If dt.Rows.Count > 0 Then
            Dim filename As String = "RawData.xls"
            Dim tw As New System.IO.StringWriter()
            Dim hw As New System.Web.UI.HtmlTextWriter(tw)
            Dim dgGrid As New DataGrid()
            dgGrid.DataSource = dt
            dgGrid.DataBind()

            'Get the HTML for the control.
            dgGrid.RenderControl(hw)
            'Write the HTML back to the browser.
            Response.Clear()
            Response.Buffer = True
            Response.Charset = "BIG5" '設定字集
            Response.Write("<html><body>")
            Response.Write("<meta http-equiv=Content-Type content=text/html;charset=BIG5>") '避免亂碼
            Response.Write("<style type=text/css>")
            Response.Write("td{mso-number-format:""\@"";}") '將所有欄位格式改為"文字"
            '上方的程式碼片段是讓匯出的Excel檔儲存格格式強制為文字。
            '如果有部份欄位需要數字的儲存格式該如何處理?
            'Response.Write("<td style=\"mso-number-format:'0\\.0'\">"+欄位內容值+"</td>");
            '主要的做法就是利用css定義整個Excel欄位的格式，再利用td的style做覆寫，至於詳細的欄位格式，如下所列：
            '============================================================================================================
            '[Excel格式] 設定Excel cell的格式
            '分享: 利用網頁轉出資料到 Excel 上常會遇到想要以文字格式顯示的數字，
            '      像是手機號碼、帳號之類的資料，被 Excel 自動轉換成數字格式，
            '      於是前面的 0 被省略掉了、帳號變成科學記號了...等等的麻煩，
            '      有個方便的方式不會去加入奇奇怪怪的東西到欄位裡面，讓 Excel 不會去判斷成數字，
            '      很簡單，只要在 td 裡面加入 style 設定就行了。
            'mso-number-format:"0"                                              NO Decimals
            'mso-number-format:"0\.000"                                         3 Decimals
            'mso-number-format:"\#\,\#\#0\.000"                                 Comma with 3 dec
            'mso-number-format:"mm\/dd\/yy"                                     Date7
            'mso-number-format:"mmmm\ d\,\ yyyy"                                Date9
            'mso-number-format:"m\/d\/yy\ h\:mm\ AM\/PM"                        D -T AMPM
            'mso-number-format:"Short Date"                                     01/03/1998
            'mso-number-format:"Medium Date"                                    01-mar-98
            'mso-number-format:"d\-mmm\-yyyy"                                   01-mar-1998
            'mso-number-format:"Short Time"                                     5:16
            'mso-number-format:"Medium Time"                                    5:16 am
            'mso-number-format:"Long Time"                                      5:16:21:00
            'mso-number-format:"Percent"                                        Percent - two decimals
            'mso-number-format:"0%"                                             Percent - no decimals
            'mso-number-format:"0\.E+00"                                        Scientific Notation
            'mso-number-format:"\@"                                             Text
            'mso-number-format:"\#\ ???\/???"                                   Fractions - up to 3 digits (312/943)
            'mso-number-format:"\0022£\0022\#\,\#\#0\.00"                       £12.76
            'mso-number-format:"\#\,\#\#0\.00_ \;\[Red\]\-\#\,\#\#0\.00\ "
            'reference : http://www.netdominus.co.uk/knowledgebase/mod/resource/view.php?id=182
            '============================================================================================================
            Response.Write("</style>")
            'Response.Write("<table>")
            Response.AppendHeader("Content-Disposition", "attachment; filename=" & filename & "")
            Response.ContentEncoding = System.Text.Encoding.GetEncoding("BIG5")
            Response.ContentType = "application/vnd.ms-excel"

            Me.EnableViewState = False
            Response.Write(tw.ToString())
            Response.End()

            'Response.Write("</table>")
            Response.Write("</body></html>")
        End If
    End Sub

    Protected Sub but_Execute0_Click(sender As Object, e As System.EventArgs) Handles but_Excel.Click
        Dim status As Boolean = False
        Dim sqlStr As String = ""
        Dim itemDT, myDT, rowDT As DataTable
        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim myAdapter As SqlDataAdapter
        Dim monthNextStr As String
        Dim ConditionStr As String = ""
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ' --- Day ---
        Dim CustomerID As String = ddl_CustomerID.SelectedValue
        If CustomerID <> "" AndAlso CustomerID <> "All" Then
            ConditionStr += "and Customer_Id = '" + CustomerID + "' "
        End If
        If rbl_BySource.SelectedIndex = 0 Then
            Dim ProductType As String = Get_PartID()
            If ProductType <> "" Then
                ConditionStr += "and ProductType IN(" + ProductType + ") "
            End If
        Else
            Dim partID As String = Get_PartID()
            If partID <> "" AndAlso partID <> "''" Then
                ConditionStr += "and Part_Id IN(" + partID + ") "
            End If
        End If

        Try
            conn.Open()

            ' --- 取得 Chart Data ---
            sqlStr = ""
            sqlStr += "select part_id as part, Lot_id as lot, "
            sqlStr += "Convert(char(19), DataTime, 120) as DataTime, "
            sqlStr += "ROUND((yield), 4) as yield "
            If ddl_CustomerID.SelectedValue = "INTEL" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    'NORMAL
                    sqlStr += "from dbo.Yield_Daily_RawData "
                Else
                    'BKM
                    sqlStr += "from dbo.BKM_Yield_Daily_RawData "
                    BKMSql = "and BKM='Y' "
                End If
            ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    'NORMAL
                    sqlStr += "from dbo.Yield_Daily_RawData "
                    AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
                Else
                    'BKM'
                    sqlStr += "from dbo.Yield_Daily_RawData_NonIntel "
                End If
            ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    'NORMAL
                    sqlStr += "from dbo.Yield_Daily_RawData "
                    AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
                Else
                    'BKM'
                    sqlStr += "from dbo.Yield_Daily_RawData_NonIntel "
                End If
            Else
                If IsRename = False Then
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                        If cb_ChartMerge0.Checked = True Then
                            'WB
                            sqlStr += "from WB_Yield_Daily_RawData "
                        Else
                            'WB
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                Else
                                    sqlStr += "from WB_Yield_Daily_RawData_NotMerge "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage "
                                End If
                            End If
                        End If
                    Else
                        'BKM
                        sqlStr += " from Yield_Daily_RawData_NonIntel "
                    End If
                Else
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                        If cb_ChartMerge0.Checked = True Then
                            'WB
                            sqlStr += "from WB_Yield_Daily_RawData "
                        Else
                            'WB
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                Else
                                    sqlStr += "from WB_Yield_Daily_RawData_NotMerge "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage "
                                End If
                            End If
                        End If
                    Else
                        'BKM
                        sqlStr += " from Yield_Daily_RawData_NonIntel "
                    End If
                End If
            End If
            sqlStr += "where 1=1 "
            'sqlStr += "and yield_category='" + SqlDbType + "' "
            sqlStr += ConditionStr
            If rb_DataTimeCustor.SelectedIndex = 0 Then
                sqlStr += "and datediff(month,datatime,getdate()) < 3 " '取3個月
            Else
                Dim DateRange As String = Get_DateRange()
                If rbl_lossItem.SelectedIndex = 0 Then
                    If DateRange = "" Then
                        sqlStr += "and datediff(day,datatime,getdate()) < 7 " '取7天
                    Else
                        sqlStr += "and convert(char(10), datatime, 112) in (" + DateRange + ") "
                    End If
                ElseIf rbl_lossItem.SelectedIndex = 1 Then
                    If DateRange = "" Then
                        sqlStr += "and datediff(week,datatime,getdate()) < 5 " '取5週
                    Else
                        sqlStr += "and datename(year,datatime)+Right('00' + Cast(datename(week,datatime) as varchar),2) in (" + DateRange + ") "
                    End If
                ElseIf rbl_lossItem.SelectedIndex = 2 Then
                    If DateRange = "" Then
                        sqlStr += "and datediff(month,datatime,getdate()) < 3 " '取3個月
                    Else
                        'sqlStr += "and convert(char(7), datatime, 120) in (" + DateRange + ") "
                        sqlStr += "and CONVERT(varchar(6), GETDATE(), 112) in (" + DateRange + ") "
                    End If
                End If
            End If
            sqlStr += "order by DataTime"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)

            ' --- 取得 Yield Item ---
            sqlStr = ""
            'sqlStr += "select yield_category, SEQ "
            sqlStr += "select yield_category "
            If IsRename = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping "
            Else
                If IsRenameOrder = False Then
                    sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
                Else
                    sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
                End If
            End If
            sqlStr += "where 1=1 "
            'If CustomerID <> "" AndAlso CustomerID <> "All" Then
            '    If ddl_CustomerID.Text = "INTEL" Then
            '        ' --- Customer ID ---
            '        If ddl_CustomerID.SelectedValue <> "" Then
            '            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
            '        End If
            '    End If
            'End If
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    If ddl_CustomerID.Text = "INTEL" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    Else
                        ' --- Customer ID ---
                        sqlStr += "and customer_id ='All' "
                    End If
                End If
            Else
                If IsRenameOrder = False Then
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                    End If
                End If
            End If
            If rbl_BySource.SelectedIndex = 0 Then
                Dim ProductType As String = Get_PartID()
                If ProductType <> "" Then
                    sqlStr += "and ProductType IN(" + ProductType + ") "
                End If
            End If
            Dim YieldItem As String = Get_YieldItem()
            If YieldItem <> "" Then
                sqlStr += "and yield_category in(" + YieldItem + ")"
            End If
            sqlStr += "and SEQ != 1 "
            If IsRenameOrder = False Then
                sqlStr += BKMSql
                sqlStr += AMD_FAILMODESql
            Else
                If ddl_YieldMode.Text = "By Fail Mode" Then
                    sqlStr += "and Yield_Mode = 'FailMode' "
                ElseIf ddl_YieldMode.Text = "By Station" Then
                    sqlStr += "and Yield_Mode = 'Station' "
                ElseIf ddl_YieldMode.Text = "By BKM" Then
                    sqlStr += "and Yield_Mode = 'BKM' "
                End If
            End If
            If ddl_CustomerID.SelectedValue = "INTEL" Then
                sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
            End If
            sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
            'sqlStr += "group by yield_category, SEQ order by SEQ"
            'sqlStr += "group by yield_category order by yield_category"
            sqlStr += "group by SEQ, yield_category order by SEQ"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            itemDT = New DataTable
            myAdapter.Fill(itemDT)

            ' --- 取得 DataTable 資料 --- 
            Dim colStr As String = ""
            If itemDT.Rows.Count > 0 Then
                colStr = " part_id as part, Lot_id as lot, Convert(char(19), DataTime, 120) as DataTime, FE_Plant_id as FE, BE_Plant_id as BE, "
            Else
                colStr = " part_id as part, Lot_id as lot, Convert(char(19), DataTime, 120) as DataTime, FE_Plant_id as FE, BE_Plant_id as BE "
            End If
            Dim groupStr As String = " group by part_id, Lot_id, DataTime, FE_Plant_id, BE_Plant_id "

            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    If itemDT.Rows.Count > 0 Then
                        colStr = " part_id as part, Lot_id as lot, Convert(char(19), DataTime, 120) as DataTime, FE_Plant_id as FE, "
                    Else
                        colStr = " part_id as part, Lot_id as lot, Convert(char(19), DataTime, 120) as DataTime, FE_Plant_id as FE "
                    End If
                    groupStr = " group by part_id, Lot_id, DataTime, FE_Plant_id "
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    If itemDT.Rows.Count > 0 Then
                        colStr = " part_id as part, Lot_id as lot, Convert(char(19), DataTime, 120) as DataTime, FE_Plant_id as FE, "
                    Else
                        colStr = " part_id as part, Lot_id as lot, Convert(char(19), DataTime, 120) as DataTime, FE_Plant_id as FE "
                    End If
                    groupStr = " group by part_id, Lot_id, DataTime, FE_Plant_id "
                End If
            End If

            sqlStr = "select "
            sqlStr += colStr

            For x As Integer = 0 To (itemDT.Rows.Count - 1)
                sqlStr += "max(case when Yield_Category = '" + (itemDT.Rows(x)(0).ToString) + "' then Input_QTY else 0 end) as '" + (itemDT.Rows(x)(0).ToString) + "In',"
                sqlStr += "max(case when Yield_Category = '" + (itemDT.Rows(x)(0).ToString) + "' then Output_QTY else 0 end) as '" + (itemDT.Rows(x)(0).ToString) + "Out',"
                sqlStr += "max(case when Yield_Category = '" + (itemDT.Rows(x)(0).ToString) + "' then ROUND((yield), 4) else 0 end) as '" + (itemDT.Rows(x)(0).ToString) + "',"
            Next
            sqlStr = sqlStr.Substring(0, (sqlStr.Length - 1))

            If ddl_CustomerID.SelectedValue = "INTEL" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    'NORMAL
                    sqlStr += " from dbo.Yield_Daily_RawData "
                    sqlStr += " where customer_id='INTEL' "
                Else
                    'BKM
                    sqlStr += " from dbo.BKM_Yield_Daily_RawData "
                    sqlStr += " where 1=1 "
                End If
            ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    'NORMAL
                    sqlStr += " from dbo.Yield_Daily_RawData "
                    sqlStr += " where customer_id='AMD' "
                Else
                    'BKM'
                    sqlStr += " from dbo.Yield_Daily_RawData_NonIntel "
                    sqlStr += " where 1=1 "
                End If
            ElseIf ddl_CustomerID.SelectedValue = "NVD" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    'NORMAL
                    sqlStr += " from dbo.Yield_Daily_RawData "
                    sqlStr += " where customer_id='NVD' "
                Else
                    'BKM'
                    sqlStr += " from dbo.Yield_Daily_RawData_NonIntel "
                    sqlStr += " where 1=1 "
                End If
            ElseIf ddl_CustomerID.SelectedValue = "BCM" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    'NORMAL
                    sqlStr += " from dbo.Yield_Daily_RawData "
                    sqlStr += " where customer_id='BCM' "
                Else
                    'BKM'
                    sqlStr += " from dbo.Yield_Daily_RawData_NonIntel "
                    sqlStr += " where 1=1 "
                End If
            Else
                If IsRename = False Then
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                        If cb_ChartMerge0.Checked = True Then
                            'WB
                            sqlStr += " from WB_Yield_Daily_RawData "
                        Else
                            'WB
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                Else
                                    sqlStr += "from WB_Yield_Daily_RawData_NotMerge "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF  "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage "
                                End If
                            End If
                        End If
                    Else
                        'BKM
                        sqlStr += " from Yield_Daily_RawData_NonIntel "
                    End If
                Else
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                        If cb_ChartMerge0.Checked = True Then
                            'WB
                            sqlStr += " from WB_Yield_Daily_RawData "
                        Else
                            'WB
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                Else
                                    sqlStr += "from WB_Yield_Daily_RawData_NotMerge "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage "
                                End If
                            End If
                        End If
                    Else
                        'BKM
                        sqlStr += " from Yield_Daily_RawData_NonIntel "
                    End If
                End If
                sqlStr += " where 1=1 "
            End If

            sqlStr += ConditionStr
            If rb_DataTimeCustor.SelectedIndex = 0 Then
                sqlStr += "and datediff(month,datatime,getdate()) < 3 " '取3個月
            Else
                'If rbl_lossItem.SelectedIndex = 0 Then
                '    sqlStr += "and datediff(day,datatime,getdate()) <= 7 " '取7天
                'ElseIf rbl_lossItem.SelectedIndex = 1 Then
                '    sqlStr += "and datediff(week,datatime,getdate()) <= 5 " '取5週
                'ElseIf rbl_lossItem.SelectedIndex = 2 Then
                '    sqlStr += "and datediff(month,datatime,getdate()) <= 3 " '取3個月
                'End If
                Dim DateRange As String = Get_DateRange()
                If rbl_lossItem.SelectedIndex = 0 Then
                    If DateRange = "" Then
                        sqlStr += "and datediff(day,datatime,getdate()) < 7 " '取7天
                    Else
                        sqlStr += "and convert(char(10), datatime, 112) in (" + DateRange + ") "
                    End If
                ElseIf rbl_lossItem.SelectedIndex = 1 Then
                    If DateRange = "" Then
                        sqlStr += "and datediff(week,datatime,getdate()) < 5 " '取5週
                    Else
                        'sqlStr += "and datename(year,datatime)+Right('00' + Cast(datename(week,datatime) as varchar),2) in (" + DateRange + ") "
                        sqlStr += "and yearWW in (" + DateRange + ") "
                    End If
                ElseIf rbl_lossItem.SelectedIndex = 2 Then
                    If DateRange = "" Then
                        sqlStr += "and datediff(month,datatime,getdate()) < 3 " '取3個月
                    Else
                        'sqlStr += "and convert(char(7), datatime, 120) in (" + DateRange + ") "
                        sqlStr += "and CONVERT(varchar(6), datatime, 112) in (" + DateRange + ") "
                    End If
                End If
            End If
            If cb_CR.Checked = False Then
                sqlStr += "and substring(lot_id,9,1)<>'Y' "
                sqlStr += "and substring(lot_id,9,1)<>'Z' "
                sqlStr += "and substring(Part_id,7,1)<>'V' "
            End If
            If cb_FAI.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                sqlStr += "and ISNUMERIC(SUBSTRING(Part_id,2,1))=0 "
            End If
            If cb_out.Checked = False And ddl_ProductType.Text = sWB_Rename Then
                sqlStr += "and (substring(Part_id,2,1)<>'W' and (substring(Part_id,1,3)<>'SNW' and substring(Part_id,1,3)<>'AKW')) "
            End If
            sqlStr += groupStr
            sqlStr += "order by DataTime "

            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            rowDT = New DataTable
            myAdapter.Fill(rowDT)
            conn.Close()

            ' --- Data Grid ---
            'gv_rowdata.DataSource = rowDT
            'gv_rowdata.DataBind()

            'tr_chartDisplay.Visible = True
            'tr_gvDisplay.Visible = True

            ExportToExcel(rowDT)
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try
    End Sub

    Private Function part_id() As Object
        Throw New NotImplementedException
    End Function

#Region " 上傳 Lot 分析"

    Protected Sub cb_uploadLot_CheckedChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles cb_uploadLot.CheckedChanged

        'but_Execute.Enabled = False
        'tr_upload.Visible = False
        'tb_uploadLot.Visible = False
        'tr_gvDisplay.Visible = False

        'If cb_uploadLot.Checked Then
        '    tr_upload.Visible = True
        '    but_Excel.Visible = True
        'Else
        '    but_Execute.Enabled = True
        '    but_Excel.Visible = False
        'End If

    End Sub

    ' 解析 Excel or TXT
    Protected Sub but_Uupload_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles but_Uupload.Click
        Dim nFileName As String
        Dim file As System.IO.StreamReader
        Dim line As String
        Dim dtr As DataRow
        Dim saveFullName As String = Page.MapPath(".") + "\\upload\\"

        If (uf_UfilePath.HasFile) Then

            Dim fileName As String = uf_UfilePath.FileName
            saveFullName += fileName
            uf_UfilePath.SaveAs(saveFullName)

            Dim fileN As System.IO.FileInfo = New System.IO.FileInfo(saveFullName)

            If (fileN.Extension).ToUpper = ".TXT" Or (fileN.Extension).ToUpper = ".CSV" Then
                Try
                    Dim lotAry As New ArrayList
                    file = New System.IO.StreamReader(saveFullName, System.Text.Encoding.Default)
                    line = file.ReadLine()
                    While line <> Nothing
                        lotAry.Add(line)
                        line = file.ReadLine()
                    End While
                    file.Close()
                    handTXTFile(lotAry)

                    tr_chartDisplay.Visible = True
                    tr_gvDisplay.Visible = True
                Catch ex As Exception
                End Try
            Else
                ShowMessage("請上傳 TXT or CSV !!!")
            End If
        End If
    End Sub

    Private Sub handExcelFile(ByVal fName As String)

        Dim strCon As String = "Provider = Microsoft.Jet.OLEDB.4.0 ; Data Source = " + fName + ";Extended Properties='Excel 8.0;HDR=YES;IMEX=1;'"
        Dim sqlStr As String = ""
        Dim oledb_con As New System.Data.OleDb.OleDbConnection(strCon)
        Dim ole_apt As System.Data.OleDb.OleDbDataAdapter
        Dim ds As DataSet
        Dim dt As DataTable
        Dim rowCount As Integer = 0
        Dim excelSheetName As String = "Sheet1"
        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim myAdapter As SqlDataAdapter

        Try
            oledb_con.Open()
            ' Get Sheet Name 
            dt = New DataTable
            dt = oledb_con.GetOleDbSchemaTable(System.Data.OleDb.OleDbSchemaGuid.Tables, Nothing)
            If dt Is Nothing Then
                Exit Try
            End If

            excelSheetName = dt.Rows(0)("TABLE_NAME")
            sqlStr = "SELECT * FROM [" + excelSheetName + "]"
            ole_apt = New System.Data.OleDb.OleDbDataAdapter(sqlStr, oledb_con)
            ds = New DataSet()
            ole_apt.Fill(ds)
            dt = ds.Tables(0)
            oledb_con.Close()
            Dim lot_list As String = ""

            For i As Integer = 0 To (dt.Rows.Count - 1)
                If i = 0 Then
                    lot_list += "'" + (dt.Rows(i)(0)).ToString() + "'"
                Else
                    lot_list += ",'" + (dt.Rows(i)(0)).ToString() + "'"
                End If
            Next
            'lot_list = lot_list.Substring(0, (lot_list.Length - 1))
            'lot_list = "(" + lot_list + ")"

            Call Show_Chart_RawData(lot_list)
            'sqlStr = "select ww, Convert(char(19), DataTime, 120) as DataTime, "
            ''If cb_DRowData0.Checked = True Then '匹配報廢回歸
            ''    sqlStr += "Part_Id, production_id, Lot_Id, Customer_Id, Fail_Mode, Original_Input_QTY, Fail_Count_byXoutScrap, round(Fail_ratio_byXoutScrap,5) as Fail_ratio_byXoutScrap, 'ALL' as category "
            ''Else
            'sqlStr += "Part_Id, production_id, Lot_Id, Customer_Id, Fail_Mode, Original_Input_QTY, Fail_Count, round(Fail_ratio,5) as Fail_ratio, 'ALL' as category "
            ''End If
            'sqlStr += "from dbo.VW_BinCode_Daily_Lot "
            'sqlStr += "where Lot_Id in {0} "
            'sqlStr += "union "
            'sqlStr += "select WW, Convert(char(19), DataTime, 120) as DataTime, "
            ''If cb_DRowData0.Checked = True Then '匹配報廢回歸
            ''    sqlStr += "Part_Id, production_id, Lot_Id, Customer_Id, Fail_Mode, Original_Input_QTY, Fail_Count_byXoutScrap, round(Fail_ratio_byXoutScrap,5) as Fail_ratio_byXoutScrap, category "
            ''Else
            'sqlStr += "Part_Id, production_id, Lot_Id, Customer_Id, Fail_Mode, Original_Input_QTY, Fail_Count, round(Fail_ratio,5) as Fail_ratio, category "
            ''End If
            'sqlStr += "from dbo.VW_BinCode_Detail_Daily_Lot "
            'sqlStr += "where Lot_Id in {1} "
            'sqlStr += "order by lot_id "
            'sqlStr = String.Format(sqlStr, lot_list, lot_list)

            conn.Open()
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            dt = New DataTable()
            myAdapter.Fill(dt)
            conn.Close()

            If dt.Rows.Count > 0 Then
                tb_uploadLot.Visible = True
                Lot_GridView.DataSource = dt
                Lot_GridView.DataBind()
                UtilObj.Set_DataGridRow_OnMouseOver_Color(Lot_GridView, "#FFF68F", Lot_GridView.AlternatingRowStyle.BackColor)
            End If

        Catch ex As Exception

        Finally
            If oledb_con.State = ConnectionState.Open Then
                oledb_con.Close()
            End If
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try

    End Sub

    Private Sub Show_Chart_RawData(ByVal lot_list As String)
        Dim status As Boolean = False
        Dim sqlStr As String = ""
        Dim itemDT, myDT, rowDT As DataTable
        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim myAdapter As SqlDataAdapter
        Dim monthNextStr As String
        Dim ConditionStr As String = ""

        Try
            conn.Open()

            ' --- 取得 Chart Data ---
            sqlStr = "select part_id as part, Lot_id as lot, yield_category, "
            sqlStr += "Convert(char(19), DataTime, 120) as DataTime, "
            sqlStr += "ROUND((yield), 4) as yield "
            If ddl_CustomerID.SelectedValue = "INTEL" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    sqlStr += "from dbo.Yield_Daily_RawData "
                    sqlStr += "where 1=1 "
                Else
                    sqlStr += "from dbo.BKM_Yield_Daily_RawData "
                    sqlStr += "where 1=1 "
                    'sqlStr += "and BKM='Y' "
                End If
            ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    sqlStr += "from dbo.Yield_Daily_RawData "
                    sqlStr += "where 1=1 "
                    'sqlStr += "and AMD_FAILMODE='Y' "
                Else
                    sqlStr += "from dbo.Yield_Daily_RawData_NonIntel "
                    sqlStr += "where 1=1 "
                End If
            ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    sqlStr += "from dbo.Yield_Daily_RawData "
                    sqlStr += "where 1=1 "
                    'sqlStr += "and AMD_FAILMODE='Y' "
                Else
                    sqlStr += "from dbo.Yield_Daily_RawData_NonIntel "
                    sqlStr += "where 1=1 "
                End If
            Else
                If IsRename = False Then
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                        If cb_ChartMerge0.Checked = True Then
                            sqlStr += "from WB_Yield_Daily_RawData "
                            sqlStr += "where 1=1 "
                        Else
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                Else
                                    sqlStr += "from WB_Yield_Daily_RawData_NotMerge "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage "
                                End If
                            End If
                            sqlStr += "where 1=1 "
                        End If
                    Else
                        sqlStr += " from Yield_Daily_RawData_NonIntel "
                        sqlStr += "where 1=1 "
                    End If
                Else
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                        If cb_ChartMerge0.Checked = True Then
                            sqlStr += "from WB_Yield_Daily_RawData "
                            sqlStr += "where 1=1 "
                        Else
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                Else
                                    sqlStr += "from WB_Yield_Daily_RawData_NotMerge "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage "
                                End If
                            End If
                            sqlStr += "where 1=1 "
                        End If
                    Else
                        sqlStr += " from Yield_Daily_RawData_NonIntel "
                        sqlStr += "where 1=1 "
                    End If
                End If
            End If
            Dim CustomerID As String = ddl_CustomerID.SelectedValue
            If ddl_CustomerID.SelectedValue <> "INTEL" AndAlso ddl_YieldMode.SelectedValue.ToUpper() <> "BY FAIL MODE" Then
                If CustomerID <> "" AndAlso CustomerID <> "All" Then
                    sqlStr += "and customer_id ='" + CustomerID + "' "
                End If
            End If
            'Dim YieldItem As String = Get_YieldItem()
            'If YieldItem <> "" Then
            '    sqlStr += "and yield_category in(" + YieldItem + ")"
            'End If
            'Dim productionID As String = ""
            'Dim partID As String = ""
            'If rbl_BySource.SelectedIndex = 0 Then
            '    If ((ddl_CustomerID.SelectedValue <> "INTEL" AndAlso ddl_CustomerID.SelectedValue <> "AMD") AndAlso ddl_ProductType.SelectedValue.ToUpper() <> "WB") Then
            '        productionID = Get_PartID()
            '        If productionID <> "" AndAlso productionID <> "''" Then
            '            sqlStr += "and production_id IN(" + productionID + ") "
            '        End If
            '    End If
            'Else
            '    partID = Get_PartID()
            '    If partID <> "" AndAlso partID <> "''" Then
            '        sqlStr += "and Part_Id IN(" + partID + ") "
            '    End If
            'End If
            'If rb_DataTimeCustor.SelectedIndex = 0 Then
            '    sqlStr += "and datediff(month,datatime,getdate()) < 3 " '取3個月
            'Else
            '    Dim DateRange As String = Get_DateRange()
            '    If rbl_lossItem.SelectedIndex = 0 Then
            '        If DateRange = "" Then
            '            sqlStr += "and datediff(day,datatime,getdate()) < 7 " '取7天
            '        Else
            '            sqlStr += "and convert(char(10), datatime, 112) in (" + DateRange + ")"
            '        End If
            '    ElseIf rbl_lossItem.SelectedIndex = 1 Then
            '        If DateRange = "" Then
            '            sqlStr += "and datediff(week,datatime,getdate()) < 5 " '取5週
            '        Else
            '            sqlStr += "and datename(year,datatime)+Right('00' + Cast(datename(week,datatime) as varchar),2) in (" + DateRange + ")"
            '        End If
            '    ElseIf rbl_lossItem.SelectedIndex = 2 Then
            '        If DateRange = "" Then
            '            sqlStr += "and datediff(month,datatime,getdate()) < 3 " '取3個月
            '        Else
            '            sqlStr += "and convert(char(7), datatime, 120) in (" + DateRange + ")"
            '        End If
            '    End If
            'End If
            If lot_list <> "" Then
                sqlStr += "and Lot_id in(" + lot_list + ") "
            End If
            sqlStr += "order by DataTime desc"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)

            ' --- 取得 Yield Item ---
            'sqlStr = "select yield_category, SEQ "
            sqlStr = "select yield_category "
            If IsRename = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping "
            Else
                If IsRenameOrder = False Then
                    sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
                Else
                    sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
                End If
            End If
            sqlStr += "where 1=1 "
            'If CustomerID <> "" AndAlso CustomerID <> "All" Then
            '    If ddl_CustomerID.Text = "INTEL" Then
            '        ' --- Customer ID ---
            '        If ddl_CustomerID.SelectedValue <> "" Then
            '            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
            '        End If
            '    End If
            'End If
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    If ddl_CustomerID.Text = "INTEL" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    Else
                        ' --- Customer ID ---
                        sqlStr += "and customer_id ='All' "
                    End If
                End If
            Else
                If IsRenameOrder = False Then
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                    End If
                End If
            End If
            'Dim YieldType As String = ddl_YieldMode.Text
            'Dim YieldCategory As String = Get_YieldType()
            'If YieldType <> "" And YieldType <> "All" Then
            '    sqlStr += "and yield_type in('" + YieldType + "') "
            'End If
            'If YieldCategory <> "" Then
            '    sqlStr += "and yield_category in('" + YieldCategory + "') "
            'End If
            sqlStr += "and SEQ != 1 "
            If IsRenameOrder = False Then
                If ddl_CustomerID.SelectedValue = "INTEL" Then
                    If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                        sqlStr += "and BKM='N' "
                        sqlStr += "and AMD_FAILMODE='N' "
                    Else
                        sqlStr += "and BKM='Y' "
                        sqlStr += "and AMD_FAILMODE='N' "
                    End If
                ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
                    If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                        sqlStr += "and BKM='N' "
                        sqlStr += "and AMD_FAILMODE='Y' "
                    Else
                        sqlStr += "and BKM='N' "
                        sqlStr += "and AMD_FAILMODE='N' "
                    End If
                ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
                    If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                        sqlStr += "and BKM='N' "
                        sqlStr += "and AMD_FAILMODE='Y' "
                    Else
                        sqlStr += "and BKM='N' "
                        sqlStr += "and AMD_FAILMODE='N' "
                    End If
                Else
                    If IsRename = False Then
                        If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                            If cb_ChartMerge0.Checked = True Then
                                sqlStr += "and BKM='N' "
                                sqlStr += "and AMD_FAILMODE='N' "
                            Else
                                sqlStr += "and BKM='N' "
                                sqlStr += "and AMD_FAILMODE='N' "
                            End If
                        Else
                            sqlStr += "and BKM='N' "
                            sqlStr += "and AMD_FAILMODE='N' "
                        End If
                    Else
                        If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                            If cb_ChartMerge0.Checked = True Then
                                sqlStr += "and BKM='N' "
                                sqlStr += "and AMD_FAILMODE='N' "
                            Else
                                sqlStr += "and BKM='N' "
                                sqlStr += "and AMD_FAILMODE='N' "
                            End If
                        Else
                            sqlStr += "and BKM='N' "
                            sqlStr += "and AMD_FAILMODE='N' "
                        End If
                    End If
                End If
            Else
                If ddl_YieldMode.Text = "By Fail Mode" Then
                    sqlStr += "and Yield_Mode = 'FailMode' "
                ElseIf ddl_YieldMode.Text = "By Station" Then
                    sqlStr += "and Yield_Mode = 'Station' "
                ElseIf ddl_YieldMode.Text = "By BKM" Then
                    sqlStr += "and Yield_Mode = 'BKM' "
                End If
            End If
            'sqlStr += "group by yield_category, SEQ order by SEQ"
            'sqlStr += "group by yield_category order by yield_category"
            sqlStr += "group by SEQ, yield_category order by SEQ"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            itemDT = New DataTable
            myAdapter.Fill(itemDT)

            ' --- 畫 Chart ---
            Try
                Dim RangeType As String = ""
                Dim RangeTime As String = ""
                Dim yield_item() As String = CType(ViewState("CPU_gItem"), String())
                Dim yieldType1 As String = ""
                'For I As Integer = 0 To lb_weekShow.Items.Count - 1
                '    If I = 0 Then
                '        yieldType += "'" & lb_weekShow.Items(I).Text & "'"
                '    Else
                '        yieldType += ",'" & lb_weekShow.Items(I).Text & "'"
                '    End If
                'Next
                'area_Thred(partID, myDT, yieldType1, RangeType, RangeTime)
                area_Thred(myDT, itemDT)
            Catch ex As Exception
                Dim error_message As String = ex.ToString
            End Try

            ' --- 取得 DataTable 資料 --- 

            Dim colStr As String = ""
            If itemDT.Rows.Count > 0 Then
                colStr = " Lot_id as lot, Convert(char(19), DataTime, 120) as DataTime, FE_Plant_id as FE, BE_Plant_id as BE, "
            Else
                colStr = " Lot_id as lot, Convert(char(19), DataTime, 120) as DataTime, FE_Plant_id as FE, BE_Plant_id as BE "
            End If
            Dim groupStr As String = " group by Lot_id, DataTime, FE_Plant_id, BE_Plant_id "

            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    If itemDT.Rows.Count > 0 Then
                        colStr = " Lot_id as lot, Convert(char(19), DataTime, 120) as DataTime, FE_Plant_id as FE, "
                    Else
                        colStr = " Lot_id as lot, Convert(char(19), DataTime, 120) as DataTime, FE_Plant_id as FE "
                    End If
                    groupStr = " group by Lot_id, DataTime, FE_Plant_id "
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    If itemDT.Rows.Count > 0 Then
                        colStr = " Lot_id as lot, Convert(char(19), DataTime, 120) as DataTime, FE_Plant_id as FE, "
                    Else
                        colStr = " Lot_id as lot, Convert(char(19), DataTime, 120) as DataTime, FE_Plant_id as FE "
                    End If
                    groupStr = " group by Lot_id, DataTime, FE_Plant_id "
                End If
            End If

            sqlStr = "select "
            sqlStr += colStr
            For x As Integer = 0 To (itemDT.Rows.Count - 1)
                sqlStr += "max(case when Yield_Category = '" + (itemDT.Rows(x)(0).ToString) + "' then Input_QTY else 0 end) as '" + (itemDT.Rows(x)(0).ToString) + "In',"
                sqlStr += "max(case when Yield_Category = '" + (itemDT.Rows(x)(0).ToString) + "' then Output_QTY else 0 end) as '" + (itemDT.Rows(x)(0).ToString) + "Out',"
                sqlStr += "max(case when Yield_Category = '" + (itemDT.Rows(x)(0).ToString) + "' then ROUND((yield), 4) else 0 end) as '" + (itemDT.Rows(x)(0).ToString) + "',"
            Next
            sqlStr = sqlStr.Substring(0, (sqlStr.Length - 1))

            If ddl_CustomerID.SelectedValue = "INTEL" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    sqlStr += "from dbo.Yield_Daily_RawData "
                    sqlStr += "where 1=1 "
                    sqlStr += "and customer_id='INTEL' "
                Else
                    sqlStr += "from dbo.BKM_Yield_Daily_RawData "
                    sqlStr += "where 1=1 "
                End If
            ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    sqlStr += "from dbo.Yield_Daily_RawData "
                    sqlStr += "where 1=1 "
                    sqlStr += "and customer_id='AMD' "
                Else
                    sqlStr += "from dbo.Yield_Daily_RawData_NonIntel "
                    sqlStr += "where 1=1 "
                End If
            ElseIf ddl_CustomerID.SelectedValue = "NVD" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    sqlStr += "from dbo.Yield_Daily_RawData "
                    sqlStr += "where 1=1 "
                    sqlStr += "and customer_id='NVD' "
                Else
                    sqlStr += "from dbo.Yield_Daily_RawData_NonIntel "
                    sqlStr += "where 1=1 "
                End If
            ElseIf ddl_CustomerID.SelectedValue = "BCM" Then
                If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                    sqlStr += "from dbo.Yield_Daily_RawData "
                    sqlStr += "where 1=1 "
                    sqlStr += "and customer_id='BCM' "
                Else
                    sqlStr += "from dbo.Yield_Daily_RawData_NonIntel "
                    sqlStr += "where 1=1 "
                End If
            Else
                If IsRename = False Then
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                        If cb_ChartMerge0.Checked = True Then
                            sqlStr += "from WB_Yield_Daily_RawData "
                            sqlStr += "where 1=1 "
                        Else
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage "
                                End If
                            End If
                            sqlStr += "where 1=1 "
                        End If
                    Else
                        sqlStr += "from Yield_Daily_RawData_NonIntel "
                        sqlStr += "where 1=1 "
                    End If
                Else
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                        If cb_ChartMerge0.Checked = True Then
                            sqlStr += "from WB_Yield_Daily_RawData "
                            sqlStr += "where 1=1 "
                        Else
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    sqlStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF "
                                Else
                                    sqlStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage "
                                End If
                            End If
                            sqlStr += "where 1=1 "
                        End If
                    Else
                        sqlStr += "from Yield_Daily_RawData_NonIntel "
                        sqlStr += "where 1=1 "
                    End If
                End If
            End If
            If ddl_CustomerID.SelectedValue <> "INTEL" AndAlso ddl_YieldMode.SelectedValue.ToUpper() <> "BY FAIL MODE" Then
                If CustomerID <> "" AndAlso CustomerID <> "All" Then
                    sqlStr += "and customer_id ='" + CustomerID + "' "
                End If
            End If
            'If YieldItem <> "" Then
            '    sqlStr += "and yield_category in(" + YieldItem + ")"
            'End If
            'If rbl_BySource.SelectedIndex = 0 Then
            '    If ((ddl_CustomerID.SelectedValue <> "INTEL" AndAlso ddl_CustomerID.SelectedValue <> "AMD") AndAlso ddl_ProductType.SelectedValue.ToUpper() <> "WB") Then
            '        If productionID <> "" AndAlso productionID <> "''" Then
            '            sqlStr += "and production_id IN(" + productionID + ") "
            '        End If
            '    End If
            'Else
            '    If partID <> "" AndAlso partID <> "''" Then
            '        sqlStr += "and Part_Id IN(" + partID + ") "
            '    End If
            'End If
            'If rb_DataTimeCustor.SelectedIndex = 0 Then
            '    sqlStr += "and datediff(month,datatime,getdate()) < 3 " '取3個月
            'Else
            '    Dim DateRange As String = Get_DateRange()
            '    If rbl_lossItem.SelectedIndex = 0 Then
            '        If DateRange = "" Then
            '            sqlStr += "and datediff(day,datatime,getdate()) < 7 " '取7天
            '        Else
            '            sqlStr += "and convert(char(10), datatime, 112) in (" + DateRange + ")"
            '        End If
            '    ElseIf rbl_lossItem.SelectedIndex = 1 Then
            '        If DateRange = "" Then
            '            sqlStr += "and datediff(week,datatime,getdate()) < 5 " '取5週
            '        Else
            '            sqlStr += "and datename(year,datatime)+Right('00' + Cast(datename(week,datatime) as varchar),2) in (" + DateRange + ")"
            '        End If
            '    ElseIf rbl_lossItem.SelectedIndex = 2 Then
            '        If DateRange = "" Then
            '            sqlStr += "and datediff(month,datatime,getdate()) < 3 " '取3個月
            '        Else
            '            sqlStr += "and convert(char(7), datatime, 120) in (" + DateRange + ")"
            '        End If
            '    End If
            'End If
            If lot_list <> "" Then
                sqlStr += "and lot_id in(" + lot_list + ") "
            End If
            sqlStr += groupStr
            sqlStr += " order by DataTime "

            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            rowDT = New DataTable
            myAdapter.Fill(rowDT)
            conn.Close()

            ' --- Data Grid ---
            Lot_GridView.DataSource = rowDT
            Lot_GridView.DataBind()

            tb_uploadLot.Visible = True
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try

    End Sub

    'Private Sub area_Thred(ByVal Part_id As String, ByRef LotDT As DataTable, ByVal FailMode As String, ByVal rangeType As String, ByVal rangeTime As String)
    Private Sub area_Thred(ByRef LotDT As DataTable, ByRef Items As DataTable)
        For item As Integer = 0 To (Items.Rows.Count - 1)
            Dim YeildCategory As String = Items.Rows(item)("yield_category").ToString()
            Dim oFilterData() As DataRow = LotDT.Select("yield_category='" + YeildCategory + "'")

            If oFilterData.Length > 0 Then
                'Dim aryColor() As Color = {Color.Blue, Color.DarkOrange, Color.Purple, Color.DarkGreen, Color.DodgerBlue, Color.Firebrick, Color.Olive, Color.Green}
                Dim aryColor() As Color = {Color.DodgerBlue, Color.Olive, Color.DarkOrange, Color.Purple, Color.DarkGreen, Color.Blue, Color.Firebrick, Color.Green, Color.DarkSlateBlue, Color.DarkSlateGray, Color.Khaki, Color.Thistle}
                Dim Chart As New Dundas.Charting.WebControl.Chart()
                Chart.ImageUrl = "temp/yieldDetail_#SEQ(1000,1)"
                Chart.ImageType = ChartImageType.Png
                Chart.Palette = ChartColorPalette.Dundas
                Chart.Height = Unit.Pixel(400) 'big
                Chart.Width = Unit.Pixel(1100) 'midd

                Chart.Palette = ChartColorPalette.Dundas
                Chart.BackColor = Color.White
                Chart.BackGradientEndColor = Color.Peru
                Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
                Chart.BorderStyle = ChartDashStyle.Solid
                Chart.BorderWidth = 3
                Chart.BorderColor = Color.DarkBlue

                Chart.ChartAreas.Add("Default")
                Chart.ChartAreas("Default").AxisX.Title = "【Daily Yield Report by Lot】"
                Chart.ChartAreas("Default").AxisX.TitleColor = Color.Red
                Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
                Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -60 '文字對齊
                Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet

                Chart.UI.Toolbar.Enabled = False
                Chart.UI.ContextMenu.Enabled = True

                Dim series As Series
                series = Chart.Series.Add(YeildCategory)
                series.ChartArea = "Default"
                'series.Type = SeriesChartType.Line
                If oFilterData.Length > 1 Then
                    series.Type = SeriesChartType.Line
                Else
                    series.Type = SeriesChartType.Point
                End If
                series.Color = aryColor(0)
                series.MarkerStyle = MarkerStyle.Circle
                series.MarkerSize = 8
                series.MarkerColor = Color.DarkBlue
                series.BorderColor = Color.White
                series.BorderWidth = 1

                Dim lot_id As String
                Dim timeStr As String
                Dim value As Double
                Dim minValue As Double = 0
                Dim maxValue As Double = 0
                Dim firstTimeIn As Boolean = True

                'For rowIndex As Integer = 0 To (LotDT.Rows.Count - 1)
                For rowIndex As Integer = 0 To (oFilterData.Length - 1)
                    If Not IsDBNull(LotDT.Rows(rowIndex)("yield")) Then

                        'lot_id = LotDT.Rows(rowIndex)("LOT").ToString
                        'timeStr = LotDT.Rows(rowIndex)("DataTime").ToString
                        'value = ((CType(LotDT.Rows(rowIndex)("yield"), Double)) * 100)
                        lot_id = oFilterData(rowIndex)("LOT").ToString
                        timeStr = oFilterData(rowIndex)("DataTime").ToString
                        value = ((CType(oFilterData(rowIndex)("yield"), Double)) * 100)

                        If (LotDT.Rows.Count = 1) Then
                            series.Type = SeriesChartType.Point
                        End If

                        Chart.Series(YeildCategory).Points.AddXY(rowIndex, value)
                        Chart.Series(YeildCategory).Points(rowIndex).AxisLabel = lot_id
                        Chart.Series(YeildCategory).Points(rowIndex).ToolTip = "[" + lot_id + "  " + timeStr + "] " + value.ToString + "%"
                        Chart.Series(YeildCategory).Points(rowIndex).Href = "javascript:LinkPoint('" + (lot_id + timeStr) + "');"

                        If firstTimeIn Then
                            maxValue = value
                            minValue = value
                            firstTimeIn = False
                        End If

                        If value > maxValue Then
                            maxValue = value
                        End If

                        If value < minValue Then
                            minValue = value
                        End If
                    End If
                Next

                Dim Maxntemp As Double
                Dim Minntemp As Double
                Dim nInterval As Double = Math.Round((maxValue - minValue), 2, MidpointRounding.AwayFromZero)
                If nInterval <> 0 Then
                    ' --- Max ---
                    Maxntemp = (maxValue + nInterval)
                    Maxntemp = Math.Round(Maxntemp, 2, MidpointRounding.AwayFromZero)
                    ' --- Min ---
                    Minntemp = 0 '(minValue - nInterval)
                    Minntemp = Math.Round(Minntemp, 2, MidpointRounding.AwayFromZero)
                End If

                If maxValue = minValue Then
                    Maxntemp = maxValue + 5
                    Minntemp = minValue - 5
                End If

                If Maxntemp > 100 Then
                    Maxntemp = 100
                End If

                'getSPECLine(LotDT, Chart, part_id, "LotID")
                Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
                UploadLot_Chart.Controls.Add(New LiteralControl("<tr><td>"))
                UploadLot_Chart.Controls.Add(Chart)
                UploadLot_Chart.Controls.Add(New LiteralControl("</td></tr>"))
            End If
        Next
    End Sub

    Private Sub getSPECLine(ByRef dt As DataTable, ByRef Chart As Dundas.Charting.WebControl.Chart, ByVal Part_ID As String, ByVal yieldType As String)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim categoryStr As String = ""
        Dim ucl As Double = 0
        Dim lcl As Double = 0

        Try
            conn.Open()
            sqlStr = "SELECT "
            sqlStr += "UCL_Sigma, LCL_Sigma, "
            sqlStr += "CASE WHEN (UCL_Sigma = 3) THEN UCL_3S  WHEN (UCL_Sigma = 4) THEN UCL_4S WHEN (UCL_Sigma = 5) THEN UCL_5S ELSE NULL END as UCL,"
            sqlStr += "CASE WHEN (LCL_Sigma = 3) THEN LCL_3S  WHEN (LCL_Sigma = 4) THEN LCL_4S WHEN (LCL_Sigma = 5) THEN LCL_5S ELSE NULL END as LCL "
            sqlStr += "FROM dbo.Yield_SPEC "
            sqlStr += "WHERE 1=1 "
            sqlStr += "AND Part_Id='{0}' "
            sqlStr += "AND UPPER(OOC_Code)='{1}' "
            sqlStr = String.Format(sqlStr, Part_ID, (yieldType.ToUpper()))
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            conn.Close()

            If myDT.Rows.Count > 0 Then

                If Not IsDBNull(myDT.Rows(0)("UCL")) Then
                    ucl = Math.Round((CType(myDT.Rows(0)("UCL").ToString(), Double) * 100), 2, MidpointRounding.AwayFromZero)
                    Chart_SPEC(dt, Chart, (myDT.Rows(0)("UCL_Sigma").ToString() + "_UCL"), ucl.ToString())
                End If

                If Not IsDBNull(myDT.Rows(0)("LCL")) Then
                    lcl = Math.Round((CType(myDT.Rows(0)("LCL").ToString(), Double) * 100), 2, MidpointRounding.AwayFromZero)
                    Chart_SPEC(dt, Chart, (myDT.Rows(0)("LCL_Sigma").ToString() + "_LCL"), lcl.ToString())
                End If

            End If

            Chart.ChartAreas("Default").AxisY.Interval = 10
            Chart.ChartAreas("Default").AxisY.Maximum = 100
            Chart.ChartAreas("Default").AxisY.Minimum = 0

        Catch ex As Exception

        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try
    End Sub

    Public Sub Chart_SPEC(ByRef dt As DataTable, ByRef Chart As Dundas.Charting.WebControl.Chart, ByVal LineType As String, ByVal LineValue As Double)
        Dim series As Series
        series = Chart.Series.Add(LineType)
        series.ChartArea = "Default"
        'series.Type = SeriesChartType.Line
        If dt.Rows.Count > 1 Then
            series.Type = SeriesChartType.Line
        Else
            series.Type = SeriesChartType.Point
        End If
        series.Color = Color.Red
        series.BorderWidth = 2
        series.MarkerStyle = MarkerStyle.None
        series.MarkerSize = 0
        series.Font = New Font("Times New Roman", 8, FontStyle.Regular)
        series.ShowLabelAsValue = False
        series("LabelStyle") = "Top"

        Dim objPoint As DataPoint
        For i As Integer = 0 To (dt.Rows.Count - 1)
            objPoint = New DataPoint(i, LineValue)
            series.Points.Add(objPoint)
            objPoint.ToolTip = String.Format((LineType + ":{0:##0.###}"), LineValue)
        Next

        If CheckBox1.Checked = True Then
            series.Points(series.Points.Count - 1).Label = String.Format((LineType + ":{0:##0.###}"), LineValue)
            series.Points(series.Points.Count - 1).LabelBackColor = Color.Yellow
        Else
            series.Points(0).Label = String.Format((LineType + ":{0:##0.###}"), LineValue)
            series.Points(0).LabelBackColor = Color.Yellow
        End If
        series.SmartLabels.Enabled = True
        series.SmartLabels.AllowOutsidePlotArea = LabelOutsidePlotAreaStyle.Partial
        series.SmartLabels.MarkerOverlapping = False
        series.SmartLabels.MinMovingDistance = 15
        Chart.Series(LineType).LegendText = LineType
    End Sub

#Region "上傳 Lot 分析"

    Private Sub handTXTFile(ByRef lotAry As ArrayList)
        Dim sqlStr As String = ""
        Dim ds As DataSet
        Dim dt As DataTable
        Dim rowCount As Integer = 0
        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim myAdapter As SqlDataAdapter
        Dim lot_list As String = ""
        Dim lotList As String = ""

        Try
            For i As Integer = 0 To (lotAry.Count - 1)
                'lot_list += "'" + (lotAry(i)).ToString() + "',"
                'lotList += (lotAry(i)).ToString() + ","
                If i = 0 Then
                    lot_list += "'" + (lotAry(i)).ToString() + "'"
                Else
                    lot_list += ",'" + (lotAry(i)).ToString() + "'"
                End If
            Next
            'lot_list = lot_list.Substring(0, (lot_list.Length - 1))
            'lotList = lotList.Substring(0, (lotList.Length - 1))
            'lot_list = "(" + lot_list + ")"

            Call Show_Chart_RawData(lot_list)
            '' --- Row Data SQL --- 
            'sqlStr = "select distinct  "
            'sqlStr += "ww, Convert(char(19), DataTime, 120) as DataTime, "
            ''If cb_DRowData0.Checked = True Then '匹配報廢回歸
            ''    sqlStr += "Part_Id, production_type, Lot_Id, Customer_Id, Fail_Mode, MF_Stage, DefectCode, BinCode, Original_Input_QTY, Fail_Count_byXoutScrap, round(Fail_ratio_byXoutScrap, 5) as Fail_ratio_byXoutScrap, FE_Plant, BE_Plant "
            ''Else
            'sqlStr += "Part_Id, production_type, Lot_Id, Customer_Id, Fail_Mode, MF_Stage, DefectCode, BinCode, Original_Input_QTY, Fail_Count, round(Fail_ratio, 5) as Fail_ratio, FE_Plant, BE_Plant "
            ''End If
            'sqlStr += "from dbo.VW_BinCode_Daily_Lot "
            'sqlStr += "where 1=1 "
            'sqlStr += "and Lot_Id in {0} "
            'sqlStr += "order by lot_id, MF_Stage, Fail_Mode"
            'sqlStr = String.Format(sqlStr, lot_list)

            'conn.Open()
            'myAdapter = New SqlDataAdapter(sqlStr, conn)
            'dt = New DataTable()
            'myAdapter.Fill(dt)

            'If dt.Rows.Count > 0 Then

            '    ' --- Lot Raw Data
            '    tb_uploadLot.Visible = True
            '    Lot_GridView.DataSource = dt
            '    Lot_GridView.DataBind()
            '    UtilObj.Set_DataGridRow_OnMouseOver_Color(Lot_GridView, "#FFF68F", Lot_GridView.AlternatingRowStyle.BackColor)
            '    ' --- Chart 

            '    sqlStr = "Select SUM(Original_Input_QTY) as total_count "
            '    sqlStr += "from VW_BinCode_Daily_RawData "
            '    sqlStr += "where Lot_Id in {0} "
            '    sqlStr = String.Format(sqlStr, lot_list)
            '    myAdapter = New SqlDataAdapter(sqlStr, conn)
            '    dt = New DataTable()
            '    myAdapter.Fill(dt)

            '    'If cb_DRowData0.Checked = True Then '匹配報廢回歸(XoutScrap)
            '    '    'Fail_Count_byXoutScrap
            '    '    sqlStr = "SELECT TOP(20) Fail_Mode, round((convert(float, SUM(Fail_Count_byXoutScrap))/" + (dt.Rows(0)("total_count")).ToString() + "), 4) * 100 as Ratio "
            '    'Else
            '    sqlStr = "SELECT TOP(20) Fail_Mode, round((convert(float, SUM(Fail_Count))/" + (dt.Rows(0)("total_count")).ToString() + "), 4) * 100 as Ratio "
            '    'End If
            '    sqlStr += "FROM VW_BinCode_Daily_Lot "
            '    sqlStr += "WHERE 1=1 "
            '    sqlStr += "AND Lot_Id IN {0} "
            '    If cb_Non8K.Checked = True Then
            '        sqlStr += "AND Fail_Mode NOT LIKE '8K%' "
            '    End If
            '    sqlStr += "GROUP BY Fail_Mode "
            '    sqlStr += "ORDER BY Ratio desc"
            '    sqlStr = String.Format(sqlStr, lot_list)
            '    myAdapter = New SqlDataAdapter(sqlStr, conn)
            '    dt = New DataTable()
            '    myAdapter.Fill(dt)

            '    sqlStr = "SELECT b.yearWW, a.Production_Type, a.Category "
            '    sqlStr += "FROM VW_BinCode_Daily_Lot a, SystemDateMapping b "
            '    sqlStr += "WHERE b.DateTime = a.trtm "
            '    sqlStr += "AND Lot_Id IN {0} "
            '    sqlStr += "GROUP BY b.yearWW, a.Production_Type, a.Category "
            '    sqlStr += "ORDER BY b.yearWW DESC"
            '    sqlStr = String.Format(sqlStr, lot_list)
            '    myAdapter = New SqlDataAdapter(sqlStr, conn)
            '    Dim newDT As DataTable = New DataTable()
            '    myAdapter.Fill(newDT)

            '    ' 畫 Chart
            '    upLoadLotChart(dt, newDT, lotList)

            'End If
            conn.Close()
        Catch ex As Exception

        Finally
            If conn.State = ConnectionState.Open Then
                conn.Close()
            End If
        End Try
    End Sub

    Private Const gChartH As Integer = 600
    Private Const gChartW As Integer = 1080
    Private Sub upLoadLotChart(ByRef dt As DataTable, ByRef newDT As DataTable, ByVal lot_list As String)
        Dim scriptStr As String = ""
        Dim productionType As String = ""
        Dim weekStr As String = ""
        Dim productStr As String = ""
        Dim pieChartWeek As String = ""

        Try
            productionType = (newDT.Rows(0)("Production_Type")).ToString()
            weekStr = (newDT.Rows(0)("yearWW")).ToString()
            productStr = (newDT.Rows(0)("Category")).ToString()
            pieChartWeek = ""
            Dim weekDT_Distinct As DataTable = newDT.DefaultView.ToTable(True, New String() {"yearWW"})
            For Each dr As DataRow In weekDT_Distinct.Rows
                pieChartWeek += (dr("yearWW") + ",")
            Next
            pieChartWeek = pieChartWeek.Substring(0, (pieChartWeek.Length - 1))
        Catch ex As Exception
            weekStr = ""
        End Try


        Dim Chart As New Dundas.Charting.WebControl.Chart()
        Chart = New Dundas.Charting.WebControl.Chart()
        Chart.ImageUrl = "temp/ULOTChart_#SEQ(1000,1)"
        Chart.ImageType = ChartImageType.Png
        Chart.Palette = ChartColorPalette.Dundas
        Chart.Height = Unit.Pixel(gChartH)
        Chart.Width = Unit.Pixel(gChartW)

        Chart.Palette = ChartColorPalette.Dundas
        Chart.BackColor = Color.White
        Chart.BackGradientEndColor = Color.Peru
        Chart.BorderSkin.SkinStyle = BorderSkinStyle.Emboss
        Chart.BorderStyle = ChartDashStyle.Solid
        Chart.BorderWidth = 3
        Chart.BorderColor = Color.DarkBlue

        Chart.ChartAreas.Add("Default")
        Chart.ChartAreas("Default").AxisY.LabelStyle.Format = "P2"
        Chart.ChartAreas("Default").AxisX.LabelStyle.Interval = 1
        Chart.ChartAreas("Default").AxisX.LabelStyle.FontAngle = -45 '文字對齊
        Chart.ChartAreas("Default").BorderStyle = ChartDashStyle.NotSet
        Chart.ChartAreas("Default").AxisY.LabelStyle.Font = New Font("Arial", 14, GraphicsUnit.Pixel)

        Chart.UI.Toolbar.Enabled = False
        Chart.UI.ContextMenu.Enabled = True

        Dim series As Series
        series = Chart.Series.Add("FailMode")
        series.ChartArea = "Default"
        series.Type = SeriesChartType.Column
        series.Color = Color.DodgerBlue
        series.ShowInLegend = False

        Dim failMode As String
        Dim failValue As Double
        'Dim product_part As String = "PRODUCT"
        'If rb_ProductPart.SelectedIndex = 1 Then
        '    product_part = "PART"
        'End If

        For i As Integer = 0 To (dt.Rows.Count - 1)

            failMode = (dt.Rows(i)("Fail_Mode").ToString.Trim()).Replace("'", "''")
            failValue = 0
            If Not IsDBNull(dt.Rows(i)("Ratio")) Then
                failValue = CType(dt.Rows(i)("Ratio"), Double)
            End If

            Chart.Series("FailMode").Points.AddXY(failMode, failValue)
            Chart.Series("FailMode").Points(i).Label = ((failValue.ToString) + "%")
        Next

        UploadLot_Chart.Controls.Add(Chart)
    End Sub

#End Region

#End Region

    Protected Sub but_OL_ProcessRight_Click(sender As Object, e As System.EventArgs) Handles but_OL_ProcessRight.Click
        moveList(listB_OL_ProcessSource, listB_OL_ProcessShow)

        'If listB_OL_ProcessSource.Items.Count = 0 Then
        '    'ddl_CustomerID.Enabled = True
        '    'ddlPart.Enabled = True
        '    'rbl_BySource.Enabled = True
        '    'rbl_BySource.Items(0).Selected = True

        '    ddl_CustomerID.Enabled = False
        '    rbl_BySource.Enabled = False
        '    'ddlPart.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False

        '    'cb_ChartMerge.Checked = True
        '    'cb_ChartMerge.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_OL_ProcessShow.Items.Count = 0 Then
        '                'ddl_CustomerID.Enabled = True
        '                'rbl_BySource.Enabled = True
        '                ''ddlPart.Enabled = True
        '                'listB_PartSource.Enabled = True
        '                'listB_PartShow.Enabled = True
        '                'but_PartRight.Enabled = True
        '                'but_PartLeft.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                'ddl_CustomerID.Enabled = False
        '                'rbl_BySource.Enabled = False
        '                ''ddlPart.Enabled = False
        '                'listB_PartSource.Enabled = False
        '                'listB_PartShow.Enabled = False
        '                'but_PartRight.Enabled = False
        '                'but_PartLeft.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            'ddl_CustomerID.Enabled = True
        '            'rbl_BySource.Enabled = True
        '            'rbl_BySource.Items(0).Selected = True
        '            ''ddlPart.Enabled = True
        '            'listB_PartSource.Enabled = True
        '            'listB_PartShow.Enabled = True
        '            'but_PartRight.Enabled = True
        '            'but_PartLeft.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_OL_ProcessShow.Items.Count = 0 Then
        '                'ddl_CustomerID.Enabled = True
        '                'rbl_BySource.Enabled = True
        '                ''ddlPart.Enabled = True
        '                'listB_PartSource.Enabled = True
        '                'listB_PartShow.Enabled = True
        '                'but_PartRight.Enabled = True
        '                'but_PartLeft.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                'ddl_CustomerID.Enabled = False
        '                'rbl_BySource.Enabled = False
        '                ''ddlPart.Enabled = False
        '                'listB_PartSource.Enabled = False
        '                'listB_PartShow.Enabled = False
        '                'but_PartRight.Enabled = False
        '                'but_PartLeft.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            'ddl_CustomerID.Enabled = True
        '            'rbl_BySource.Enabled = True
        '            'rbl_BySource.Items(0).Selected = True
        '            ''ddlPart.Enabled = True
        '            'listB_PartSource.Enabled = True
        '            'listB_PartShow.Enabled = True
        '            'but_PartRight.Enabled = True
        '            'but_PartLeft.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    End If
        '    If ddl_CustomerID.Items.Count > 0 Then
        '        ddl_CustomerID.SelectedIndex = 0
        '    End If
        '    'If ddlPart.Items.Count > 0 Then
        '    '    ddlPart.SelectedIndex = 0
        '    'End If
        'End If

        ListBoxSort(listB_OL_ProcessSource, False)
        ListBoxSort(listB_OL_ProcessShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ' --- Customer ID (廠商) ---
        If IsRename = False Then
            sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        Else
            sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        End If
        sqlStr += "and a.yield_function=1 "
        ' --- Product Type ---
        sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            Else
                If strBumpingType <> "" Then
                    sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                End If
            End If
        End If
        sqlStr += "group by a.customer_id order by a.customer_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillController(myDT, ddl_CustomerID, 1)

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            'If strBumpingType <> "" Then
            '    sqlStr += "and Bumping_Type IN(" + strBumpingType + ") "
            'End If
            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            Else
                If strBumpingType <> "" Then
                    sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        'sqlStr += "and production_id <> '' "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            'If Not IsDBNull(myDT.Rows(0)(0)) Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                'UtilObj.FillController(myDT, ddlPart, 0)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    'If strBumpingType <> "" Then
                    '    sqlStr += "and Bumping_Type IN(" + strBumpingType + ") "
                    'End If
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                'If strBumpingType <> "" Then
                '    sqlStr += "and Bumping_Type IN(" + strBumpingType + ") "
                'End If
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        lb_weekSource.Items.Clear()
        lb_weekShow.Items.Clear()
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Protected Sub but_BackendRight_Click(sender As Object, e As System.EventArgs) Handles but_BackendRight.Click
        moveList(listB_BackendSource, listB_BackendShow)

        'If listB_BackendSource.Items.Count = 0 Then
        '    'ddl_CustomerID.Enabled = True
        '    'ddlPart.Enabled = True
        '    'rbl_BySource.Enabled = True
        '    'rbl_BySource.Items(0).Selected = True

        '    ddl_CustomerID.Enabled = False
        '    rbl_BySource.Enabled = False
        '    'ddlPart.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False

        '    'cb_ChartMerge.Checked = True
        '    'cb_ChartMerge.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_BackendShow.Items.Count = 0 Then
        '                'ddl_CustomerID.Enabled = True
        '                'rbl_BySource.Enabled = True
        '                ''ddlPart.Enabled = True
        '                'listB_PartSource.Enabled = True
        '                'listB_PartShow.Enabled = True
        '                'but_PartRight.Enabled = True
        '                'but_PartLeft.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                'ddl_CustomerID.Enabled = False
        '                'rbl_BySource.Enabled = False
        '                ''ddlPart.Enabled = False
        '                'listB_PartSource.Enabled = False
        '                'listB_PartShow.Enabled = False
        '                'but_PartRight.Enabled = False
        '                'but_PartLeft.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            'ddl_CustomerID.Enabled = True
        '            'rbl_BySource.Enabled = True
        '            'rbl_BySource.Items(0).Selected = True
        '            ''ddlPart.Enabled = True
        '            'listB_PartSource.Enabled = True
        '            'listB_PartShow.Enabled = True
        '            'but_PartRight.Enabled = True
        '            'but_PartLeft.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_BackendShow.Items.Count = 0 Then
        '                'ddl_CustomerID.Enabled = True
        '                'rbl_BySource.Enabled = True
        '                ''ddlPart.Enabled = True
        '                'listB_PartSource.Enabled = True
        '                'listB_PartShow.Enabled = True
        '                'but_PartRight.Enabled = True
        '                'but_PartLeft.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                'ddl_CustomerID.Enabled = False
        '                'rbl_BySource.Enabled = False
        '                ''ddlPart.Enabled = False
        '                'listB_PartSource.Enabled = False
        '                'listB_PartShow.Enabled = False
        '                'but_PartRight.Enabled = False
        '                'but_PartLeft.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            'ddl_CustomerID.Enabled = True
        '            'rbl_BySource.Enabled = True
        '            'rbl_BySource.Items(0).Selected = True
        '            ''ddlPart.Enabled = True
        '            'listB_PartSource.Enabled = True
        '            'listB_PartShow.Enabled = True
        '            'but_PartRight.Enabled = True
        '            'but_PartLeft.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    End If
        '    If ddl_CustomerID.Items.Count > 0 Then
        '        ddl_CustomerID.SelectedIndex = 0
        '    End If
        '    'If ddlPart.Items.Count > 0 Then
        '    '    ddlPart.SelectedIndex = 0
        '    'End If
        'End If

        ListBoxSort(listB_BackendSource, False)
        ListBoxSort(listB_BackendShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ' --- Customer ID (廠商) ---
        If IsRename = False Then
            sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        Else
            sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        End If
        sqlStr += "and a.yield_function=1 "
        ' --- Product Type ---
        sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True  Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        sqlStr += "group by a.customer_id order by a.customer_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillController(myDT, ddl_CustomerID, 1)

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True  Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        'sqlStr += "and production_id <> '' "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            'If Not IsDBNull(myDT.Rows(0)(0)) Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                'UtilObj.FillController(myDT, ddlPart, 0)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True  Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True  Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        lb_weekSource.Items.Clear()
        lb_weekShow.Items.Clear()
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Protected Sub but_OL_ProcessLeft_Click(sender As Object, e As System.EventArgs) Handles but_OL_ProcessLeft.Click
        moveList(listB_OL_ProcessShow, listB_OL_ProcessSource)

        'If listB_OL_ProcessSource.Items.Count = 0 Then
        '    'ddl_CustomerID.Enabled = True
        '    'ddlPart.Enabled = True
        '    'rbl_BySource.Enabled = True
        '    'rbl_BySource.Items(0).Selected = True

        '    ddl_CustomerID.Enabled = False
        '    rbl_BySource.Enabled = False
        '    'ddlPart.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False

        '    'cb_ChartMerge.Checked = True
        '    'cb_ChartMerge.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_OL_ProcessShow.Items.Count = 0 Then
        '                ddl_CustomerID.Enabled = True
        '                rbl_BySource.Enabled = True
        '                'ddlPart.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                ddl_CustomerID.Enabled = False
        '                rbl_BySource.Enabled = False
        '                'ddlPart.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            ddl_CustomerID.Enabled = True
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            'ddlPart.Enabled = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_OL_ProcessShow.Items.Count = 0 Then
        '                ddl_CustomerID.Enabled = True
        '                rbl_BySource.Enabled = True
        '                'ddlPart.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                ddl_CustomerID.Enabled = False
        '                rbl_BySource.Enabled = False
        '                'ddlPart.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            ddl_CustomerID.Enabled = True
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            'ddlPart.Enabled = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    End If
        '    If ddl_CustomerID.Items.Count > 0 Then
        '        ddl_CustomerID.SelectedIndex = 0
        '    End If
        '    'If ddlPart.Items.Count > 0 Then
        '    '    ddlPart.SelectedIndex = 0
        '    'End If
        'End If

        ListBoxSort(listB_OL_ProcessSource, False)
        ListBoxSort(listB_OL_ProcessShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ' --- Customer ID (廠商) ---
        If IsRename = False Then
            sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        Else
            sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        End If
        sqlStr += "and a.yield_function=1 "
        ' --- Product Type ---
        sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            Else
                If strBumpingType <> "" Then
                    sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                End If
            End If
        End If
        sqlStr += "group by a.customer_id order by a.customer_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillController(myDT, ddl_CustomerID, 1)

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            'If strBumpingType <> "" Then
            '    sqlStr += "and Bumping_Type IN(" + strBumpingType + ") "
            'End If
            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            Else
                If strBumpingType <> "" Then
                    sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        'sqlStr += "and production_id <> '' "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            'If Not IsDBNull(myDT.Rows(0)(0)) Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                'UtilObj.FillController(myDT, ddlPart, 0)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    'If strBumpingType <> "" Then
                    '    sqlStr += "and Bumping_Type IN(" + strBumpingType + ") "
                    'End If
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                'If strBumpingType <> "" Then
                '    sqlStr += "and Bumping_Type IN(" + strBumpingType + ") "
                'End If
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        lb_weekSource.Items.Clear()
        lb_weekShow.Items.Clear()
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Protected Sub but_BackendLeft_Click(sender As Object, e As System.EventArgs) Handles but_BackendLeft.Click
        moveList(listB_BackendShow, listB_BackendSource)

        'If listB_BackendSource.Items.Count = 0 Then
        '    'ddl_CustomerID.Enabled = True
        '    'ddlPart.Enabled = True
        '    'rbl_BySource.Enabled = True
        '    'rbl_BySource.Items(0).Selected = True

        '    ddl_CustomerID.Enabled = False
        '    rbl_BySource.Enabled = False
        '    'ddlPart.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False

        '    'cb_ChartMerge.Checked = True
        '    'cb_ChartMerge.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_BackendShow.Items.Count = 0 Then
        '                ddl_CustomerID.Enabled = True
        '                rbl_BySource.Enabled = True
        '                'ddlPart.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                ddl_CustomerID.Enabled = False
        '                rbl_BySource.Enabled = False
        '                'ddlPart.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            ddl_CustomerID.Enabled = True
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            'ddlPart.Enabled = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_BackendShow.Items.Count = 0 Then
        '                ddl_CustomerID.Enabled = True
        '                rbl_BySource.Enabled = True
        '                'ddlPart.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                ddl_CustomerID.Enabled = False
        '                rbl_BySource.Enabled = False
        '                'ddlPart.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            ddl_CustomerID.Enabled = True
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            'ddlPart.Enabled = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    End If
        '    If ddl_CustomerID.Items.Count > 0 Then
        '        ddl_CustomerID.SelectedIndex = 0
        '    End If
        '    'If ddlPart.Items.Count > 0 Then
        '    '    ddlPart.SelectedIndex = 0
        '    'End If
        'End If

        ListBoxSort(listB_BackendSource, False)
        ListBoxSort(listB_BackendShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ' --- Customer ID (廠商) ---
        If IsRename = False Then
            sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        Else
            sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        End If
        sqlStr += "and a.yield_function=1 "
        ' --- Product Type ---
        sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True  Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        sqlStr += "group by a.customer_id order by a.customer_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillController(myDT, ddl_CustomerID, 1)

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True  Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        'sqlStr += "and production_id <> '' "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            'If Not IsDBNull(myDT.Rows(0)(0)) Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                'UtilObj.FillController(myDT, ddlPart, 0)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True  Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True  Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        lb_weekSource.Items.Clear()
        lb_weekShow.Items.Clear()
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Protected Sub but_BumpingTypeRightAll_Click(sender As Object, e As System.EventArgs) Handles but_BumpingTypeRightAll.Click
        moveListAll(listB_BumpingTypeSource, listB_BumpingTypeShow)

        'If listB_BumpingTypeSource.Items.Count = 0 Then
        '    ddl_CustomerID.Enabled = False
        '    rbl_BySource.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_BumpingTypeShow.Items.Count = 0 Then

        '            Else

        '            End If
        '        Else

        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_BumpingTypeShow.Items.Count = 0 Then

        '            Else

        '            End If
        '        Else

        '        End If
        '    End If
        '    If ddl_CustomerID.Items.Count > 0 Then
        '        ddl_CustomerID.SelectedIndex = 0
        '    End If
        'End If

        ListBoxSort(listB_BumpingTypeSource, False)
        ListBoxSort(listB_BumpingTypeShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ' --- Customer ID (廠商) ---
        If IsRename = False Then
            sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        Else
            sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        End If
        sqlStr += "and a.yield_function=1 "
        ' --- Product Type ---
        sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        sqlStr += "group by a.customer_id order by a.customer_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillController(myDT, ddl_CustomerID, 1)

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        lb_weekSource.Items.Clear()
        lb_weekShow.Items.Clear()
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Protected Sub but_BumpingTypeLeftAll_Click(sender As Object, e As System.EventArgs) Handles but_BumpingTypeLeftAll.Click
        moveListAll(listB_BumpingTypeShow, listB_BumpingTypeSource)

        'If listB_BumpingTypeSource.Items.Count = 0 Then
        '    ddl_CustomerID.Enabled = False
        '    rbl_BySource.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_BumpingTypeShow.Items.Count = 0 Then
        '                ddl_CustomerID.Enabled = True
        '                rbl_BySource.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True
        '            Else
        '                ddl_CustomerID.Enabled = False
        '                rbl_BySource.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False
        '            End If
        '        Else
        '            ddl_CustomerID.Enabled = True
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True
        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_BumpingTypeShow.Items.Count = 0 Then
        '                ddl_CustomerID.Enabled = True
        '                rbl_BySource.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True
        '            Else
        '                ddl_CustomerID.Enabled = False
        '                rbl_BySource.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False
        '            End If
        '        Else
        '            ddl_CustomerID.Enabled = True
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True
        '        End If
        '    End If
        '    If ddl_CustomerID.Items.Count > 0 Then
        '        ddl_CustomerID.SelectedIndex = 0
        '    End If
        'End If

        ListBoxSort(listB_BumpingTypeSource, False)
        ListBoxSort(listB_BumpingTypeShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ' --- Customer ID (廠商) ---
        If IsRename = False Then
            sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        Else
            sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        End If
        sqlStr += "and a.yield_function=1 "
        ' --- Product Type ---
        sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        sqlStr += "group by a.customer_id order by a.customer_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillController(myDT, ddl_CustomerID, 1)

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        lb_weekSource.Items.Clear()
        lb_weekShow.Items.Clear()
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Protected Sub but_CustomerIDRight_Click(sender As Object, e As System.EventArgs) Handles but_CustomerIDRight.Click
        Try
            moveList(listB_CustomerIDSource, listB_CustomerIDShow)

            'If listB_CustomerIDSource.Items.Count = 0 Then
            '    rbl_BySource.Enabled = False
            '    listB_PartSource.Enabled = False
            '    listB_PartShow.Enabled = False
            '    but_PartRight.Enabled = False
            '    but_PartLeft.Enabled = False
            '    '================
            '    'Customer開放複選
            '    '================
            '    but_PartRightAll.Enabled = False
            '    but_PartLeftAll.Enabled = False
            'Else
            '    If IsRename = False Then
            '        If ddl_ProductType.Text = sWB Then
            '            If listB_CustomerIDShow.Items.Count = 0 Then

            '            Else

            '            End If
            '        Else

            '        End If
            '    Else
            '        If ddl_ProductType.Text = sWB_Rename Then
            '            If listB_CustomerIDShow.Items.Count = 0 Then

            '            Else

            '            End If
            '        Else

            '        End If
            '    End If
            'End If

            ListBoxSort(listB_CustomerIDSource, False)
            ListBoxSort(listB_CustomerIDShow, False)

            Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
            Dim sqlStr As String = ""
            Dim myDT As DataTable
            Dim myAdapter As SqlDataAdapter
            Dim BKMSql As String = "and BKM='N' "
            Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

            ddl_YieldMode.Items.Clear()
            If ddl_CustomerID.SelectedValue = "INTEL" Then
                ddl_YieldMode.Items.Add("By Fail Mode")
                ddl_YieldMode.Items.Add("By BKM")
                If ddl_YieldMode.SelectedIndex = 1 Then
                    BKMSql = "and BKM='Y' "
                End If
            ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
                ddl_YieldMode.Items.Add("By Fail Mode")
                ddl_YieldMode.Items.Add("By Station")
                If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                    AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
                End If
            ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
                ddl_YieldMode.Items.Add("By Fail Mode")
                ddl_YieldMode.Items.Add("By Station")
                If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                    AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
                End If
            Else
                If IsRename = False Then
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                        ddl_YieldMode.Items.Add("By Fail Mode")
                    Else
                        ddl_YieldMode.Items.Add("By Station")
                    End If
                Else
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                        ddl_YieldMode.Items.Add("By Fail Mode")
                    Else
                        ddl_YieldMode.Items.Add("By Station")
                    End If
                End If
            End If

            ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
            If IsRename = False Then
                sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True  Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.production_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)

            ' --- Group ---
            If myDT.Rows.Count > 0 Then
                'If Not IsDBNull(myDT.Rows(0)(0)) Then
                If myDT.Rows(0)(0).ToString() <> "" Then
                    ' 有就秀 Group
                    rbl_BySource.SelectedIndex = 0
                    'UtilObj.FillController(myDT, ddlPart, 0)
                    listB_PartSource.Items.Clear()
                    listB_PartShow.Items.Clear()
                    For i As Integer = 0 To myDT.Rows.Count - 1
                        listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                    Next
                Else
                    ' 轉向 Part ID
                    rbl_BySource.SelectedIndex = 1
                    rbl_BySource.Items(0).Enabled = False
                    'If IsRename = False Then
                    '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                    'Else
                    '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                    'End If
                    If IsRename = False Then
                        sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                    Else
                        sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                    End If
                    ' --- Product Type ---
                    sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                    If tr_BumpingType.Visible = True  Then
                        ' --- Bumping Type ---
                        Dim strBumpingType As String = ""
                        For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                            If n = 0 Then
                                strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                            Else
                                strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                            End If
                        Next
                        ' --- OL_Process ---
                        Dim strOL_Process As String = ""
                        For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                            If n = 0 Then
                                strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                            Else
                                strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                            End If
                        Next
                        ' --- Backend ---
                        Dim strBackend As String = ""
                        For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                            If n = 0 Then
                                strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                            Else
                                strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                            End If
                        Next
                        If listB_BumpingTypeShow.Items.Count > 0 Then
                            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            Else
                                If strBumpingType <> "" Then
                                    sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                                End If
                            End If
                        Else
                            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                    sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and b.Backend IN(" + strBackend + ") "
                                End If
                            End If
                        End If
                    End If
                    '================
                    'Customer開放複選
                    '================
                    If ddl_ProductType.Text <> sWB_Rename Then
                        If ddl_CustomerID.Text <> "All" Then
                            ' --- Customer ID ---
                            If ddl_CustomerID.SelectedValue <> "" Then
                                sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                            End If
                        End If
                    Else
                        Dim strCustomerID As String = ""
                        For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                            If n = 0 Then
                                strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                            Else
                                strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                            End If
                        Next
                        If strCustomerID <> "" Then
                            sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                        End If
                    End If
                    sqlStr += "and a.yield_function=1 "
                    sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                    myAdapter = New SqlDataAdapter(sqlStr, conn)
                    myAdapter.SelectCommand.CommandTimeout = 3600
                    myDT = New DataTable
                    myAdapter.Fill(myDT)
                    'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                    listB_PartSource.Items.Clear()
                    listB_PartShow.Items.Clear()
                    For i As Integer = 0 To myDT.Rows.Count - 1
                        listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                    Next
                End If
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True  Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If

            ' --- Yield Item ---
            'sqlStr = "select yield_category, SEQ "
            sqlStr = "select yield_category "
            If IsRename = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping "
            Else
                If IsRenameOrder = False Then
                    sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
                Else
                    sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
                End If
            End If
            sqlStr += "where 1=1 "
            ' --- Product Type ---
            sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    If ddl_CustomerID.Text = "INTEL" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    Else
                        ' --- Customer ID ---
                        sqlStr += "and customer_id ='All' "
                    End If
                End If
            Else
                If IsRenameOrder = False Then
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                    End If
                End If
            End If
            sqlStr += "and SEQ != 1 "
            If IsRenameOrder = False Then
                sqlStr += BKMSql
                sqlStr += AMD_FAILMODESql
            Else
                If ddl_YieldMode.Text = "By Fail Mode" Then
                    sqlStr += "and Yield_Mode = 'FailMode' "
                ElseIf ddl_YieldMode.Text = "By Station" Then
                    sqlStr += "and Yield_Mode = 'Station' "
                ElseIf ddl_YieldMode.Text = "By BKM" Then
                    sqlStr += "and Yield_Mode = 'BKM' "
                End If
            End If
            'sqlStr += "group by yield_category, SEQ order by SEQ"
            'sqlStr += "group by yield_category order by yield_category"
            sqlStr += "group by SEQ, yield_category order by SEQ"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            lb_weekSource.Items.Clear()
            lb_weekShow.Items.Clear()
            UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

            ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
            Dim addIndex As Integer = 0
            Dim gItem(myDT.Rows.Count) As String
            gItem(addIndex) = "LotCount"
            addIndex += 1
            For i As Integer = 0 To (myDT.Rows.Count - 1)
                gItem(addIndex) = myDT.Rows(i)(0)
                addIndex += 1
            Next
            ViewState("CPU_gItem") = gItem
            conn.Close()

            rb_DataTimeCustor_SelectedIndexChanged(sender, e)
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try
    End Sub

    Protected Sub but_CustomerIDLeft_Click(sender As Object, e As System.EventArgs) Handles but_CustomerIDLeft.Click
        moveList(listB_CustomerIDShow, listB_CustomerIDSource)

        'If listB_CustomerIDSource.Items.Count = 0 Then
        '    rbl_BySource.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_CustomerIDShow.Items.Count = 0 Then
        '                rbl_BySource.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True
        '            Else
        '                rbl_BySource.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False
        '            End If
        '        Else
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True
        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_CustomerIDShow.Items.Count = 0 Then
        '                rbl_BySource.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True
        '            Else
        '                rbl_BySource.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False
        '            End If
        '        Else
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True
        '        End If
        '    End If
        'End If

        ListBoxSort(listB_CustomerIDSource, False)
        ListBoxSort(listB_CustomerIDShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True  Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        'sqlStr += "and production_id <> '' "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            'If Not IsDBNull(myDT.Rows(0)(0)) Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                'UtilObj.FillController(myDT, ddlPart, 0)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True  Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True  Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        lb_weekSource.Items.Clear()
        lb_weekShow.Items.Clear()
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Protected Sub but_OL_ProcessRightAll_Click(sender As Object, e As System.EventArgs) Handles but_OL_ProcessRightAll.Click
        moveListAll(listB_OL_ProcessSource, listB_OL_ProcessShow)

        'If listB_OL_ProcessSource.Items.Count = 0 Then
        '    'ddl_CustomerID.Enabled = True
        '    'ddlPart.Enabled = True
        '    'rbl_BySource.Enabled = True
        '    'rbl_BySource.Items(0).Selected = True

        '    ddl_CustomerID.Enabled = False
        '    rbl_BySource.Enabled = False
        '    'ddlPart.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False

        '    'cb_ChartMerge.Checked = True
        '    'cb_ChartMerge.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_OL_ProcessShow.Items.Count = 0 Then
        '                'ddl_CustomerID.Enabled = True
        '                'rbl_BySource.Enabled = True
        '                ''ddlPart.Enabled = True
        '                'listB_PartSource.Enabled = True
        '                'listB_PartShow.Enabled = True
        '                'but_PartRight.Enabled = True
        '                'but_PartLeft.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                'ddl_CustomerID.Enabled = False
        '                'rbl_BySource.Enabled = False
        '                ''ddlPart.Enabled = False
        '                'listB_PartSource.Enabled = False
        '                'listB_PartShow.Enabled = False
        '                'but_PartRight.Enabled = False
        '                'but_PartLeft.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            'ddl_CustomerID.Enabled = True
        '            'rbl_BySource.Enabled = True
        '            'rbl_BySource.Items(0).Selected = True
        '            ''ddlPart.Enabled = True
        '            'listB_PartSource.Enabled = True
        '            'listB_PartShow.Enabled = True
        '            'but_PartRight.Enabled = True
        '            'but_PartLeft.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_OL_ProcessShow.Items.Count = 0 Then
        '                'ddl_CustomerID.Enabled = True
        '                'rbl_BySource.Enabled = True
        '                ''ddlPart.Enabled = True
        '                'listB_PartSource.Enabled = True
        '                'listB_PartShow.Enabled = True
        '                'but_PartRight.Enabled = True
        '                'but_PartLeft.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                'ddl_CustomerID.Enabled = False
        '                'rbl_BySource.Enabled = False
        '                ''ddlPart.Enabled = False
        '                'listB_PartSource.Enabled = False
        '                'listB_PartShow.Enabled = False
        '                'but_PartRight.Enabled = False
        '                'but_PartLeft.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            'ddl_CustomerID.Enabled = True
        '            'rbl_BySource.Enabled = True
        '            'rbl_BySource.Items(0).Selected = True
        '            ''ddlPart.Enabled = True
        '            'listB_PartSource.Enabled = True
        '            'listB_PartShow.Enabled = True
        '            'but_PartRight.Enabled = True
        '            'but_PartLeft.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    End If
        '    If ddl_CustomerID.Items.Count > 0 Then
        '        ddl_CustomerID.SelectedIndex = 0
        '    End If
        '    'If ddlPart.Items.Count > 0 Then
        '    '    ddlPart.SelectedIndex = 0
        '    'End If
        'End If

        ListBoxSort(listB_OL_ProcessSource, False)
        ListBoxSort(listB_OL_ProcessShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ' --- Customer ID (廠商) ---
        If IsRename = False Then
            sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        Else
            sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        End If
        sqlStr += "and a.yield_function=1 "
        ' --- Product Type ---
        sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            Else
                If strBumpingType <> "" Then
                    sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                End If
            End If
        End If
        sqlStr += "group by a.customer_id order by a.customer_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillController(myDT, ddl_CustomerID, 1)

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            'If strBumpingType <> "" Then
            '    sqlStr += "and Bumping_Type IN(" + strBumpingType + ") "
            'End If
            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            Else
                If strBumpingType <> "" Then
                    sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        'sqlStr += "and production_id <> '' "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            'If Not IsDBNull(myDT.Rows(0)(0)) Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                'UtilObj.FillController(myDT, ddlPart, 0)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    'If strBumpingType <> "" Then
                    '    sqlStr += "and Bumping_Type IN(" + strBumpingType + ") "
                    'End If
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                'If strBumpingType <> "" Then
                '    sqlStr += "and Bumping_Type IN(" + strBumpingType + ") "
                'End If
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Protected Sub but_OL_ProcessLeftAll_Click(sender As Object, e As System.EventArgs) Handles but_OL_ProcessLeftAll.Click
        moveListAll(listB_OL_ProcessShow, listB_OL_ProcessSource)

        'If listB_OL_ProcessSource.Items.Count = 0 Then
        '    'ddl_CustomerID.Enabled = True
        '    'ddlPart.Enabled = True
        '    'rbl_BySource.Enabled = True
        '    'rbl_BySource.Items(0).Selected = True

        '    ddl_CustomerID.Enabled = False
        '    rbl_BySource.Enabled = False
        '    'ddlPart.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False

        '    'cb_ChartMerge.Checked = True
        '    'cb_ChartMerge.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_OL_ProcessShow.Items.Count = 0 Then
        '                ddl_CustomerID.Enabled = True
        '                rbl_BySource.Enabled = True
        '                'ddlPart.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                ddl_CustomerID.Enabled = False
        '                rbl_BySource.Enabled = False
        '                'ddlPart.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            ddl_CustomerID.Enabled = True
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            'ddlPart.Enabled = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_OL_ProcessShow.Items.Count = 0 Then
        '                ddl_CustomerID.Enabled = True
        '                rbl_BySource.Enabled = True
        '                'ddlPart.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                ddl_CustomerID.Enabled = False
        '                rbl_BySource.Enabled = False
        '                'ddlPart.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            ddl_CustomerID.Enabled = True
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            'ddlPart.Enabled = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    End If
        '    If ddl_CustomerID.Items.Count > 0 Then
        '        ddl_CustomerID.SelectedIndex = 0
        '    End If
        '    'If ddlPart.Items.Count > 0 Then
        '    '    ddlPart.SelectedIndex = 0
        '    'End If
        'End If

        ListBoxSort(listB_OL_ProcessSource, False)
        ListBoxSort(listB_OL_ProcessShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ' --- Customer ID (廠商) ---
        If IsRename = False Then
            sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        Else
            sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        End If
        sqlStr += "and a.yield_function=1 "
        ' --- Product Type ---
        sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            Else
                If strBumpingType <> "" Then
                    sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                End If
            End If
        End If
        sqlStr += "group by a.customer_id order by a.customer_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillController(myDT, ddl_CustomerID, 1)

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            'If strBumpingType <> "" Then
            '    sqlStr += "and Bumping_Type IN(" + strBumpingType + ") "
            'End If
            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                End If
            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                If strBumpingType <> "" AndAlso strBackend <> "" Then
                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                End If
            Else
                If strBumpingType <> "" Then
                    sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        'sqlStr += "and production_id <> '' "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            'If Not IsDBNull(myDT.Rows(0)(0)) Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                'UtilObj.FillController(myDT, ddlPart, 0)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    'If strBumpingType <> "" Then
                    '    sqlStr += "and Bumping_Type IN(" + strBumpingType + ") "
                    'End If
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True AndAlso listB_OL_ProcessShow.Items.Count > 0 Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                'If strBumpingType <> "" Then
                '    sqlStr += "and Bumping_Type IN(" + strBumpingType + ") "
                'End If
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Protected Sub but_BackendRightAll_Click(sender As Object, e As System.EventArgs) Handles but_BackendRightAll.Click
        moveListAll(listB_BackendSource, listB_BackendShow)

        'If listB_BackendSource.Items.Count = 0 Then
        '    'ddl_CustomerID.Enabled = True
        '    'ddlPart.Enabled = True
        '    'rbl_BySource.Enabled = True
        '    'rbl_BySource.Items(0).Selected = True

        '    ddl_CustomerID.Enabled = False
        '    rbl_BySource.Enabled = False
        '    'ddlPart.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False

        '    'cb_ChartMerge.Checked = True
        '    'cb_ChartMerge.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_BackendShow.Items.Count = 0 Then
        '                'ddl_CustomerID.Enabled = True
        '                'rbl_BySource.Enabled = True
        '                ''ddlPart.Enabled = True
        '                'listB_PartSource.Enabled = True
        '                'listB_PartShow.Enabled = True
        '                'but_PartRight.Enabled = True
        '                'but_PartLeft.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                'ddl_CustomerID.Enabled = False
        '                'rbl_BySource.Enabled = False
        '                ''ddlPart.Enabled = False
        '                'listB_PartSource.Enabled = False
        '                'listB_PartShow.Enabled = False
        '                'but_PartRight.Enabled = False
        '                'but_PartLeft.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            'ddl_CustomerID.Enabled = True
        '            'rbl_BySource.Enabled = True
        '            'rbl_BySource.Items(0).Selected = True
        '            ''ddlPart.Enabled = True
        '            'listB_PartSource.Enabled = True
        '            'listB_PartShow.Enabled = True
        '            'but_PartRight.Enabled = True
        '            'but_PartLeft.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_BackendShow.Items.Count = 0 Then
        '                'ddl_CustomerID.Enabled = True
        '                'rbl_BySource.Enabled = True
        '                ''ddlPart.Enabled = True
        '                'listB_PartSource.Enabled = True
        '                'listB_PartShow.Enabled = True
        '                'but_PartRight.Enabled = True
        '                'but_PartLeft.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                'ddl_CustomerID.Enabled = False
        '                'rbl_BySource.Enabled = False
        '                ''ddlPart.Enabled = False
        '                'listB_PartSource.Enabled = False
        '                'listB_PartShow.Enabled = False
        '                'but_PartRight.Enabled = False
        '                'but_PartLeft.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            'ddl_CustomerID.Enabled = True
        '            'rbl_BySource.Enabled = True
        '            'rbl_BySource.Items(0).Selected = True
        '            ''ddlPart.Enabled = True
        '            'listB_PartSource.Enabled = True
        '            'listB_PartShow.Enabled = True
        '            'but_PartRight.Enabled = True
        '            'but_PartLeft.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    End If
        '    If ddl_CustomerID.Items.Count > 0 Then
        '        ddl_CustomerID.SelectedIndex = 0
        '    End If
        '    'If ddlPart.Items.Count > 0 Then
        '    '    ddlPart.SelectedIndex = 0
        '    'End If
        'End If

        ListBoxSort(listB_BackendSource, False)
        ListBoxSort(listB_BackendShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ' --- Customer ID (廠商) ---
        If IsRename = False Then
            sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        Else
            sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        End If
        sqlStr += "and a.yield_function=1 "
        ' --- Product Type ---
        sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True  Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        sqlStr += "group by a.customer_id order by a.customer_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillController(myDT, ddl_CustomerID, 1)

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True  Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        'sqlStr += "and production_id <> '' "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            'If Not IsDBNull(myDT.Rows(0)(0)) Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                'UtilObj.FillController(myDT, ddlPart, 0)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True  Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True  Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Protected Sub but_BackendLeftAll_Click(sender As Object, e As System.EventArgs) Handles but_BackendLeftAll.Click
        moveListAll(listB_BackendShow, listB_BackendSource)

        'If listB_BackendSource.Items.Count = 0 Then
        '    'ddl_CustomerID.Enabled = True
        '    'ddlPart.Enabled = True
        '    'rbl_BySource.Enabled = True
        '    'rbl_BySource.Items(0).Selected = True

        '    ddl_CustomerID.Enabled = False
        '    rbl_BySource.Enabled = False
        '    'ddlPart.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False

        '    'cb_ChartMerge.Checked = True
        '    'cb_ChartMerge.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_BackendShow.Items.Count = 0 Then
        '                ddl_CustomerID.Enabled = True
        '                rbl_BySource.Enabled = True
        '                'ddlPart.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                ddl_CustomerID.Enabled = False
        '                rbl_BySource.Enabled = False
        '                'ddlPart.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            ddl_CustomerID.Enabled = True
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            'ddlPart.Enabled = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_BackendShow.Items.Count = 0 Then
        '                ddl_CustomerID.Enabled = True
        '                rbl_BySource.Enabled = True
        '                'ddlPart.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = True
        '            Else
        '                ddl_CustomerID.Enabled = False
        '                rbl_BySource.Enabled = False
        '                'ddlPart.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False

        '                'cb_ChartMerge.Checked = True
        '                'cb_ChartMerge.Enabled = False
        '            End If
        '        Else
        '            ddl_CustomerID.Enabled = True
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            'ddlPart.Enabled = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True

        '            'cb_ChartMerge.Checked = True
        '            'cb_ChartMerge.Enabled = True
        '        End If
        '    End If
        '    If ddl_CustomerID.Items.Count > 0 Then
        '        ddl_CustomerID.SelectedIndex = 0
        '    End If
        '    'If ddlPart.Items.Count > 0 Then
        '    '    ddlPart.SelectedIndex = 0
        '    'End If
        'End If

        ListBoxSort(listB_BackendSource, False)
        ListBoxSort(listB_BackendShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ' --- Customer ID (廠商) ---
        If IsRename = False Then
            sqlStr = "select a.customer_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        Else
            sqlStr = "select a.customer_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where (a.customer_id is not null and a.customer_id <> '') "
        End If
        sqlStr += "and a.yield_function=1 "
        ' --- Product Type ---
        sqlStr += "and a.category = '" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True  Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        sqlStr += "group by a.customer_id order by a.customer_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillController(myDT, ddl_CustomerID, 1)

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True  Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        'sqlStr += "and production_id <> '' "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            'If Not IsDBNull(myDT.Rows(0)(0)) Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                'UtilObj.FillController(myDT, ddlPart, 0)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True  Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True  Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Protected Sub but_CustomerIDRightAll_Click(sender As Object, e As System.EventArgs) Handles but_CustomerIDRightAll.Click
        Try
            moveListAll(listB_CustomerIDSource, listB_CustomerIDShow)

            'If listB_CustomerIDSource.Items.Count = 0 Then
            '    rbl_BySource.Enabled = False
            '    listB_PartSource.Enabled = False
            '    listB_PartShow.Enabled = False
            '    but_PartRight.Enabled = False
            '    but_PartLeft.Enabled = False
            '    '================
            '    'Customer開放複選
            '    '================
            '    but_PartRightAll.Enabled = False
            '    but_PartLeftAll.Enabled = False
            'Else
            '    If IsRename = False Then
            '        If ddl_ProductType.Text = sWB Then
            '            If listB_CustomerIDShow.Items.Count = 0 Then

            '            Else

            '            End If
            '        Else

            '        End If
            '    Else
            '        If ddl_ProductType.Text = sWB_Rename Then
            '            If listB_CustomerIDShow.Items.Count = 0 Then

            '            Else

            '            End If
            '        Else

            '        End If
            '    End If
            'End If

            ListBoxSort(listB_CustomerIDSource, False)
            ListBoxSort(listB_CustomerIDShow, False)

            Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
            Dim sqlStr As String = ""
            Dim myDT As DataTable
            Dim myAdapter As SqlDataAdapter
            Dim BKMSql As String = "and BKM='N' "
            Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

            ddl_YieldMode.Items.Clear()
            If ddl_CustomerID.SelectedValue = "INTEL" Then
                ddl_YieldMode.Items.Add("By Fail Mode")
                ddl_YieldMode.Items.Add("By BKM")
                If ddl_YieldMode.SelectedIndex = 1 Then
                    BKMSql = "and BKM='Y' "
                End If
            ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
                ddl_YieldMode.Items.Add("By Fail Mode")
                ddl_YieldMode.Items.Add("By Station")
                If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                    AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
                End If
            ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
                ddl_YieldMode.Items.Add("By Fail Mode")
                ddl_YieldMode.Items.Add("By Station")
                If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                    AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
                End If
            Else
                If IsRename = False Then
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                        ddl_YieldMode.Items.Add("By Fail Mode")
                    Else
                        ddl_YieldMode.Items.Add("By Station")
                    End If
                Else
                    If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                        ddl_YieldMode.Items.Add("By Fail Mode")
                    Else
                        ddl_YieldMode.Items.Add("By Station")
                    End If
                End If
            End If

            ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
            If IsRename = False Then
                sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True  Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.production_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)

            ' --- Group ---
            If myDT.Rows.Count > 0 Then
                'If Not IsDBNull(myDT.Rows(0)(0)) Then
                If myDT.Rows(0)(0).ToString() <> "" Then
                    ' 有就秀 Group
                    rbl_BySource.SelectedIndex = 0
                    'UtilObj.FillController(myDT, ddlPart, 0)
                    listB_PartSource.Items.Clear()
                    listB_PartShow.Items.Clear()
                    For i As Integer = 0 To myDT.Rows.Count - 1
                        listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                    Next
                Else
                    ' 轉向 Part ID
                    rbl_BySource.SelectedIndex = 1
                    rbl_BySource.Items(0).Enabled = False
                    'If IsRename = False Then
                    '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                    'Else
                    '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                    'End If
                    If IsRename = False Then
                        sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                    Else
                        sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                    End If
                    ' --- Product Type ---
                    sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                    If tr_BumpingType.Visible = True  Then
                        ' --- Bumping Type ---
                        Dim strBumpingType As String = ""
                        For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                            If n = 0 Then
                                strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                            Else
                                strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                            End If
                        Next
                        ' --- OL_Process ---
                        Dim strOL_Process As String = ""
                        For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                            If n = 0 Then
                                strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                            Else
                                strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                            End If
                        Next
                        ' --- Backend ---
                        Dim strBackend As String = ""
                        For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                            If n = 0 Then
                                strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                            Else
                                strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                            End If
                        Next
                        If listB_BumpingTypeShow.Items.Count > 0 Then
                            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            Else
                                If strBumpingType <> "" Then
                                    sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                                End If
                            End If
                        Else
                            If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                                If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                    sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                                End If
                            ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                                If strBumpingType <> "" AndAlso strBackend <> "" Then
                                    sqlStr += "and b.Backend IN(" + strBackend + ") "
                                End If
                            End If
                        End If
                    End If
                    '================
                    'Customer開放複選
                    '================
                    If ddl_ProductType.Text <> sWB_Rename Then
                        If ddl_CustomerID.Text <> "All" Then
                            ' --- Customer ID ---
                            If ddl_CustomerID.SelectedValue <> "" Then
                                sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                            End If
                        End If
                    Else
                        Dim strCustomerID As String = ""
                        For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                            If n = 0 Then
                                strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                            Else
                                strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                            End If
                        Next
                        If strCustomerID <> "" Then
                            sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                        End If
                    End If
                    sqlStr += "and a.yield_function=1 "
                    sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                    myAdapter = New SqlDataAdapter(sqlStr, conn)
                    myAdapter.SelectCommand.CommandTimeout = 3600
                    myDT = New DataTable
                    myAdapter.Fill(myDT)
                    'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                    listB_PartSource.Items.Clear()
                    listB_PartShow.Items.Clear()
                    For i As Integer = 0 To myDT.Rows.Count - 1
                        listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                    Next
                End If
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True  Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If

            ' --- Yield Item ---
            'sqlStr = "select yield_category, SEQ "
            sqlStr = "select yield_category "
            If IsRename = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping "
            Else
                If IsRenameOrder = False Then
                    sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
                Else
                    sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
                End If
            End If
            sqlStr += "where 1=1 "
            ' --- Product Type ---
            sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    If ddl_CustomerID.Text = "INTEL" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    Else
                        ' --- Customer ID ---
                        sqlStr += "and customer_id ='All' "
                    End If
                End If
            Else
                If IsRenameOrder = False Then
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and customer_id IN(" + strCustomerID + ") "
                    End If
                End If
            End If
            sqlStr += "and SEQ != 1 "
            If IsRenameOrder = False Then
                sqlStr += BKMSql
                sqlStr += AMD_FAILMODESql
            Else
                If ddl_YieldMode.Text = "By Fail Mode" Then
                    sqlStr += "and Yield_Mode = 'FailMode' "
                ElseIf ddl_YieldMode.Text = "By Station" Then
                    sqlStr += "and Yield_Mode = 'Station' "
                ElseIf ddl_YieldMode.Text = "By BKM" Then
                    sqlStr += "and Yield_Mode = 'BKM' "
                End If
            End If
            'sqlStr += "group by yield_category, SEQ order by SEQ"
            'sqlStr += "group by yield_category order by yield_category"
            sqlStr += "group by SEQ, yield_category order by SEQ"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

            ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
            Dim addIndex As Integer = 0
            Dim gItem(myDT.Rows.Count) As String
            gItem(addIndex) = "LotCount"
            addIndex += 1
            For i As Integer = 0 To (myDT.Rows.Count - 1)
                gItem(addIndex) = myDT.Rows(i)(0)
                addIndex += 1
            Next
            ViewState("CPU_gItem") = gItem
            conn.Close()

            rb_DataTimeCustor_SelectedIndexChanged(sender, e)
        Catch ex As Exception
            Dim sError As String = ex.ToString()
        End Try
    End Sub

    Protected Sub but_CustomerIDLeftAll_Click(sender As Object, e As System.EventArgs) Handles but_CustomerIDLeftAll.Click
        moveListAll(listB_CustomerIDShow, listB_CustomerIDSource)

        'If listB_CustomerIDSource.Items.Count = 0 Then
        '    rbl_BySource.Enabled = False
        '    listB_PartSource.Enabled = False
        '    listB_PartShow.Enabled = False
        '    but_PartRight.Enabled = False
        '    but_PartLeft.Enabled = False
        '    '================
        '    'Customer開放複選
        '    '================
        '    but_PartRightAll.Enabled = False
        '    but_PartLeftAll.Enabled = False
        'Else
        '    If IsRename = False Then
        '        If ddl_ProductType.Text = sWB Then
        '            If listB_CustomerIDShow.Items.Count = 0 Then
        '                rbl_BySource.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True
        '            Else
        '                rbl_BySource.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False
        '            End If
        '        Else
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True
        '        End If
        '    Else
        '        If ddl_ProductType.Text = sWB_Rename Then
        '            If listB_CustomerIDShow.Items.Count = 0 Then
        '                rbl_BySource.Enabled = True
        '                listB_PartSource.Enabled = True
        '                listB_PartShow.Enabled = True
        '                but_PartRight.Enabled = True
        '                but_PartLeft.Enabled = True
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = True
        '                but_PartLeftAll.Enabled = True
        '            Else
        '                rbl_BySource.Enabled = False
        '                listB_PartSource.Enabled = False
        '                listB_PartShow.Enabled = False
        '                but_PartRight.Enabled = False
        '                but_PartLeft.Enabled = False
        '                '================
        '                'Customer開放複選
        '                '================
        '                but_PartRightAll.Enabled = False
        '                but_PartLeftAll.Enabled = False
        '            End If
        '        Else
        '            rbl_BySource.Enabled = True
        '            rbl_BySource.Items(0).Selected = True
        '            listB_PartSource.Enabled = True
        '            listB_PartShow.Enabled = True
        '            but_PartRight.Enabled = True
        '            but_PartLeft.Enabled = True
        '            '================
        '            'Customer開放複選
        '            '================
        '            but_PartRightAll.Enabled = True
        '            but_PartLeftAll.Enabled = True
        '        End If
        '    End If
        'End If

        ListBoxSort(listB_CustomerIDSource, False)
        ListBoxSort(listB_CustomerIDShow, False)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "

        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        ' --- 檢查有無 Group Part, 沒有就呈現 Part ID ---
        'If IsRename = False Then
        '    sqlStr = "select production_id from " + confTable + " where 1=1 "
        'Else
        '    sqlStr = "select production_id from " + confTableRename + " where 1=1 "
        'End If
        If IsRename = False Then
            sqlStr = "select a.production_id from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        Else
            sqlStr = "select a.production_id from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
        End If
        ' --- Product Type ---
        sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
        If tr_BumpingType.Visible = True  Then
            ' --- Bumping Type ---
            Dim strBumpingType As String = ""
            For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                If n = 0 Then
                    strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                Else
                    strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                End If
            Next
            ' --- OL_Process ---
            Dim strOL_Process As String = ""
            For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                If n = 0 Then
                    strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                Else
                    strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                End If
            Next
            ' --- Backend ---
            Dim strBackend As String = ""
            For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                If n = 0 Then
                    strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                Else
                    strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                End If
            Next
            If listB_BumpingTypeShow.Items.Count > 0 Then
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                Else
                    If strBumpingType <> "" Then
                        sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                    End If
                End If
            Else
                If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                    If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                        sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                    End If
                ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                    If strBumpingType <> "" AndAlso strBackend <> "" Then
                        sqlStr += "and b.Backend IN(" + strBackend + ") "
                    End If
                End If
            End If
        End If
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                ' --- Customer ID ---
                If ddl_CustomerID.SelectedValue <> "" Then
                    sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                End If
            End If
        Else
            Dim strCustomerID As String = ""
            For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                If n = 0 Then
                    strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                Else
                    strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                End If
            Next
            If strCustomerID <> "" Then
                sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
            End If
        End If
        sqlStr += "and a.yield_function=1 "
        'sqlStr += "and production_id <> '' "
        sqlStr += "group by a.production_id"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)

        ' --- Group ---
        If myDT.Rows.Count > 0 Then
            'If Not IsDBNull(myDT.Rows(0)(0)) Then
            If myDT.Rows(0)(0).ToString() <> "" Then
                ' 有就秀 Group
                rbl_BySource.SelectedIndex = 0
                'UtilObj.FillController(myDT, ddlPart, 0)
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("production_id").ToString())
                Next
            Else
                ' 轉向 Part ID
                rbl_BySource.SelectedIndex = 1
                rbl_BySource.Items(0).Enabled = False
                'If IsRename = False Then
                '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
                'Else
                '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
                'End If
                If IsRename = False Then
                    sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                Else
                    sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
                End If
                ' --- Product Type ---
                sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
                If tr_BumpingType.Visible = True  Then
                    ' --- Bumping Type ---
                    Dim strBumpingType As String = ""
                    For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                        If n = 0 Then
                            strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        Else
                            strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- OL_Process ---
                    Dim strOL_Process As String = ""
                    For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                        If n = 0 Then
                            strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        Else
                            strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                        End If
                    Next
                    ' --- Backend ---
                    Dim strBackend As String = ""
                    For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                        If n = 0 Then
                            strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                        Else
                            strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                        End If
                    Next
                    If listB_BumpingTypeShow.Items.Count > 0 Then
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        Else
                            If strBumpingType <> "" Then
                                sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                            End If
                        End If
                    Else
                        If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                            If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                                sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                            End If
                        ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                            If strBumpingType <> "" AndAlso strBackend <> "" Then
                                sqlStr += "and b.Backend IN(" + strBackend + ") "
                            End If
                        End If
                    End If
                End If
                '================
                'Customer開放複選
                '================
                If ddl_ProductType.Text <> sWB_Rename Then
                    If ddl_CustomerID.Text <> "All" Then
                        ' --- Customer ID ---
                        If ddl_CustomerID.SelectedValue <> "" Then
                            sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                        End If
                    End If
                Else
                    Dim strCustomerID As String = ""
                    For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                        If n = 0 Then
                            strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                        Else
                            strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                        End If
                    Next
                    If strCustomerID <> "" Then
                        sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                    End If
                End If
                sqlStr += "and a.yield_function=1 "
                sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
                listB_PartSource.Items.Clear()
                listB_PartShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
                Next
            End If
        Else
            ' 轉向 Part ID
            rbl_BySource.SelectedIndex = 1
            rbl_BySource.Items(0).Enabled = False
            'If IsRename = False Then
            '    sqlStr = "select Part_id, Memo from " + confTable + " where 1=1 "
            'Else
            '    sqlStr = "select Part_id, Memo from " + confTableRename + " where 1=1 "
            'End If
            If IsRename = False Then
                sqlStr = "select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            Else
                sqlStr = "select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where 1=1 "
            End If
            ' --- Product Type ---
            sqlStr += "and a.category ='" + ddl_ProductType.SelectedValue + "' "
            If tr_BumpingType.Visible = True  Then
                ' --- Bumping Type ---
                Dim strBumpingType As String = ""
                For n As Integer = 0 To (listB_BumpingTypeShow.Items.Count - 1)
                    If n = 0 Then
                        strBumpingType += "'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    Else
                        strBumpingType += ",'" & listB_BumpingTypeShow.Items(n).Text & "'"
                    End If
                Next
                ' --- OL_Process ---
                Dim strOL_Process As String = ""
                For n As Integer = 0 To (listB_OL_ProcessShow.Items.Count - 1)
                    If n = 0 Then
                        strOL_Process += "'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    Else
                        strOL_Process += ",'" & listB_OL_ProcessShow.Items(n).Text & "'"
                    End If
                Next
                ' --- Backend ---
                Dim strBackend As String = ""
                For n As Integer = 0 To (listB_BackendShow.Items.Count - 1)
                    If n = 0 Then
                        strBackend += "'" & listB_BackendShow.Items(n).Text & "'"
                    Else
                        strBackend += ",'" & listB_BackendShow.Items(n).Text & "'"
                    End If
                Next
                If listB_BumpingTypeShow.Items.Count > 0 Then
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.OL_Process IN(" + strOL_Process + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (a.Bumping_Type IN(" + strBumpingType + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    Else
                        If strBumpingType <> "" Then
                            sqlStr += "and a.Bumping_Type IN(" + strBumpingType + ") "
                        End If
                    End If
                Else
                    If listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and (b.OL_Process IN(" + strOL_Process + ") OR b.Backend IN(" + strBackend + ")) "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count > 0 AndAlso listB_BackendShow.Items.Count = 0 Then
                        If strBumpingType <> "" AndAlso strOL_Process <> "" Then
                            sqlStr += "and b.OL_Process IN(" + strOL_Process + ") "
                        End If
                    ElseIf listB_OL_ProcessShow.Items.Count = 0 AndAlso listB_BackendShow.Items.Count > 0 Then
                        If strBumpingType <> "" AndAlso strBackend <> "" Then
                            sqlStr += "and b.Backend IN(" + strBackend + ") "
                        End If
                    End If
                End If
            End If
            '================
            'Customer開放複選
            '================
            If ddl_ProductType.Text <> sWB_Rename Then
                If ddl_CustomerID.Text <> "All" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and a.customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                End If
            Else
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
            sqlStr += "and a.yield_function=1 "
            sqlStr += "group by a.Part_id, a.Memo order by a.Part_id"
            myAdapter = New SqlDataAdapter(sqlStr, conn)
            myAdapter.SelectCommand.CommandTimeout = 3600
            myDT = New DataTable
            myAdapter.Fill(myDT)
            'UtilObj.FillController(myDT, ddlPart, 1, "Part_id", "Memo")
            listB_PartSource.Items.Clear()
            listB_PartShow.Items.Clear()
            For i As Integer = 0 To myDT.Rows.Count - 1
                listB_PartSource.Items.Add(myDT.Rows(i)("Part_id").ToString())
            Next
        End If

        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and a.customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        rb_DataTimeCustor_SelectedIndexChanged(sender, e)
    End Sub

    Protected Sub but_PartRightAll_Click(sender As Object, e As System.EventArgs) Handles but_PartRightAll.Click
        moveListAll(listB_PartSource, listB_PartShow)
        'If ddl_ProductType.Text = "WB" Then
        '    If listB_BumpingTypeShow.Items.Count = 0 Then
        '        cb_ChartMerge.Checked = True
        '        cb_ChartMerge.Enabled = True
        '    Else
        '        cb_ChartMerge.Checked = True
        '        cb_ChartMerge.Enabled = False
        '    End If
        'Else
        '    cb_ChartMerge.Checked = True
        '    cb_ChartMerge.Enabled = True
        'End If

        ListBoxSort(listB_PartSource, False)
        ListBoxSort(listB_PartShow, False)
        rb_DataTimeCustor_SelectedIndexChanged(sender, e)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim tableStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim categoryStr As String = ""
        tr_gvDisplay.Visible = False

        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "
        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        conn.Open()
        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        lb_weekSource.Items.Clear()
        lb_weekShow.Items.Clear()
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        If ddl_ProductType.Text = "CS" ORELSE ddl_ProductType.Text = "CPU" Then
            rb_BE_SelectedIndexChanged(sender, e)
            rb_FE_SelectedIndexChanged(sender, e)
        End If
    End Sub

    Protected Sub but_PartLeftAll_Click(sender As Object, e As System.EventArgs) Handles but_PartLeftAll.Click
        moveListAll(listB_PartShow, listB_PartSource)
        'If ddl_ProductType.Text = "WB" Then
        '    If listB_BumpingTypeShow.Items.Count = 0 Then
        '        cb_ChartMerge.Checked = True
        '        cb_ChartMerge.Enabled = True
        '    Else
        '        cb_ChartMerge.Checked = True
        '        cb_ChartMerge.Enabled = False
        '    End If
        'Else
        '    cb_ChartMerge.Checked = True
        '    cb_ChartMerge.Enabled = True
        'End If

        ListBoxSort(listB_PartSource, False)
        ListBoxSort(listB_PartShow, False)
        rb_DataTimeCustor_SelectedIndexChanged(sender, e)

        Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
        Dim sqlStr As String = ""
        Dim tableStr As String = ""
        Dim myDT As DataTable
        Dim myAdapter As SqlDataAdapter
        Dim categoryStr As String = ""
        tr_gvDisplay.Visible = False

        Dim BKMSql As String = "and BKM='N' "
        Dim AMD_FAILMODESql As String = "and AMD_FAILMODE='N' "
        ddl_YieldMode.Items.Clear()
        If ddl_CustomerID.SelectedValue = "INTEL" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By BKM")
            If ddl_YieldMode.SelectedIndex = 1 Then
                BKMSql = "and BKM='Y' "
            End If
        ElseIf ddl_CustomerID.SelectedValue = "AMD" OrElse ddl_CustomerID.SelectedValue = "NVD" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        ElseIf ddl_ProductType.Text = "CS" AndAlso ddl_CustomerID.SelectedValue = "BCM" Then
            ddl_YieldMode.Items.Add("By Fail Mode")
            ddl_YieldMode.Items.Add("By Station")
            If ddl_YieldMode.SelectedIndex = 1 = 0 Then
                AMD_FAILMODESql = "and AMD_FAILMODE='Y' "
            End If
        Else
            If IsRename = False Then
                If ddl_ProductType.SelectedValue.ToUpper() = sWB Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            Else
                If ddl_ProductType.SelectedValue.ToUpper() = sWB_Rename Then
                    ddl_YieldMode.Items.Add("By Fail Mode")
                Else
                    ddl_YieldMode.Items.Add("By Station")
                End If
            End If
        End If

        conn.Open()
        ' --- Yield Item ---
        'sqlStr = "select yield_category, SEQ "
        sqlStr = "select yield_category "
        If IsRename = False Then
            sqlStr += "from dbo.Yield_CATEGORY_Mapping "
        Else
            If IsRenameOrder = False Then
                sqlStr += "from dbo.Yield_CATEGORY_Mapping_BU_Rename "
            Else
                sqlStr += "from dbo.Yield_CATEGORY_Order_Mapping "
            End If
        End If
        sqlStr += "where 1=1 "
        ' --- Product Type ---
        sqlStr += "and yield_type ='" + ddl_ProductType.SelectedValue + "' "
        '================
        'Customer開放複選
        '================
        If ddl_ProductType.Text <> sWB_Rename Then
            If ddl_CustomerID.Text <> "All" Then
                If ddl_CustomerID.Text = "INTEL" Then
                    ' --- Customer ID ---
                    If ddl_CustomerID.SelectedValue <> "" Then
                        sqlStr += "and customer_id ='" + ddl_CustomerID.SelectedValue + "' "
                    End If
                Else
                    ' --- Customer ID ---
                    sqlStr += "and customer_id ='All' "
                End If
            End If
        Else
            If IsRenameOrder = False Then
                Dim strCustomerID As String = ""
                For n As Integer = 0 To (listB_CustomerIDShow.Items.Count - 1)
                    If n = 0 Then
                        strCustomerID += "'" & listB_CustomerIDShow.Items(n).Text & "'"
                    Else
                        strCustomerID += ",'" & listB_CustomerIDShow.Items(n).Text & "'"
                    End If
                Next
                If strCustomerID <> "" Then
                    sqlStr += "and customer_id IN(" + strCustomerID + ") "
                End If
            End If
        End If
        sqlStr += "and SEQ != 1 "
        If IsRenameOrder = False Then
            sqlStr += BKMSql
            sqlStr += AMD_FAILMODESql
        Else
            If ddl_YieldMode.Text = "By Fail Mode" Then
                sqlStr += "and Yield_Mode = 'FailMode' "
            ElseIf ddl_YieldMode.Text = "By Station" Then
                sqlStr += "and Yield_Mode = 'Station' "
            ElseIf ddl_YieldMode.Text = "By BKM" Then
                sqlStr += "and Yield_Mode = 'BKM' "
            End If
        End If
        'sqlStr += "group by yield_category, SEQ order by SEQ"
        'sqlStr += "group by yield_category order by yield_category"
        sqlStr += "group by SEQ, yield_category order by SEQ"
        myAdapter = New SqlDataAdapter(sqlStr, conn)
        myAdapter.SelectCommand.CommandTimeout = 3600
        myDT = New DataTable
        myAdapter.Fill(myDT)
        lb_weekSource.Items.Clear()
        lb_weekShow.Items.Clear()
        UtilObj.FillLitsBoxController(myDT, lb_weekSource, 0)

        ' 加入 LotCount -- 不可變動, DataTable 呈現的資料由此而來
        Dim addIndex As Integer = 0
        Dim gItem(myDT.Rows.Count) As String
        gItem(addIndex) = "LotCount"
        addIndex += 1
        For i As Integer = 0 To (myDT.Rows.Count - 1)
            gItem(addIndex) = myDT.Rows(i)(0)
            addIndex += 1
        Next
        ViewState("CPU_gItem") = gItem
        conn.Close()

        If ddl_ProductType.Text = "CS" ORELSE ddl_ProductType.Text = "CPU" Then
            rb_BE_SelectedIndexChanged(sender, e)
            rb_FE_SelectedIndexChanged(sender, e)
        End If
    End Sub

    Protected Sub but_dateRight0_Click(sender As Object, e As System.EventArgs) Handles but_dateRightAll.Click
        moveListAll(listB_timeSource, listB_timeShow)

        ListBoxSort(listB_timeSource, True)
        ListBoxSort(listB_timeShow, True)
    End Sub

    Protected Sub but_dateLeft0_Click(sender As Object, e As System.EventArgs) Handles but_dateLeftAll.Click
        moveListAll(listB_timeShow, listB_timeSource)

        ListBoxSort(listB_timeSource, True)
        ListBoxSort(listB_timeShow, True)
    End Sub

    Protected Sub but_weekTo0_Click(sender As Object, e As System.EventArgs) Handles but_weekToAll.Click

        tr_chartDisplay.Visible = False
        tr_gvDisplay.Visible = False
        tb_uploadLot.Visible = False
        Dim sourceAry As ArrayList = New ArrayList
        Dim DestAry As ArrayList = New ArrayList
        For i As Integer = 0 To (lb_weekSource.Items.Count - 1)

            'If ddlPart.SelectedValue = "All" Then
            If (listB_PartSource.Items.Count = 0 AndAlso listB_PartShow.Items.Count > 0) Then
                'If ddl_BumpingType.Enabled = False Then
                '    If lb_weekSource.Items(i).Value.ToUpper() = "TOTAL YIELD" Or lb_weekSource.Items(i).Value.ToUpper() = "TOTAL" Then
                '        DestAry.Add(lb_weekSource.Items(i).Value)
                '    Else
                '        sourceAry.Add(lb_weekSource.Items(i).Value)
                '    End If
                'Else
                '    If lb_weekSource.Items(i).Selected Then
                '        DestAry.Add(lb_weekSource.Items(i).Value)
                '    Else
                '        sourceAry.Add(lb_weekSource.Items(i).Value)
                '    End If
                'End If
                If listB_BumpingTypeShow.Enabled = False Then
                    If lb_weekSource.Items(i).Value.ToUpper() = "TOTAL YIELD" Or lb_weekSource.Items(i).Value.ToUpper() = "TOTAL" Then
                        DestAry.Add(lb_weekSource.Items(i).Value)
                    Else
                        sourceAry.Add(lb_weekSource.Items(i).Value)
                    End If
                Else
                    'If lb_weekSource.Items(i).Selected Then
                    DestAry.Add(lb_weekSource.Items(i).Value)
                    'Else
                    'sourceAry.Add(lb_weekSource.Items(i).Value)
                    'End If
                End If
            Else
                'If lb_weekSource.Items(i).Selected Then
                DestAry.Add(lb_weekSource.Items(i).Value)
                'Else
                '    sourceAry.Add(lb_weekSource.Items(i).Value)
                'End If
            End If

        Next

        lb_weekSource.Items.Clear()

        For i As Integer = 0 To (sourceAry.Count - 1)
            lb_weekSource.Items.Add(sourceAry(i).ToString())
        Next

        For i As Integer = 0 To (DestAry.Count - 1)
            lb_weekShow.Items.Add(DestAry(i).ToString())
        Next

        ListBoxSort(lb_weekSource, False)
        ListBoxSort(lb_weekShow, False)
    End Sub

    Protected Sub but_weekBack0_Click(sender As Object, e As System.EventArgs) Handles but_weekBackAll.Click
        tr_chartDisplay.Visible = False
        tr_gvDisplay.Visible = False
        tb_uploadLot.Visible = False
        Dim sourceAry As ArrayList = New ArrayList
        Dim DestAry As ArrayList = New ArrayList
        For i As Integer = 0 To (lb_weekShow.Items.Count - 1)
            'If lb_weekShow.Items(i).Selected Then
            DestAry.Add(lb_weekShow.Items(i).Value)
            'Else
            '    sourceAry.Add(lb_weekShow.Items(i).Value)
            'End If
        Next

        lb_weekShow.Items.Clear()

        For i As Integer = 0 To (sourceAry.Count - 1)
            lb_weekShow.Items.Add(sourceAry(i).ToString())
        Next

        For i As Integer = 0 To (DestAry.Count - 1)
            lb_weekSource.Items.Add(DestAry(i).ToString())
        Next

        ListBoxSort(lb_weekSource, False)
        ListBoxSort(lb_weekShow, False)
    End Sub

    Protected Sub cb_ChartMerge0_CheckedChanged(sender As Object, e As System.EventArgs) Handles cb_ChartMerge0.CheckedChanged
        If cb_ChartMerge0.Checked = True Then
            cb_FinalYield.Checked = False
            cb_FinalYield.Visible = True

            'cb_SF.Checked = False
            'cb_SF.Visible = False
            'Else
            'cb_SF.Checked = False
            'cb_SF.Visible = True
        End If
    End Sub

    Protected Sub cb_FinalYield_CheckedChanged(sender As Object, e As System.EventArgs) Handles cb_FinalYield.CheckedChanged
        If cb_FinalYield.Checked = True Then
            cb_ChartMerge0.Checked = False
            cb_ChartMerge0.Visible = True

            'cb_SF.Checked = False
            'cb_SF.Visible = True
            'Else
            'cb_SF.Checked = True
            'cb_SF.Visible = True
        End If
    End Sub

    Protected Sub cb_SF_CheckedChanged(sender As Object, e As System.EventArgs) Handles cb_SF.CheckedChanged
        'If cb_SF.Checked = True Then
        '    cb_FinalYield.Checked = False
        'End If
    End Sub
    
    Protected Sub rb_FE_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles rb_FE.SelectedIndexChanged
        tr_FE.Visible = False
        If rb_FE.SelectedIndex = 1 Then
            tr_gvDisplay.Visible = False
            tr_FE.Visible = True

            ' 取得FE_Plant_Id
            Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
            Dim sqlStr As String = ""
            Dim tableStr As String = ""
            Dim myDT As DataTable
            Dim myAdapter As SqlDataAdapter
            Dim categoryStr As String = ""

            Try
                conn.Open()

                If IsRename = False Then
                    If ddl_ProductType.Text = sWB Then
                        If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                            If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                tableStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                            Else
                                tableStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                            End If
                        ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                                Else
                                    tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF where 1=1 "
                                Else
                                    tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                                End If
                            End If
                        End If
                    Else
                        If ddl_CustomerID.SelectedValue = "INTEL" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='INTEL' "
                            Else
                                tableStr += "from dbo.BKM_Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='AMD' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "NVD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='NVD' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "BCM" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='BCM' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        Else
                            tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                            tableStr += "where 1=1 "
                        End If
                    End If
                Else
                    If ddl_ProductType.Text = sWB_Rename Then
                        If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                            If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                tableStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                            Else
                                tableStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                            End If
                        ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                                Else
                                    tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF where 1=1 "
                                Else
                                    tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                                End If
                            End If
                        End If
                    Else
                        If ddl_CustomerID.SelectedValue = "INTEL" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='INTEL' "
                            Else
                                tableStr += "from dbo.BKM_Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='AMD' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "NVD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='NVD' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "BCM" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='BCM' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        Else
                            tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                            tableStr += "where 1=1 "
                        End If
                    End If
                End If

                Dim conditionStr As String = ""
                Dim sGetPartID As String = Get_PartID()
                If (rbl_BySource.SelectedIndex = 0) Then
                    ' --- Production ID ---
                    If rbl_BySource.Enabled = True Then
                        If sGetPartID <> "" Then
                            If IsRename = False Then
                                sqlStr = "and Part_Id in(select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                            Else
                                sqlStr = "and Part_Id in(select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                            End If
                        End If
                    End If
                Else
                    ' --- Part ID ---
                    If rbl_BySource.Enabled = True Then
                        If sGetPartID <> "" Then
                            'conditionStr += "and Part_Id='" + (Me.ddlPart.SelectedValue) + "' "
                            conditionStr += "and Part_Id in(" + sGetPartID + ") "
                        End If
                    End If
                End If

                sqlStr = "select FE_Plant_Id "
                sqlStr += tableStr
                tableStr += "and FE_Plant_Id <> '' "
                sqlStr += conditionStr
                sqlStr += "group by FE_Plant_Id "
                sqlStr += "order by FE_Plant_Id desc "

                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                conn.Close()

                listB_FESource.Items.Clear()
                listB_FEShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    If (myDT.Rows(i)("FE_Plant_Id").ToString().Trim() <> "") Then
                        listB_FESource.Items.Add(myDT.Rows(i)("FE_Plant_Id").ToString().Trim())
                    End If
                Next
            Catch ex As Exception
                Dim sError As String = ex.ToString()
            Finally
                If conn.State = ConnectionState.Open Then
                    conn.Close()
                End If
            End Try
        End If
    End Sub

    Protected Sub rb_BE_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles rb_BE.SelectedIndexChanged
        tr_BE.Visible = False
        If rb_BE.SelectedIndex = 1 Then
            tr_gvDisplay.Visible = False
            tr_BE.Visible = True

            ' 取得BE_Plant_Id
            Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("iSVRConnectionString").ToString)
            Dim sqlStr As String = ""
            Dim tableStr As String = ""
            Dim myDT As DataTable
            Dim myAdapter As SqlDataAdapter
            Dim categoryStr As String = ""

            Try
                conn.Open()

                If IsRename = False Then
                    If ddl_ProductType.Text = sWB Then
                        If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                            If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                tableStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                            Else
                                tableStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                            End If
                        ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                                Else
                                    tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF where 1=1 "
                                Else
                                    tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                                End If
                            End If
                        End If
                    Else
                        If ddl_CustomerID.SelectedValue = "INTEL" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='INTEL' "
                            Else
                                tableStr += "from dbo.BKM_Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='AMD' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "NVD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='NVD' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "BCM" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='BCM' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        Else
                            tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                            tableStr += "where 1=1 "
                        End If
                    End If
                Else
                    If ddl_ProductType.Text = sWB_Rename Then
                        If cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = True Then
                            If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                tableStr += "from dbo.vw_wb_Yield_Daily_RawData_SF where 1=1 "
                            Else
                                tableStr += "from dbo.wb_Yield_Daily_RawData where 1=1 "
                            End If
                        ElseIf cb_ChartMerge0.Visible = True AndAlso cb_ChartMerge0.Checked = False Then
                            If cb_FinalYield.Checked = False Then
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_SF where 1=1 "
                                Else
                                    tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge where 1=1 "
                                End If
                            Else
                                If cb_SF.Visible = True AndAlso cb_SF.Checked = True Then
                                    tableStr += "from dbo.vw_WB_Yield_Daily_RawData_NotMerge_Storage_SF where 1=1 "
                                Else
                                    tableStr += "from dbo.WB_Yield_Daily_RawData_NotMerge_Storage where 1=1 "
                                End If
                            End If
                        End If
                    Else
                        If ddl_CustomerID.SelectedValue = "INTEL" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='INTEL' "
                            Else
                                tableStr += "from dbo.BKM_Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "AMD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='AMD' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "NVD" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='NVD' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        ElseIf ddl_CustomerID.SelectedValue = "BCM" Then
                            If ddl_YieldMode.SelectedValue.ToUpper() = "BY FAIL MODE" Then
                                tableStr += "from dbo.Yield_Daily_RawData "
                                tableStr += "where 1=1 "
                                tableStr += "and customer_id='BCM' "
                            Else
                                tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                                tableStr += "where 1=1 "
                            End If
                        Else
                            tableStr += "from dbo.Yield_Daily_RawData_NonIntel "
                            tableStr += "where 1=1 "
                        End If
                    End If
                End If

                Dim conditionStr As String = ""
                Dim sGetPartID As String = Get_PartID()
                If (rbl_BySource.SelectedIndex = 0) Then
                    ' --- Production ID ---
                    If rbl_BySource.Enabled = True Then
                        If sGetPartID <> "" Then
                            If IsRename = False Then
                                sqlStr = "and Part_Id in(select a.Part_id, a.Memo from " + confTable + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                            Else
                                sqlStr = "and Part_Id in(select a.Part_id, a.Memo from " + confTableRename + " a LEFT JOIN MES.dbo.ProductInfo b ON a.Part_Id = b.Part_No where a.Production_Id IN(" + sGetPartID + ")) "
                            End If
                        End If
                    End If
                Else
                    ' --- Part ID ---
                    If rbl_BySource.Enabled = True Then
                        If sGetPartID <> "" Then
                            'conditionStr += "and Part_Id='" + (Me.ddlPart.SelectedValue) + "' "
                            conditionStr += "and Part_Id in(" + sGetPartID + ") "
                        End If
                    End If
                End If

                sqlStr = "select BE_Plant_Id "
                sqlStr += tableStr
                tableStr += "and BE_Plant_Id <> '' "
                sqlStr += conditionStr
                sqlStr += "group by BE_Plant_Id "
                sqlStr += "order by BE_Plant_Id desc "

                myAdapter = New SqlDataAdapter(sqlStr, conn)
                myAdapter.SelectCommand.CommandTimeout = 3600
                myDT = New DataTable
                myAdapter.Fill(myDT)
                conn.Close()

                listB_BESource.Items.Clear()
                listB_BEShow.Items.Clear()
                For i As Integer = 0 To myDT.Rows.Count - 1
                    If (myDT.Rows(i)("BE_Plant_Id").ToString().Trim() <> "") Then
                        listB_BESource.Items.Add(myDT.Rows(i)("BE_Plant_Id").ToString().Trim())
                    End If
                Next
            Catch ex As Exception
                Dim sError As String = ex.ToString()
            Finally
                If conn.State = ConnectionState.Open Then
                    conn.Close()
                End If
            End Try
        End If
    End Sub

    Protected Sub but_FERightAll_Click(sender As Object, e As System.EventArgs) Handles but_FERightAll.Click
        moveListAll(listB_FESource, listB_FEShow)

        ListBoxSort(listB_FESource, True)
        ListBoxSort(listB_FEShow, True)
    End Sub

    Protected Sub but_FERight_Click(sender As Object, e As System.EventArgs) Handles but_FERight.Click
        moveList(listB_FESource, listB_FEShow)

        ListBoxSort(listB_FESource, True)
        ListBoxSort(listB_FEShow, True)
    End Sub

    Protected Sub but_FELeft_Click(sender As Object, e As System.EventArgs) Handles but_FELeft.Click
        moveList(listB_FEShow, listB_FESource)

        ListBoxSort(listB_FESource, True)
        ListBoxSort(listB_FEShow, True)
    End Sub

    Protected Sub but_FELeftAll_Click(sender As Object, e As System.EventArgs) Handles but_FELeftAll.Click
        moveListAll(listB_FEShow, listB_FESource)

        ListBoxSort(listB_FESource, True)
        ListBoxSort(listB_FEShow, True)
    End Sub

    Protected Sub but_BERightAll_Click(sender As Object, e As System.EventArgs) Handles but_BERightAll.Click
        moveListAll(listB_BESource, listB_BEShow)

        ListBoxSort(listB_BESource, True)
        ListBoxSort(listB_BEShow, True)
    End Sub

    Protected Sub but_BERight_Click(sender As Object, e As System.EventArgs) Handles but_BERight.Click
        moveList(listB_BESource, listB_BEShow)

        ListBoxSort(listB_BESource, True)
        ListBoxSort(listB_BEShow, True)
    End Sub

    Protected Sub but_BELeft_Click(sender As Object, e As System.EventArgs) Handles but_BELeft.Click
        moveList(listB_BEShow, listB_BESource)

        ListBoxSort(listB_BESource, True)
        ListBoxSort(listB_BEShow, True)
    End Sub

    Protected Sub but_BELeftAll_Click(sender As Object, e As System.EventArgs) Handles but_BELeftAll.Click
        moveListAll(listB_BEShow, listB_BESource)

        ListBoxSort(listB_BESource, True)
        ListBoxSort(listB_BEShow, True)
    End Sub

    Private Function Get_FE() As String
        Dim oFE As New StringBuilder
        Try
            For I As Integer = 0 To listB_FEShow.Items.Count - 1
                If I = 0 Then
                    oFE.Append("'" & listB_FEShow.Items(I).Text & "'")
                Else
                    oFE.Append(",'" & listB_FEShow.Items(I).Text & "'")
                End If
            Next
        Catch ex As Exception

        End Try

        Return oFE.ToString()
    End Function

    Private Function Get_BE() As String
        Dim oBE As New StringBuilder
        Try
            For I As Integer = 0 To listB_BEShow.Items.Count - 1
                If I = 0 Then
                    oBE.Append("'" & listB_BEShow.Items(I).Text & "'")
                Else
                    oBE.Append(",'" & listB_BEShow.Items(I).Text & "'")
                End If
            Next
        Catch ex As Exception

        End Try

        Return oBE.ToString()
    End Function
End Class
